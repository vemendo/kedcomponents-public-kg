{"version":3,"sources":["webpack://[name]/webpack/bootstrap","webpack://[name]/external \"React\"","webpack://[name]/./src/utils/utils.ts","webpack://[name]/./src/globals/ked.ts","webpack://[name]/./src/globals/KED.env.ts","webpack://[name]/external \"jQuery\"","webpack://[name]/./src/globals/KED.cfg.ts","webpack://[name]/./src/utils/query-string.ts","webpack://[name]/./src/components/course-builder/utils.ts","webpack://[name]/./src/access-control/get-user-claims.ts","webpack://[name]/./src/access-control/index.ts","webpack://[name]/./src/components/course-builder/sub-components/spinner.tsx","webpack://[name]/../kedbackend/js/ked-backend-client/utils.ts","webpack://[name]/../kedbackend/js/ked-backend-client-web/bearer-storage-sessionstorage.ts","webpack://[name]/../kedbackend/js/ked-model-migrator/migrate-task.ts","webpack://[name]/../kedbackend/js/ked-model-migrator/migrate.ts","webpack://[name]/../kedbackend/js/ked-model-migrator/migrate-course.ts","webpack://[name]/../kedbackend/js/ked-model-migrator/index.ts","webpack://[name]/../kedbackend/js/ked-backend-client-web/index.ts","webpack://[name]/../kedbackend/js/ked-backend-client/restclient.ts","webpack://[name]/external \"ReactDOM\"","webpack://[name]/./src/globals/KED.ts","webpack://[name]/../kedbackend/js/ked-backend-client/ked-bearer-provider.ts","webpack://[name]/../kedbackend/js/ked-backend-client/access-control.ts","webpack://[name]/../kedbackend/js/ked-backend-client/http-error.ts","webpack://[name]/../kedbackend/js/ked-backend-client/index.ts","webpack://[name]/./src/components/utility-components/open-close-box.tsx","webpack://[name]/./src/components/utility-components/renameable-text.tsx","webpack://[name]/./src/components/course-builder/sub-components/remove-item.tsx","webpack://[name]/./src/features/features.ts","webpack://[name]/./src/repos/repo.ts","webpack://[name]/./src/global-setters/set-ked-backend-client.ts","webpack://[name]/./src/global-setters/set-bearer-providers.ts","webpack://[name]/./src/utils/error-success-feedback.tsx","webpack://[name]/./node_modules/moment/locale sync sv|en","webpack://[name]/./src/components/course-builder/courses/course-banner.tsx","webpack://[name]/./src/components/course-builder/schools/editable-school-list.tsx","webpack://[name]/./src/components/course-builder/schools/index.tsx","webpack://[name]/./src/components/course-builder/schools/edit-school.tsx","webpack://[name]/./src/components/course-builder/schools/new-school.tsx","webpack://[name]/./src/components/course-builder/subjects/uploaded-subject.tsx","webpack://[name]/./src/components/course-builder/subjects/show-subject.tsx","webpack://[name]/./src/components/course-builder/subjects/index.tsx","webpack://[name]/./src/components/course-builder/modal-pages/edit-resource.tsx","webpack://[name]/./src/components/course-builder/sub-components/editable-resource-list.tsx","webpack://[name]/./src/components/course-builder/sub-components/knowledge-matrix.tsx","webpack://[name]/./src/components/course-builder/sub-components/select-related-docs.tsx","webpack://[name]/./src/utils/cached-response.ts","webpack://[name]/./src/contracts/ked-models.ts","webpack://[name]/./src/components/utility-components/wysiwyg/wash-html.ts","webpack://[name]/./src/components/utility-components/wysiwyg/exec.ts","webpack://[name]/./src/components/utility-components/wysiwyg/actions.ts","webpack://[name]/./src/components/utility-components/wysiwyg/index.tsx","webpack://[name]/./src/components/utility-components/wysiwyg/image-edit-actions.ts","webpack://[name]/./src/components/utility-components/wysiwyg/actions-sv.ts","webpack://[name]/./src/components/course-builder/modal-pages/edit-task.tsx","webpack://[name]/./src/components/course-builder/sub-components/editable-task-list.tsx","webpack://[name]/./src/components/course-builder/courses/course-module.tsx","webpack://[name]/./src/components/course-builder/courses/course-module-list.tsx","webpack://[name]/./src/repos/school-courses.ts","webpack://[name]/./src/components/course-builder/sub-components/school-courses.tsx","webpack://[name]/./src/components/course-builder/courses/business-logic.ts","webpack://[name]/./src/components/course-builder/sub-components/editable-teacher-list.tsx","webpack://[name]/./src/components/course-builder/sub-components/weighted-items-table.tsx","webpack://[name]/./src/components/course-builder/modal-pages/edit-workflow-link.tsx","webpack://[name]/./src/components/course-builder/sub-components/editable-workflow-link.tsx","webpack://[name]/./src/components/course-builder/courses/inner-edit-course.tsx","webpack://[name]/./src/components/course-builder/courses/edit-course.tsx","webpack://[name]/./src/components/course-builder/courses/list-course-templates.tsx","webpack://[name]/./src/components/course-builder/courses/create-new.tsx","webpack://[name]/./src/components/course-builder/courses/index.tsx","webpack://[name]/./src/utils/keep-session-alive.ts","webpack://[name]/./src/components/course-builder/index.tsx","webpack://[name]/./src/elements/KEDAppCourseBuilder/app.coursebuilder.client.tsx","webpack://[name]/./src/elements/KEDAppCourseBuilder/webpack-entry.ts"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","5","exports","module","l","m","c","d","name","getter","o","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","p","jsonpArray","window","oldJsonpFunction","bind","slice","React","capitalizeFirst","str","charCodeAt","substr","toLocaleUpperCase","extend","obj","extension","keys","forEach","key","clone","getOwnPropertyNames","getOwnPropertyDescriptor","concat","flatten","a","compareProp","prop","b","aProp","bProp","compareProps","props","locales","options","Array","isArray","map","localeCompare","reduce","cmp1","cmp2","L","text","args","_i","arguments","rv","buildMessage","dateTimeReviver","exec","Date","showInfo","msg","event","CustomEvent","detail","dispatchEvent","showError","errMsg","message","console","error","maxLength","maxLen","arrayToLookup","keyAccessor","item","array","arrayToMap","cherryPickProps","propsToPick","propsToPick_1","param","distinct","KED","ked","env","__webpack_exports__","jQuery","_KED__WEBPACK_IMPORTED_MODULE_0__","cfg","parseQueryString","locationSearch","toLower","split","part","decodeURIComponent","trim","_a","toLowerCase","encodeParams","params","encodeURIComponent","join","generateQueryString","splitUrlAndQuery","urlWithPossibleQuery","pQuery","indexOf","updateDocumentGraphs","oldDoc","newDoc","table","graphs","batch","docUpdates","docId","id","navProp","foreignTable","oldList","newList","tuples","doc","idx","added_1","filter","tuple","some","meta","mutatedSubDoc","tslib__WEBPACK_IMPORTED_MODULE_0__","$meta","kedbackend_client__WEBPACK_IMPORTED_MODULE_2__","add","put","link","$set","removed_1","unlink","_b","updated_1","u","react_addons_update__WEBPACK_IMPORTED_MODULE_3___default","dtFormat","dateTime","moment__WEBPACK_IMPORTED_MODULE_1___default","format","shortDateFormat","updateModificationStamp","now","user","modifiedDate","modifiedBy","displayName","url","mail","updateCreationStamp","createdDate","createdBy","updateModificationAndCreationStamps","applyEtags","newEtags","res","etag","$etag","graphs_1","label","readBlob","blob","Promise","resolve","reject","reader","FileReader","onload","ev","target","onabort","Error","onerror","readBlobAsText","readAsText","readBlobAsDataUrl","readAsDataURL","allowCopy","e","stopPropagation","preventDefault","dataTransfer","dropEffect","updateCourseBuilderStatus","status","div","jquery__WEBPACK_IMPORTED_MODULE_4___default","className","loadCourse","client","_globals_KED_env__WEBPACK_IMPORTED_MODULE_5__","kedBackendClient","includeTemplateChain","all","include","list","hasEdgesFrom","flags","sent","course","courseTasks","templateChain","tasks","knowledgeRequirementsOrder","knowledgeRequirements","find","centralContentOrder","centralContent","cc","getUserClaims","type","school","roles","role","access_control_IMPERSONATION_QUERY_PARAMS","access_control_hasAccess","requestedRight","claims","KED_env","currentUser","fromStringArray","acl","access_control_hasWriteAccess","access_control_isTeacherAtSchool","isTeacher","belongsToSchool","access_control_impersonationEnv","actAs","currentQuery","query_string","location","search","newQuery","tslib_es6","newQueryString","href","hash","access_control_actAs","access_control_preserveImpersonationQuery","query","IMPERSONATION_QUERY_PARAMS_1","Spinner","react__WEBPACK_IMPORTED_MODULE_0__","aria-hidden","createUUID","replace","Math","random","floor","toString","avoidSimultanousCalls","method","ongoingPromise","this","then","BearerStorageSessionStorage","save","tokenInfo","sessionStorage","setItem","JSON","stringify","load","json","getItem","parse","token","expires","ex","migrateTask","task","resources","migrate_migrate","taskIds","responsibleTeachers","resourses","migrate_course_migrateCourse","__migrator_mixed_in","ked_model_migrator_KedModelMigratorMixin","ked_backend_client","ked_backend_client_web_storage","ked_backend_client_web_timeOfPageLoad","ked_backend_client_web_WebServerBearerProvider","WebServerBearerProvider","tokenPath","tokenResponseMapper","tokenId","getBearer","utils","refreshBearer","fetch","headers","Accept","redirect","cache","credentials","_e","wantsRedirect","log","reload","_c","_d","ked_backend_client_web_isomorphic","self","btoa","ked_backend_client_web_KedBackendClientWeb","_super","KedBackendClientWeb","apiBaseUrl","providerOrTokenPath","bearerProvider","x","ked_backend_client_web_extends","_utils__WEBPACK_IMPORTED_MODULE_0__","RestClient","isomorphic","baseUrl","fetchOptions","mode","authHeader","bearer","username","password","path","__assign","nocache","queryStr","Authorization","wwwauth","test","post","Content-Type","body","delete","ReactDOM","ked_bearer_provider_KedBearerProvider","KedBearerProvider","storage","clientId","clientSecret","tokenUrl","tokenQuery","restclient","retries","warn","statusText","DocumentAccess","accessClaimType","accessClaimValue","right","fromString","ac","claimType","unescape","claimValue","escape","accessComponent","toStringArray","hasAccess","userClaims","claim","HttpError","code","_this","__extends","ked_backend_client_KedBackendClient","KedBackendClient","http","getMyClaims","reqs","sort","req1","req2","op","do","scopeFn","runner","ked_backend_client_BatchRunner","mutationRequests","deleteRealm","realm","share","unshare","sourceTable","sourceId","targetTable","targetId","link2","unlink2","BatchRunner","ked_backend_client_assign","react__WEBPACK_IMPORTED_MODULE_1__","OpenCloseBox","state","headerOpen","componentWillReceiveProps","nextProps","setState","render","title","children","headerClassName","contentClassName","onClick","onOpenClose","RenameableText","editMode","runtimeStyle","readOnly","tabIndex","onFocus","rename","style","width","ref","display","clickAdvertiseText","tag","input","maxChars","jquery__WEBPACK_IMPORTED_MODULE_2___default","select","onBlur","onKeyDown","onChange","placeholder","undefined","keyCode","blur","propagateOnChange","newValue","propagatedOnChange","eager","txt","textAlign","css","fontSize","paddingTop","paddingBottom","paddingLeft","paddingRight","marginTop","marginBottom","marginLeft","marginRight","borderRadius","backgroundColor","lineHeight","fontWeight","outLine","borderStyle","height","boxSizing","focus","RemoveItem","_utils_utils__WEBPACK_IMPORTED_MODULE_2__","templateObject_1","features_Features","features","feature","EditUserTasksViaPenOnly","schoolType","schooltype","SubTasks","AssignmentTasks","testversion","Repo","comm","listPromise","items","subscribers","subscribe","subscriber","ensureHasData","unsubscribe","notifySubscribers","refreshFromServer","update","it","assign","insert","ids","_globals_KED_env__WEBPACK_IMPORTED_MODULE_0__","kedbackend_clientweb__WEBPACK_IMPORTED_MODULE_2__","_globals_KED_cfg__WEBPACK_IMPORTED_MODULE_1__","KED_API_URL","getMergedTokenPath","scopes","_utils_query_string__WEBPACK_IMPORTED_MODULE_1__","impersonationProps","_utils_utils__WEBPACK_IMPORTED_MODULE_7__","_access_control_index__WEBPACK_IMPORTED_MODULE_6__","tokenPathWithoutQuery","tokenQueryString","tokenPathQuery","getTokenId","mergedTokenPath","userEmail","createTestTokenProvider","kedbackend_client__WEBPACK_IMPORTED_MODULE_3__","_globals_KED_cfg__WEBPACK_IMPORTED_MODULE_4__","KED_CLIENT_ID","KED_CLIENT_SECRET","email","storedSessionUser","initialUserEmail","KED_TOKEN_PATH","responseText","ok","saveUserInfo","createBearerProvider","googleMergedPath","googleTokenProvider","createGoogleTokenProvider","KED_TOKEN_URL","ErrorSuccessFeedback","info","_unhandledRejection","_error","_customError","_onInfo","componentDidMount","addEventListener","componentWillUnmount","removeEventListener","reason","_utils__WEBPACK_IMPORTED_MODULE_2__","setTimeout","templateObject_2","position","left","top","pointerEvents","margin","./en-au","./en-au.js","./en-ca","./en-ca.js","./en-gb","./en-gb.js","./en-ie","./en-ie.js","./en-nz","./en-nz.js","./sv","./sv.js","webpackContext","req","webpackContextResolve","course_banner_AdminMenuItems","course_banner_templateObject_1","route","course_banner_templateObject_2","course_banner_NonAdminMenuItems","course_banner_templateObject_3","course_banner_templateObject_4","external_React_","course_banner_setCourseImage","origCourse","host","imageId","images","course_banner_CourseBanner","isTemplate","backgroundImage","activePage","isAdmin","menuItems","onDragOver","course_builder_utils","onDrop","files","from","file","size","course_banner_templateObject_5","match","getAsString","course_banner_templateObject_6","course_banner_onDropImage","isActive","callback","callbacks","givenRoute","routes","defaultRoute","es","to","editable_school_list_EditableSchoolList","schools","viewCourseUrl","cursor","access_control","spinner","schools_Schools","Schools","catch","err","outline","feedback","feedbackUrl","edit_school_EditSchool","EditSchool","origSchool","deleteSchool","confirm","edit_school_templateObject_1","editExisting","autoFocus","disabled","edit_school_templateObject_2","new_school_NewSchool","uploaded_subject_UploadedSubject","UploadedSubject","coursesElems","centralContentElems","knowledgeRequirementElems","showFullText","changes","isWorking","isImporting","addClassesForCherryPickedElements","diffWithExisting","abilities","external_jQuery_default","purposeElem","first","parent","addClass","centralContents","cherryPickData","skolSubject","html","courses","courseCode","elem","points","gradeStep","ct","createTime","subjectToImport","existingSubjects","existingSubject","courseTemplates","expandedCourseTemplates","courseTemplate","xmlCourse","xmlKR","kr","derivedCourses","subjectCode","change","content","description","mutations","derivedCourses_1","expandedCourseTemplates_1","newSubject_1","publishable","subjectAbilities","newAbility","newCourse","tags","subjectId","newCentralContent","cr","newKnowledgeRequirement","subjectAbilities_1","cancel","onCancel","import","allMutations","mut","onImportSuccess","fixL","uploaded_subject_templateObject_1","colSpan","dangerouslySetInnerHTML","__html","uploaded_subject_templateObject_2","uploaded_subject_templateObject_3","purpose","knownledgeRequirements","show_subject_ShowSubject","ShowSubject","subject","componentWillMount","subjects_Subjects","Subjects","isListingSubjects","subjects","uploadedSubject","handleFileSelect","xml","parseXML","model","parseInt","subjects_templateObject_1","subjects_templateObject_2","subjects_templateObject_3","edit_resource_EditResource","EditResource","resource","valid_url_default","isUri","edit_resource_templateObject_1","onSave","onDelete","isValidUrl","editable_resource_list_EditableResourceList","EditableResourceList","onUpdate","openDialog","Component","editedResource","updatedResource","$splice","closeDialog","newResource","$push","knowledge_matrix_KnowledgeMatrix","KnowledgeMatrix","markedIds","idsToMarkNotOk","markMode","onMarkChanged","columns","rows","row","grade","pNext","findIndex","toUpperCase","every","requirement","isMarkedOK","isMarkedNotOK","select_related_docs_SelectRelatedDocs","SelectRelatedDocs","open_close_box","option","isMarked","CachedResponse","queryer","promise","reset","futureAbilities","parser","DOMParser","HTML_WASH_POLICY","strike","pre","h1","h2","h3","h4","h5","img","src","class","tabindex","ul","ol","li","hr","br","span","border","tbody","thead","tfoot","tr","td","colspan","rowspan","th","abbr","scope","sorted","washHtml","parseFromString","childNodes","modified","washNode","innerHTML","node","tagName","isElement","element","policy","washChildNodes","parentNode","insertBefore","remove","removeMiddleElement","attributes","attr","allowed","removeAttribute","washElement","command","document","execCommand","actions","bold","icon","italic","underline","strikethrough","heading1","heading2","heading3","paragraph","quote","olist","ulist","line","prompt","image","wysiwyg_classes","wysiwyg_Wysiwyg","Wysiwyg","focusRect","onMouseDown","onMouseMove","onMouseUp","contentDiv","querySelectorAll","onfocus","onblur","componentDidUpdate","shouldComponentUpdate","nextState","triggerOnChange","newState","wysiwyg_getRelatativeClientRect","parentElement","focusElem","relatedTarget","focusRectDiv","makeClickable","corner","getRectCorner","resizeStartX","clientX","getBoundingClientRect","newWidth","max","endsWith","factor","newHeight","execImageEditAction","cmd","cssFloat","cb","defaultActions","actionsToUse","action","contentEditable","onInput","which","removeChild","bottom","child","parentRect","childRect","scrollTop","scrollLeft","actions_sv","component","sel","range","createElement","getSelection","rangeCount","getRangeAt","collapse","insertNode","setStartAfter","removeAllRanges","addRange","edit_task_EditTask","EditTask","src_features","writeAccess","edit_task_templateObject_1","edit_task_templateObject_2","searchMode","edit_task_templateObject_3","edit_task_templateObject_4","futureAbilitiesOpen","taskCustomization","searchMarkedIds","searchResult","isSearching","searchResponse","setStatePromised","updateSearchResult","err_1","updateSearchMarkedIds","setStatePromise","previewTaskContent","allTasksForSubject","t","ability","knowledgeRequirement","collectionProp","updatedCollection","updatedTask","edit_task_templateObject_5","edit_task_templateObject_6","onReplace","edit_task_templateObject_7","onSaveCustomization","copyTask","taskCopy","edit_task_templateObject_8","getTaskProp","taskProp","customization","updateTaskOrCustomization","updates","newCustomization","react_addons_update_default","newTask","idsNotCoveredByAnyTask","fa","selected","foundTask","external_ReactDOM_","react_datepicker_es","moment_default","dateFormat","locale","popperPlacement","learningGoal","resourceUpdates","editable_task_list_EditableTaskList","EditableTaskList","openTaskDialog","taskCustomizations","onTaskUpdated","onTaskAdded","onTaskCustomizationUpdated","onTaskDeleted","onTaskReplaced","taskId","canUpdateTask","choosenTask","course_module_CourseModuleComponent","CourseModuleComponent","editMandatoryContent","getModuleIndex","getModuleOrderIndex","getOrderedModules","updateModule","moduleUpdates","updatedModule","moduleIndex","courseUpdates","customizations","course_module_templateObject_1","taskIndex","onTaskCustomized","tid","$apply","copy","idxTask","course_module_templateObject_2","moduleOrderedIndex","week","startWeekOptions","endWeekOptions","renameable_text","newName","startWeek","endWeek","mandatoryContent","resourcesUpdates","onReorder","remove_item","course_module_templateObject_3","course_module_list_CourseModuleList","CourseModuleList","_moduleRefs","addModule","moduleOrder","reorder","direction","orderedModules","newModuleIndex","currentModuleAtPosition","origScrollPos","documentElement","elemModule","scrollTo","scrollIntoView","behavior","block","_elem","school_courses_mySchoolCoursesRepo","SchoolCoursesRepo","getSchoolName","schoolName","_schoolId","school_courses_templateObject_1","getSchoolId","school_courses_SchoolCourses","SchoolCourses","schoolCourses","onSchoolCoursesUpdated","compareName","compareCreatedDate","active","fontStyle","scroll","business_logic_getUncoveredKnowledgeRequirements","uncoveredRequirements","editable_teacher_list_EditableTeacherList","EditableTeacherList","addEmtpyRow","teachers","teacher","nameElem","shiftKey","weighted_items_table_WeightedItemsTable","WeightedItemsTable","isOpen","tasksPerId","business_logic_getTasksPerId","futureAbilityText","edit_workflow_link_EditWorkflowLink","EditWorkflowLink","edit_workflow_link_templateObject_1","editable_workflow_link_EditableWorkFlowLink","EditableWorkFlowLink","newUrl","inner_edit_course_InnerEditCourse","InnerEditCourse","changeImageUrl","setImageUrl","imageUrl","uncoveredKnowledgeRequirements","uncoveredIds","business_logic_getIdsNotCoveredByTasks","sanityCheckWarnings","business_logic_templateObject_1","hasDuplicateTasks","taskUrls","business_logic_templateObject_2","tasksWithSameUrl","business_logic_templateObject_3","hasEmptyModuleNames","moduleNames","business_logic_templateObject_4","hasDuplicateModuleNames","business_logic_sanityCheck","courseImage","courseImageIsUploaded","startsWith","runUpText","newHtml","workFlowLink","googleClassRoomURL","googleClassRoomCode","teachersUpdate","assignmentEmails","activatedDate","activatedBy","inactivatedBy","inactivatedDate","warning","inner_edit_course_templateObject_1","deleteCourse","history","go","inactivateAndSave","activateAndSave","edit_course_catcher","ENVIRONMENT","edit_course_CONFIRM_NAVIGATE_MESSAGE","edit_course_templateObject_1","edit_course_DEFAULT_STATE","origTemplate","dialogContainers","hasUnsavedData","view","edit_course_EditCourse","EditCourse","refDialog","contentYPos","beforeUnload","onClickPreventUnload","isSaving","dialogs","_setState","setNonSaveableDataState","usedTaskIds_1","filteredCourseTasks","modifiedCourse","allCourses","idxOurCourse","templateId","prevProps","prevState","loadFromTemplate","template","parentId","mySchool","loadExistingCourse","edit_course_templateObject_2","courseId","courseSchool","hasEdgesTo","children_1","_save","errorMessage","edit_course_templateObject_3","edit_course_templateObject_4","edit_course_templateObject_5","edit_course_templateObject_6","doesAllTasksCoverAllRequirements","edit_course_templateObject_7","orig","newCourseTasks","origTask","schoolId","edit_course_templateObject_8","edit_course_templateObject_9","dialogContainer","pop","dialog","index","ctrlKey","metaKey","saveDialog","targetElem","returnValue","getAttribute","studentPage","list_course_templates_ListCourseTemplates","list_course_templates_templateObject_1","selectedCourseId","create_new_CreateNewCourse","Courses","standardCourses","c1","c2","courses_templateObject_1","CreateNewCourse","courseOptions","selectedTemplateId","onSelectCourse","descriptionOrAuthor","kedStandardOptions","teacherMade","create_new_templateObject_1","keep_session_alive_HEARTBEAT_INTERVAL","keep_session_alive_HEARTBEAT_URL","keep_session_alive_lastActivity","keep_session_alive_onUserActive","keep_session_alive_onTimeout","keep_session_alive_heartbeat","setInterval","mousemove","keypress","course_builder_CourseBuilder","CourseBuilder","isAuthorized","exact","course_builder_templateObject_1","error_success_feedback","app_coursebuilder_client_bearerPromise","app_coursebuilder_client_KEDAppCourseBuilder","KEDAppCourseBuilder","isTokenLoaded","course_builder","components","app_coursebuilder_client_namespaceObject"],"mappings":"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","file":"kedappcoursebuilder.min.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \tvar installedChunks = {\n \t\t5: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp_name_\"] = window[\"webpackJsonp_name_\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([86,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","module.exports = React;","\nexport function capitalizeFirst (str) {\n    for (let i=0, l=str.length; i<l; ++i) {\n        if (str.charCodeAt(i) < 0x2000) {\n            return str.substr(0, i) + str[i].toLocaleUpperCase() + str.substr(i + 1);\n        }\n    }\n    return str;\n}\n\nexport function extend(obj, extension) {\n    if (typeof extension !== 'object') return obj;\n    Object.keys(extension).forEach(key => {\n        obj[key] = extension[key];\n    });\n    return obj;\n}\n\nexport function clone<T,E> (obj : T, extension?: E) {\n    let clone = {};\n    Object.getOwnPropertyNames(obj).forEach(key => {\n        Object.defineProperty(clone, key, Object.getOwnPropertyDescriptor(obj, key));\n    });\n    if (extension) extend(clone, extension);\n    return clone as (T & E);\n}\n\nconst concat = [].concat;\nexport function flatten<T> (a : (T | T[])[]) {\n    return concat.apply([], a) as T[];\n}\n\nexport function compareProp(prop:string) {\n    return (a,b) => {\n        const aProp = a[prop], bProp = b[prop];\n        return aProp > bProp ? 1 : aProp < bProp ? -1 : 0;\n    }\n}\n\nexport function compareProps(props: string | string[], locales?: string | string[], options?: Intl.CollatorOptions) {\n    props = Array.isArray(props) ? props : [props];\n\n    const localeCompare = (a,b) =>\n        typeof a === 'string' ?\n            a.localeCompare(b, locales, options) :\n            a < b ? -1 : a > b ? 1 : 0;\n\n    return props\n        .map(prop => (a,b) => localeCompare(a[prop], b[prop]))\n        .reduce((cmp1, cmp2) =>\n            (a,b) => cmp1(a,b) || cmp2(a,b));\n}\n\nexport function L(text, ...args) {\n    let first = text[0];\n    return buildMessage(text, args);\n}\n\nfunction buildMessage (text, args) {\n    let rv = text[0];\n    for (let i=1, l=text.length; i<l; ++i) {\n        rv += args[i-1] + text[i];\n    }\n    return rv;\n}\n\nexport class TC<T> {\n    constructor(template: T) {\n        extend(this, template);\n    }\n}\n\nexport function dateTimeReviver (key, value) {\n    var a;\n    if (typeof value === 'string') {\n        a = /\\/Date\\((\\d*)\\)\\//.exec(value);\n        if (a) {\n            return new Date(+a[1]);\n        }\n    }\n    return value;\n}\n\nexport function showInfo (msg) {\n    var event = new CustomEvent('info', { 'detail': msg });\n    window.dispatchEvent(event);\n}\n\nexport function showError (errMsg: string | Error) {\n    const msg = typeof errMsg === 'string' ? errMsg : errMsg.message;\n    var event = new CustomEvent('customerror', { 'detail': msg });\n    console.error(errMsg);\n    window.dispatchEvent(event);\n}\n\nexport function maxLength(str: string, maxLen: number) {\n    return str.length > maxLen ?\n        str.substr(0, maxLen - 3) + \"...\" :\n        str;\n}\n\nexport function arrayToLookup<T>(a: T[], keyAccessor: (item: T) => string | number) {\n    const result : {[key: string] : T[]} = {};\n    for (let i=0, l=a.length; i<l; ++i) {\n        const item = a[i];\n        const key = keyAccessor(item);\n        let array = result[key];\n        if (array) array.push(item);\n        else result[key] = [item];\n    }\n    return result;\n}\n\nexport function arrayToMap<T>(a: T[], keyAccessor: (item: T) => string | number) {\n    const result : {[key: string] : T} = {};\n    for (let i=0, l=a.length; i<l; ++i) {\n        const item = a[i];\n        const key = keyAccessor(item);\n        result[key] = item;\n    }\n    return result;\n}\n\nexport function cherryPickProps<T> (obj: T, propsToPick: string[]): Partial<T> {\n    const result = {};\n    for (const param of propsToPick) {\n      if (param in obj) result[param] = obj[param];\n    }\n    return result as Partial<T>;\n}\n\nexport function distinct<T> (a: T[], keyAccessor: (item: T) => any) {\n    const map = arrayToMap(a, keyAccessor);\n    return Object.keys(map).map(key => map[key]);\n}\n","\nexport const KED_NAMESPACE = \"KED\";\n\ndeclare var KED: any;\n\nvar result = typeof KED === 'undefined' ? {} : KED;\n\nif (typeof window !== 'undefined' && typeof KED === 'undefined') {\n    window[KED_NAMESPACE] = result;\n}\n\nexport default result;\n","import {User, LearningModuleTasks} from '../contracts/ked-models';\nimport { KedBackendClient, BearerProvider } from 'kedbackend/client';\nimport {UserTask} from 'kedbackend/models';\nimport {KedRepo} from '../repos/ked-repo';\nimport {EdsClient} from '../apis/edsclient';\nimport KED from './ked';\n\nexport interface Env {\n    currentUser?: User;\n    learningModuleTasks?: LearningModuleTasks;\n    bearerProvider?: BearerProvider;\n    googleTokenProvider?: BearerProvider;\n    kedBackendClient?: KedBackendClient;\n    edsClient?: EdsClient;\n    userTasksRepo?;\n    hiddenCoursesRepo?;\n}\n\nif (!KED.env) KED.env = {};\n\nexport default KED.env as Env;\n","module.exports = jQuery;","import KED from './KED';\n\n/* This default configuration is used as a fallback.\nNormally both test pages and production pages will override these configrations\n*/\n/*const defaultConfiguration = {\n  // Environment\n  ENVIRONMENT: 'development' as 'production' | 'development' | 'test',\n  // Authentication Server:\n  KED_TOKEN_URL: 'https://kedauthtest.azurewebsites.net/token',\n  KED_TOKEN_PATH: '/api/token.Skript.portlet?sv.contenttype=application/json',\n  KED_CLIENT_ID: 'devclient',\n  KED_CLIENT_SECRET: '4fRdfQpWtJqjTWf',\n  // Services:\n  KED_API_URL: 'https://kedbackendtest.azurewebsites.net/api/',  \n  EDS_API_URL: 'https://edsportalowinapi.azurewebsites.net/api/'\n}*/\n\nexport interface IKedConfiguration {\n  ENVIRONMENT: 'production' | 'development' | 'test';\n  KED_TOKEN_URL: string;\n  KED_TOKEN_PATH: string;\n  KED_CLIENT_ID: string;\n  KED_CLIENT_SECRET: string;\n  KED_API_URL: string;\n  EDS_API_URL: string;\n};\n\nif (!KED.cfg) KED.cfg = {};\n\nexport default KED.cfg as IKedConfiguration;\n","export interface ParseQueryStringOptions {\n  toLower?: boolean;\n}\n\nexport function parseQueryString(locationSearch: string, options?: ParseQueryStringOptions): { [key: string]: string } {\n  const {toLower} = (options ||{}) as ParseQueryStringOptions;\n  const result = {};\n  if (locationSearch && locationSearch.length > 1)\n    locationSearch.substr(1)\n      .split('&')\n      .map(part => part.split('=').map(s => decodeURIComponent(s.trim())))\n      .forEach(([key, value]) => result[toLower ? key.toLowerCase() : key] = value);\n  return result;\n}\n\nfunction encodeParams(params: {[key: string]:string}) {\n  return Object.keys(params).map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`).join('&');\n}\n\nexport function generateQueryString(params: {[key: string]:string}) {\n  return \"?\" + encodeParams(params);\n}\n\nexport function parseHashQueryString(locationHash: string, options?: ParseQueryStringOptions) {\n  return parseQueryString(locationHash, options);\n}\n\nexport function generateHashQueryString(params: {[key: string]:string}) {\n  return \"#\" + encodeParams(params);\n}\n\nexport function splitUrlAndQuery (urlWithPossibleQuery: string) {\n  const pQuery = urlWithPossibleQuery.indexOf('?');\n  return pQuery >= 0 ?\n    [urlWithPossibleQuery.substr(0, pQuery), urlWithPossibleQuery.substr(pQuery)] :\n    [urlWithPossibleQuery, \"\"];\n}\n","import moment from 'moment';\nimport { L } from '../../utils/utils';\nimport { Document, Resource, ModificationTracked, Course, Task } from 'kedbackend/models';\nimport { BatchRunner, createUUID } from 'kedbackend/client';\nimport update from 'react-addons-update';\nimport { User } from '../../contracts/ked-models';\nimport $ from 'jquery';\nimport env from '../../globals/KED.env';\n\nexport function updateDocumentGraphs(oldDoc, newDoc, table: string, graphs: { [label: string]: string }, batch: BatchRunner) {\n  const docUpdates = {};\n  const docId = newDoc.id;\n  for (let navProp of Object.keys(graphs)) {\n    const foreignTable = graphs[navProp];\n    const oldList: Document[] = oldDoc[navProp] || [];\n    const newList: Document[] = newDoc[navProp];\n    if (!newList) continue;\n    const tuples = newList\n      .map((doc, idx)=>({doc, idx})); // Create tubles of {doc, array-index} so we can update result\n    const added = tuples.filter(tuple => !oldList.some(o => o.id === tuple.doc.id)); // Find added items\n\n    for (let a of added) {\n      const mutatedSubDoc = {...a.doc};\n      const meta = mutatedSubDoc.$meta;\n      delete mutatedSubDoc.$meta; // Delete $meta so that \"add\" or \"update\" does not persiste to next state.\n      if (meta === 'add') {\n        if (!mutatedSubDoc.id) mutatedSubDoc.id = createUUID(); // Generate ID if not done yet.\n        // Now put an 'add' mutation in the batch queue.\n        batch.add(foreignTable, mutatedSubDoc);\n      } else if (meta === 'update') {\n        batch.put(foreignTable, mutatedSubDoc);\n      }\n      batch.link(table, docId, foreignTable, mutatedSubDoc.id, navProp);\n\n      // Update result so that state is reflected after succesful POST to server.\n      if (!docUpdates[navProp]) docUpdates[navProp] = {};\n      docUpdates[navProp][a.idx] = {$set: mutatedSubDoc};\n    }\n    const removed = oldList.filter(o => !newList.some(n => n.id === o.id));\n    for (let r of removed) {\n      batch.unlink(table, docId, foreignTable, r.id, navProp);\n    }\n    const updated = tuples.filter(tuple => oldList.some(o => o.id === tuple.doc.id && tuple.doc.$meta === 'update'));\n    for (let u of updated) {\n      const mutatedSubDoc = {...u.doc};\n      delete mutatedSubDoc.$meta;\n      batch.put(foreignTable, mutatedSubDoc);\n\n      // Update result so that $meta is removed from navigation prop after successful POST to server.\n      if (!docUpdates[navProp]) docUpdates[navProp] = {};\n      docUpdates[navProp][u.idx] = {$set: mutatedSubDoc};\n    }\n  }\n  return update(newDoc, docUpdates);\n}\n\nexport function dtFormat(dateTime: number | Date | moment.Moment) {\n  return moment(dateTime).format('YYMMDD HH:mm');\n}\n\nexport function shortDateFormat(dateTime: number | Date | moment.Moment) {\n  return moment(dateTime).format('YYMMDD');\n}\n\nexport function updateModificationStamp (now: number, obj: ModificationTracked, user: User) {\n  return update(obj, {\n    dateTime: {$set: now}, // For queries...\n    modifiedDate: {$set: now},\n    modifiedBy: {\n      $set: {\n        name: user.displayName,\n        url: \"mailto:\" + user.mail\n      }\n    }\n  });\n}\n\nexport function updateCreationStamp (now: number, obj: ModificationTracked, user: User) {\n  return update(obj, {\n    createdDate: {$set: Date.now()},\n    createdBy: {\n      $set: {\n        name: user.displayName,\n        url: \"mailto:\" + user.mail\n      }\n    }\n  });\n}\n\nexport function updateModificationAndCreationStamps(obj: ModificationTracked, user: User) {\n  const now = Date.now();\n  obj = updateModificationStamp(now, obj, user);\n  if (!obj.createdBy) obj = updateCreationStamp(now, obj, user);\n  return obj;\n}\n\nexport function applyEtags(doc: Document, newEtags: {[id: string]: string}, graphs: string[]) {\n  const res = {...doc};\n  const etag = newEtags[doc.id];\n  if (etag)\n    res.$etag = etag;\n  for (let label of graphs) {\n    const newList = doc[label].map(d => applyEtags(d, newEtags, []));\n    res[label] = newList;\n  }\n  return res;\n}\n\nexport function readBlob(blob: Blob, m: (r:FileReader)=>void) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = ev => resolve((ev.target as any).result);\n    reader.onabort = ev => reject(new Error(\"file read aborted\"));\n    reader.onerror = ev => reject((ev.target as any).error);\n    m(reader);\n  });\n}\n\nexport function readBlobAsText (blob: Blob) {\n  return readBlob(blob, r=>r.readAsText(blob));\n}\n\nexport function readBlobAsDataUrl (blob: Blob) {\n  return readBlob(blob, r=>r.readAsDataURL(blob));\n}\n\nexport function allowCopy(e: React.DragEvent<HTMLDivElement>) {\n  e.stopPropagation();\n  e.preventDefault();\n  e.dataTransfer.dropEffect = 'copy';\n}\n\nexport function updateCourseBuilderStatus(status: 'unsaved' | 'saved' | 'error' | '') {\n  const div = $('div.course-builder')[0];\n  if (div) div.className = \"course-builder\" + (status ? \" status \" + status : \"\");\n}\n\nexport async function loadCourse(id: string, options?: {\n    includeTemplateChain?: boolean\n  }): Promise<Course>\n{\n  const client = env.kedBackendClient;\n  const includeTemplateChain = options && options.includeTemplateChain;\n  const [course, courseTasks, templateChain] = (await Promise.all([\n    client.get(\"courses\", id, {\n      include: [\n        \"centralContent\",\n        \"knowledgeRequirements\",\n        \"abilities\",\n        \"images\",\n        \"acl\" // Don't include tasks here...\n      ]\n    }),\n    // ... but include tasks here instead so that we can load the graphs for the\n    // tasks as well!\n    client.list(\"tasks\", {\n      hasEdgesFrom: id,\n      include: ['knowledgeRequirements', 'centralContent', 'abilities', 'acl'],\n      flags: ['includeIdsOnly'] // Don't need redundant info that's already on course\n    }),\n    includeTemplateChain && client.list(\"courses\", {\n      hasEdgesFrom: id,\n      flags: ['idsOnly']\n    })\n  ])) as [Course, Task[], Course[]];\n  course.tasks = courseTasks;\n\n  // Correct the order of KnowledgeRequirements\n  if (course.knowledgeRequirementsOrder) {\n    course.knowledgeRequirements = course.knowledgeRequirementsOrder.map(id =>\n      course.knowledgeRequirements.find(c => c.id === id));\n  }\n\n  // Correct the order of CentralContent\n  if (course.centralContentOrder) {\n    course.centralContent = course.centralContentOrder.map(id =>\n      course.centralContent.find(cc => cc.id === id));\n  }\n  \n  // Include template chain if requested.\n  if (includeTemplateChain) course.templateChain = templateChain;\n  return course;\n}\n\n","import { User } from \"../contracts/ked-models\";\n\nexport default function getUserClaims (user: User) {\n  return [{\n    type: \"email\",\n    value: user.mail\n  },{\n    type: \"school\",\n    value: user.school\n  }].concat(user.roles.map(role => ({\n    type: \"role\",\n    value: role\n  }))).concat(user.roles.map(role => ({\n    type: \"schoolRole\",\n    value: user.school + \"/\" + role\n  })));\n}\n","import { AccessClaim, DocumentAccess, hasAccess as _hasAccess, AccessRight } from 'kedbackend/client';\nimport { Document } from 'kedbackend/models';\nimport getUserClaims from './get-user-claims';\nimport env from '../globals/KED.env';\nimport { parseQueryString, generateQueryString } from \"../utils/query-string\";\nexport { getUserClaims };\n\nexport const IMPERSONATION_QUERY_PARAMS = [\"user\",\"role\",\"school\",\"debug\",\"testVersion\",\"testversion\",\"schoolType\",\"schooltype\"];\n\nexport function hasAccess(doc: Document, requestedRight: AccessRight) {\n  var claims = getUserClaims(env.currentUser);\n  var result = _hasAccess(DocumentAccess.fromStringArray(doc.acl || []), claims, requestedRight);\n  //console.log(`Has ${requestedRight} access to ${doc.name}/${doc.id}: ${result}`);\n  return result;\n}\n\nexport function hasReadAccess(doc: Document) {\n  return hasAccess(doc, 'R');\n}\n\nexport function hasWriteAccess(doc: Document) {\n  return hasAccess(doc, 'W');\n}\n\nexport function hasShareAccess(doc: Document) {\n  return hasAccess(doc, 'S');\n}\n\nexport function isTeacherAtSchool(school: string) {\n  const isTeacher = env.currentUser.roles.some(role => role === 'EMPLOYEE' || role === 'ADMIN');\n  const belongsToSchool = (school||\"\").toLowerCase() === env.currentUser.school.toLowerCase();\n  return (isTeacher && belongsToSchool);\n}\n\nexport const impersonationEnv = {\n  actAs (options: {role, school, url?}) {\n    const {role, school, url} = options;\n    const currentQuery = parseQueryString(location.search);\n    const newQuery = {...currentQuery, role, school};\n    const newQueryString = generateQueryString(newQuery);\n    if (url) {\n      location.href = `${url}${newQueryString}`;\n    } else {\n      location.hash = \"#\";\n      location.search = newQueryString;\n    }\n  }\n}\n\nexport function actAs(options: {role, school, url?}) {\n  impersonationEnv.actAs(options);\n}\n\nexport function preserveImpersonationQuery (url: string, query: {[name: string] : string}) {\n  const currentQuery = parseQueryString(location.search);\n  const newQuery = {...query};\n  for (const param of IMPERSONATION_QUERY_PARAMS) {\n    if (currentQuery[param]) newQuery[param] = currentQuery[param];\n  }\n  const newQueryString = generateQueryString(newQuery);\n  return `${url}${newQueryString}`;\n}\n","import * as React from 'react';\n\nexport const Spinner = ()=> <span><i className=\"fa fa-spinner fa-spin\" aria-hidden=\"true\"></i>&nbsp;</span>;\n","\nexport function createUUID() {\n  // Decent solution from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\n  var d = Date.now();\n  var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\n    var r = (d + Math.random() * 16) % 16 | 0;\n    d = Math.floor(d / 16);\n    return (c === 'x' ? r : (r & 0x7 | 0x8)).toString(16);\n  });\n  return uuid;\n}\n\nexport function avoidSimultanousCalls<T,A>(method: (...args:A[])=>Promise<T>) : (...args:A[])=>Promise<T> {\n  let ongoingPromise: Promise<T> = null;\n  return function() {\n      if (!ongoingPromise) {\n          ongoingPromise = method.apply(this, arguments).then(result=>{\n              ongoingPromise = null;\n              return result;\n          });\n      }\n      return ongoingPromise;\n  }\n}\n","import {BearerPersistentStorage, BearerTokenInfo} from '../ked-backend-client';\n\nexport class BearerStorageSessionStorage implements BearerPersistentStorage {\n    save(id: string, tokenInfo: BearerTokenInfo) {\n        sessionStorage.setItem(\"bearer-\" + id, JSON.stringify(tokenInfo));\n    }\n\n    load(id: string): Promise<BearerTokenInfo> {\n        try {\n            const json = sessionStorage.getItem(\"bearer-\" + id);\n            return Promise.resolve(json ? JSON.parse(json) : {token: null, expires: 0});\n        } catch (ex) {\n            return Promise.resolve({token: null, expires: 0});\n        }\n    }\n}\n","import { Task } from '../../KED.Backend.API/schema';\n\nexport default function migrateTask(task: Task) {\n    if (!task.resources) task.resources = [];\n}\n","import * as model from '../../KED.Backend.API/schema';\nimport migrateCourse from './migrate-course';\nimport migrateTask from './migrate-task';\n\nexport default function migrate(doc, table: string, graphs?: string[]) {\n  switch (table) {\n    case \"courses\":\n      migrateCourse(doc, graphs);\n      break;\n    case \"tasks\":\n      migrateTask(doc);\n      break;\n  }\n}\n","import { Course } from '../../KED.Backend.API/schema';\nimport migrateTask from './migrate-task';\n\nexport default function migrateCourse(course: Course, graphs?: string[]) {\n  if (!course.modules) course.modules = [];\n  course.modules.forEach(module => {\n    if (!module.resources) {\n      module.resources = [];\n    }\n    if (!module.taskIds) {\n      module.taskIds = [];\n    }\n  });\n\n  if (!course.responsibleTeachers) {\n    course.responsibleTeachers = []\n  }\n\n  // Earlier wrong spelling of resources\n  if ('resourses' in (course as any) && !('resources' in (course as any))) {\n    course.resources = (course as any).resourses;\n    delete (course as any).resourses;\n  }\n  if (!course.resources) {\n    course.resources = [];\n  }\n\n  if (graphs) {\n    graphs.forEach(label => {\n      switch (label) {\n        case 'tasks':\n          course.tasks.forEach(task => migrateTask(task));\n          break;\n      }\n    });\n  }\n}\n","import { KedBackendClient } from '../ked-backend-client';\nimport migrate from './migrate';\n\nexport const KedModelMigratorMixin = (client: KedBackendClient) => {\n    if ((client as any).__migrator_mixed_in) return;\n    (client as any).__migrator_mixed_in = true;\n    \n    const get = client.get;\n    const list = client.list;\n\n    client.get = function (table, id, options) {\n        const include = options && options.include;\n        return get.apply(this, arguments).then(result => {\n            migrate(result, table, include && include.toString().split(','));\n            return result;\n        });\n    }\n\n    client.list = function (table, options) {\n        const include = options && options.include;\n        return list.apply(this, arguments).then(result => {\n            result.forEach(doc => migrate(doc, table, include && include.toString().split(',')));\n            return result;\n        });\n    }\n\n    return client;\n}\n\n","import { KedBackendClient, BearerProvider, BearerTokenInfo, IsomorphicEnv } from '../ked-backend-client';\nimport { BearerStorageSessionStorage } from \"./bearer-storage-sessionstorage\";\nimport { avoidSimultanousCalls } from '../ked-backend-client/utils';\nimport { KedModelMigratorMixin } from '../ked-model-migrator';\nKedModelMigratorMixin(KedBackendClient.prototype);\n\nexport const storage = new BearerStorageSessionStorage();\n\nconst timeOfPageLoad = Date.now();\n\nexport class WebServerBearerProvider implements BearerProvider {\n    tokenInfo: BearerTokenInfo;\n    wantsRedirect: boolean;\n\n    constructor (\n        public tokenPath: string,\n        public tokenResponseMapper: (responseText: string) => BearerTokenInfo,\n        public tokenId: string)\n    {\n        this.tokenInfo = {token: null, expires: 0};\n        this.getBearer = avoidSimultanousCalls(this.getBearer.bind(this));\n        this.refreshBearer = avoidSimultanousCalls(this.refreshBearer.bind(this));\n    }\n\n    async getBearer() {\n        if (!this.tokenInfo.token) {\n            if (this.tokenId) this.tokenInfo = await storage.load(this.tokenId);\n        }\n        if (this.tokenInfo.expires < Date.now()) {\n            await this.refreshBearer();\n        }\n        return this.tokenInfo;\n    }\n\n    async refreshBearer() {\n        const res = await fetch(this.tokenPath, {\n            headers: {Accept: \"text/plain; application/json\"},\n            redirect: 'manual',\n            cache: 'no-cache',\n            credentials: \"same-origin\"\n        });\n        if (res.status === 302 || (!res.status && res.type === \"opaqueredirect\")) {\n            // User session timed out and server wants to redirect entire page to login page\n            // Time to reload current page to force a redirect of the entire page instead for\n            // just redirecting to /api/token or whatever.\n            if (Date.now() - timeOfPageLoad > 60000) {// prohibit endless loop of reloading self.\n                this.wantsRedirect = true; // So that listeners to onbeforeunload could show alternate message.\n                console.log(\"Redirect wanted. Reload page.\")\n                window.location.reload(true);\n            }\n        }\n        if (res.status != 200) throw new Error(\"HTTP\"+res.status + \" \" + await res.text());\n        this.tokenInfo = this.tokenResponseMapper(await res.text());\n        storage.save(this.tokenId, this.tokenInfo);\n        return this.tokenInfo;\n    }\n}\n\nexport const isomorphic = {fetch: fetch.bind(self), btoa: btoa.bind(self)};\n\nexport class KedBackendClientWeb extends KedBackendClient {\n    constructor(\n        apiBaseUrl: string,\n        providerOrTokenPath: string | BearerProvider,\n        options?: {\n            tokenResponseMapper?: (responseText: string) => BearerTokenInfo,\n            tokenId?: string\n        })\n    {\n        const bearerProvider = typeof providerOrTokenPath !== 'string' ?\n            providerOrTokenPath :\n            new WebServerBearerProvider(\n                providerOrTokenPath,\n                (options && options.tokenResponseMapper) || (x=>({token: x, expires: Date.now() + 59 * 60 * 60})),\n                options && options.tokenId);\n        super(isomorphic, bearerProvider, apiBaseUrl);\n    }\n}\n","/*\ndeclare var Buffer; // node built-in\n\n\nfunction basicAuthHeader(username, password) {\n    return \"Basic \" + new Buffer(username + \":\" + password).toString(\"base64\");\n}\n*/\n\nimport {IsomorphicEnv} from './isomorphic-env';\nimport { createUUID } from \"./utils\";\n\nexport interface BearerTokenInfo {\n    token: string;\n    expires: number;\n}\n\nexport interface BearerProvider {\n    getBearer(): Promise<BearerTokenInfo>;\n    refreshBearer(): Promise<BearerTokenInfo>;\n    wantsRedirect?: boolean;\n}\n\nexport class RestClient {\n    authHeader?: string;\n    tokenInfo?: BearerTokenInfo;\n    bearerProvider?: BearerProvider;\n    fetchOptions: RequestInit;\n\n    constructor(\n        public isomorphic: IsomorphicEnv,\n        public baseUrl: string,\n        public options: {\n            username?,\n            password?,\n            bearer?,\n            bearerProvider?: BearerProvider\n        },\n    ) {\n        this.fetchOptions = {mode: 'cors'};\n        this.authHeader = options.bearer ?\n            \"Bearer \" + options.bearer :\n            options.username ?\n                \"Basic \" + isomorphic.btoa(options.username + \":\" + (options.password || \"\")) :\n                null;\n        this.bearerProvider = options.bearerProvider || null;\n    }\n\n    async fetch(path: string, method: string, headers, query?, fetchOptions?: RequestInit): Promise<Response> {\n        if (fetchOptions && fetchOptions.cache === 'no-cache') {\n            // Workaround for back-button not respecting cache control in Chrome/Opera.\n            // Append a query parameter to force a cache entry\n            query = {...query, nocache: createUUID()}\n        }\n        const queryStr = query && Object.keys(query).map(key =>\n            encodeURIComponent(key) +\n            \"=\" +\n            encodeURIComponent(query[key]))\n            .join('&');\n\n        let {authHeader, tokenInfo, bearerProvider} = this;\n\n        // {username, password or bearer} not specified in options, but bearerProvider specified:\n        if (!authHeader && !tokenInfo && bearerProvider) {\n            this.tokenInfo = tokenInfo = await bearerProvider.getBearer();\n        }\n        // Either because we've just specified bearerProvider in options, OR, we've got a 401\n        // in earlier response with www-authenticate: Bearer, and we had a BearerProvider,\n        // so we saved the tokenInfo. Now use it regardless of whether username,password or bearer was given\n        // to options in constructor:\n        if (tokenInfo) {\n            if (tokenInfo.expires < Date.now()) {\n                console.log(\"Token expired. Refresh it:\");\n                this.tokenInfo = tokenInfo = await bearerProvider.refreshBearer();\n            }\n            authHeader = \"Bearer \" + tokenInfo.token;            \n        }\n\n        // In one way or another, we've concluded an Authorization header to use:\n        if (authHeader) {\n            headers.Authorization = authHeader;\n        }\n\n        const url = this.baseUrl + path + (queryStr ? \"?\" + queryStr : \"\");\n        let res: Response = await this.isomorphic.fetch(url, { ...this.fetchOptions, headers, method, ...fetchOptions });\n        if (res.status == 401 && this.bearerProvider) {\n            const wwwauth = res.headers.get(\"www-authenticate\");\n            console.log(`Got ${res.status} from ${this.baseUrl + path}`);\n            if (wwwauth && /Bearer/i.test(wwwauth)) {\n                this.tokenInfo = await this.bearerProvider.refreshBearer();\n                headers.Authorization = \"Bearer \" + this.tokenInfo.token;\n                res = await this.isomorphic.fetch(url, { ...this.fetchOptions, headers, method, ...fetchOptions });\n            }\n        }\n        return res;\n    }\n\n    get(path: string, query?, fetchOptions?: RequestInit) {\n        return this.fetch(path, \"GET\", { Accept: \"application/json; text/plain\" }, query, fetchOptions);\n    }\n\n    post(path: string, data, fetchOptions?: RequestInit): Promise<Response> {\n        return this.fetch(path, \"POST\", {\n            \"Content-Type\": \"application/json\",\n            \"Accept\": \"application/json\"\n        }, null, {...fetchOptions, body: JSON.stringify(data)});\n    }\n\n    delete(path: string, query?, body?, fetchOptions?: RequestInit) {\n        return this.fetch(path, \"DELETE\", { Accept: \"application/json; text/plain\" }, query, {...fetchOptions, body});\n    }\n}\n","module.exports = ReactDOM;","\nexport const KED_NAMESPACE = \"KED\";\n\ndeclare var KED: any;\n\nvar result = typeof KED === 'undefined' ? {} : KED;\n\nif (typeof window !== 'undefined' && typeof KED === 'undefined') {\n    window[KED_NAMESPACE] = result;\n}\n\nexport default result;\n","import {BearerProvider, RestClient, BearerTokenInfo} from './restclient';\nimport {IsomorphicEnv} from './isomorphic-env';\nimport {TokenQuery} from './token-query';\nimport {avoidSimultanousCalls} from './utils';\n\nexport interface BearerPersistentStorage {\n    save(id: string, tokenInfo: BearerTokenInfo);\n    load(id: string) : Promise<BearerTokenInfo>;\n}\n\nexport class KedBearerProvider implements BearerProvider {\n    tokenInfo: BearerTokenInfo;\n    client: RestClient;\n    \n    constructor (\n        public isomorphic: IsomorphicEnv,\n        public storage: BearerPersistentStorage,\n        public tokenId:string,\n        public clientId: string,\n        public clientSecret: string,\n        public tokenUrl: string,\n        public tokenQuery: TokenQuery)\n    {\n        this.tokenInfo = {token: null, expires: 0};\n        this.client = new RestClient(isomorphic, \"\", {\n            username: this.clientId,\n            password: this.clientSecret\n        });\n        this.getBearer = avoidSimultanousCalls(this.getBearer.bind(this));\n        this.refreshBearer = avoidSimultanousCalls(this.refreshBearer.bind(this));\n    }\n\n    async getBearer(): Promise<BearerTokenInfo> {\n        const {token, expires} = this.tokenInfo;\n        if (token && expires >= Date.now()) return this.tokenInfo;\n        try {\n            this.tokenInfo = await this.storage.load(this.clientId + \"/\" + this.tokenId);\n            if (this.tokenInfo.token && this.tokenInfo.expires >= Date.now()) return this.tokenInfo;\n            await this.refreshBearer();\n            return this.tokenInfo;\n        } catch (e) {\n            await this.refreshBearer();\n            return this.tokenInfo;\n        }\n    }\n\n    async refreshBearer(): Promise<BearerTokenInfo> {\n        let res: Response;\n        for (let retries=0;retries<6;++retries) {\n            console.log(`Retrieving token for ${this.tokenId}`);\n            res = await this.client.get(this.tokenUrl, this.tokenQuery, {cache: 'reload'});\n            if (res.status !== 200) {\n                console.warn(`Got ${res.status} ${res.statusText}`);\n                continue;\n            }\n            this.tokenInfo = {token: await res.text(), expires: Date.now() + 59 * 60 * 1000};\n            console.log(`Got token for ${this.tokenId}: ${JSON.stringify(this.tokenInfo)}`);\n            this.storage.save(this.clientId + \"/\" + this.tokenId, this.tokenInfo);\n            return this.tokenInfo;\n        }\n        throw new Error(\"Failed to retrieve token for \" + JSON.stringify(this.tokenId));\n    }\n}\n","export interface AccessClaim {\n  type: string;\n  value: string;\n}\n\nexport type AccessRight = 'R' | 'W' | 'S';\n\nexport class DocumentAccess {\n  constructor(\n    public accessClaimType: string,\n    public accessClaimValue: string,\n    public right: AccessRight\n  ) { }\n\n  static fromString(ac: string) {\n    if (!ac) return null;\n    var split = ac.split(':');\n    if (split.length < 3) throw new Error(\"Invalid access string: \" + ac);\n    var claimType = DocumentAccess.unescape(split[0]);\n    var claimValue = DocumentAccess.unescape(split[1]);\n    var right = split[2];\n    if (right !== 'R' && right !== 'W' && right !== 'S')\n      throw new Error(\"Invalid access string: \" + ac);\n    return new DocumentAccess(\n      claimType,\n      claimValue,\n      right);\n  }\n\n  static escape(accessComponent: string) {\n    return accessComponent.replace(/\\%/g, \"%25\").replace(/\\:/g, \"%3A\");\n  }\n\n  static unescape(accessComponent: string) {\n    return accessComponent.replace(/\\%3A/g, \":\").replace(/\\%25/g, \"%\");\n  }\n\n  toString() {\n    return DocumentAccess.escape(this.accessClaimType) + \":\" +\n      DocumentAccess.escape(this.accessClaimValue) + \":\" +\n      this.right;\n  }\n\n  static fromStringArray(acl: string[]) {\n    return acl\n      .map(ac => DocumentAccess.fromString(ac))\n      .filter(ac => ac);\n  }\n\n  static toStringArray(acl: DocumentAccess[]) {\n    return acl.map(ac => ac.toString());\n  }\n}\n\nexport function hasAccess(acl: DocumentAccess[], userClaims: AccessClaim[], requestedRight: AccessRight) {\n  if (userClaims.some(claim => claim.type === 'role' && claim.value === \"ADMIN\"))\n    return true;\n\n  return acl.some(a =>\n    userClaims.some(c =>\n      a.accessClaimType === c.type &&\n      a.accessClaimValue === c.value && (\n        (a.right === 'R' && requestedRight === 'R') ||\n        (a.right === 'W' && ['R','W'].indexOf(requestedRight) >= 0) ||\n        (a.right === 'S'))));\n}\n","\nexport class HttpError extends Error {\n    constructor (public code: number, public message: string) {\n      super(\"HTTP\" + code + \" \" + message)\n      this.name = \"http\" + code;\n    }\n}\n","import {RestClient, BearerProvider, BearerTokenInfo} from './restclient';\nexport {BearerProvider, BearerTokenInfo};\nexport {BearerPersistentStorage} from './ked-bearer-provider';\nexport {createUUID} from './utils';\nexport {KedBearerProvider} from './ked-bearer-provider';\nimport {IsomorphicEnv} from './isomorphic-env';\nexport {IsomorphicEnv};\nexport {TokenQuery} from './token-query';\nexport * from './access-control';\nimport {HttpError} from './http-error';\nexport {HttpError}\n\nexport interface ListOptions {\n    from?: number,\n    to?: number,\n    include?: string | string[],\n    role?: string | string[],\n    hasEdgesTo?: string | string[],\n    hasEdgesFrom?: string | string[],\n    ids?: string[],\n    name?: string,\n    tags?: string | string[],\n    flags?: QueryFlag[],\n    cacheBust?: string | number\n};\n\nexport type QueryFlag = 'idsOnly' | 'includeIdsOnly' | 'idsAndNamesOnly' | 'includeIdsAndNamesOnly'; // | 'otherFlag' | 'thirdFlag';...\n\nexport class KedBackendClient {\n    http: RestClient;\n\n    constructor (\n        isomorphic: IsomorphicEnv,\n        bearerProvider: BearerProvider,\n        baseUrl: string)\n    {\n        this.http = new RestClient(\n            isomorphic,\n            baseUrl,\n            {bearerProvider});\n    }\n\n    async getMyClaims(table?: string, fetchOptions?: RequestInit) : Promise<any> // TODO: Specify what you get here\n    {\n        const res = await this.http.get(\"me/claims/\" + (table ||\"\"), null, fetchOptions);\n        if (res.status != 200) throw new HttpError(res.status, await res.text());\n        return await res.json();\n    }\n\n    async get<T = any>(table, id, options?: {include?: string | string[]}, fetchOptions?: RequestInit) : Promise<T> {\n        const res = await this.http.get(`${table}/${id}`, options, fetchOptions);\n        if (res.status != 200) throw new HttpError(res.status, await res.text());\n        return await res.json();\n    }    \n\n    async list<T = any>(table: string, options?: ListOptions, fetchOptions?: RequestInit) : Promise<T[]>\n    {\n        const res = await this.http.get(`${table}`, options, fetchOptions);\n        if (res.status != 200) throw new HttpError(res.status, await res.text());\n        return await res.json();\n    }\n\n    async batch(reqs: MutationRequest[], fetchOptions?: RequestInit) : Promise<BatchResponse> {\n        // Reorder operations so that 'add's come first and 'delete's come last:\n        reqs = reqs.slice().sort((req1, req2) =>\n            req1.op === 'add' ? -1 : req2.op === 'add' ? 1 : \n            req1.op === 'delete' ? 1 : req2.op === 'delete' ? -1 : 0);\n        const res = await this.http.post(`batch`, reqs, fetchOptions);\n        if (res.status != 200) throw new HttpError(res.status, await res.text());\n        return await res.json();\n    }\n\n    async do(scopeFn: (r:BatchRunner)=>void) : Promise<BatchResponse> {\n        const runner = new BatchRunner();\n        scopeFn(runner);\n        return await this.batch(runner.mutationRequests);\n    }\n\n    async deleteRealm(realm: string) : Promise<number> {\n        const res = await this.http.delete(\"realms/\" + realm);\n        if (res.status != 200) throw new HttpError(res.status, await res.text());\n        return await res.json();\n    }\n\n    add(table:string, doc) {\n        return this.do(r=>r.add(table, doc));\n    }\n    put(table:string, doc) {\n        return this.do(r=>r.put(table, doc));\n    }\n    delete (table:string, id:string) {\n        return this.do(r=>r.delete(table, id));\n    }\n    share(table:string, id:string, acl: string[]) {\n        return this.do(r=>r.share(table, id, acl));\n    }\n    unshare (table:string, id:string, acl: string[]) {\n        return this.do(r=>r.unshare(table, id, acl));\n    }\n    link (sourceTable:string, sourceId:string, targetTable:string, targetId:string, label:string) {\n        return this.do(r=>r.link(sourceTable, sourceId, targetTable, targetId, label));\n    }\n    link2 (sourceTable:string, sourceId:string, targetId:string, label:string) {\n        return this.do(r=>r.link2(sourceTable, sourceId, label, targetId));\n    } \n    unlink (sourceTable:string, sourceId:string, targetTable:string, targetId:string, label:string) {\n        return this.do(r=>r.unlink(sourceTable, sourceId, targetTable, targetId, label));\n    }\n    unlink2 (sourceTable:string, sourceId:string, targetId:string, label:string) {\n        return this.do(r=>r.unlink2(sourceTable, sourceId, label, targetId));\n    }\n}\n\nexport class BatchRunner {\n    mutationRequests: MutationRequest[];\n\n    constructor() {\n        this.mutationRequests = [];\n    }\n\n    add (table:string, doc) {\n        this.mutationRequests.push({op: 'add', table, doc});\n        return this;\n    }\n    put (table:string, doc) {\n        doc = {...doc};\n        delete doc.acl; // Forbidden to send acl with put() calls.\n        this.mutationRequests.push({op: 'put', table, doc});\n        return this;\n    }\n    delete (table:string, id:string) {\n        this.mutationRequests.push({op: 'delete', table, id});\n        return this;\n    }\n    share (table:string, id:string, acl:string[]) {\n        this.mutationRequests.push({op: 'share', table, id, acl});\n        return this;\n    }\n    unshare (table:string, id:string, acl:string[]) {\n        this.mutationRequests.push({op: 'unshare', table, id, acl});\n        return this;\n    }\n    link (sourceTable:string, sourceId:string, targetTable:string, targetId:string, label:string) {\n        this.mutationRequests.push({op: 'link', sourceTable, sourceId, targetTable, targetId, label});\n        return this;\n    }\n    link2 (sourceTable:string, sourceId:string, label:string, targetId:string) {\n        this.mutationRequests.push({op: 'link', sourceTable, sourceId, targetId, label});\n    }\n    unlink (sourceTable:string, sourceId:string, targetTable:string, targetId:string, label:string) {\n        this.mutationRequests.push({op: 'unlink', sourceTable, sourceId, targetTable, targetId, label});\n        return this;\n    }\n    unlink2 (sourceTable:string, sourceId:string, label:string, targetId:string) {\n        this.mutationRequests.push({op: 'unlink', sourceTable, sourceId, targetId, label});\n        return this;\n    }\n}\n\nexport interface AddRequest {\n    op: 'add';\n    table: string;\n    doc: {id?: string, acl?: string[], name?: string, dateTime?: number};\n}\n\nexport interface PutRequest {\n    op: 'put';\n    table: string;\n    doc: {id: string, name?: string, dateTime?: number};\n}\n\nexport interface DeleteRequest {\n    op: 'delete';\n    table: string;\n    id: string;\n}\n\nexport interface ShareRequest {\n    op: 'share';\n    table: string;\n    id: string;\n    acl: string[];\n}\n\nexport interface UnshareRequest {\n    op: 'unshare';\n    table: string;\n    id: string;\n    acl: string[];\n}\n\nexport interface LinkRequest {\n    op: 'link';\n    sourceTable: string;\n    sourceId: string;\n    targetTable?: string;\n    targetId: string;\n    label: string;\n}\n\nexport interface UnlinkRequest {\n    op: 'unlink';\n    sourceTable: string;\n    sourceId: string;\n    targetTable?: string;\n    targetId: string;\n    label: string;\n}\n\nexport type MutationRequest =\n    AddRequest |\n    PutRequest |\n    DeleteRequest |\n    ShareRequest |\n    UnshareRequest |\n    LinkRequest |\n    UnlinkRequest;\n\nexport interface BatchResponse {\n    newEtags: {[id:string] : string};\n}\n\n","/* REFACTOR: Move this component outside coursebuilder!\n   This is a general-purpose component\n*/\n\nimport * as React from 'react';\n\ninterface Props {\n  title: string | JSX.Element;\n  className?: string;\n  headerClassName?: string;\n  contentClassName?: string;\n  headerOpen?: boolean;\n  onOpenClose?: (becameOpen: boolean) => void;\n  children;\n}\n\ninterface State {\n  headerOpen: boolean;\n}\n\nexport class OpenCloseBox extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      headerOpen: props.headerOpen || false\n    };\n  }\n\n  componentWillReceiveProps (nextProps: Props) {\n    if (nextProps.headerOpen !== this.props.headerOpen) {\n      this.setState({headerOpen: nextProps.headerOpen});\n    }\n  }\n\n  render() {\n    const { title, className, children, headerClassName, contentClassName } = this.props;\n    const { headerOpen } = this.state;\n\n    return <div className={(className||'') + \" openClose\" + (headerOpen ? \" open\" : \"\")}>\n      <div className={\"openHeader\" + (headerClassName ? \" \" + headerClassName : \"\")}\n        onClick={() => {\n          if (this.props.onOpenClose) this.props.onOpenClose(!this.state.headerOpen);\n          this.setState({ headerOpen: !this.state.headerOpen });\n        }} >\n        {title}\n      </div>\n      <div className={\"openContent\" + (contentClassName ? \" \" + contentClassName : \"\")}>\n        {children}\n      </div>\n    </div>;\n  }\n}\n","import * as React from 'react';\nimport { L } from '../../utils/utils';\nimport $ from 'jquery';\n\ninterface Props {\n    text: string;\n    tag?: 'input' | 'textarea'\n    eager?: boolean;\n    onChange: (newName: string) => void;\n    placeholder?: string; // If text is empty, this will be the placeholder\n    clickAdvertiseText?: string;\n    maxChars?: number;\n    readOnly?: boolean;\n}\n\ninterface State {\n    editMode: boolean;\n    runtimeStyle: Object;\n    text: string | null;\n}\n\n/** \n * Makes a text element (such as an A or P tag) possible to replace with an input element of the same CSS style, for example by clicking on it.\n * \n*/\nexport class RenameableText extends React.Component<Props,State> {\n    label: HTMLElement;\n    input: HTMLInputElement | HTMLTextAreaElement;\n\n    constructor(props: Props) {\n        super(props);\n        this.state = {\n            editMode: false,\n            runtimeStyle: null,\n            text: props.text || \"\"\n        }\n    }\n\n    componentWillReceiveProps(nextProps) {\n        if (this.props.text !== nextProps.text) {\n            this.setState({text: nextProps.text || \"\"});\n        }\n    }\n\n    render() {\n        const text = this.state.text || \"\";\n        return <div\n                className={\"renameable-text\" + (text ? \"\" : \" unnamed\") + (this.props.readOnly ? \" disabled\" : \"\")}\n                tabIndex={!this.state.editMode && 0}\n                onFocus={(e)=>{this.rename()}}\n                style={{width: \"100%\"}}\n            >\n            <div\n                ref={label => this.label = label}                \n                style={{\n                    display: this.state.editMode ? 'none' : ''\n                }}\n            >\n                {text || this.props.clickAdvertiseText}\n            </div>\n            {this.props.tag === 'textarea' ?\n                <textarea ref={input => this.input = input}\n                    maxLength={this.props.maxChars}\n                    style={{...this.state.runtimeStyle, display: this.state.editMode ? '' : 'none'}}\n                    onFocus={ev=>$(ev.target).select()}\n                    onBlur={this.onBlur.bind(this)}\n                    value={text}\n                    onKeyDown={this.onKeyDown.bind(this)}\n                    onChange={this.onChange.bind(this)}\n                    tabIndex={this.state.editMode && 0}\n                    placeholder={this.props.placeholder}\n                /> : \n                <input ref={input => this.input = input}\n                    type=\"text\"\n                    maxLength={this.props.maxChars}\n                    style={{...this.state.runtimeStyle, display: this.state.editMode ? '' : 'none'}}\n                    onFocus={ev=>$(ev.target).select()}\n                    onBlur={this.onBlur.bind(this)}\n                    value={text}\n                    onKeyDown={this.onKeyDown.bind(this)}\n                    onChange={this.onChange.bind(this)}\n                    tabIndex={this.state.editMode ? 0 : undefined}\n                    placeholder={this.props.placeholder}\n                />\n            }\n        </div>\n    }\n\n    onKeyDown(e: KeyboardEvent) {\n        if (e.keyCode === 27) { // ESC\n            this.input.value = this.props.text || \"\";\n            this.input.blur();\n            e.stopPropagation();\n        } else if (e.keyCode === 13) { // ENTER\n            this.propagateOnChange(this.input.value);\n            this.setState({ editMode: false, text: this.input.value });\n        }\n    }\n\n    onBlur(e: Event) {\n        this.propagateOnChange(this.input.value);\n        this.setState({ editMode: false, text: this.input.value });\n    }\n\n    propagatedOnChange: string;\n\n    propagateOnChange(newValue) {\n        if (this.propagatedOnChange != newValue) {\n            this.propagatedOnChange = newValue;\n            this.props.onChange(newValue);\n        }\n    }\n\n    onChange(e: Event) {\n        this.setState({ text: this.input.value });\n        if (this.props.eager) this.propagateOnChange(this.input.value);\n    }\n\n    rename(txt?: string) {\n        if (this.state.editMode || this.props.readOnly) return;\n        txt = txt || this.state.text || \"\";\n        const label = $(this.label);\n        this.setState({\n            text: txt,\n            editMode: true,\n            runtimeStyle: {\n                textAlign: label.css('textAlign'),\n                fontSize: label.css('font-size'),\n                paddingTop: label.css('paddingTop'),\n                paddingBottom: label.css('paddingBottom'),\n                paddingLeft: label.css('paddingLeft'),\n                paddingRight: label.css('paddingRight'),\n                marginTop: label.css('marginTop'),\n                marginBottom: label.css('marginBottom'),\n                marginLeft: label.css('marginLeft'),\n                marginRight: label.css('marginRight'),\n                borderRadius: label.css('borderRadius'),\n                backgroundColor: label.css('backgroundColor'),\n                lineHeight: label.css('lineHeight'),\n                fontWeight: label.css('fontWeight'),\n                outLine: 0,\n                borderStyle: 'none',\n                height: \"100%\",\n                width: \"100%\",\n                boxSizing: \"border-box\",\n            }\n        }, ()=>$(this.input).focus());\n    }\n}\n","import * as React from 'react';\nimport { L } from \"../../../utils/utils\";\n\ninterface Props {\n  onClick,\n  className?,\n  style?,\n  title?\n};\n\nexport const RemoveItem = ({ onClick, className, style, title }: Props) =>\n\n  <div\n    title={title || L`Radera`}\n    className={\"removeItem \" + (className || \"\")}\n    onClick={onClick} style={style} />\n","import { User } from '../contracts/ked-models';\nimport { parseQueryString } from '../utils/query-string';\nimport env from '../globals/KED.env';\n\nexport class Features {\n  EditUserTasksViaPenOnly?: boolean;\n  SubTasks?: boolean;\n  AssignmentTasks?: boolean;\n\n  constructor () {\n    const user = env.currentUser!;\n    const query = parseQueryString(location.search, {toLower: true});\n    const features = ((query.features||'').split(',') as string[])\n      .map(feature => feature.toLowerCase()); // Can be used on forwards...\n\n    this.EditUserTasksViaPenOnly =\n      user.schoolType !== 'Grundskolor' && query.schooltype !== \"Grundskolor\";\n    this.SubTasks =\n      user.schoolType !== 'Grundskolor' && query.schooltype !== \"Grundskolor\";\n    this.AssignmentTasks = !!query.testversion;\n  }\n}\n","\n\nexport interface RepoCommunicator<T extends {id: string}> {\n  query(): Promise<T[]>;\n}\n\ntype Subscriber<T> = (items:T[]) => any;\n\nexport class Repo<T extends {id: string}> {\n  listPromise: Promise<void>;\n  items: T[];\n  subscribers: Subscriber<T>[];\n\n  constructor(public comm: RepoCommunicator<T>) {\n    this.listPromise = null;\n    this.items = null;\n    this.subscribers = [];\n  }\n\n  subscribe(subscriber: Subscriber<T>) {\n    return this.ensureHasData().then(()=>{\n      subscriber(this.items);\n      this.subscribers.push(subscriber);\n    });\n  }\n\n  unsubscribe(subscriber: Subscriber<T>) {\n    this.subscribers = this.subscribers.filter (s => s !== subscriber);\n  }\n\n  notifySubscribers() {\n    this.subscribers.forEach(s => s(this.items));\n  }\n\n  ensureHasData() {\n    if (!this.listPromise) this.refreshFromServer();\n    return this.listPromise;\n  }\n\n  refreshFromServer() {\n    this.listPromise = this.comm.query().then(items => {\n      this.items = items;\n      this.notifySubscribers();\n    });\n    return this.listPromise;\n  }\n  \n  async update(item: T | T[]) {\n    await this.ensureHasData();\n    const items = Array.isArray(item) ? item : [item];\n    this.items = this.items.map(it => {\n      const item = items.find(({id}) => it.id === id);\n      return item ?\n        Object.assign({}, item) :\n        it;\n    });\n    this.notifySubscribers();\n  }\n\n  insert(item: T | T[]) {\n    return this.ensureHasData().then(()=>{\n      this.items = this.items.concat(item);\n      this.notifySubscribers();\n    });\n  }\n\n  delete(id: string | string[]) {\n    const ids = Array.isArray(id) ? id : [id];\n    return this.ensureHasData().then(()=>{\n      this.items = this.items.filter(it => !ids.some(id => it.id === id));\n      this.notifySubscribers();\n    });\n  }\n}\n","import env from '../globals/KED.env';\nimport cfg from '../globals/KED.cfg';\nimport { KedBackendClientWeb } from 'kedbackend/clientweb';\n\nenv.kedBackendClient = new KedBackendClientWeb (\n  cfg.KED_API_URL,\n  env.bearerProvider);\n\n","import { parseQueryString, generateQueryString, splitUrlAndQuery } from \"../utils/query-string\";\nimport { KedBackendClientWeb, WebServerBearerProvider, isomorphic, storage } from 'kedbackend/clientweb';\nimport { BearerProvider, KedBearerProvider } from 'kedbackend/client';\nimport cfg from '../globals/KED.cfg';\nimport env from '../globals/KED.env';\nimport { User } from \"../contracts/ked-models\";\nimport { IMPERSONATION_QUERY_PARAMS } from \"../access-control/index\";\nimport { cherryPickProps } from \"../utils/utils\";\n\nfunction getMergedTokenPath(tokenPath: string, locationSearch: string, scopes: string[]) {\n  // Merge configured query params of token path with params given to current page\n  const currentQuery = parseQueryString(locationSearch);\n  const impersonationProps = cherryPickProps(currentQuery, IMPERSONATION_QUERY_PARAMS);\n  const [tokenPathWithoutQuery, tokenQueryString] = splitUrlAndQuery(tokenPath);\n  const tokenPathQuery = parseQueryString(tokenQueryString);\n  return tokenPathWithoutQuery + generateQueryString({\n    ...tokenPathQuery,\n    ...impersonationProps,\n    scopes: scopes.join(',')\n  });\n}\n\nfunction getTokenId(mergedTokenPath: string, userEmail: string) {\n  return mergedTokenPath + \"/\" + userEmail;\n}\n\nfunction saveUserInfo(user: User, tokenId: string) {\n  env.currentUser = user;\n  sessionStorage.setItem(\"userInfo\" + tokenId, JSON.stringify(user));\n}\n\nfunction loadUserInfo(tokenId: string) {\n  const storedSessionUser = sessionStorage.getItem(\"userInfo\" + tokenId);\n  if (storedSessionUser) {\n    env.currentUser = JSON.parse(storedSessionUser);\n  }\n}\n\nfunction createBearerProvider(mergedTokenPath: string, userEmail: string) {\n  const tokenId = getTokenId(mergedTokenPath, userEmail);\n  return new WebServerBearerProvider(mergedTokenPath, responseText => {\n    const res = JSON.parse(responseText) as { ok: boolean, error?: string, token?: string, user?: User };\n    if (!res.ok) throw new Error(res.error);\n    if (res.user) {\n      saveUserInfo(res.user, tokenId);\n    }\n    return { token: res.token, expires: Date.now() + 59 * 60 * 1000 };\n  }, tokenId);\n}\n\nfunction createGoogleTokenProvider(mergedTokenPath: string, userEmail: string) {\n  const tokenId = getTokenId(mergedTokenPath, userEmail);\n  return new WebServerBearerProvider(mergedTokenPath, responseText => {\n    const res = JSON.parse(responseText) as { ok: boolean, error?: string, token?: string, user?: User };\n    if (!res.ok) throw new Error(res.error);\n    return { token: res.token, expires: Date.now() + 59 * 60 * 1000 };\n  }, tokenId);\n}\n\nfunction createTestTokenProvider(tokenUrl: string, user: User, scopes: string[]) {\n  return new KedBearerProvider(\n    isomorphic,\n    storage,\n    tokenUrl + user.mail + location.search,\n    cfg.KED_CLIENT_ID,\n    cfg.KED_CLIENT_SECRET,\n    tokenUrl, {\n      email: user.mail.toLowerCase(),\n      roles: user.roles,\n      school: user.school,\n      schoolType: user.schoolType,\n      scopes\n    });\n}\n\n// env.currentUser.mail is set by SiteVision server initially.\n// A response from /api/token may change the mail attribute of the current\n// user, so env.currentUser.mail may be different after getting a response.\n// However, the initial value is valuable always in order to distinguish the case\n// when one normal user logs out and another user logs in.\nconst initialUserEmail = env.currentUser && env.currentUser.mail; // Initial value of mail. May change.\nif (initialUserEmail) {\n  // KED\n  if (cfg.KED_TOKEN_PATH) {\n    //\n    //\n    // Production / SiteVision proxied /api/token to request tokens from:\n    //\n    //\n    const mergedTokenPath = getMergedTokenPath(\n      cfg.KED_TOKEN_PATH,\n      location.search, [\n        \"kedbackend\",\n        \"EDS\",\n      ]);\n    env.bearerProvider = createBearerProvider(mergedTokenPath, initialUserEmail);\n    loadUserInfo(getTokenId(mergedTokenPath, initialUserEmail));\n\n    // Google\n    const googleMergedPath = getMergedTokenPath(\n      cfg.KED_TOKEN_PATH,\n      location.search, [\n        \"https://www.googleapis.com/auth/calendar.readonly\",\n      ]);\n    env.googleTokenProvider = createGoogleTokenProvider(googleMergedPath, initialUserEmail);\n  } else if (cfg.KED_TOKEN_URL && cfg.KED_CLIENT_ID && cfg.KED_CLIENT_SECRET) {\n    //\n    //\n    // Test - go directly to KEDAUTH server to retrieve tokens\n    //\n    //\n    env.bearerProvider = createTestTokenProvider(cfg.KED_TOKEN_URL, env.currentUser, [\n      \"kedbackend\",\n      \"EDS\",\n    ]);\n    env.googleTokenProvider = createTestTokenProvider(cfg.KED_TOKEN_URL + \"/google\", env.currentUser, [\n      \"https://www.googleapis.com/auth/calendar.readonly\",\n    ]);\n  } else {\n    throw new Error(`Missing configuration parameter KED_TOKEN_PATH`);\n  }\n}\n","import * as React from 'react';\nimport {L} from './utils';\nimport $ from 'jquery';\n\ninterface Props {\n}\n\ninterface State {\n  error: string | undefined;\n  info: string | undefined;\n}\n\nexport class ErrorSuccessFeedback extends React.Component<Props,State> {\n  constructor (props: Props) {\n    super(props);\n    this.state={\n      error: undefined,\n      info: undefined\n    };\n    this._unhandledRejection = this._unhandledRejection.bind(this);\n    this._error = this._error.bind(this);\n    this._customError = this._customError.bind(this);\n    this._onInfo = this._onInfo.bind(this);\n  }\n\n  componentDidMount() {\n    window.addEventListener('unhandledrejection', this._unhandledRejection);\n    window.addEventListener('error', this._error);\n    window.addEventListener('customerror', this._customError);\n    window.addEventListener('info', this._onInfo);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('unhandledrejection', this._unhandledRejection);\n    window.removeEventListener('error', this._error);\n    window.removeEventListener('customerror', this._customError);\n    window.removeEventListener('info', this._onInfo);\n  }\n\n  _unhandledRejection (ev: Event & {reason: Error}) {\n    this.setState({error: ev.reason ? ev.reason.message : L`Ett oknt fel intrffade...`, info: null});\n    setTimeout(()=>this.setState({error: null}), 10000);\n  }\n\n  _error (ev: Event & {error: Error}) {\n    this.setState({error: ev.error ? ev.error.message : L`Ett oknt fel intrffade...`, info: null});\n    setTimeout(()=>this.setState({error: null}), 10000);\n  }\n\n  _customError (ev: CustomEvent) {\n    this.setState({error: ev.detail, info: null});\n    setTimeout(()=>this.setState({error: null}), 10000);\n  }\n\n  _onInfo(ev: CustomEvent) {\n    this.setState({error: null, info: ev.detail });\n    setTimeout(()=>this.setState({info: null}), 10000);\n  } \n\n  render() {\n    return <div className=\"error-success-feedback\" style={{\n      position: \"fixed\",\n      left: 0,\n      top: 0,\n      width: \"100%\",\n      pointerEvents: 'none'\n    }}>\n      <div style={{display: 'table', margin: \"0 auto\"}}>\n        <p className=\"error\" style={{display: this.state.error ? \"\" : \"none\"}}>{this.state.error && this.state.error}</p>\n        <p className=\"info\" style={{display: this.state.info ? \"\" : \"none\"}}>{this.state.info}</p>\n      </div>\n    </div>;\n  }\n}\n","var map = {\n\t\"./en-au\": 47,\n\t\"./en-au.js\": 47,\n\t\"./en-ca\": 46,\n\t\"./en-ca.js\": 46,\n\t\"./en-gb\": 45,\n\t\"./en-gb.js\": 45,\n\t\"./en-ie\": 44,\n\t\"./en-ie.js\": 44,\n\t\"./en-nz\": 43,\n\t\"./en-nz.js\": 43,\n\t\"./sv\": 42,\n\t\"./sv.js\": 42\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\tvar module = __webpack_require__(id);\n\treturn module;\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error('Cannot find module \"' + req + '\".');\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 58;","import * as React from 'react';\nimport { HashRouter as Router, Route, Link, Redirect } from 'react-router-dom';\nimport { ICourseEditorHost } from \"../interfaces/course-editor-host\";\nimport { Course } from 'kedbackend/models';\nimport { readBlobAsText, allowCopy, readBlobAsDataUrl } from \"../utils\";\nimport { showError, L } from \"../../../utils/utils\";\nimport { createUUID } from \"kedbackend/client\";\nimport { hasAccess } from \"../../../access-control\";\nimport env from '../../../globals/KED.env';\n\ntype Callback = () => void;\n\ninterface Props {\n  title: string,\n  activePage: BannerMenuItem,\n  callbacks?: { [menuName: string]: Callback },\n  routes: { [menuName: string]: string } & { feedback: string },\n  backgroundImage?: string,\n  isTemplate?,\n  host?: ICourseEditorHost,\n  course?: Course,\n  origCourse?: Course\n}\n\ntype BannerMenuItem =\n  \"courseBuilder\" |\n  \"studentPage\" |\n  \"templateBuilder\" |\n  \"subjects\" |\n  \"schools\";\n\nconst AdminMenuItems = [\n  { name: \"schools\", text: L`Skolor`, route: \"/schools\" },\n  { name: \"subjects\", text: L`mnen`, route: \"/subjects\" },\n  //{name: \"templateBuilder\", text: L`Mallbyggaren`, route: \"/course-templates\"},\n]\n\nconst NonAdminMenuItems = [\n  { name: \"courseBuilder\", text: L`Kursbyggaren`, route: \"/courses/new\" },\n  { name: \"studentPage\", text: L`Elevsida`, route: \"\" },\n  { name: \"feedback\", text: <span><i className=\"fa fa-commenting-o\" aria-hidden=\"true\"></i> Feedback</span>, route: \"https://kg.kunskapsporten.se/kursbyggaren/\" }\n]\n\n\nasync function onDropImage(ev: React.DragEvent<HTMLDivElement>, host: ICourseEditorHost, course: Course, origCourse: Course) {\n  ev.stopPropagation();\n  ev.preventDefault();\n  const files = ev.dataTransfer.files;\n  let url = null;\n  const items = Array.from(ev.dataTransfer.items);\n  if (files.length > 0) {\n    const file = files[0];\n    if (file.size > 2 * 1024 * 1024) {\n      showError(L`Kan inte ladda upp bilder strre n 2 MB`);\n      return;\n    }\n    url = await readBlobAsDataUrl(file);\n  } else {\n    for (let i = 0; i < items.length; ++i) {\n      const item = items[i];\n      if (item.type.match('^text/uri-list')) {\n        // URI\n        url = await new Promise(resolve => item.getAsString(resolve));\n      }\n    }\n  }\n  if (url == null) {\n    showError(L`Kunde inte hitta ngon bild i innehllet`);\n    return;\n  }\n  setCourseImage(course, origCourse, host, url);\n}\n\nexport function setCourseImage(\n  course: Course,\n  origCourse: Course,\n  host: ICourseEditorHost,\n  url: string\n) {\n  const imageId = createUUID();\n  host.update({\n    imageId: { $set: imageId },\n    images: {\n      $set: [{\n        id: imageId,\n        url,\n        acl: [\n          `role:USER:R`,\n          `schoolRole:${env.currentUser.school}/EMPLOYEE:S`\n        ],\n        $meta: 'add'\n      }]\n    }\n  });\n}\n\n/* This version had the bug that old images were not replaced.\nOne course at Uppsala contained 12 images.\n\n\nexport function setCourseImageOld(\n  course: Course,\n  origCourse: Course,\n  host: ICourseEditorHost,\n  url: string)\n{\n  if (!origCourse || !origCourse.imageId) {\n    const imageId = createUUID();\n    host.update({\n      imageId: { $set: imageId },\n      images: {\n        $push: [{\n          id: imageId,\n          url,\n          acl: course.isTemplate ? [\"role:USER:R\"] : [\"role:USER:R\", `schoolRole:${env.currentUser.school}/EMPLOYEE:S`],\n          $meta: 'add'\n        }]\n      }\n    });\n  } else {\n    // Update existing image:\n    const imgIdx = course.images.findIndex(img => img.id === course.imageId);\n    if (imgIdx >= 0) {\n      const imageEntity = course.images[imgIdx];\n      if (course.isTemplate) {\n        // Templates: Update the template image content:\n        host.update({\n          images: {\n            $splice: [[imgIdx, 1, {\n              ...imageEntity,\n              url,\n              $meta: 'update'\n            }]]\n          }\n        })\n      } else {\n        // Real courses: Replace with a new image\n        const imageId = createUUID();\n        host.update({\n          imageId: { $set: imageId },\n          images: {\n            $splice: [[imgIdx, 1, {\n              id: imageId,\n              url,\n              acl: [\n                `role:USER:R`,\n                `schoolRole:${env.currentUser.school}/EMPLOYEE:S`\n              ],\n              $meta: 'add'\n            }]]\n          }\n        })\n      }\n    } else {\n      showError(L`Kunde inte uppdatera bilden.`);\n    }\n  }\n}\n*/\n\nexport const CourseBanner = (props: Props) => {\n  const { title, isTemplate, host, course, origCourse, backgroundImage, activePage } = props;\n  const isAdmin = env.currentUser.roles.some(role => role === \"ADMIN\");\n  let menuItems = NonAdminMenuItems;\n  if (isAdmin) menuItems = AdminMenuItems.concat(menuItems);\n\n  return <div className=\"sv-row sv-layout sv-skip-spacer\">\n    <div className=\"sv-layout sv-skip-spacer sv-column-12\">\n      <div className=\"sv-script-portlet sv-portlet sv-skip-spacer\">\n        {backgroundImage && <style>{`\n        .pageHeader {\n          background-image: url('${backgroundImage}') !important;\n        }\n      `}</style>}\n        <div className=\"pageHeader\"\n          onDragOver={course && allowCopy}\n          onDrop={course && (ev => onDropImage(ev, host, course, origCourse))}>\n          <a>\n            <h1>{title}</h1>\n          </a>\n          <div className=\"buttonsField\">\n            <div className=\"buttonsContainer\">\n              <div className=\"align-horizontal\"></div>\n              <div className='horizontalMenu'>\n                <ul>\n                  {menuItems.map(item => ({\n                    item,\n                    isActive: activePage === item.name,\n                    callback: props.callbacks && props.callbacks[item.name],\n                    givenRoute: (props.routes && props.routes[item.name]),\n                    defaultRoute: item.route\n                  })).filter(x => x.callback || x.defaultRoute || x.givenRoute).map(({ item, isActive, callback, defaultRoute, givenRoute }) => {\n                    return <li\n                      key={item.name}\n                      className={isActive ? \"activePage\" : \"\"}\n                      onClick={callback}\n                    >\n                      {callback ?\n                        <a>{item.text}</a> :\n                        defaultRoute || givenRoute ?\n                          givenRoute || /^http[s]\\:\\/\\//i.test(defaultRoute) ?\n                            <a href={givenRoute || defaultRoute}>{item.text}</a> :\n                            <Link to={defaultRoute}>{item.text}</Link> :\n                          <a>{item.text}</a>}\n                    </li>;\n                  })}\n                </ul>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n}\n","import * as React from 'react';\nimport { School } from 'kedbackend/models';\nimport { DialogContainer } from \"../interfaces/course-editor-host\";\nimport { L } from \"../../../utils/utils\";\nimport env from '../../../globals/KED.env';\nimport { updateModificationAndCreationStamps } from \"../utils\";\nimport { EditSchool } from './edit-school';\nimport { Link } from 'react-router-dom';\nimport { actAs } from \"../../../access-control\";\nimport { Spinner } from \"../sub-components/spinner\";\n\ninterface Props {\n  schools?: School[]\n  viewCourseUrl: string\n}\n\nexport const EditableSchoolList = (props: Props) => {\n  const { schools, viewCourseUrl } = props;\n  const isAdmin = env.currentUser.roles.some(role => role === \"ADMIN\");\n  return <div className=\"editable-school-list\">\n    <div>\n      {schools ? <table>\n        <tbody>\n          {schools.map(school =>\n            <tr className=\"align-horizontal\" key={school.id}>\n              <td>\n                <Link className=\"editItem\" to={`/schools/${school.id}/edit`}></Link>\n              </td>\n              <td>\n                <p>{school.name}</p>\n              </td>\n              <td>\n                <p><a style={{cursor: 'pointer'}} onClick={()=>actAs({role: \"EMPLOYEE\", school: school.name})}>Agera som lrare p denna skola</a></p>\n              </td>\n              <td>\n                <p><a style={{cursor: 'pointer'}} onClick={()=>actAs({role: \"STUDENT\", school: school.name, url: viewCourseUrl})}>Agera som elev p denna skola</a></p>\n              </td>\n            </tr>)}\n        </tbody>\n      </table> : <p><Spinner />V.g. vnta medan skolor laddas</p>}\n    </div>\n    <br />\n    {schools && isAdmin && <Link to=\"/schools/new\" className=\"btn\">Lgg till skola</Link>}\n  </div >\n}\n","import * as React from 'react';\nimport { CourseBanner } from \"../courses/course-banner\";\nimport env from '../../../globals/KED.env';\nimport { School } from 'kedbackend/models';\nimport { EditableSchoolList } from './editable-school-list';\nimport { showError, compareProp } from \"../../../utils/utils\";\n\ninterface Props {\n  viewCourseUrl: string;\n  feedbackUrl: string;\n}\n\ninterface State {\n  schools: School[] | null\n}\n\nexport class Schools extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      schools: null\n    }\n  }\n\n  componentDidMount() {\n    this.load().catch(err => showError(err.message || err));\n  }\n\n  async load() {\n    const schools = await env.kedBackendClient.list<School>(\"schools\");\n    this.setState({ schools });\n  }\n\n  render() {\n    const { schools } = this.state;\n    schools && schools.sort(compareProp(\"name\"));\n    return <div style={{ outline: 0 }}>\n      <CourseBanner title=\"Skolor\" activePage=\"schools\" routes={{feedback: this.props.feedbackUrl}} />\n      <div className=\"sv-row sv-layout\">\n        <div className=\"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer\">\n          <EditableSchoolList schools={schools} viewCourseUrl={this.props.viewCourseUrl} />\n        </div>\n      </div>\n    </div>\n\n  }\n}\n","import * as React from 'react';\nimport { School } from \"kedbackend/models\";\nimport { CourseBanner } from \"../courses/course-banner\";\nimport { showError, L } from \"../../../utils/utils\";\nimport env from '../../../globals/KED.env';\nimport { createUUID, DocumentAccess, BatchRunner } from \"kedbackend/client\";\nimport { Link } from 'react-router-dom';\n\ninterface Props {\n  id?: string\n  title: string\n  feedbackUrl: string\n}\n\ntype State = School;\n\nexport class EditSchool extends React.Component<Props,State> {\n  origSchool: School;\n\n  constructor(props: Props) {\n    super(props);\n    this.state = null;\n  }\n\n  componentDidMount() {\n    this.load().catch(err => showError(err));\n  }\n\n  async load() {\n    if (this.props.id) {\n      // ID given, load it.\n      const { id } = this.props;\n      const school = await env.kedBackendClient.get<School>(\"schools\", id);\n      this.origSchool = { ...school };\n      this.setState({ ...school });\n    } else {\n      // No id, create new instead.\n      this.setState({\n        id: createUUID()\n      });\n    }\n  }\n\n  async save() {\n    const r = new BatchRunner();\n    let school = { ...this.state };\n    if (!this.origSchool) {\n      school.acl = [\"role:USER:R\"];\n      school.acl.push(\n        new DocumentAccess(\n          \"schoolRole\",\n          `${school.name}/EMPLOYEE`, \"W\").toString());\n      r.add(\"schools\", school);\n    } else if (this.origSchool.name !== this.state.name) {\n\n      // Unshare the old name\n      r.unshare(\"schools\", school.id, [\n        new DocumentAccess(\"schoolRole\", `${this.origSchool.name}/EMPLOYEE`, \"W\")\n      ].map(a => a.toString()));\n      // BUG workaround - renaming a school to a new name where just casing matters:\n      if (this.origSchool.name.toLowerCase() === this.state.name.toLowerCase()) {\n        // Workaround for bug with renaming when it differs just by casing:\n        await env.kedBackendClient.batch(r.mutationRequests);\n        r.mutationRequests = [];\n      }\n      // Share the new name\n      r.share(\"schools\", this.state.id, [\n        new DocumentAccess(\"schoolRole\", `${this.state.name}/EMPLOYEE`, \"W\")\n      ].map(a => a.toString()));\n      r.put(\"schools\", school);\n    } else {\n      r.put(\"schools\", school);\n    }\n\n    await env.kedBackendClient.batch(r.mutationRequests);\n\n    location.hash = \"#/schools\";\n  }\n\n  async deleteSchool() {\n    if (confirm(L`r du sker p att ta bort skolan \"${this.state.name}\"`)) {\n      await env.kedBackendClient.delete(\"schools\", this.state.id);\n      location.hash= \"#/schools\";\n    }\n  }\n\n  render() {\n    const { title, id } = this.props;\n    const editExisting = !!id;\n    const school = this.state;\n    const origSchool = this.origSchool;\n    const isAdmin = env.currentUser.roles.some(role => role === \"ADMIN\");\n    return <div style={{ outline: 0 }}>\n      <CourseBanner\n        title=\"Skolor\" activePage=\"schools\" callbacks={{schools: ()=>location.hash=\"#/schools\"}}\n        routes={{feedback: this.props.feedbackUrl}} />\n      <div className=\"sv-row sv-layout\">\n        <div className=\"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer\">\n          <h2>{title}</h2>\n          <hr />\n          <div className=\"align-horizontal\">\n            <div className=\"horizontalItem top\">Namn:</div>\n            <div className=\"horizontalItem top\">\n              <input type=\"text\" autoFocus\n                disabled={!isAdmin}\n                tabIndex={1}\n                size={50}\n                value={school ? school.name : \"\"}\n                onChange={ev => this.setState({ name: ev.target.value })} />\n            </div>\n            <div className=\"horizontalItem top spaced\"></div>\n          </div>\n          {isAdmin && editExisting && <div tabIndex={2} className=\"btn btn-warning btn-large pull-right\" onClick={() =>\n            this.deleteSchool().catch(showError)}>\n            Ta bort skola\n          </div>}\n          <div className=\"pull-right\">&nbsp;</div>\n          <Link className=\"btn btn-warning btn-large pull-right\" to=\"/schools\">\n            Avbryt\n          </Link>\n          \n          {isAdmin && <a tabIndex={1} className={\"btn btn-large\"} onClick={() => {\n            if (origSchool && origSchool.name !== school.name) {\n              if (!confirm(L`r du sker p att du vill dpa om skolan? Detta pverkar portalens funktion fr lrare och elever som tillhr skolan. Namnet mste stmma exakt verens med namngivningen av skolan p anvndarobjekten.\n\nDet som hnder annars r att elever och lrare p skolan inte lngre hittar ngra kurser.\n\nBlir det fel kan du dock alltid bara dpa tillbaka skolans namn.`)) {\n                return;\n              }\n            }\n            this.save().catch(showError);\n          }}>Spara</a>}\n        </div>\n      </div>\n    </div>;\n  }\n}","import * as React from 'react';\nimport {EditSchool} from './edit-school';\n\ninterface Props {\n  feedbackUrl: string;\n}\n\nexport const NewSchool = (props: Props)=><EditSchool title=\"Lgg till skola\" feedbackUrl={props.feedbackUrl} />;\n","import * as React from 'react';\nimport { L } from '../../../utils/utils';\nimport { SkolverketSubject, SkolverketCourse } from './skolverket-subject';\nimport $ from 'jquery';\nimport env from '../../../globals/KED.env';\nimport { Subject, Course, Ability, KnowledgeRequirement, CentralContent } from 'kedbackend/models';\nimport { MutationRequest, BatchRunner, createUUID } from 'kedbackend/client';\nimport { SubjectToImport } from './subject-to-import';\nimport { loadCourse } from '../utils';\n\ninterface Props extends SkolverketSubject {\n  onCancel: () => void;\n  onImportSuccess: (subject: string) => void;\n}\n\ninterface Change {\n  change?: string;\n  content?: string;\n  mutations: (r: BatchRunner) => void;\n}\n\ninterface State {\n  showFullText: boolean;\n  changes: Change[];\n  isWorking: boolean,\n  isImporting: boolean\n}\n\nexport class UploadedSubject extends React.Component<Props, State> {\n  purposeElem: HTMLElement;\n  coursesElems: { [courseCode: string]: { course: SkolverketCourse, elem: HTMLElement } };\n  centralContentElems: HTMLElement[];\n  knowledgeRequirementElems: HTMLElement[];\n\n  constructor(props: Props) {\n    super(props);\n    this.coursesElems = {};\n    this.centralContentElems = [];\n    this.knowledgeRequirementElems = [];\n    this.state = {\n      showFullText: false,\n      changes: [],\n      isWorking: true,\n      isImporting: false\n    };\n  }\n\n  async componentDidMount() {\n    this.addClassesForCherryPickedElements();\n    try {\n      const changes = await this.diffWithExisting();\n      this.setState({ changes });\n    } finally {\n      this.setState({ isWorking: false });\n    }\n  }\n\n  addClassesForCherryPickedElements() {\n    const abilities = $(this.purposeElem).find('li').first().parent().children('li');\n    abilities.addClass('ability');\n    const centralContents = $(this.centralContentElems).find('li');\n    centralContents.addClass('central-content');\n    const knowledgeRequirements = $(this.knowledgeRequirementElems).find('p');\n    knowledgeRequirements.addClass('knowledge-requirement');\n    const all = $([abilities, centralContents, knowledgeRequirements]);\n    all.addClass('marked-area');\n  }\n\n  cherryPickData(): SubjectToImport {\n    //\n    // Reads elements (tagged by classes in addClassesForCherryPickedElements()) and converts their inner HTML to the corresponding\n    // model SubjectToImport. Note that if we need to adjust how to pick the right LI or P elements, we\n    // will only need to change the code in addClassesForCherryPickedElements(), not this code.\n    //\n    const skolSubject = this.props;\n    const abilities = Array.from($(this.purposeElem).find('li').first().parent().children('li'));\n\n    return {\n      name: skolSubject.name,\n      code: skolSubject.code,\n      abilities: abilities.map((a, i) => `${i + 1}. ${$(a).html()}`),\n      courses: Object.keys(this.coursesElems)\n        .map(courseCode => this.coursesElems[courseCode])\n        .map(({ course, elem }) => ({\n          name: course.name,\n          code: course.code,\n          points: course.points,\n          centralContent: Array.from($(elem).find('.central-content')).map(c => $(c).html()),\n          knowledgeRequirements:\n          Array.from($(elem).find('.grade-step-E .knowledge-requirement')).map(r => $(r).html())\n            .map(html => ({ gradeStep: \"E\", html }))\n            .concat(\n            Array.from($(elem).find('.grade-step-C .knowledge-requirement')).map(r => $(r).html())\n              .map(html => ({ gradeStep: \"C\", html })))\n            .concat(\n            Array.from($(elem).find('.grade-step-A .knowledge-requirement')).map(r => $(r).html())\n              .map(html => ({ gradeStep: \"A\", html })))\n        }))\n    };\n  }\n\n  async diffWithExisting(): Promise<Change[]> {\n    const subjectToImport = this.cherryPickData();\n    let changes: Change[] = [];\n    // Find existing Subject\n    const existingSubjects = await env.kedBackendClient.list<Subject>(\"subjects\");\n    let existingSubject = existingSubjects.filter(s => s.code === this.props.code)[0];\n    let centralContent = [] as CentralContent[],\n      knowledgeRequirements = [] as KnowledgeRequirement[];\n\n    let createTime = Date.now();\n    function ct() {\n      const rv = createTime;\n      createTime += 2;\n      return rv;\n    }\n\n    if (existingSubject) {\n      // Include abilities and standardCourses with the found Subject:\n      existingSubject = await env.kedBackendClient.get(\n        'subjects',\n        existingSubject.id, { include: \"courseTemplates\" });\n      // Lazily load all central contents and knowledgeRequirements on\n      // each course template\n      const expandedCourseTemplates = await Promise.all(\n        existingSubject.courseTemplates.map(ct => env.kedBackendClient.get<Course>(\"courses\", ct.id, {\n          include: [\n            'centralContent',\n            'knowledgeRequirements'\n          ]\n        })));\n\n      for (const courseTemplate of expandedCourseTemplates) {\n        // We don't have to include graphs. We already know that all courses\n        // with the same name and subjectCode will point to the same centralContent and\n        // same knowledgeRequirements.\n\n        // Now go through the XML data and record the order of centralContent\n        // and knowledgeRequirements:\n        const xmlCourse = subjectToImport.courses.find(c => c.name === courseTemplate.name);\n\n        const centralContentOrder = xmlCourse.centralContent\n          .map(html => courseTemplate.centralContent\n            .filter(cc => cc.name === html)\n            .map(cc => cc.id)[0]);\n\n        if (centralContentOrder.some(id => !id)) throw new Error(\n          \"Could not lookup all central contents!\");\n\n        const knowledgeRequirementsOrder = xmlCourse.knowledgeRequirements\n          .map(xmlKR => courseTemplate.knowledgeRequirements\n            .filter(kr => kr.name === xmlKR.html && kr.gradeStep === xmlKR.gradeStep)\n            .map(kr => kr.id)[0]);\n\n        if (knowledgeRequirementsOrder.some(id => !id)) throw new Error(\n          \"Could not lookup all knowledge requirements!\");\n\n        let derivedCourses = await env.kedBackendClient.list<Course>(\n          \"courses\", { name: courseTemplate.name });\n        // Just for sure - filter away courses with same name but different course code...\n        derivedCourses = derivedCourses.filter(c => c.subjectCode === subjectToImport.code);\n\n        for (const course of derivedCourses) {\n          if (!course.centralContentOrder ||\n            !course.knowledgeRequirementsOrder ||\n            course.centralContentOrder.join(',') !== centralContentOrder.join(',') ||\n            course.knowledgeRequirementsOrder.join(',') !== knowledgeRequirementsOrder.join(',')) {\n            course.centralContentOrder = centralContentOrder;\n            course.knowledgeRequirementsOrder = knowledgeRequirementsOrder;\n            changes.push({\n              change: \"Uppdatera ordningen fr centralt innehll och kunskapskrav\",\n              content: `${course.name} p ${course.school} (${course.description})`,\n              mutations: r => {\n                r.put(\"courses\", { ...course });\n              }\n            });\n          }\n        }\n      }\n    } else {\n      // Subject not imported before. Add it!\n      const newSubject: Subject = existingSubject = {\n        id: createUUID(),\n        acl: [\"role:USER:R\"],\n        code: subjectToImport.code,\n        name: subjectToImport.name,\n        publishable: false,\n        dateTime: ct()\n      };\n      changes.push({\n        change: \"Nytt mne\",\n        content: `${subjectToImport.name} (${subjectToImport.code})`,\n        mutations: r => r.add(\"subjects\", newSubject)\n      });\n\n      const subjectAbilities = [];\n\n      for (let a of subjectToImport.abilities) {\n        const newAbility: Ability = {\n          id: createUUID(),\n          name: a,\n          acl: [\"role:USER:R\"],\n          dateTime: ct()\n        };\n\n        subjectAbilities.push(newAbility); // To refer from in courses later on!\n\n        changes.push({\n          change: \"Ny frmga\",\n          content: a,\n          mutations: r => {\n            r.add(\"abilities\", newAbility);\n            r.link(\"subjects\", newSubject.id, \"abilities\", newAbility.id, \"abilities\");\n          }\n        });\n      }\n\n      for (let c of subjectToImport.courses) {\n        const newCourse: Course = {\n          id: createUUID(),\n          subjectCode: newSubject.code,\n          tags: [\"sub:\" + newSubject.code],\n          dateTime: ct(),\n          isTemplate: true,\n          acl: [\"role:EMPLOYEE:R\"], // Standardkurser endast synliga fr lrare\n          name: c.name,\n          code: c.code,\n          points: c.points,\n          modules: [],\n          subjectId: newSubject.id,\n          resources: [],\n          createdBy: { name: env.currentUser.displayName, url: \"mailto:\" + env.currentUser.mail },\n          createdDate: Date.now(),\n          knowledgeRequirementsOrder: [],\n          centralContentOrder: []\n        };\n\n        changes.push({\n          change: \"Ny kurs\",\n          content: c.name,\n          mutations: r => {\n            r.add(\"courses\", newCourse);\n            r.link(\"subjects\", newSubject.id, \"courses\", newCourse.id, \"courseTemplates\");\n          }\n        });\n\n        for (let html of c.centralContent) {\n          // Check if there exists an identical central content on previous course first\n          let newCentralContent = centralContent.filter(cc => cc.name === html)[0];\n          if (!newCentralContent) {\n            newCentralContent = {\n              id: createUUID(),\n              dateTime: ct(),\n              name: html,\n              acl: [\"role:USER:R\"]\n            };\n            centralContent.push(newCentralContent);\n\n            changes.push({\n              change: \"Nytt centralt innehll\",\n              content: html,\n              mutations: r => {\n                r.add(\"central-content\", newCentralContent);\n                r.link(\"courses\", newCourse.id, \"central-content\", newCentralContent.id, \"centralContent\");\n              }\n            });\n          } else {\n\n            changes.push({\n              mutations: r => {\n                r.link(\"courses\", newCourse.id, \"central-content\", newCentralContent.id, \"centralContent\");\n              }\n            });\n          }\n          // Register the order in which this central content appeared in the XML:\n          newCourse.centralContentOrder.push(newCentralContent.id);\n        }\n\n        for (let cr of c.knowledgeRequirements) {\n          let newKnowledgeRequirement = knowledgeRequirements.filter(kr => kr.name === cr.html && kr.gradeStep === cr.gradeStep)[0];\n          if (!newKnowledgeRequirement) {\n            newKnowledgeRequirement = {\n              id: createUUID(),\n              dateTime: ct(),\n              name: cr.html,\n              gradeStep: cr.gradeStep,\n              acl: [\"role:USER:R\"]\n            };\n\n            knowledgeRequirements.push(newKnowledgeRequirement);\n\n            changes.push({\n              change: \"Nytt kunskapskrav fr betyget \" + cr.gradeStep,\n              content: cr.html,\n              mutations: r => {\n                r.add(\"knowledge-requirements\", newKnowledgeRequirement);\n                r.link(\"courses\", newCourse.id, \"knowledge-requirements\", newKnowledgeRequirement.id, \"knowledgeRequirements\");\n              }\n            });\n          } else {\n            changes.push({\n              mutations: r => {\n                r.link(\"courses\", newCourse.id, \"knowledge-requirements\", newKnowledgeRequirement.id, \"knowledgeRequirements\");\n              }\n            })\n          }\n          // Register the order in which this knowledge requirement appeared in the XML:\n          newCourse.knowledgeRequirementsOrder.push(newKnowledgeRequirement.id);\n        }\n        // Build knowledge matrix\n\n        // Link directly from course template to all abilities that the subject has:\n        for (const a of subjectAbilities) {\n          changes.push({\n            mutations: r => {\n              r.link(\"courses\", newCourse.id, \"abilities\", a.id, \"abilities\");\n            }\n          })\n        }\n      }\n    }\n    return changes;\n  }\n\n  cancel() {\n    this.props.onCancel();\n  }\n\n  async import() {\n    this.setState({ isWorking: true, isImporting: true });\n    const allMutations = this.state.changes.map(change => change.mutations);\n    try {\n      await env.kedBackendClient.do(r => {\n        allMutations.forEach(mut => mut(r));\n      });\n    } finally {\n      this.setState({ isWorking: false, isImporting: false });\n    }\n    this.props.onImportSuccess(this.props.name);\n  }\n\n  fixL(html: string) {\n    return html;//.replace('<l fromat=\"OL\">')\n  }\n\n  render() {\n    return <div><h1>{L`Uppladdat mne`}</h1>\n      {this.state.isWorking ? <p>Arbetar...</p> :\n        this.state.isImporting ? <p>Importerar...</p> :\n          this.state.changes.length === 0 ?\n            <div>\n              <p>mnet redan importerat.</p>\n              <button onClick={() => this.cancel()}> OK </button>\n            </div> :\n        <div>\n          <table><thead><tr>\n          <th colSpan={2}>Granskning av ndringar i grund-data</th>\n        </tr><tr>\n            <th>ndring</th>\n            <th>Innehll</th>\n          </tr></thead><tbody>\n            {this.state.changes.filter(change => change.change).map(change => <tr key={change.change + change.content}>\n              <td>{change.change}</td>\n              <td dangerouslySetInnerHTML={{ __html: change.content }} />\n            </tr>)}\n          </tbody></table>\n        <button onClick={() => this.cancel()} disabled={this.state.isImporting}>Avbryt</button>\n        <button onClick={() => this.import()} disabled={this.state.isImporting}>Importera</button>\n        <br />\n        </div>} \n      <button\n        onClick={() => this.setState({ showFullText: !this.state.showFullText })}>\n        {this.state.showFullText ?\n          L`Dlj nedan` :\n          L`Visa hela texten frn Skolverket`}\n      </button>\n\n      {/* The table below is NOT just for show!\n          Functionality is dependent on its existence for importing stuff using jQuery to cherry-pick data. */}          \n      <table style={{ display: this.state.showFullText ? '' : 'none' }}><tbody><tr>\n        <th>\n          Namn\n          </th>\n        <td>\n          {this.props.name}\n        </td>\n      </tr><tr>\n          <th>\n            mneskod\n          </th>\n          <td>\n            {this.props.code}\n          </td>\n        </tr><tr>\n          <th>\n            Syfte\n          </th>\n          <td ref={elem => this.purposeElem = elem} dangerouslySetInnerHTML={{ __html: this.fixL(this.props.purpose) }} />\n        </tr><tr>\n          <th>\n            Kurser\n          </th>\n          <td>\n            {this.props.courses.map(course => <table key={course.code} ref={elem => this.coursesElems[course.code] = { course, elem }}><tbody>\n              <tr><th>Kursens namn</th><td>{course.name}</td></tr>\n              <tr><th>Kurskod</th><td>{course.code}</td></tr>\n              <tr><th>Pong</th><td>{course.points}</td></tr>\n              <tr><th>Centralt innehll</th><td ref={elem => this.centralContentElems.push(elem)} dangerouslySetInnerHTML={{ __html: this.fixL(course.centralContent) }} /></tr>\n              <tr><th>Kunskapskrav Betyg E</th><td className=\"grade-step-E\" ref={elem => this.knowledgeRequirementElems.push(elem)} dangerouslySetInnerHTML={{ __html: this.fixL(course.knownledgeRequirements.filter(r => r.gradeStep === 'E')[0].text) }} /></tr>\n              <tr><th>Kunskapskrav Betyg C</th><td className=\"grade-step-C\" ref={elem => this.knowledgeRequirementElems.push(elem)} dangerouslySetInnerHTML={{ __html: this.fixL(course.knownledgeRequirements.filter(r => r.gradeStep === 'C')[0].text) }} /></tr>\n              <tr><th>Kunskapskrav Betyg A</th><td className=\"grade-step-A\" ref={elem => this.knowledgeRequirementElems.push(elem)} dangerouslySetInnerHTML={{ __html: this.fixL(course.knownledgeRequirements.filter(r => r.gradeStep === 'A')[0].text) }} /></tr>\n            </tbody></table>)}\n          </td>\n        </tr></tbody></table>\n    </div>\n  }\n}\n","import * as React from 'react';\nimport { L } from '../../../utils/utils';\nimport { Subject } from 'kedbackend/models';\nimport env from '../../../globals/KED.env';\nimport { HashRouter as Router, Route, Link, Redirect } from 'react-router-dom';\nimport { CourseBanner } from \"../courses/course-banner\";\nimport { Spinner } from \"../sub-components/spinner\";\n\ninterface Props {\n  id: string\n  feedbackUrl: string\n}\n\ninterface State {\n  subject: Subject\n}\n\nexport class ShowSubject extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {subject: null};\n  }\n\n  componentWillMount() {\n    this.load();\n  }\n\n  async load() {\n    const subject = await env.kedBackendClient.get<Subject>('subjects', this.props.id, { include: 'courseTemplates' });\n    this.setState({ subject });\n  }\n\n  render() {\n    if (!this.state.subject) return <p><Spinner /></p>;\n    const { name, code, courseTemplates } = this.state.subject;\n    return <div><CourseBanner\n      title={name}\n      activePage=\"subjects\"\n      routes={{feedback: this.props.feedbackUrl}}\n       />\n      <h2>Kurser fr mnet {name} ({code})</h2>\n      <ul className=\"entity-list\">\n        {courseTemplates.map(({id, name, code, publishable, points}) =>\n          <li key={id} className=\"complete\">\n            {name} - {points}p\n          </li>)}\n      </ul>\n    </div>;\n  }\n}\n","import * as React from 'react';\nimport { L, showInfo, compareProp } from '../../../utils/utils';\nimport env from '../../../globals/KED.env';\nimport { Subject } from 'kedbackend/models';\nimport $ from 'jquery';\nimport { SkolverketSubject } from './skolverket-subject';\nimport { UploadedSubject } from './uploaded-subject';\nexport { ShowSubject } from './show-subject';\nimport { HashRouter as Router, Route, Link, Redirect } from 'react-router-dom';\nimport { readBlobAsText, allowCopy } from \"../utils\";\nimport { CourseBanner } from \"../courses/course-banner\";\nimport { Spinner } from \"../sub-components/spinner\";\n\ninterface Props {\n  feedbackUrl: string\n}\n\ninterface State {\n  subjects: Subject[];\n  isListingSubjects: boolean;\n  uploadedSubject: SkolverketSubject | null;\n}\n\nexport class Subjects extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      isListingSubjects: true,\n      subjects: [],\n      uploadedSubject: null\n    };\n  }\n\n  componentWillMount() {\n    this.load();\n  }\n\n  async load() {\n    const subjects = await env.kedBackendClient.list(\"subjects\");\n    subjects.sort(compareProp(\"name\"));\n    this.setState({ subjects, isListingSubjects: false });\n  }\n\n  async handleFileSelect(ev: React.DragEvent<HTMLDivElement>) {\n    ev.stopPropagation();\n    ev.preventDefault();\n    const files = ev.dataTransfer.files;\n    const xml = await readBlobAsText(files[0]);\n    const doc = $($.parseXML(xml));\n    const model : SkolverketSubject = {\n      name: doc.find(\"subject>name\").text(),\n      code: doc.find(\"subject>code\").text(),\n      purpose: doc.find(\"subject>purpose\").text(),\n      courses: []\n    };\n    const courses = doc.find(\"subject>courses\");\n    for (let i=0; i<courses.length; ++i) {\n      const course = $(courses[i]);\n      const knownledgeRequirements = [].slice.call(course.find(\"knowledgeRequirements\"))\n        .map(r => ({gradeStep: $(r).find('gradeStep').text(), text: $(r).find('text').text()}));\n\n      model.courses.push({\n        name: course.find(\"name\").text(),\n        code: course.find(\"code\").text(),\n        centralContent: course.find(\"centralContent\").text(),\n        points: parseInt(course.find(\"point\").text()),\n        knownledgeRequirements,\n      });\n    }\n    this.setState({uploadedSubject: model});\n  }\n\n  onImportSuccess(subject) {\n     showInfo(L`Importen av ${subject} lyckades`);\n     this.setState({uploadedSubject: null});\n     this.load();\n  }\n\n  render() {\n    return <div><CourseBanner\n      title={L`mnen`}\n      activePage=\"subjects\"\n      routes={{feedback: this.props.feedbackUrl}}\n     />\n      {this.state.uploadedSubject ?\n      <UploadedSubject\n        onCancel={()=>this.setState({uploadedSubject: null})}\n        onImportSuccess={subject => this.onImportSuccess(subject)}\n        {...this.state.uploadedSubject} />\n    : this.state.isListingSubjects ?\n      <div><p><Spinner/>Var god vnta medan mnen hmtas...</p></div> :\n      <div>\n        <h2>{L`mnen`}</h2>\n        <ul>{this.state.subjects.map(s =>\n          <li key={s.id} className={s.publishable ? \"complete\" : \"incomplete\"}>\n            <Link to={\"/subjects/\" + s.id}>{s.name}</Link>\n          </li>)}\n        </ul>\n        <div className=\"drop-zone\" onDragOver={allowCopy} onDrop={ev=>this.handleFileSelect(ev)}>\n          Droppa Subject-fil hr frn skolverket (Hmtas frn <a href=\"http://opendata.skolverket.se\" target=\"skolverket\">opendata.skolverket.se</a>)\n        </div>\n      </div>\n    }</div>\n  }\n}\n","import * as React from 'react';\nimport { L } from '../../../utils/utils';\nimport { SchoolCourses } from '../sub-components/school-courses';\nimport { Resource } from 'kedbackend/models';\nimport { dtFormat } from '../utils';\nimport { Dialog } from '../interfaces/course-editor-host';\nimport validUrl from 'valid-url';\n\ninterface Props {\n  resource?: Resource;\n  title: string;\n  onSave: (newResource: Resource) => void;\n  onDelete?: ()=>void;\n}\n\ntype State = Resource;\n\nexport class EditResource extends React.Component<Props,State> implements Dialog {\n  constructor(props: Props) {\n    super(props);\n    this.state = this.props.resource || {name: '', url: ''};\n  }\n\n  save() {\n    const resource = this.state;\n    if (!validUrl.isUri(resource.url)) throw new Error(L`Angiven URL '${resource.url}' r ogiltig. Ska brja med exempelvis http:, https: eller mailto:`);\n    this.props.onSave(resource);\n  }\n\n  render() {\n    const {title, onSave, onDelete} = this.props;\n    const resource = this.state;\n    const isValidUrl = validUrl.isUri(this.state.url);\n\n    return <div><div className=\"sv-html-portlet sv-portlet sv-skip-spacer\">\n      <h2>{title}</h2>\n      <hr />\n      <div className=\"align-horizontal\">\n        <div className=\"horizontalItem top\">Namn:</div>\n        <div className=\"horizontalItem top\">\n          <input type=\"text\" autoFocus\n            tabIndex={1}\n            size={50}\n            value={resource.name}\n            onChange={ev=>this.setState({name: ev.target.value})} />\n        </div>\n        <div className=\"horizontalItem top spaced\"></div>\n      </div>\n      <div className=\"align-horizontal\">\n        <div className=\"horizontalItem top\">Lnk:</div>\n        <div className=\"horizontalItem top \">\n          <input type=\"text\"\n            tabIndex={1}\n            size={50}\n            value={resource.url}\n            onChange={ev=>this.setState({url: ev.target.value})} />\n        </div>\n        <div className=\"horizontalItem top spaced\"></div>\n      </div>\n      <br /></div>\n      <div className=\"sv-html-portlet sv-portlet\">\n        {(resource.createdDate || resource.modifiedDate) && <div>\n          {resource.createdDate && <p>\n            Resursen/Lnken skapades {dtFormat(resource.createdDate)} av <strong>{resource.createdBy.name}</strong>.\n          </p>}\n          {resource.modifiedDate && <p>\n            Resursen/Lnken redigerades senast {dtFormat(resource.modifiedDate)} av <strong>{resource.modifiedBy.name}</strong>.\n          </p>}\n          <br /><br/>\n        </div>}\n        {onDelete && <div tabIndex={2} className=\"btn btn-warning btn-large pull-right\" onClick={()=>onDelete()}>\n          Ta bort resurs/lnk\n        </div>}\n        <a tabIndex={1} className={\"btn btn-large\" + (isValidUrl ? \"\" : \" btn-inactive\")} onClick={isValidUrl && (() => onSave(resource))}>Spara</a>\n      </div>\n    </div>\n  }\n}\n","import * as React from 'react';\nimport {Resource} from 'kedbackend/models';\nimport {Link} from 'react-router-dom';\nimport {ICourseEditorHost} from '../interfaces/course-editor-host';\nimport {EditResource} from '../modal-pages/edit-resource';\nimport { updateModificationAndCreationStamps } from '../utils';\nimport env from '../../../globals/KED.env';\n\ninterface Props {\n  resources: Resource[];\n  onUpdate: (resourcesUpdates) => void;\n  host: ICourseEditorHost;\n}\n\ninterface State {\n\n}\n\nexport class EditableResourceList extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state={};\n  }\n\n  render() {\n    const {host, onUpdate, resources} = this.props;\n    return <div>\n      <div className=\"taskContainer\">\n        {resources.map((resource, idx) => \n          <div className=\"align-horizontal\" key={idx}>\n            <div className=\"horizontalItem top\">\n              <a className=\"editItem\" onClick={()=>host.openDialog({\n                Component: EditResource,\n                props: {\n                  title: \"Redigera resurs\",\n                  resource,\n                  onSave: editedResource => {\n                    const updatedResource = updateModificationAndCreationStamps(editedResource, env.currentUser);\n                    onUpdate({$splice: [[idx, 1, updatedResource]]});\n                    host.closeDialog();\n                  },\n                  onDelete: ()=>{\n                    onUpdate({$splice: [[idx, 1]]});\n                    host.closeDialog();\n                  }\n                }\n              })}></a>\n            </div>\n            <div className=\"horizontalItem top\">\n              <a href={resource.url} target=\"_blank\" >{resource.name}</a>\n            </div>\n          </div>)}\n     </div>\n    <a className=\"btn\" onClick={()=>host.openDialog({\n      Component: EditResource,\n      props: {\n        title: \"Lgg till resurs\",\n        onSave: newResource => {\n          const updatedResource = updateModificationAndCreationStamps(newResource, env.currentUser);\n          onUpdate({$push: [updatedResource]})\n          host.closeDialog();\n        }\n      }\n    })}><i className=\"fa fa-paperclip\" aria-hidden></i> Lgg till resurs</a>\n    </div>\n  }\n}\n","import * as React from 'react';\nimport {Ability, KnowledgeRequirement} from 'kedbackend/models';\nimport env from '../../../globals/KED.env';\nimport {RemoveItem} from './remove-item';\nimport update from 'react-addons-update';\n\ninterface Props {\n  knowledgeRequirements: KnowledgeRequirement[];\n  idsToMarkNotOk?: {[id: string]: true};\n  // Props used in edit mode (editing course templates)\n  coveredIds?: string[];\n  // Props used in mark mode (editing tasks)\n  markMode?: boolean;\n  markedIds?: string[];\n  onMarkChanged: (id: string, isMarked: boolean) => void;\n}\n\nexport class KnowledgeMatrix extends React.Component<Props, {}> {\n  constructor(props: Props) {\n    super(props);\n  }\n\n  render() {\n    const { knowledgeRequirements, markedIds } = this.props;\n    const { idsToMarkNotOk, markMode, onMarkChanged } = this.props;\n\n    const columns = [\"E\", \"C\", \"A\"];\n    const rows: KnowledgeRequirement[][] = [];\n    const reqs = knowledgeRequirements.slice();\n    let row: KnowledgeRequirement[] | null = null;\n    while (true) {\n      row = columns.map(grade => {\n        const pNext = reqs.findIndex(r => r.gradeStep.toUpperCase() === grade);\n        if (pNext < 0) return null;\n        const rv = reqs[pNext];\n        reqs.splice(pNext, 1);\n        return rv;\n      });\n      if (row.every(r => r === null))\n        break;\n      rows.push(row);\n    }\n\n    return <div>\n      <table>\n        <thead>\n          <tr>\n            {columns.map(c => <th key={c}>{c}</th>)}\n          </tr>\n        </thead>\n        <tbody>\n          {rows.map((row,i) =>\n            <tr key={i}>\n              {row.map((requirement,j) => {\n                const isMarkedOK = requirement && markedIds && markedIds.indexOf(requirement.id) >= 0;\n                const isMarkedNotOK = requirement && idsToMarkNotOk && idsToMarkNotOk[requirement.id];\n                return <td\n                  key={j}\n                  dangerouslySetInnerHTML={{__html: requirement ? requirement.name : \"\"}}\n                  className={(markMode ? \"selectable\" : \"\") +\n                  (isMarkedOK ?\n                    \" markedGreen\" :\n                    (isMarkedNotOK ?\n                      \" markedRed\":\n                      \"\"))}\n                    onClick={markMode && requirement ?\n                      ()=>onMarkChanged(requirement.id, !isMarkedOK) :\n                      undefined} />\n              })}\n            </tr>\n          )}\n        </tbody>\n      </table>\n    </div>\n\n    {/*return <div>\n      <table>\n        <thead>\n          <tr>\n            <th>E</th>\n            <th>C</th>\n            <th>A</th>\n          </tr>\n        </thead>\n        <tbody>\n          {tbody.map((row, i) => \n          <tr key={i}>{row.map((cell, j) => {\n            const isMarkedOK = props.markedIds && props.markedIds.indexOf(cell.id) >= 0;\n            const isMarkedNotOK = props.idsToMarkNotOk && props.idsToMarkNotOk[cell.id];\n            return <td\n              key={j}\n              rowSpan={cell.rowSpan}\n              className={(props.markMode ? \"selectable\" : \"\") +\n                (isMarkedOK ?\n                  \" markedGreen\" :\n                  (isMarkedNotOK ?\n                    \" markedRed\":\n                    \"\"))}\n              onClick={props.markMode && (()=>props.onMarkChanged(cell.id, !isMarkedOK))}>\n              {cell.html && <div style={{position: 'relative'}}>\n                <p\n                  className={cell.type === 'ability' ? 'abilityText' : 'criteriaText'}\n                  dangerouslySetInnerHTML={{__html: cell.html}} />\n                {props.editMode && <RemoveItem className=\"upperRight\" onClick={()=>\n                  this.setCellIds(\n                    cell.type,\n                    cell.rowIndex,\n                    this.getCellIds(\n                      cell.type,\n                      cell.rowIndex).filter(id => id != cell.id) )} /> }\n              </div>}\n            </td>})}\n          </tr>)}\n        </tbody>\n      </table>\n    </div>*/}\n  }\n}\n","import * as React from 'react';\nimport { Course, CourseModule, Task, Document } from 'kedbackend/models';\nimport { OpenCloseBox } from \"../../utility-components/open-close-box\";\n\ninterface Props {\n  options: Document[];\n  title;\n  markMode: boolean;\n  markedIds: string[];\n  onMarkChanged: (id: string, isMarked: boolean) => void;\n}\n\ninterface State {\n}\n\nexport class SelectRelatedDocs extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {};\n  }\n\n  render() {\n    const {options, title, markedIds, markMode} = this.props;\n    return <OpenCloseBox title={<p>{title}</p>} className=\"larger\">\n        {options.map(option => {\n          const isMarked = markedIds.some(x => x === option.id);\n          return <div className=\"align-horizontal\" key={option.id} onClick={()=>\n            markMode && this.props.onMarkChanged(option.id, !isMarked)}>\n            <div className={\"horizontalItem top spaced\" +\n              (markMode ? \" selectable\" : \"\") +\n              (isMarked ? \" markedGreen\" : \"\")}>\n              <p dangerouslySetInnerHTML={{__html: option.name}} />\n              <br />\n            </div>\n          </div>;\n        })}\n    </OpenCloseBox>\n  }\n}","\nexport class CachedResponse<T> {\n    promise: Promise<T> | null;\n    result: T | null;\n    constructor(public queryer: ()=>Promise<T>) {\n        this.promise = null;\n        this.result = null;\n    }\n\n    query() {\n        return this.promise ?\n            this.promise :\n            (this.promise = this.queryer().then(x => this.result = x));\n    }\n\n    reset() {\n        this.promise = null;\n    }\n}\n","import {TC} from '../utils/utils';\n\nexport type Term = 'AT' | 'ST';\nexport type AcademicYear = string; // \"2016/2017\", \"2017/2018\", ...\nexport type SchoolGrade = number; // 0-9 (grundskola), 10-13 (gymnasium)\nexport type Grade = 'A' | 'B' | 'C' | 'D' | 'E';\n\nexport interface User {\n    username?: string;\n    mail: string;\n    displayName: string;\n    roles: string[];\n    schoolGrade?: number;\n    school?: string;\n    schoolType?: string;\n}\n\nexport interface LearningModuleTasks {\n    moduleName: string;\n    url?: string;\n    subject: SchoolSubject;\n    commonTasks?: LearningTask[];\n    learningGoals: LearningGoal[];\n}\n\nexport interface LearningGoal {\n    name: string;\n    tasks?: LearningTask[];\n}\n\nexport interface CustomGoal {\n  name: string,\n  url: string,\n  course: string,\n  description: string\n}\n\n\n/*export interface LearningGoal {\n    id?: string;\n    name: string;\n    courseId?: string;\n    subjectId?: string;\n}*/\n\n\nexport interface LearningTask {\n    name: string;\n    url?: string;\n    description?: string;\n    done?: boolean;\n}\n\nexport interface LearningCourse {\n    name: string;\n    url?: string;\n}\n\nexport interface SchoolSubject {\n    name: string;\n    course: LearningCourse;\n}\n\nexport class Course {\n    //Schema: \"[year+term+schoolYear+name],sortorder\";\n    id?: string;\n    //aYear: string; // Academic Year / Lsr / \"2016/2017\", \"2017/2018\", ...\n    //schoolGrade: number; // rskurs (0-9 grundskola, 10-13 gymnasium). 100 = ej bundet till rskurs.\n    //term?: Term; // AT (Autumn Term) / ST (Spring Term)\n    name: string;\n    points?: number;\n    modules?: CourseModule[];\n    learningGoals?: LearningGoal[];\n    url?: string;\n}\n\n\nexport interface CourseModule {\n    id?: string;\n    courseId: string;\n    name: string;\n    readonly url: string;\n}\n\nexport interface TargetGrade {\n    id?: string;\n    user: string;\n    courseId?: string;\n    subjectId?: string;\n    aYear?: AcademicYear; // Lsr, tex \"2016/2017\". null means final goal.\n    term?: Term; // null means final goal.\n    grade: Grade;\n}\n\n\nexport const futureAbilities = [\n    \"Lra att lra\",\n    \"Samarbeta\",\n    \"Agera globalt\",\n    \"Visa handlingskraft\",\n    \"Vara innovativ\",\n    \"Leva digitalt\"];\n","import $ from 'jquery';\n\nconst parser = new DOMParser();\n\ntype HTMLPolicy = {[tagNameLower: string]: {[attributeLower: string]: boolean}};\n\n/** Tags / Attributes Whitelist\n * \n */\nconst HTML_WASH_POLICY: HTMLPolicy = {\n  b: {},  // bold\n  i: {},  // italic\n  p: {},  // paragraph\n  u: {},  // underline\n  strike: {}, // strike-through\n  pre: {}, // unformatted\n  h1: {}, // heading 1\n  h2: {}, // heading 2\n  h3: {}, // heading 3\n  h4: {}, // heading 4\n  h5: {}, // heading 5\n  img: {src: true, class: true, style: true, tabindex: true}, // image. We set style and tabindex ourselves. Accept that.\n  a: {href: true, target: true}, // link\n  ul: {}, // Unordered list\n  ol: {}, // Ordered list\n  li: {}, // list item\n  hr: {}, // Horizontal rule\n  br: {}, // Break line\n  div: {},// Of some reason, divs are sometimes inserted when pressing ENTER in the wysiwyg editor.\n  span: {},// Spans are harmless, just remove their style and other attributes and I feel great.\n  // table tags:\n  table: {border: true},\n  tbody: {},\n  thead: {},\n  tfoot: {},\n  tr: {},\n  td: {headers: true, colspan: true, rowspan: true},\n  th: {abbr: true, headers: true, scope: true, sorted: true, colspan: true, rowspan: true}\n};\n\nexport function washHtml (html: string): string {\n  const doc = parser.parseFromString(html, \"text/html\");\n  const {childNodes} = doc.body;\n  let modified = false;\n  for (let i=0; i<childNodes.length; ++i) {\n    if (washNode(childNodes.item(i))) {\n      modified = true;\n    }\n  }\n  return modified ?\n    doc.body.innerHTML :\n    html; // By returning the original HTML string, we spare the user from refreshing the edit area,\n          // which would otherwise put the cursor at the top, losing the position where user where.\n}\n\nfunction washNode(node: Node | Element | HTMLElement): boolean {\n  let modified = false;\n  if (isElement(node)) {\n    if (washElement(node)) {\n      modified = true;\n    }\n  }\n  if (washChildNodes(node)) {\n    modified = true;\n  }\n  return modified;\n}\n\nfunction washChildNodes(node: Node) {\n  let modified = false;\n  const {childNodes} = node;\n  for (let i=0; i<childNodes.length; ++i) {\n    if (washNode(childNodes.item(i))) {\n      modified = true;\n    }\n  }\n  return modified;\n} \n\n/** Replace an element with its child nodes.\n * \n */\nfunction removeMiddleElement(element: Element) {\n  const {childNodes} = element;\n  for (let i=0; i<childNodes.length; ++i) {\n    element.parentNode.insertBefore(childNodes.item(i), element);\n  }\n  element.remove();\n}\n\nfunction washElement(element: Element): boolean {\n  const policy = element.tagName && HTML_WASH_POLICY[element.tagName.toLowerCase()];\n  if (!policy) {\n    console.warn(\"Wysiwyg: not allowed tag\", element.tagName);\n    washChildNodes(element);\n    removeMiddleElement(element);\n    return true;\n  }\n  let modified = false;\n  for (let i=0; i<element.attributes.length; ++i) {\n    const attr = element.attributes.item(i);\n    const allowed = attr.name && !!policy[attr.name.toLowerCase()];\n    if (!allowed) {\n      modified = true;\n      console.warn(\"Wysiwyg: not allowed attribute\", attr.name);\n      element.removeAttribute(attr.name);\n    }\n  }\n  return modified;\n}\n\nfunction isElement(node: Node) : node is Element {\n  return !!(node as Element).tagName;\n}\n","export default (command, value = null) => {\n  document.execCommand(command, false, value)\n}\n","import exec from './exec';\n\nexport default {\n  bold: {\n    icon: '<b>B</b>',\n    title: 'Bold',\n    result: () => exec('bold')\n  },\n  italic: {\n    icon: '<i>I</i>',\n    title: 'Italic',\n    result: () => exec('italic')\n  },\n  underline: {\n    icon: '<u>U</u>',\n    title: 'Underline',\n    result: () => exec('underline')\n  },\n  strikethrough: {\n    icon: '<strike>S</strike>',\n    title: 'Strike-through',\n    result: () => exec('strikeThrough')\n  },\n  heading1: {\n    icon: '<b>H<sub>1</sub></b>',\n    title: 'Heading 1',\n    result: () => exec('formatBlock', '<H1>')\n  },\n  heading2: {\n    icon: '<b>H<sub>2</sub></b>',\n    title: 'Heading 2',\n    result: () => exec('formatBlock', '<H2>')\n  },\n  heading3: {\n    icon: '<b>H<sub>3</sub></b>',\n    title: 'Heading 3',\n    result: () => exec('formatBlock', '<H3>')\n  },\n  paragraph: {\n    icon: '&#182;',\n    title: 'Paragraph',\n    result: () => exec('formatBlock', '<P>')\n  },\n  quote: {\n    icon: '&#8220; &#8221;',\n    title: 'Quote',\n    result: () => exec('formatBlock', '<BLOCKQUOTE>')\n  },\n  olist: {\n    icon: '&#35;',\n    title: 'Ordered List',\n    result: () => exec('insertOrderedList')\n  },\n  ulist: {\n    icon: '&#8226;',\n    title: 'Unordered List',\n    result: () => exec('insertUnorderedList')\n  },\n  code: {\n    icon: '&lt;/&gt;',\n    title: 'Code',\n    result: () => exec('formatBlock', '<PRE>')\n  },\n  line: {\n    icon: '&#8213;',\n    title: 'Horizontal Line',\n    result: () => exec('insertHorizontalRule')\n  },\n  link: {\n    icon: '&#128279;',\n    title: 'Link',\n    result: () => {\n      const url = window.prompt('Enter the link URL')\n      if (url) exec('createLink', url)\n    }\n  },\n  image: {\n    icon: '&#128247;',\n    title: 'Image',\n    result: () => {\n      const url = window.prompt('Enter the image URL')\n      if (url) exec('insertImage', url)\n    }\n  }\n}\n","import * as React from 'react';\nimport exec from './exec';\nimport {washHtml} from './wash-html';\nimport imageEditActions from './image-edit-actions';\nimport actions from './actions';\n\nexport interface Action {\n  name?: string;\n  icon: string;\n  title: string;\n  result: (ev: React.MouseEvent<HTMLButtonElement>, component: Wysiwyg) => void;\n}\n\ninterface Props {\n  className?: string;\n  html: string;\n  onChange?: (html: string) => void;\n  defaultActions?: {[name: string]: Action};\n  actions?: (Partial<Action> | string)[];\n  readOnly?: boolean;\n}\n\ninterface State {\n  focusRect: ClientRect | null;\n}\n\nconst classes = {\n  actionbar: 'wysiwyg-actionbar',\n  button: 'wysiwyg-button',\n  content: 'wysiwyg-content',\n  focusrect: 'wysiwyg-focusrect',\n  focuspoint: 'wysiwyg-focuspoint',\n  readonlyContent: 'wysiwyg-content readonly'\n}\n\nexport class Wysiwyg extends React.Component<Props,State> {\n  contentDiv: HTMLDivElement;\n  focusRectDiv: HTMLDivElement;\n  focusElem: HTMLElement | null;\n  corner: string;\n  resizeStartX: number;\n\n  constructor (props: Props) {\n    super(props);\n    this.state = {focusRect: null};\n    this.onFocus = this.onFocus.bind(this);\n    this.onBlur = this.onBlur.bind(this);\n    this.onMouseDown = this.onMouseDown.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n  }\n\n  componentDidMount() {\n    Array.from(this.contentDiv.querySelectorAll(\"img,a\")).map(elem => (elem as (HTMLImageElement | HTMLAnchorElement)))\n    .forEach(elem => {\n      elem.tabIndex = 1;\n      elem.onfocus = this.onFocus;\n      elem.onblur = this.onBlur as any;\n    });\n    document.addEventListener('mousedown', this.onMouseDown);\n    document.addEventListener('mousemove', this.onMouseMove);\n    document.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  componentDidUpdate() {\n    Array.from(this.contentDiv.querySelectorAll(\"img,a\")).map(elem => (elem as (HTMLImageElement | HTMLAnchorElement)))\n    .forEach(elem => {\n      elem.tabIndex = 1;\n      elem.onfocus = this.onFocus;\n      elem.onblur = this.onBlur as any;\n    });\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mousedown', this.onMouseDown);\n    document.removeEventListener('mousemove', this.onMouseMove);\n    document.removeEventListener('mouseup', this.onMouseUp);\n  }\n\n  shouldComponentUpdate(nextProps: Props, nextState: State) {\n    //this.contentDiv.onfocus = this.onFocus;\n    //this.contentDiv.onblur = this.onBlur;\n    return !this.contentDiv ||\n      nextState != this.state ||\n      nextProps.readOnly !== this.props.readOnly ||\n      nextProps.html !== this.contentDiv.innerHTML;\n  }\n\n  triggerOnChange(html: string) {\n    this.props.onChange && this.props.onChange(washHtml(html));\n  }\n\n  onFocus(ev: FocusEvent) {\n    const elem = ev.target as HTMLElement;\n    if (!elem || !elem.tagName) return;\n    if (elem.tagName !== 'IMG' && elem.tagName !== 'A') return;\n    const contentParent = this.contentDiv.parentElement;\n    const newState = {\n      focusRect: getRelatativeClientRect(contentParent, elem),\n    }\n    switch (elem.tagName) {\n      case 'A':\n      case 'IMG':\n\n      default: break;\n    }\n    this.setState(newState);\n    this.focusElem = elem;\n  }\n\n  onBlur(ev: React.FocusEvent<HTMLDivElement>) {\n    /*if (ev.relatedTarget) {\n      const relatedTarget = ev.relatedTarget as HTMLElement;\n      if (relatedTarget.className && relatedTarget.className.split(' ').indexOf(classes.button) >= 0) {\n        // A image action button was pressed\n        set\n        return;\n      }\n    }*/\n    if ((ev.target === this.focusElem && ev.relatedTarget !== this.focusRectDiv) ||\n      ev.target === this.focusRectDiv)\n    {\n      this.setState({focusRect: null});\n    }\n  }\n\n  makeClickable(elem: HTMLElement) {\n     elem.tabIndex = 1;\n  }\n\n  onMouseDown(ev) {\n    if ((ev.target.className || \"\").split(' ').indexOf(classes.focuspoint) >= 0) {\n      const corner = this.getRectCorner(ev);\n      this.corner = corner;\n      this.resizeStartX = ev.clientX;\n    }\n  }\n\n  onMouseMove(ev: MouseEvent) {\n    if (this.corner && this.state.focusRect && this.focusElem) {\n      ev.preventDefault();\n      // TODO: Rkna ut baserat p this.corner hur bildens storlek borde ndras.\n      // Leta upp bilden per ID frn this.contentDiv\n      // Stt DIV:ens style attribut width till ny width.\n      // Om DIV:en redan hade height, stt ny height med samma aspect ratio som innan,\n      // annars, stt inte height alls (eller mjligtvis till auto))\n      const focusRect = this.focusRectDiv.getBoundingClientRect();\n      if (focusRect.width < 32) return;\n      //const currentWidth = focusRect.width;\n      //const currentHeight = focusRect.height;\n      //const hasHeightStyle = !this.focusElem.style.height || this.focusElem.style.height === \"auto\";\n      const newWidth = Math.max(32, this.corner.endsWith('l') ?\n        focusRect.width + (this.resizeStartX - ev.clientX) :\n        //focusRect.right - ev.clientX :\n        focusRect.width - (this.resizeStartX - ev.clientX));\n      this.resizeStartX = ev.clientX;\n        //ev.clientX - focusRect.left;\n      const factor = newWidth / focusRect.width;\n      const newHeight = focusRect.height * factor;\n      this.focusElem.style.width = newWidth + \"px\";\n      this.focusElem.style.height = newHeight + \"px\";\n      this.setState({\n        focusRect: getRelatativeClientRect(this.contentDiv.parentElement, this.focusElem),\n      });\n    }\n  }\n\n  onMouseUp(ev) {\n    if (this.corner && this.state.focusRect && this.focusElem) {\n      this.corner = null;\n      this.triggerOnChange(this.contentDiv.innerHTML);\n    }\n  }\n\n  getRectCorner(ev) {\n    for (const className of (ev.target.className || '').split(' ')) {\n      switch (className) {\n        case 'fpul':\n          return 'ul';\n        case 'fpur':\n          return 'fpur';\n        case 'fplr':\n          return 'lr';\n        case 'fpll':\n          return 'll';\n      }\n    }\n    return null;\n  }\n\n  execImageEditAction (cmd: string) {\n    //console.log(cmd);\n    if (!this.focusElem) return;\n    //console.log(\"doing it\");\n    switch (cmd) {\n      case 'float-left':\n        this.focusElem.style.cssFloat = 'left';\n        break;\n      case 'float-right':\n        this.focusElem.style.cssFloat = 'right';\n        break;\n      case 'unfloat':\n        this.focusElem.style.cssFloat = '';\n        break;\n    }\n    this.triggerOnChange(this.contentDiv.innerHTML);\n    this.setState({focusRect: getRelatativeClientRect(this.contentDiv.parentElement, this.focusElem)});\n  }\n\n  render() {\n    const defaultActions = this.props.defaultActions || actions;\n    let actionsToUse = this.props.actions ? this.props.actions.map(action =>\n      typeof action === 'string' ?\n        defaultActions[action] :\n        defaultActions[action.name] ?\n          { ...defaultActions[action.name], ...action } :\n          action)\n    : Object.keys(defaultActions).map(action => defaultActions[action]);\n\n    if (this.state.focusRect) {\n      actionsToUse = actionsToUse.concat(imageEditActions(cmd => this.execImageEditAction(cmd)));\n    }\n\n    const {focusRect} = this.state;\n    const {readOnly} = this.props;\n\n    return <div className={this.props.className}>\n      {!readOnly && <div className={classes.actionbar}>\n        {actionsToUse.map((action, idx) =>\n          <button key={idx} className={classes.button}\n            dangerouslySetInnerHTML={{__html: action.icon}}\n            title={action.title}\n            onMouseDown={ev=>{action.result(ev, this)}}\n            onMouseUp={ev=>setTimeout(()=>this.contentDiv.focus(), 10)}\n          />)}\n      </div>}\n      <div className={readOnly ? classes.readonlyContent : classes.content} style={{position: 'relative', top: 0, left: 0}}>\n        <div className=\"editor\"\n          ref={div => this.contentDiv = div}\n          dangerouslySetInnerHTML={{__html: washHtml(this.props.html)}}\n          contentEditable={!readOnly}\n          onInput={ev => this.triggerOnChange((ev.target as any).innerHTML)}\n          onKeyDown={ev => {\n            if (readOnly) return;\n            //console.log(\"Key: \" + ev.which);\n            if (ev.which >= 35 && ev.which <= 40) {// home/end/up/down/left/right\n              ev.stopPropagation(); // Prevent entire page from scrolling??\n            }\n            if (ev.which === 9) ev.preventDefault();\n            if ((ev.keyCode === 8 || ev.keyCode === 46) && this.focusElem && this.state.focusRect) {\n              if (this.focusElem && this.focusElem.parentElement) {\n                this.focusElem.parentElement.removeChild(this.focusElem);\n              }\n              this.focusElem = null;\n              this.setState({focusRect: null});\n              this.triggerOnChange(this.contentDiv.innerHTML);\n            }\n          }}\n        />\n        {focusRect && <div\n          ref={div => this.focusRectDiv = div}\n          className={classes.focusrect}\n          onBlur={this.onBlur}\n          tabIndex={1}\n          style={{\n            outline: 0,\n            position: 'absolute',\n            top: this.state.focusRect.top,\n            left: this.state.focusRect.left,\n            width: this.state.focusRect.width,\n            height: this.state.focusRect.height}}>\n          <div className={classes.focuspoint + \" fpul\"} style={{position:'absolute', top:0, left:0}} />\n          <div className={classes.focuspoint + \" fpur\"} style={{position:'absolute', top:0, right:0}} />\n          <div className={classes.focuspoint + \" fplr\"} style={{position:'absolute', bottom:0, right:0}} />\n          <div className={classes.focuspoint + \" fpll\"} style={{position:'absolute', bottom:0, left:0}} />\n        </div>}\n      </div>\n    </div>\n  }\n}\n\nfunction getRelatativeClientRect (parent: HTMLElement, child: HTMLElement) : ClientRect {\n  const parentRect = parent.getBoundingClientRect();\n  const childRect = child.getBoundingClientRect();\n  return {\n    top: childRect.top - parentRect.top + parent.scrollTop,\n    left: childRect.left - parentRect.left + parent.scrollLeft,\n    bottom: childRect.bottom - parentRect.top + parent.scrollTop,\n    right: childRect.right - parentRect.left + parent.scrollLeft,\n    width: childRect.width,\n    height: childRect.height\n  };\n}\n","export default function imageEditActions(cb) {\n  return [{\n    name: 'float-left',\n    icon: `<div style=\"position:relative\">\n      <i class=\"fa fa-align-right\" aria-hidden=\"true\"></i>\n      <div style=\"position:absolute; left:-4px;top:0; transform: scale(0.5); transform-origin: left top\">\n        <i class=\"fa fa-picture-o\" aria-hidden=\"true\"></i>\n      </div>\n    </div>`,\n    title: 'Lt bilden flyta vnster om text',\n    result: () => cb('float-left')\n  }, {\n    name: 'float-right',\n    icon: `<div style=\"position:relative\">\n      <i class=\"fa fa-align-left\" aria-hidden=\"true\"></i>\n      <div style=\"position:absolute; right:-4px;top:0; transform: scale(0.5); transform-origin: right top\">\n        <i class=\"fa fa-picture-o\" aria-hidden=\"true\"></i>\n      </div>\n    </div>`,\n    title: 'Lt bilden flyta hger om text',\n    result: () => cb('float-right')\n  }, {\n    name: 'unfloat',\n    icon: `<div style=\"position:relative;\" aria-hidden=\"true\">\n      <div style=\"position:absolute;top:0;left:0\">&#8254;</div>\n      <div style=\"position:absolute;top:0:left:0;transform: scale(0.5); transform-origin: left bottom\">\n        <i class=\"fa fa-picture-o\" aria-hidden=\"true\"></i>\n      </div>\n      <div style=\"position:absolute;top:0;left:0\">_</div>\n    </div>`,\n    title: 'Placera bilden p egen rad',\n    result: () => cb('unfloat')\n  }];\n}\n\n","import exec from './exec';\n\nexport default {\n  bold: {\n    icon: '<b>F</b>',\n    title: 'Fetstil',\n    result: () => exec('bold')\n  },\n  italic: {\n    icon: '<i>K</i>',\n    title: 'Kursiv',\n    result: () => exec('italic')\n  },\n  underline: {\n    icon: '<u>U</u>',\n    title: 'Understruken',\n    result: () => exec('underline')\n  },\n  strikethrough: {\n    icon: '<strike>S</strike>',\n    title: 'Struken',\n    result: () => exec('strikeThrough')\n  },\n  heading1: {\n    icon: '<b>H<sub>1</sub></b>',\n    title: 'Rubrik 1',\n    result: () => exec('formatBlock', '<H1>')\n  },\n  heading2: {\n    icon: '<b>H<sub>2</sub></b>',\n    title: 'Rubrik 2',\n    result: () => exec('formatBlock', '<H2>')\n  },\n  heading3: {\n    icon: '<b>H<sub>3</sub></b>',\n    title: 'Rubrik 3',\n    result: () => exec('formatBlock', '<H3>')\n  },\n  paragraph: {\n    icon: '&#182;',\n    title: 'Paragraf',\n    result: () => exec('formatBlock', '<P>')\n  },\n  quote: {\n    icon: '&#8220; &#8221;',\n    title: 'Citat',\n    result: () => exec('formatBlock', '<BLOCKQUOTE>')\n  },\n  olist: {\n    icon: '<i class=\"fa fa-list-ol\" aria-hidden=\"true\"></i>',\n    title: 'Ordnad lista',\n    result: () => exec('insertOrderedList')\n  },\n  ulist: {\n    icon: '<i class=\"fa fa-list\" aria-hidden=\"true\"></i>',\n    title: 'Punktlista',\n    result: () => exec('insertUnorderedList')\n  },\n  code: {\n    icon: '&lt;/&gt;',\n    title: 'Programkod',\n    result: () => exec('formatBlock', '<PRE>')\n  },\n  line: {\n    icon: '&#8213;',\n    title: 'Vgrt linje',\n    result: () => exec('insertHorizontalRule')\n  },\n  link: {\n    icon: '<i class=\"fa fa-link\" aria-hidden=\"true\"></i>',\n    title: 'Infoga lnk',\n    result: () => {\n      const url = window.prompt('Ange lnkens URL')\n      if (url) exec('createLink', url)\n    }\n  },\n  image: {\n    icon: '<i class=\"fa fa-picture-o\" aria-hidden=\"true\"></i>',\n    title: 'Infoga bild',\n    result: (ev, component) => {\n      const url = window.prompt('Ange bildens URL')\n      if (url) {\n        //exec('insertImage', url);\n        const img = document.createElement(\"img\");\n        img.src = url;\n        img.tabIndex = 1;\n        insertElement(img);\n        img.onfocus = component.onFocus;\n        img.onblur = component.onBlur;\n        component.props.onChange(component.contentDiv.innerHTML);\n      }\n    }\n  }\n}\n\nfunction insertElement(element: HTMLElement) {\n    var sel, range;\n    if (window.getSelection && (sel = window.getSelection()).rangeCount) {\n        range = sel.getRangeAt(0);\n        range.collapse(true);\n        range.insertNode(element);\n        // Move the caret immediately after the inserted span\n        range.setStartAfter(element);\n        range.collapse(true);\n        sel.removeAllRanges();\n        sel.addRange(range);\n    }\n}\n","import * as React from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Course, CourseModule, Ability, Task, Document } from 'kedbackend/models';\nimport { createUUID } from 'kedbackend/client';\nimport { KnowledgeMatrix } from '../sub-components/knowledge-matrix';\nimport update from 'react-addons-update';\nimport { Dialog, ICourseEditorHost } from \"../interfaces/course-editor-host\";\nimport { hasWriteAccess } from '../../../access-control';\nimport { SelectRelatedDocs } from '../sub-components/select-related-docs';\nimport validUrl from 'valid-url';\nimport { L, showError } from \"../../../utils/utils\";\nimport { CachedResponse } from \"../../../utils/cached-response\";\nimport { EditableResourceList } from \"../sub-components/editable-resource-list\";\nimport { dtFormat } from \"../utils\";\nimport { futureAbilities } from \"../../../contracts/ked-models\";\nimport env from '../../../globals/KED.env';\nimport { Spinner } from \"../sub-components/spinner\";\nimport { Wysiwyg } from '../../utility-components/wysiwyg';\nimport actions_swedish from '../../utility-components/wysiwyg/actions-sv';\nimport ReactDatePicker from 'react-datepicker';\nimport moment from 'moment';\nimport { Features } from '../../../features';\n\ninterface Props {\n  searchMode?: boolean;\n  task?: Task;\n  taskCustomization?: Partial<Task>;\n  module: CourseModule;\n  course: Course;\n  host: ICourseEditorHost;\n  idsNotCoveredByAnyTask: { [id: string]: true };\n  onSave: (task: Task, taskCustomization: Partial<Task>) => Promise<any>;\n  onSaveCustomization: (taskCustomization: Partial<Task>) => Promise<any>;\n  onReplace: (taskId: string, task: Task) => Promise<any>;\n  onCancel: () => void;\n  onDelete: () => void;\n}\n\ninterface State {\n  title: string;\n  task: Task;\n  taskCustomization: Partial<Task>\n  futureAbilitiesOpen: boolean;\n  searchResult?: Task[];\n  searchMarkedIds?: string[];\n  isSearching: boolean;\n  previewTaskContent?: string;\n}\n\nexport class EditTask extends React.Component<Props, State> implements Dialog {\n  searchResponse?: CachedResponse<Task[]>;\n  dialogElem: HTMLDivElement;\n  features = new Features();\n\n  setStatePromised(state: Partial<State>) {\n    return new Promise(resolve => super.setState(() => state as State, resolve));\n  }\n\n  constructor(props: Props) {\n    super(props);\n    const writeAccess = !props.task || hasWriteAccess(props.task);\n    this.state = {\n      title: props.task ?\n        writeAccess ?\n          L`Redigera uppgift till \"${props.module.name}\"` :\n          L`Visa uppgift till \"${props.module.name}\"` :\n        props.searchMode ?\n          L`Sk ny uppgift till \"${props.module.name}\"` :\n          L`Lgg till egen uppgift till \"${props.module.name}\"`,\n      futureAbilitiesOpen: false,\n      taskCustomization: props.taskCustomization || {},\n      task: props.task ?\n        // A task was given. Clone it and add $meta: 'update' to it\n        // to inform EditCourse.save() to update it on its own entity.\n        {\n          $meta: props.task.$meta || 'update',\n          ...props.task\n        } : props.searchMode ? null :\n          // No task was given. Set $meta = 'add' to inform EditCourse.save()\n          // to add the task to the tasks table.\n          {\n            id: createUUID(),\n            $meta: 'add',\n            tags: [\"sub:\" + props.course.subjectCode],\n            school: !props.course.isTemplate && env.currentUser.school,\n            resources: [],\n            abilities: [],\n            centralContent: [],\n            futureAbilities: [],\n            knowledgeRequirements: [],\n            name: \"\",\n            url: \"\",\n            acl: props.course.isTemplate ? [\n              `role:USER:R`// (OK to keep after kursbygg-changes). Templates (which will be empty!) will not have tasks. If they had, might not tasks should not be possible to modify. (An ADMIN could belong to a school! Other non-admins at that school should not be able to edit it)\n            ] : [\n                `role:USER:R`,\n                `schoolRole:${env.currentUser.school}/EMPLOYEE:S`\n              ]\n          },\n      searchMarkedIds: props.searchMode && [],\n      searchResult: props.searchMode && [],\n      isSearching: props.searchMode\n    };\n    if (props.searchMode) {\n      this.searchResponse = new CachedResponse(() =>\n        env.kedBackendClient.list<Task>(\"tasks\", {\n          tags: `sub:${props.course.subjectCode}`,\n          include: ['knowledgeRequirements', 'abilities', 'centralContent'],\n          flags: ['includeIdsOnly']\n        })); // TODO: includeIds istead of include?\n    }\n  }\n\n  async componentDidMount() {\n    if (this.props.searchMode) {\n      this.setStatePromised({ isSearching: true });\n      try {\n        await this.searchResponse.query();\n        if (this.state.searchMarkedIds && this.state.searchMarkedIds.length === 0) {\n          await this.updateSearchResult(this.state.searchMarkedIds);\n        }\n      } catch (err) {\n        showError(err);\n      } finally {\n        await this.setStatePromised({ isSearching: false });\n      }\n    }\n  }\n\n  async updateSearchMarkedIds(searchMarkedIds: string[]) {\n    const setStatePromise = this.setStatePromised({ task: null, searchMarkedIds, previewTaskContent: null });\n    if (!this.searchResponse.result) {\n      await this.searchResponse.promise;\n      // Refresh searchMarkedIds now as user might have clicked around while waiting for\n      // tasks to load...\n      await setStatePromise; // So we know state has been reflected...\n      searchMarkedIds = this.state.searchMarkedIds;\n    }\n    await this.updateSearchResult(searchMarkedIds);\n  }\n\n  async updateSearchResult(searchMarkedIds: string[]) {\n    const allTasksForSubject = await this.searchResponse.query();\n\n    const searchResult = allTasksForSubject.filter(t =>\n      searchMarkedIds.every(id =>\n        t.knowledgeRequirements.some(kr => kr.id === id) ||\n        t.abilities.some(a => a.id === id) ||\n        t.centralContent.some(c => c.id === id)));\n\n    this.setStatePromised({\n      searchResult\n    });\n  }\n\n  onMarkChanged(id: string, isMarked: boolean) {\n    const { searchMode } = this.props;\n    if (searchMode) {\n      const { searchMarkedIds } = this.state;\n      this.updateSearchMarkedIds(isMarked ?\n        searchMarkedIds.concat(id) :\n        searchMarkedIds.filter(x => x !== id)).catch(showError);\n      return;\n    }\n    const { course } = this.props;\n    const { task } = this.state;\n    // One of the following three will be found:\n    const ability = course.abilities.find(a => a.id === id);\n    const knowledgeRequirement = course.knowledgeRequirements.find(r => r.id === id);\n    const centralContent = course.centralContent.find(cc => cc.id === id);\n\n    const [collectionProp, item] =\n      ability ?\n        [\"abilities\", ability] :\n        knowledgeRequirement ?\n          [\"knowledgeRequirements\", knowledgeRequirement] :\n          centralContent ?\n            [\"centralContent\", centralContent] :\n            [null, null];\n\n    if (!collectionProp) {\n      console.error(\"Could not find marked id \" + id);\n      return;\n    }\n\n    const updatedCollection: Document[] = task[collectionProp].slice();\n    if (isMarked)\n      updatedCollection.push(item);\n    else\n      updatedCollection.splice(updatedCollection.findIndex(doc => doc.id === id), 1);\n\n    const updatedTask = { ...task };\n    updatedTask[collectionProp] = updatedCollection;\n\n    this.setStatePromised({\n      task: updatedTask\n    });\n  }\n\n  async save() {\n    const { task, taskCustomization } = this.state;\n    const writeAccess = hasWriteAccess(task);\n    if (writeAccess) {\n      if (!task.url && !task.content)\n        throw new Error(L`Uppgiften mste antingen ha en URL eller ett innehll`);\n      if (task.url && !validUrl.isUri(task.url))\n        throw new Error(L`Angiven URL '${task.url}' r ogiltig. Den ska brja med http: eller https:`);\n      if (this.props.task && this.props.task.id !== task.id) {\n        // Replace existing task with copy\n        await this.props.onReplace(this.props.task.id, task);\n      } else {\n        // Update existing task\n        await this.props.onSave(task, null);\n      }\n    } else if (this.props.searchMode) {\n      await this.props.onSave(task, taskCustomization);\n    } else {\n      if (this.props.course.isTemplate && task.$meta === 'add')\n        throw new Error(L`Du saknar behrighet fr att spara nya versioner av uppgifter i kursmallen`);\n\n      await this.props.onSaveCustomization(taskCustomization);\n    }\n  }\n\n  async copyTask() {\n    const taskCopy = {\n      ...this.state.task,\n      ...(this.state.taskCustomization || {}),\n      id: createUUID(),\n      acl: this.props.course.isTemplate ? [\n        `role:USER:R` // (OK to keep but this check might become unnescesary if we totally remove the possibility to edit templates) Template tasks should not be possible to modify. (An ADMIN could belong to a school! Other non-admins at that school should not be able to edit it)\n      ] : [\n          `role:USER:R`,\n          `schoolRole:${env.currentUser.school}/EMPLOYEE:S`\n        ]\n    };\n    taskCopy.$meta = 'add';\n\n    await this.setStatePromised({\n      task: taskCopy,\n      title: L`Redigera kopierad uppgift till \"${this.props.module.name}\"`,\n      taskCustomization: undefined\n    });\n  }\n\n  getTaskProp<T extends keyof Task>(taskProp: T) : Task[T] {\n    const {task, taskCustomization} = this.state;\n    const customization = taskCustomization && taskCustomization[taskProp];\n    return customization !== undefined ?\n      customization :\n      task[taskProp];\n  }\n\n  updateTaskOrCustomization (taskProp: keyof Task, updates) {\n    const {task, taskCustomization} = this.state;\n    const writeAccess = task && hasWriteAccess(task);\n    if (writeAccess && (!taskCustomization || taskCustomization[taskProp] === undefined)) {\n      const newTask = {...task};\n      newTask[taskProp] = update(task[taskProp], updates);\n      this.setStatePromised({task: newTask});\n    } else {\n      const newCustomization = {...taskCustomization};\n      newCustomization[taskProp] = update (\n        newCustomization[taskProp] || task[taskProp],\n        updates\n      );\n      this.setStatePromised({taskCustomization: newCustomization});\n    }\n  }\n\n  render() {\n    const { course, module, onCancel, onDelete, idsNotCoveredByAnyTask, searchMode } = this.props;\n    const { task, taskCustomization, title, searchResult, searchMarkedIds, isSearching } = this.state;\n    const markedIds = searchMode ?\n      searchMarkedIds :\n      task.centralContent.map(x => x.id)\n        .concat(task.abilities.map(x => x.id))\n        .concat(task.knowledgeRequirements.map(x => x.id));\n\n    const writeAccess = task && hasWriteAccess(task);\n    const taskUrlValid = task && validUrl.isUri(task.url);\n    const {features} = this;\n\n    return <div className=\"sv-spacer-20pxvt sv-vertical sv-layout sv-skip-spacer\">\n      <div className=\"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer\">\n        <div className=\"sv-text-portlet sv-use-margins sv-skip-spacer\">\n          <div className=\"sv-text-portlet-content\">\n            <h1 className=\"h1\">{title}</h1>\n          </div>\n        </div>\n        <div className=\"sv-fluid-grid sv-grid-ksgs12 sv-layout\">\n          <div className=\"sv-layout sv-skip-spacer sv-column-6\">\n            <div className=\"sv-html-portlet sv-portlet sv-skip-spacer\">\n              <div className=\"ked_boxed\">\n                <h3>{searchMode ?\n                  \"Filtrera p kunskapskrav\" : writeAccess ?\n                    \"Vlj kunskapskrav\" :\n                    \"Kunskapskrav\"}</h3>\n                {searchMode ?\n                  <p>\n                    Markera de kunskapskrav som uppgiften mste tcka.\n                  </p> : writeAccess &&\n                  <p>\n                    Markera de kunskapskrav som din uppgift tcker.\n                  </p>\n                }\n                <KnowledgeMatrix\n                  knowledgeRequirements={course.knowledgeRequirements}\n                  markedIds={markedIds}\n                  idsToMarkNotOk={idsNotCoveredByAnyTask}\n                  markMode={searchMode || writeAccess}\n                  onMarkChanged={this.onMarkChanged.bind(this)}\n                />\n              </div>\n            </div>\n\n            <div className=\"sv-html-portlet sv-portlet\">\n              <SelectRelatedDocs\n                options={course.abilities}\n                title={writeAccess || searchMode ? \"Vlj frmgor\" : \"Frmgor\"}\n                markedIds={markedIds}\n                markMode={writeAccess || searchMode}\n                onMarkChanged={this.onMarkChanged.bind(this)} />\n            </div>\n\n            <div className=\"sv-html-portlet sv-portlet\">\n              <SelectRelatedDocs\n                options={course.centralContent}\n                title={writeAccess || searchMode ? \"Vlj centralt innehll\" : \"Centralt innehll\"}\n                markedIds={markedIds}\n                markMode={writeAccess || searchMode}\n                onMarkChanged={this.onMarkChanged.bind(this)} />\n            </div>\n\n            {!searchMode && <div className=\"sv-html-portlet sv-portlet\"><div className={\"openClose larger\" + (this.state.futureAbilitiesOpen ? \" open\" : \"\")}>\n              <div className=\"openHeader\" onClick={() => this.setStatePromised({ futureAbilitiesOpen: !this.state.futureAbilitiesOpen })}>\n                {writeAccess ?\n                  <p>Vlj ytterligare alternativ</p> :\n                  <p>Ytterligare alternativ</p>}\n              </div>\n              <div className=\"openContent\">\n                <h4>Framtidsfrmgor</h4>\n\n                <div className=\"taskContainer\">\n                  {futureAbilities.map(fa => {\n                    const selected = task.futureAbilities.indexOf(fa) >= 0;\n                    return <div className=\"align-horizontal\" key={fa}>\n                      <div className=\"horizontalItem top\">\n                        <div\n                          className={\"checkBox\" + (selected ? \" checked\" : \"\")}\n                          onClick={writeAccess ? () => {\n                            const updatedTask = { ...task };\n                            updatedTask.futureAbilities =\n                              selected ?\n                                task.futureAbilities.filter(a => a != fa) :\n                                task.futureAbilities.concat(fa);\n                            this.setStatePromised({ task: updatedTask });\n                          } : undefined} />\n                      </div>\n                      <div className=\"horizontalItem top\">{fa}\n                      </div>\n                    </div>\n                  })}\n                </div>\n              </div>\n\n            </div></div>}\n          </div>\n          <div className=\"sv-layout sv-column-6\">\n            <div className=\"sv-html-portlet sv-portlet sv-skip-spacer\">\n              {isSearching && <p><Spinner /> Laddar uppgifter...</p>}\n              {searchResult ? <div className={\"task-search-result\" + (!this.state.task && !this.state.previewTaskContent ? \" fixed\" : \"\")}>\n                {searchMarkedIds.length === 0 ?\n                  <h2>Samtliga uppgifter fr mnet</h2> :\n                  <h2>Uppgifter som tcker valda filter</h2>}\n                <div className=\"taskContainer\">\n                  {searchResult.map(foundTask => <div key={foundTask.id} className=\"align-horizontal\">\n                    <div className=\"horizontalItem top\">\n                      <div\n                        className={\"checkBox\" + (task && task.id === foundTask.id ? \" checked\" : \"\")}\n                        onClick={() => findDOMNode(this).parentElement.scrollTop = 0 || this.setStatePromised({ task: foundTask, previewTaskContent: null })} />\n                    </div>\n                    <div className=\"horizontalItem top\">\n                      {foundTask.content ?\n                        <a href=\"#\" onClick={ev => {\n                          this.setState({ previewTaskContent: foundTask.content, task: null });\n                          ev.preventDefault();\n                          ev.stopPropagation();\n                        }}>{foundTask.name}</a> :\n                        <a href={foundTask.url} target=\"_blank\">{foundTask.name}</a>}\n                    </div>\n                  </div>)}\n                </div>\n                <br />\n                <hr />\n              </div> : task && <div>\n                <h2>Uppgiftens namn och lnk</h2>\n                <div className=\"align-horizontal spaced\">\n                  <div className=\"horizontalItem top\">\n                    <p>Uppgiftens namn:</p>\n                  </div>\n                  <div className=\"horizontalItem top\">\n                    <input autoFocus type=\"text\" size={35} value={task.name} disabled={!writeAccess} readOnly={!writeAccess} onChange={ev => {\n                      const newTask = { ...task };\n                      newTask.name = ev.target.value;\n                      this.setStatePromised({ task: newTask });\n                    }} />\n                  </div>\n                </div>\n                <div className=\"align-horizontal spaced\">\n                  <div className=\"horizontalItem top\">\n                    <p>URL:</p>\n                  </div>\n                  <div className={\"horizontalItem top\"}>\n                    <input type=\"text\" size={35} value={task.url} disabled={!writeAccess} readOnly={!writeAccess} onChange={ev => {\n                      const newTask = { ...task };\n                      newTask.url = ev.target.value;\n                      this.setStatePromised({ task: newTask });\n                    }} />\n                  </div>\n                </div>\n\n                {features.AssignmentTasks && <><h2>Inlmningsuppgift</h2>\n                <div className=\"align-horizontal\">\n                  <div className=\"horizontalItem top\">\n                    <div className={\"checkBox\" + (this.getTaskProp(\"assignment\") ? \" checked\" : \"\")}\n                      onClick={() => {\n                        this.updateTaskOrCustomization(\"assignment\", {$set: !this.getTaskProp(\"assignment\")});\n                      }}\n                    />\n                  </div>\n                  <div className=\"horizontalItem top\">\n                      <p>Den hr uppgiften r en inlmningsuppgift</p>\n                  </div>\n                </div>\n                {this.getTaskProp(\"assignment\") && <>\n                  <p>Inlmningsdatum</p>\n                    <div className=\"align-horizontal\">\n                      <div className=\"horizontalItem top\">\n                        <ReactDatePicker\n                          selected={this.getTaskProp(\"deadline\") && moment(this.getTaskProp(\"deadline\"))}\n                          dateFormat=\"YYYY-MM-DD\"\n                          locale={\"sv\"}\n                          popperPlacement=\"bottom-start\"\n                          onChange={value => {\n                            this.updateTaskOrCustomization(\"deadline\", {$set: value.format(\"YYYY-MM-DD\")});\n                          }}\n                        />\n                      </div>\n                      <div className=\"horizontalItem top\">\n                        {this.getTaskProp(\"deadline\") && <a className=\"deleteDate\" href=\"#\" title=\"Ta bort inlmningsdatum\" onClick={ev=>{\n                          ev.preventDefault();\n                          this.updateTaskOrCustomization(\"deadline\", {$set: null});\n                        }}></a>}\n                      </div>\n                    </div>\n                </>}\n              </>}\n              </div>}\n\n              {this.state.previewTaskContent ? \n                <div dangerouslySetInnerHTML={{__html: this.state.previewTaskContent}} />\n               : task && <>\n                    <h3>Uppgiftens lrandeml</h3>\n                    <div>\n                      <textarea\n                        className=\"inputTextBox learning-goal-box\"\n                        disabled={!writeAccess}\n                        value={task.learningGoal}\n                        onChange={ev => {\n                          const newTask = { ...task };\n                          newTask.learningGoal = ev.target.value;\n                          this.setStatePromised({ task: newTask });\n                        }}\n                      />\n                    </div>\n\n                    <br />\n                    {(writeAccess || !!task.content) && <>\n                      <h3>Uppgiftens innehll</h3>\n                        {writeAccess && <p>\n                          Om uppgiften inte lnkar till ngot dokument kan du lgga innehll hr.\n                        </p>}\n                        <Wysiwyg\n                          actions={[\n                            \"bold\",\n                            \"italic\",\n                            \"underline\",\n                            \"strikethrough\",\n                            \"heading2\",\n                            \"heading3\",\n                            \"olist\",\n                            \"ulist\",\n                            \"line\",\n                            \"link\",\n                            \"image\"]}\n                          defaultActions={actions_swedish}\n                          readOnly={!writeAccess}\n                          html={task.content}\n                          onChange={html => {\n                            const newTask = { ...task };\n                            newTask.content = html;\n                            this.setState({ task: newTask });\n                          }}\n                        />\n                    </>}\n\n                  {taskCustomization && taskCustomization.resources ?\n                    <h3>Resurser fr uppgiften (modifierad fr denna kursinstans)</h3> :\n                    <h3>Resurser kopplade till uppgiften</h3>}\n\n                  <EditableResourceList\n                    resources={\n                      (taskCustomization && taskCustomization.resources) || task.resources}\n                    host={this.props.host}\n                    onUpdate={resourceUpdates => {\n                      this.updateTaskOrCustomization(\"resources\", resourceUpdates);\n                    }} />\n                </>}\n            </div>\n            {task && <div className=\"sv-html-portlet sv-portlet\"><hr />\n              <h3>Uppgiftens status</h3>\n\n              {task.createdBy && task.createdDate && <p>\n                Uppgiften skapades {dtFormat(task.createdDate)} av <strong>{task.createdBy.name}</strong>.\n              </p>}\n              {task.modifiedBy && task.modifiedDate && <p>\n                Uppgiften redigerades senast {dtFormat(task.modifiedDate)} av <strong>{task.modifiedBy.name}</strong>.\n              </p>}\n\n              <br />\n              {!!this.props.onDelete && <div\n                className=\"btn btn-warning btn-large pull-right\"\n                onClick={() => this.props.onDelete()}>\n                Ta bort frn kursmodul\n              </div>}\n              <div className=\"pull-right\">&nbsp;</div>\n              <div className=\"btn btn-warning btn-large pull-right\" onClick={() => this.props.onCancel()}>\n                Avbryt\n              </div>\n\n              <div className=\"btn btn-large\" onClick={() => this.save().catch(showError)}>\n                Spara\n              </div>\n              {!writeAccess && <div className=\"btn btn-large\" onClick={() => this.copyTask().catch(showError)}>\n                Skapa kopia av den hr uppgiften\n              </div>}\n            </div>}\n          </div>\n        </div>\n        <div className=\"sv-layout\">\n          <div className=\"sv-html-portlet sv-portlet sv-skip-spacer\"></div>\n        </div>\n      </div></div>\n  }\n\n}","import * as React from 'react';\nimport { L } from '../../../utils/utils';\nimport { Task, Course, CourseModule, Ability } from 'kedbackend/models';\nimport { Link } from 'react-router-dom';\nimport { EditTask } from '../modal-pages/edit-task';\nimport { ICourseEditorHost } from '../interfaces/course-editor-host';\nimport { updateModificationAndCreationStamps } from \"../utils\";\nimport env from '../../../globals/KED.env';\nimport { hasWriteAccess } from \"../../../access-control\";\n\ninterface Props {\n  taskIds: string[];\n  taskCustomizations?: { [taskId: string]: Partial<Task> }\n  course: Course;\n  module: CourseModule;\n  idsNotCoveredByAnyTask: {[id: string]: true};\n  onTaskAdded: (task: Task, taskCustomization?: Partial<Task>) => void;\n  onTaskUpdated: (task) => void;\n  onTaskCustomizationUpdated: (taskId, customization) => void;\n  onTaskDeleted: (id) => void;\n  onTaskReplaced: (id, task) => void;\n  host: ICourseEditorHost;\n}\n\ninterface State {\n\n}\n\nexport class EditableTaskList extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {};\n  }\n\n  openTaskDialog(task: Task) {\n    const {\n      taskCustomizations,\n      course,\n      host,\n      module,\n      taskIds,\n      onTaskAdded,\n      onTaskUpdated,\n      onTaskCustomizationUpdated,\n      onTaskDeleted,\n      idsNotCoveredByAnyTask,\n      onTaskReplaced\n    } = this.props;\n\n    host.openDialog({\n      Component: EditTask,\n      props: {\n        task,\n        taskCustomization: taskCustomizations && taskCustomizations[task.id],\n        module,\n        course,\n        host,\n        idsNotCoveredByAnyTask,\n        onSave: task => {\n          const updatedTask = updateModificationAndCreationStamps(task, env.currentUser);\n          onTaskUpdated(updatedTask);\n          host.closeDialog();\n        },\n        onSaveCustomization: customization => {\n          onTaskCustomizationUpdated(task.id, customization);\n          host.closeDialog();\n        },\n        onDelete: () => {\n          onTaskDeleted(task.id);\n          host.closeDialog();\n        },\n        onReplace: (taskId: string, newTask: Task) => {\n          onTaskReplaced(taskId, newTask);\n          host.closeDialog();\n        },\n        onCancel: () => host.closeDialog()\n      }\n    });\n  }\n\n  render() {\n    const props = this.props;\n    return <div>\n      <div className=\"taskContainer\">\n        {props.taskIds.map(id => props.course.tasks.find(t => t.id === id)).map(task => {\n          const canUpdateTask = hasWriteAccess(task);\n\n          return <div className=\"align-horizontal\" key={task.id}>\n            <div className=\"horizontalItem top\">\n              <div className={canUpdateTask ? \"editItem\" : \"viewItem\"} onClick={() =>\n                this.openTaskDialog(task)} />\n            </div>\n            <div className=\"horizontalItem top\">\n              {task.content ?\n                // Rather than linking to url, show the task's content (by opening\n                // the task dialog)\n                <a href=\"#\" onClick={ev=>{\n                  ev.preventDefault();\n                  this.openTaskDialog(task);\n                }}>{task.name}</a> :\n                <a href={task.url} target=\"_blank\">{task.name}</a>}\n            </div>\n          </div>;\n        })}\n      </div>\n      <br />\n      <a className=\"btn\" onClick={() => {\n        const {\n          course,\n          host,\n          idsNotCoveredByAnyTask,\n          module,\n          onTaskAdded,\n          onTaskCustomizationUpdated } = this.props;\n\n        props.host.openDialog({\n          Component: EditTask,\n          props: {\n            searchMode: true,\n            module,\n            course,\n            host,\n            idsNotCoveredByAnyTask,\n            onSave: (choosenTask, taskCustomization) => {\n              choosenTask = updateModificationAndCreationStamps(choosenTask, env.currentUser);\n              onTaskAdded(choosenTask, taskCustomization);\n              host.closeDialog();\n            },\n            onCancel: () => host.closeDialog()\n          }\n        });\n      }}><i className=\"fa fa-search\" aria-hidden /> Sk uppgift</a>\n      &nbsp;\n      <a onClick={() => {\n        const { course, host, module, taskIds, onTaskAdded, onTaskUpdated, onTaskDeleted, idsNotCoveredByAnyTask } = this.props;\n        host.openDialog({\n          Component: EditTask,\n          props: {\n            module,\n            course,\n            host,\n            idsNotCoveredByAnyTask,\n            onSave: newTask => {\n              newTask = updateModificationAndCreationStamps(newTask, env.currentUser);\n              onTaskAdded(newTask);\n              host.closeDialog();\n            },\n            onCancel: () => host.closeDialog()\n          }\n        });\n      }} className=\"btn\">\n        <i className=\"fa fa-plus\" aria-hidden /> Lgg till egen uppgift\n      </a>\n    </div >\n  }\n}","import * as React from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Course, CourseModule, Image, Task, Document, Ability } from 'kedbackend/models';\nimport $ from 'jquery';\nimport { EditableResourceList } from '../sub-components/editable-resource-list';\nimport { EditableTaskList } from '../sub-components/editable-task-list';\nimport update from 'react-addons-update';\nimport { ICourseEditorHost } from '../interfaces/course-editor-host';\nimport { RenameableText } from '../../utility-components/renameable-text';\nimport { RemoveItem } from '../sub-components/remove-item';\nimport { createUUID } from 'kedbackend/client';\nimport { L, showError } from \"../../../utils/utils\";\nimport moment from 'moment';\nimport { Wysiwyg } from '../../utility-components/wysiwyg';\nimport actions_swedish from '../../utility-components/wysiwyg/actions-sv';\nimport { OpenCloseBox } from '../../utility-components/open-close-box';\n\ninterface Props {\n  course: Course;\n  module: CourseModule;\n  host: ICourseEditorHost;\n  idsNotCoveredByAnyTask: {[id: string]: true};\n  onReorder: (direction: 1 | -1) => void;\n  getOrderedModules: ()=>CourseModule[];\n}\n\ninterface State {\n  editMandatoryContent: boolean;\n}\n\nconst DEFAULT_KNOWLEDGE_MATRIX = [{\n  abilityIds: [],\n  EIds: [],\n  CIds: [],\n  AIds: []\n}];\n\nexport class CourseModuleComponent extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      editMandatoryContent: false\n    }\n  }\n\n  getModuleIndex() {\n    const {course, module} = this.props;\n    return course.modules.findIndex(m => m.id === module.id);\n  }\n\n  getModuleOrderIndex() {\n    const {course, module} = this.props;\n    const orderedModules = this.props.getOrderedModules();\n    return orderedModules.findIndex(m => m.id === module.id);\n  }\n\n  updateModule(moduleUpdates) {\n    const {module} = this.props;\n    const updatedModule = update(module, moduleUpdates);\n    const moduleIndex = this.getModuleIndex();\n    this.props.host.update({ modules: { $splice: [[moduleIndex, 1, updatedModule]] } });\n  }\n\n  /* This method works for both adding new tasks to the task table\n  and adding references to existing tasks. The magic of that has to do with\n  whether task.$meta = 'add' or not and is done in EditCourse.save()\n  */\n  onTaskAdded (task: Task, taskCustomization: Partial<Task> | null) {\n    // Add task ID to module taskIds list:\n    const courseUpdates:any = {};\n    const taskIds = this.props.module.taskIds.slice();\n    taskIds.push(task.id);\n    // Add physical Task to Course.tasks.\n    if (!this.props.course.tasks.some(t => t.id ===task.id)) {\n      courseUpdates.tasks = {$push: [task]};\n    }\n    const customizations = {...(this.props.module.taskCustomizations || {})};\n    if (taskCustomization) customizations[task.id] = taskCustomization;\n    const moduleIndex = this.getModuleIndex();\n    courseUpdates.modules = {};\n    courseUpdates.modules[moduleIndex] = {\n      taskIds: {$set: taskIds},\n      taskCustomizations: {$set: customizations}\n    };\n    // Update module\n    this.props.host.update(courseUpdates);\n  }\n\n  onTaskUpdated (task: Task) {\n    if (!task.$meta) throw new Error(L`Hoppsan, blev lite knas. Fel ID: ${'Pa7Dq'}`);\n    const taskIndex = this.props.course.tasks.findIndex(t => t.id === task.id);\n    if (taskIndex >= 0) {\n      this.props.host.update({tasks: {$splice: [[taskIndex, 1, task]]}});\n    }\n  }\n\n  onTaskCustomized (taskId: string, customization: Partial<Task>) {\n    const customizations = {...(this.props.module.taskCustomizations || {})};\n    customizations[taskId] = customization;\n    this.updateModule({taskCustomizations: {$set: customizations}});\n  }\n\n  onTaskDeleted (id: string) {\n    // Remove task ID from module taskIds list.\n    // This depends on the fact that EditCourse._setState() maintains\n    // removed Task links (which it actually does (or should do at least)).\n    this.updateModule({\n      taskIds: {$set: this.props.module.taskIds.filter(tid => tid !== id)},\n      taskCustomizations: {\n        $apply: customizations => {\n          const copy = {...customizations};\n          delete copy[id];\n          return copy;\n        }\n      }\n    });\n  }\n\n  onTaskReplaced (id: string, task: Task) {\n    const idxTask = this.props.module.taskIds.indexOf(id);\n    if (idxTask < 0) {\n      showError(L`Kunde inte spara uppgift. Felkod d72kQ`);\n      return;\n    }\n    const moduleUpdates = {\n      // Replace old id with new id:\n      taskIds: {$splice: [[idxTask, 1, task.id]]},\n      taskCustomizations: {\n        $apply: customizations => {\n          const copy = {...customizations};\n          delete copy[id];\n          return copy;\n        }\n      }\n    }\n    const updatedModule = update(this.props.module, moduleUpdates);\n    const moduleIndex = this.getModuleIndex();\n    this.props.host.update({\n      // Apply moduleUpdates from above:\n      modules: { $splice: [[moduleIndex, 1, updatedModule]] },\n      // Add the new task to Course.tasks.\n      // Don't remove the old one! Why? Because it may be referenced\n      // by another module in same course! Let EditCourse._setState()\n      // do the \"garbage collection\" instead.\n      tasks: { $set: this.props.course.tasks.concat(task)}\n    });\n  }\n\n  render() {\n    const { course, host, module, idsNotCoveredByAnyTask } = this.props;\n    const moduleIndex = this.getModuleIndex();\n    const moduleOrderedIndex = this.getModuleOrderIndex();\n    let knowledgeMatrixDiv;\n\n    const updateModule = this.updateModule.bind(this);\n    let week = 1;\n    const startWeekOptions = [\"--\"];\n    const endWeekOptions = [\"--\"];\n    for (let i=0; i<51; ++i) {\n      startWeekOptions.push(''+ week);\n      endWeekOptions.push(''+ ++week);\n    }\n\n    return <div className=\"course-module ked_boxed\" style={{position: 'relative'}}>\n      <h3><RenameableText eager={true}\n        clickAdvertiseText=\"Namnls modul\"\n        maxChars={100}\n        text={module.name}\n        onChange={newName => updateModule({name: {$set: newName}})} />\n      </h3>\n      <div className=\"align-horizontal spaced\">\n        <div className=\"horizontalItem center\">\n          <p>Startvecka</p>\n        </div>\n        <div className=\"horizontalItem center\">\n          <select value={module.startWeek || \"--\"}\n            onChange={ev => updateModule({startWeek: {\n              $set: ev.target.value === '--' ?\n                undefined :\n                parseInt(ev.target.value)\n            }\n          })}>\n            {startWeekOptions.map(o => <option key={o} value={o}>{o}</option>)}\n          </select>\n        </div>\n        <div className=\"horizontalItem center\">\n          <p>Slutvecka</p>\n        </div>\n        <div className=\"horizontalItem center\">\n          <select value={module.endWeek || \"--\"}\n            onChange={ev => updateModule({endWeek: {\n              $set: ev.target.value === '--' ?\n                undefined :\n                parseInt(ev.target.value)\n            }\n          })}>\n            {endWeekOptions.map(o => <option key={o} value={o}>{o}</option>)}\n          </select>\n        </div>\n      </div>\n      <h4>Kursmodulens introduktion</h4>\n      <Wysiwyg\n        actions={[\n          \"bold\",\n          \"italic\",\n          \"underline\",\n          \"strikethrough\",\n          \"heading2\",\n          \"heading3\",\n          \"olist\",\n          \"ulist\",\n          \"line\",\n          \"link\",\n          \"image\"]}\n        defaultActions={actions_swedish}\n        html={module.mandatoryContent}\n        onChange={html => {\n          updateModule({mandatoryContent: {$set: html}})\n        }} />\n\n      <h4>Uppgifter</h4>\n      <EditableTaskList\n        taskIds={module.taskIds}\n        taskCustomizations={module.taskCustomizations}\n        course={course}\n        module={module}\n        host={host}\n        idsNotCoveredByAnyTask={idsNotCoveredByAnyTask}\n        onTaskAdded={(task: Task, taskCustomization: Partial<Task>) => this.onTaskAdded(task, taskCustomization)}\n        onTaskUpdated={(task: Task) => this.onTaskUpdated(task)}\n        onTaskCustomizationUpdated={(taskId: string, customization: Partial<Task>) =>\n          this.onTaskCustomized(taskId, customization)}\n        onTaskDeleted={(id: string) => this.onTaskDeleted(id)}\n        onTaskReplaced={(id: string, task: Task) => this.onTaskReplaced(id, task)} />\n\n      <h4>Modulresurser</h4>\n      <p className=\"subHeader\">(Eventuella resuser fr redovisning av modulen samt fr modulen som helhet)</p>\n      <EditableResourceList\n        resources={module.resources}\n        onUpdate={resourcesUpdates => updateModule({ resources: resourcesUpdates })}\n        host={host} />\n      <div style={{position: 'absolute', top: 0, right: 0}}>\n        {moduleOrderedIndex > 0 && <span>\n          <i className=\"fa fa-arrow-circle-up selectable\"\n            aria-hidden=\"true\"\n            onClick={()=>this.props.onReorder(-1)} /> </span>}\n        {moduleOrderedIndex < course.modules.length - 1 && <span>\n          <i className=\"fa fa-arrow-circle-down selectable\"\n            aria-hidden=\"true\"\n            onClick={()=>this.props.onReorder(1)} /> </span>}\n        <RemoveItem\n          title=\"Ta bort modulen\"\n          style={{display: 'inline-block'}}\n          onClick={()=>confirm(L`Ta bort modul ${module.name}?`) && host.update({modules: {$splice: [[moduleIndex, 1]]}})} />\n      </div>\n    </div>\n  }\n}\n\n","import * as React from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Course, CourseModule, Image, Task, Document, Ability } from 'kedbackend/models';\nimport { createUUID } from 'kedbackend/client';\nimport $ from 'jquery';\nimport update from 'react-addons-update';\nimport { ICourseEditorHost } from '../interfaces/course-editor-host';\nimport { CourseModuleComponent } from './course-module';\n\ninterface Props {\n  course: Course;\n  host: ICourseEditorHost;\n  idsNotCoveredByAnyTask: {[id: string]: true};\n}\n\ninterface State {\n}\n\nexport class CourseModuleList extends React.Component<Props,State> {\n  _elem: HTMLDivElement;\n  _moduleRefs: {[moduleId: string]: CourseModuleComponent};\n\n  constructor(props: Props) {\n    super(props);\n    this._moduleRefs = {};\n    this.state = {\n    }\n  }\n\n  addModule() {\n    this.props.host.update({modules: {$push: [{\n      name: \"Ny kursmodul\",\n      id: createUUID(),\n      resources: [],\n      taskIds: []\n     } as CourseModule\n    ]}});\n  }\n\n  getOrderedModules() {\n    const { course } = this.props;\n    const moduleOrder = course.moduleOrder || course.modules.map(m => m.id);\n    return moduleOrder\n      // Map ordered id to module\n      .map(id => course.modules.find(m => m.id === id))\n      // Ignore entries that only exists in moduleOrder but not in modules\n      .filter(m => !!m)\n      // Append modules at end that are not listed in moduleOrder\n      .concat (course.modules.filter(m => !moduleOrder.find(id => m.id === id)));\n  }\n\n  async reorder (moduleId: string, direction: -1 | 1) {\n    const { course } = this.props;\n    const orderedModules = this.getOrderedModules();\n    const moduleIndex = orderedModules.findIndex(m => m.id === moduleId);\n    const newModuleIndex = moduleIndex + direction;\n    if (newModuleIndex < 0 || newModuleIndex >= orderedModules.length) {\n      // Cannot order outside limits.\n      return;\n    }\n    const currentModuleAtPosition = orderedModules[newModuleIndex];\n    const moduleOrder = orderedModules.map(m => m.id);\n    moduleOrder[newModuleIndex] = moduleId;\n    moduleOrder[moduleIndex] = currentModuleAtPosition.id;\n    const origScrollPos = document.documentElement.scrollTop;\n    await this.props.host.update({\n      moduleOrder: {$set: moduleOrder}\n    });\n    // Now, scroll smoothly into view after reordering:\n    const elemModule: HTMLElement = findDOMNode(this._moduleRefs[moduleId]);\n    if (elemModule) {\n      try {\n        window.scrollTo({top: origScrollPos}); // Prohibit default scrolling directly upwards on move up.\n        elemModule.scrollIntoView({behavior: 'smooth', block: 'start'});\n      } catch (e) {\n        // Only Chrome beta supports the arguments given above. Default for older browsers.\n        window.scrollTo(null, origScrollPos);\n        elemModule.scrollIntoView(true);\n      }\n    }\n  }\n\n  render() {\n    const { course, host, idsNotCoveredByAnyTask} = this.props;\n    const moduleOrder = course.moduleOrder || course.modules.map(m => m.id);\n    const orderedModules = this.getOrderedModules();\n\n    return <div className=\"sv-html-portlet sv-portlet\" ref={elem => this._elem = elem}>\n      {orderedModules.map(module => <CourseModuleComponent\n        ref={elem => this._moduleRefs[module.id] = elem}\n        key={module.id}\n        course={course}\n        module={module}\n        onReorder={direction => this.reorder(module.id, direction)}\n        getOrderedModules={()=>this.getOrderedModules()}\n        host={host}\n        idsNotCoveredByAnyTask={idsNotCoveredByAnyTask}\n       />)}\n      <div className=\"btn btn-large\" onClick={()=>this.addModule()}>\n        Lgg till kursmodul\n      </div>\n    </div>\n  }\n}\n\n","import { Repo, RepoCommunicator } from './repo';\nimport { Course, School } from 'kedbackend/models';\nimport env from '../globals/KED.env';\nimport { flatten, L } from \"../utils/utils\";\n\nclass SchoolCoursesRepo extends Repo<Course> {\n  private _schoolId: string;\n  getSchoolId() {\n    return this.ensureHasData().then(()=>this._schoolId);\n  }\n\n  constructor(getSchoolName: ()=>string) {\n    super({\n      query: async () => {\n        const schoolName = getSchoolName();\n        const schools = await env.kedBackendClient.list<School>(\n          \"schools\", {\n            name: schoolName,\n            include: [\"courses\"]\n          });\n        this._schoolId = schools.length > 0 && schools[0].id;\n        if (!this._schoolId) throw new Error(L`Skolan ${schoolName} finns inte registrerad i systemet.\n          Kontakta en administratr fr Kursbyggarverktyget och be om att lgga till skolan med namnet \"${schoolName}\"`);\n        return flatten(schools.map(school => school.courses));\n      }\n    })\n  }\n}\n\nexport const mySchoolCoursesRepo = new SchoolCoursesRepo(()=>env.currentUser.school);\n","import * as React from 'react';\nimport { L, showError, compareProp } from '../../../utils/utils';\nimport { Course } from \"kedbackend/models\";\nimport { mySchoolCoursesRepo } from \"../../../repos/school-courses\";\nimport { Spinner } from \"./spinner\";\nimport { Link } from 'react-router-dom';\nimport { shortDateFormat } from \"../utils\";\n\ninterface Props {\n}\n\ninterface State {\n  schoolCourses: Course[] | null;\n}\n\nexport class SchoolCourses extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      schoolCourses: null\n    }\n    this.onSchoolCoursesUpdated = this.onSchoolCoursesUpdated.bind(this);\n  }\n\n  componentDidMount() {\n    mySchoolCoursesRepo.subscribe(this.onSchoolCoursesUpdated).catch(showError);\n  }\n\n  componentWillUnmount() {\n    mySchoolCoursesRepo.unsubscribe(this.onSchoolCoursesUpdated);\n  }\n\n  onSchoolCoursesUpdated(schoolCourses: Course[]) {\n    const compareName = compareProp(\"name\");\n    const compareCreatedDate = compareProp(\"createdDate\");\n    schoolCourses.sort((a,b) => compareName(a,b) || compareCreatedDate(a,b));\n    this.setState({schoolCourses});\n  }\n\n  render() {\n    const {schoolCourses} = this.state;\n    return <div className=\"sv-html-portlet sv-portlet sv-skip-spacer\">\n      <div className=\"ked_boxed\">\n        <h3>Skolans kurser</h3>\n        <div className=\"taskContainer odd-even\">\n          {!schoolCourses ?\n            <p><Spinner /> Laddar skolans kurser</p> :\n            schoolCourses.map(course => <div className=\"schoolCourse\" key={course.id}>\n            <div className=\"align-horizontal\">\n              <div className=\"horizontalItem top pull-right\">\n                <Link\n                  to={`/courses/${course.id}/edit`}\n                  className=\"editItem\"\n                />\n              </div>\n              <div className=\"horizontalItem top\">\n                <Link to={`/courses/${course.id}/edit`}>{course.name}</Link></div>\n              <div className=\"horizontalItem top\">\n                {course.active && <div className=\"pill active\">Aktiv</div>}\n              </div>\n              {course.active && !course.publishable && <div className=\"horizontalItem top\">\n                <div className=\"pill incomplete\">Inkomplett</div>\n              </div>}\n            </div>\n            <div className=\"horizontalItem top\">\n              <p>{course.description}</p>\n            </div>\n            <div className=\"horizontalItem top\">\n              {course.modifiedBy ?\n                <p className=\"small\">Redigerad av {course.modifiedBy.name} / {shortDateFormat(course.modifiedDate)}</p> :\n                <p className=\"small\" style={{fontStyle: 'italic'}}> </p>}\n            </div>\n          </div>)}\n        </div>\n        {location.hash !== \"#/courses/new\" && <Link\n          className=\"btn\"\n          to=\"/courses/new\"\n          onClick={()=>window.scroll(0, 0)}>\n          Skapa ny kurs\n        </Link>}\n      </div>\n    </div>\n  }\n}\n","import { Document, Course, KnowledgeRequirement, CourseModule, Task } from 'kedbackend/models';\nimport { flatten, L } from \"../../../utils/utils\";\n\nexport function getUncoveredKnowledgeRequirements(course: Course) {\n  const uncoveredRequirements = course.knowledgeRequirements.reduce((result, item) => {\n    result[item.id] = item;\n    return result;\n  }, {} as { [id: string]: KnowledgeRequirement });\n\n  course.tasks.forEach(task => {\n    task.knowledgeRequirements.forEach(kr => {\n      delete uncoveredRequirements[kr.id];\n    });\n  });\n\n  return Object.keys(uncoveredRequirements).map(id => uncoveredRequirements[id]);\n}\n\nexport function getIdsNotCoveredByTasks(course: Course) : {[id: string]: true} {\n  const uncoveredIds = {};\n  // 1. Mark the ids of all knowledge requirements, abilities and central content for this course:\n  course.knowledgeRequirements.forEach(r => {\n    uncoveredIds[r.id] = true;\n  });\n  course.abilities.forEach(a => {\n    uncoveredIds[a.id] = true;\n  });\n  course.centralContent.forEach(cc => {\n    uncoveredIds[cc.id] = true;\n  });\n  // 2. List all tasks and unmark all ids that they refer to\n  const { tasks } = course;\n  tasks.forEach(task => {\n    task.knowledgeRequirements.forEach(kr => {\n      delete uncoveredIds[kr.id];\n    });\n    task.abilities.forEach(a => {\n      delete uncoveredIds[a.id];\n    });\n    task.centralContent.forEach(cc => {\n      delete uncoveredIds[cc.id];\n    });\n  });\n  return uncoveredIds;\n}\n\nexport function sanityCheck (course: Course) {\n  function hasDuplicateTasks(course: Course) {\n    const taskIds: {[id:string]: boolean} = {};\n    return flatten(course.modules.map(module => module.taskIds.map(taskId => {\n      if (taskIds[taskId]) {\n        const task = course.tasks.find(t => t.id === taskId);\n        return L`Samma uppgift frekommer flera gnger: \"${task.name}\"`;\n      }\n      taskIds[taskId] = true;\n    }).filter(x => x)));\n  }\n\n  function tasksWithSameUrl(course: Course) {\n    const taskUrls: {[url:string]: Task} = {};\n    return course.tasks.map(task => {\n      if (task.url) {\n        if (taskUrls[task.url]) {\n          return L`Tv uppgifter pekar p samma URL: \"${taskUrls[task.url].name}\" samt \"${task.name}\"`;\n        }\n        taskUrls[task.url] = task;\n      }\n    }).filter(x => x);  \n  }\n\n  function hasEmptyModuleNames(course: Course) {\n    return course.modules.some (module => module.name === \"\") &&\n      L`Det finns minst en modul utan angivet namn`;\n  }\n\n  function hasDuplicateModuleNames(course: Course) {\n    const moduleNames: {[name: string]: true} = {};\n    return course.modules.map(module => {\n      if (module.name && moduleNames[module.name]) {\n        return L`Modulen med namn ${module.name} frekommer flera gnger`;\n      }\n      if (module.name) moduleNames[module.name] = true;\n    })\n  }\n\n  const checks = flatten([\n    hasDuplicateTasks(course),\n    tasksWithSameUrl(course),\n    hasEmptyModuleNames(course),\n    hasDuplicateModuleNames(course)\n  ]);\n\n  return checks.filter (result => result);\n}\n\n\nexport function getTasksPerId (course: Course) {\n  const result: {[id: string]: Task[]} = {};\n  function add(id: string, task: Task) {\n    const list = result[id] || (result[id] = []);\n    list.push(task);\n  }\n  course.tasks.forEach(task => {\n    task.abilities.forEach(a => add(a.id, task));\n    task.centralContent.forEach(c => add(c.id, task));\n    task.futureAbilities.forEach(fa => add(fa, task));\n  });\n  return result;\n}\n","import * as React from 'react';\nimport { Resource } from 'kedbackend/models';\nimport { RemoveItem } from \"./remove-item\";\n\ninterface Props {\n  teachers: Resource[];\n  onUpdate: (teachersUpdates) => void;\n}\n\ninterface State {\n  addEmtpyRow: boolean;\n}\n\nexport class EditableTeacherList extends React.Component<Props,State> {\n  nameElem: HTMLInputElement;\n\n  constructor(props: Props) {\n    super(props);\n    this.state={addEmtpyRow: props.teachers.length === 0};\n  }\n\n  render() {\n    let {teachers, onUpdate} = this.props;\n    const {addEmtpyRow} = this.state;\n    if (addEmtpyRow) teachers = teachers.concat({name: \"\", url: \"\"});\n\n    return <div className=\"teachers-list\">\n      <h3>Ansvariga lrare</h3>\n      <table tabIndex={1} style={{width: \"100%\"}} onBlur={ev=>\n        (!ev.relatedTarget ||\n        (ev.relatedTarget as any).tagName !== 'INPUT') &&\n        this.props.teachers.length > 0 &&\n        this.setState({addEmtpyRow: false})\n      }>\n        <thead>\n          {teachers.length > 0 && <tr>\n            <th style={{width: \"20%\"}}>Namn</th>\n            <th>Lnk eller E-postadress</th>\n          </tr>}\n        </thead>\n        <tbody>\n          {teachers.map((teacher, idx) => \n          <tr key={idx}>\n            <td><input type=\"text\" ref={elem => this.nameElem = elem} value={teacher.name} autoFocus={!teacher.name && idx > 0} onChange={\n              ev=>{\n                if (addEmtpyRow && idx == teachers.length - 1) {\n                  onUpdate({$push: [{...teacher, name: ev.target.value}] });\n                  this.setState({addEmtpyRow: false});\n                } else if (ev.target.value || teacher.url) {\n                  onUpdate({$splice: [[idx, 1, {...teacher, name: ev.target.value}]] });\n                } else {\n                  if (this.props.teachers.length === 1)\n                    this.setState({addEmtpyRow: true});\n                  onUpdate({$splice: [[idx, 1]]});\n                }\n              }\n            }/></td>\n            <td><input\n              type=\"text\"\n              style={{width: \"100%\"}}\n              value={teacher.url}\n              onKeyDown={ev =>\n                ev.which === 9 &&\n                !ev.shiftKey &&\n                idx === teachers.length - 1 &&\n                (teachers.length < 1 || !!teachers[teachers.length - 1].name &&\n                  (this.setState({addEmtpyRow: true}),ev.preventDefault()))}\n              onChange={ev => {\n                if (addEmtpyRow && idx == teachers.length - 1) {\n                  onUpdate({$push: [{...teacher, url: ev.target.value}]})\n                  this.setState({addEmtpyRow: false});\n                } else if (ev.target.value || teacher.name) {\n                  onUpdate({$splice: [[idx, 1, {...teacher, url: ev.target.value}]]});\n                } else {\n                  if (this.props.teachers.length === 1)\n                    this.setState({addEmtpyRow: true});\n                  onUpdate({$splice: [[idx, 1]]});\n                }\n              }\n              \n            }/></td>\n          </tr>)}\n        </tbody>\n      </table>\n      <br/>\n      <a className=\"btn\" onClick={() =>\n        this.state.addEmtpyRow ?\n          this.nameElem.focus() :\n          this.setState({addEmtpyRow: true})}>\n            <i className=\"fa fa-user-plus\" aria-hidden /> Lgg till ansvarig lrare</a>\n    </div>\n  }\n}","import * as React from 'react';\nimport { Course } from 'kedbackend/models';\nimport { getTasksPerId } from \"../courses/business-logic\";\nimport { futureAbilities } from \"../../../contracts/ked-models\";\nimport { OpenCloseBox } from \"../../utility-components/open-close-box\";\n\ninterface Props {\n  course: Course;\n}\n\ninterface State {\n  isOpen: boolean;\n}\n\nexport class WeightedItemsTable extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      isOpen: false\n    };\n  }\n\n  render() {\n    const { course } = this.props;\n    const { isOpen } = this.state;\n    const rows = [];\n    const tasksPerId = getTasksPerId(course);\n\n    rows.push(<tr key=\"centralContent\" className=\"covered-item-label\"><td colSpan={2}>Centralt innehll</td></tr>);\n    course.centralContent.forEach((cc,idx) => rows.push(<tr key={cc.id} className={idx % 2 ? \"tableOdd\" : \"\"}>\n      <td><p className=\"criteriaText\" dangerouslySetInnerHTML={{__html: cc.name}}/></td>\n      <td><p>{(tasksPerId[cc.id] || []).length}</p></td>\n    </tr>));\n\n    rows.push(<tr key=\"abilities\" className=\"covered-item-label\"><td colSpan={2}>Frmgor</td></tr>);\n    course.abilities.forEach((ability,idx) => rows.push(<tr key={ability.id} className={idx % 2 ? \"tableOdd\" : \"\"}>\n      <td><p className=\"abilityText\" dangerouslySetInnerHTML={{__html: ability.name}}/></td>\n      <td><p>{(tasksPerId[ability.id] || []).length}</p></td>\n    </tr>));\n\n    rows.push(<tr key=\"futureAbilities\" className=\"covered-item-label\"><td colSpan={2}>Framtidsfrmgor</td></tr>);\n     futureAbilities.forEach((futureAbilityText, idx) => rows.push(<tr key={futureAbilityText} className={idx % 2 ? \"tableOdd\" : \"\"}>\n      <td><p className=\"abilityText\">{futureAbilityText}</p></td>\n      <td><p>{(tasksPerId[futureAbilityText] || []).length}</p></td>\n    </tr>));\n\n    return <OpenCloseBox\n      className=\"larger\"\n      title={<p>Kursens tckningstabell</p>}\n      contentClassName=\"weighted-items-table\">\n        <p>Tabellen anger hur mnga uppgifter som berr varje del.</p>\n        <table><tbody>{rows}</tbody></table>\n    </OpenCloseBox>\n  }\n}","import * as React from 'react';\nimport { L } from '../../../utils/utils';\nimport { Resource } from 'kedbackend/models';\nimport { Dialog } from '../interfaces/course-editor-host';\nimport validUrl from 'valid-url';\n\ninterface Props {\n  url?: string;\n  onSave: (newUrl: string) => void;\n  onDelete?: ()=>void;\n}\n\ninterface State {\n  url: string;\n}\n\nexport class EditWorkflowLink extends React.Component<Props,State> implements Dialog {\n  constructor(props: Props) {\n    super(props);\n    this.state = {url: this.props.url || ''};\n  }\n\n  save() {\n    const {url} = this.state;\n    if (!validUrl.isUri(url)) throw new Error(L`Angiven URL '${url}' r ogiltig. Ska brja med http: eller https:`);\n    this.props.onSave(url);\n  }\n\n  render() {\n    const {onSave, onDelete} = this.props;\n    const state = this.state;\n    const isValidUrl = validUrl.isUri(this.state.url);\n\n    return <div><div className=\"sv-html-portlet sv-portlet sv-skip-spacer\">\n      <h2>Koppla en arbetsgng till kursen</h2>\n      <p>Det gr bara att lgga in en arbetsgng per kurs.</p>\n      <br />\n      <div className=\"align-horizontal\">\n        <div className=\"horizontalItem top\">Lnk:</div>\n        <div className=\"horizontalItem top \">\n          <input type=\"text\"\n            tabIndex={1}\n            size={50}\n            value={state.url}\n            onChange={ev=>this.setState({url: ev.target.value})} />\n        </div>\n        <div className=\"horizontalItem top spaced\"></div>\n      </div>\n      <br /></div>\n      <div className=\"sv-html-portlet sv-portlet\" id=\"svid12_492422d515badf36646e4ff1\">\n        {onDelete && <div tabIndex={2} className=\"btn btn-warning btn-large pull-right\" onClick={()=>onDelete()}>\n          Ta bort arbetsgng\n        </div>}\n        <a\n          tabIndex={1}\n          className={\"btn btn-large\" + (isValidUrl ? \"\" : \" btn-inactive\")}\n          onClick={isValidUrl && (() => onSave(state.url))}>Spara</a>\n      </div>\n    </div>\n  }\n}\n","import * as React from 'react';\nimport {Resource} from 'kedbackend/models';\nimport {Link} from 'react-router-dom';\nimport {ICourseEditorHost} from '../interfaces/course-editor-host';\nimport {EditResource} from '../modal-pages/edit-resource';\nimport { updateModificationAndCreationStamps } from '../utils';\nimport env from '../../../globals/KED.env';\nimport { EditWorkflowLink } from '../modal-pages/edit-workflow-link';\n\ninterface Props {\n  url: string;\n  onUpdate: (updates) => void;\n  host: ICourseEditorHost;\n}\n\nexport class EditableWorkFlowLink extends React.Component<Props> {\n  constructor(props: Props) {\n    super(props);\n    this.state={};\n  }\n\n  render() {\n    const {host, onUpdate, url} = this.props;\n    return <div>\n      <div className=\"taskContainer\">\n        {url &&\n          <div className=\"align-horizontal\">\n            <div className=\"horizontalItem top\">\n              <a className=\"editItem\" onClick={()=>host.openDialog({\n                Component: EditWorkflowLink,\n                props: {\n                  url,\n                  onSave: newUrl => {\n                    onUpdate({$set: newUrl});\n                    host.closeDialog();\n                  },\n                  onDelete: ()=>{\n                    onUpdate({$set: undefined});\n                    host.closeDialog();\n                  }\n                }\n              })}></a>\n            </div>\n            <div className=\"horizontalItem top\">\n              <a href={url} target=\"_blank\" >Nuvarande arbetsgng</a>\n            </div>\n          </div>\n        }\n     </div>\n    {!url && <a className=\"btn\" onClick={()=>host.openDialog({\n      Component: EditWorkflowLink,\n      props: {\n        onSave: newUrl => {\n          onUpdate({$set: newUrl})\n          host.closeDialog();\n        }\n      }\n    })}><i className=\"fa fa-paperclip\" aria-hidden></i> Koppla en arbetsgng till kursen</a>}\n    </div>\n  }\n}\n","import * as React from 'react';\nimport { Course, Ability, Subject } from 'kedbackend/models';\nimport { EditableResourceList } from '../sub-components/editable-resource-list';\nimport { dtFormat } from '../utils';\nimport { CourseModuleList } from './course-module-list';\nimport { SchoolCourses } from '../sub-components/school-courses';\nimport { ICourseEditorHost } from '../interfaces/course-editor-host';\nimport { getUncoveredKnowledgeRequirements, sanityCheck, getIdsNotCoveredByTasks } from './business-logic';\nimport { setCourseImage } from \"./course-banner\";\nimport { Courses } from \"./index\";\nimport { ListCourseTemplates } from \"./list-course-templates\";\nimport { Spinner } from '../sub-components/spinner';\nimport { EditableTeacherList } from '../sub-components/editable-teacher-list';\nimport { showError, L } from \"../../../utils/utils\";\nimport { WeightedItemsTable } from '../sub-components/weighted-items-table';\nimport { Wysiwyg } from '../../utility-components/wysiwyg/index';\nimport actions_swedish from '../../utility-components/wysiwyg/actions-sv';\nimport { EditableWorkFlowLink } from '../sub-components/editable-workflow-link';\nimport { RenameableText } from '../../utility-components/renameable-text';\n\ninterface Props {\n  course: Course;\n  origCourse: Course;\n  host: ICourseEditorHost;\n};\n\ninterface State {\n  changeImageUrl: boolean;\n}\n\nexport class InnerEditCourse extends React.Component<Props,State> {\n  props: Props;\n  state: State;\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      changeImageUrl: false\n    };\n  }\n\n  setImageUrl(imageUrl: string) {\n    const { course } = this.props;\n    if (!course.imageId) {\n\n    }\n  }\n\n  render() {\n    const { course, origCourse, host } = this.props;\n    const uncoveredKnowledgeRequirements = getUncoveredKnowledgeRequirements(course);\n    const idsNotCoveredByAnyTask = getIdsNotCoveredByTasks(course);\n    const sanityCheckWarnings = sanityCheck(course);\n    const courseImage = course.images.find(img => img.id === course.imageId);\n    const courseImageIsUploaded = courseImage && courseImage.url.startsWith('data:');\n\n    return <div className=\"sv-row sv-layout sv-skip-spacer\">\n      <div className={\"sv-layout sv-skip-spacer sv-column-7\"}>\n        <div className=\"sv-html-portlet sv-portlet sv-skip-spacer\">\n          {course.isTemplate && <h1>Kursmall</h1> }\n          <h2>Kursvergripande</h2>\n          <hr />\n          <div className=\"ked_boxed\">\n            <div>\n              <h3>Kursens bild</h3>\n              {courseImageIsUploaded ?\n                <p>Kursens bild ligger i databasen. Fr att ndra bild mste du dra och slppa en ny bild ovanp den gamla hgst upp p denna sida.\n                  Bilden kan antingen vara frn en annan webbsida. Lokala bildfiler gr ocks bra att dra och slppa.</p>\n                 : courseImage ? <div><textarea\n                  value={courseImage.url}\n                  style={{width: '100%', height: '30px'}}\n                  onChange={ev=>setCourseImage(course, origCourse, host, ev.target.value)}/>\n                  <p>Bilden som visas hgst upp hmtas frn angiven URL.\n                    Fr att ndra bild kan du redigera URL ovan. Ett annat stt att ndra bild r att dra och slppa en ny bild ver den gamla hgst upp p sidan.</p>\n                </div> :\n                  <p>Kursen saknar egen bild.\n                    Lgg till en bild genom att dra och slppa en bild p kurs-bannern hgst upp p den hr sidan.</p>}\n              <br/>\n            </div>\n\n            {!course.isTemplate && <div>\n              <h3>Beskrivning</h3>\n              <p className=\"subHeader\">(Beskrivning av kursen. Fr att skilja mellan olika varianter av samma gymnasiekurs)</p>\n              <textarea className=\"inputTextBox inputTextSmall\"\n                value={course.description}\n                onChange={ev => host.update({ description: { $set: ev.target.value } })} />\n              <br />\n            </div>}            \n\n            <div>\n              <h3>Upptaktstext</h3>\n              <p className=\"subHeader\">(texten ska visas p kursens upptaktssektion)</p>\n              <Wysiwyg\n                html={course.runUpText}\n                defaultActions={actions_swedish}\n                actions={[\n                  \"bold\",\n                  \"italic\",\n                  \"underline\",\n                  \"strikethrough\",\n                  \"heading2\",\n                  \"heading3\",\n                  \"olist\",\n                  \"ulist\",\n                  \"line\",\n                  \"link\",\n                  \"image\"]}\n                onChange={newHtml => host.update({ runUpText: {$set: newHtml}})} />\n              <br />\n            </div>\n\n            <h3>Kursresurser</h3>\n            <p className=\"subHeader\">(Resurser fr upptakt och kursen som helhet)</p>\n            <EditableResourceList\n              resources={course.resources}\n              onUpdate={resourcesUpdates => host.update({ resources: resourcesUpdates })}\n              host={host} />\n            <br />\n            <h3>Arbetsgng</h3>\n            <p className=\"subHeader\">(Eventuell lnk till arbetsgng fr kursen)</p>\n            <EditableWorkFlowLink\n              url={course.workFlowLink}\n              onUpdate={updates => host.update({ workFlowLink: updates })}\n              host={host} />\n            <br />\n            {!course.isTemplate && <div>\n              <h3>Google Classroom</h3>\n              <div className=\"align-horizontal spaced\">\n                <div className=\"horizontalItem top\">\n                  <input\n                    placeholder=\"Google classroom URL\"\n                    type=\"text\"\n                    size={30}\n                    value={course.googleClassRoomURL}\n                    onChange={ev => host.update({googleClassRoomURL: {$set: ev.target.value}})}/>\n                </div>\n                <div className=\"horizontalItem top\">\n                  <input\n                    placeholder=\"kod\"\n                    type=\"text\"\n                    size={8}\n                    value={course.googleClassRoomCode}\n                    onChange={ev => host.update({googleClassRoomCode: {$set: ev.target.value}})} />\n                </div>\n              </div>\n            </div>}\n\n            <br />\n            {!course.isTemplate && <><EditableTeacherList \n              teachers={course.responsibleTeachers}\n              onUpdate={teachersUpdate => {\n                host.update({responsibleTeachers: teachersUpdate});\n              }} />\n            <br />\n            <h3>Inlmnings E-post</h3>\n            <table tabIndex={1} style={{width: '100%'}}>\n              <thead><tr><th>\n                E-postaddress\n              </th></tr></thead>\n              <tbody>\n                <tr>\n                  <td>\n                    <RenameableText\n                      eager={true}\n                      clickAdvertiseText=\"Klicka hr fr att ange vem som tar emot inlmningsuppgifter\"\n                      text={course.assignmentEmails ? course.assignmentEmails[0] : \"\"}\n                      placeholder=\"Ange mottagare av inlmningsuppgifter\"\n                      tag=\"input\"\n                      onChange={value => host.update({assignmentEmails: {$set: [value]}})}\n                    />\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n            </>}\n\n          </div>\n          <div className=\"sv-html-portlet sv-portlet\" id=\"svid12_6ab4811f15b13c706b43bb47\">\n            <div id=\"Kursensmoduler\">\n            </div>\n            <h2>Kursens moduler</h2>\n            <hr />\n          </div>\n          <CourseModuleList\n            host={host}\n            course={course}\n            idsNotCoveredByAnyTask={idsNotCoveredByAnyTask} />\n          \n          <div>\n            <br/>\n            <WeightedItemsTable course={course}/>\n          </div>\n\n          <div className=\"sv-html-portlet sv-portlet\">\n            <h2>Kursens status</h2>\n            <hr />\n            {course.createdBy && course.createdDate && <p>\n              Kursen skapades {dtFormat(course.createdDate)} av <strong>{course.createdBy.name}</strong>.\n            </p>}\n            {course.modifiedBy && course.modifiedDate && <p>\n              Kursen redigerades senast {dtFormat(course.modifiedDate)} av <strong>{course.modifiedBy.name}</strong>.\n            </p>}\n            {course.active ? <p>\n              Kursen r <strong>AKTIV</strong> sedan {dtFormat(course.activatedDate)} av <strong>{course.activatedBy.name}</strong>.\n            </p> : <p>\n                Kursen r <strong>INAKTIV</strong>{course.inactivatedBy ? <span>\n                  sedan {dtFormat(course.inactivatedDate)} av <strong>{course.inactivatedBy.name}</strong>.</span> : <span>.</span>\n                }\n              </p>}\n            {(uncoveredKnowledgeRequirements.length === 0 ?\n              <p className=\"markedGreen\">Modulernas kunskapskrav tcker skolverkets krav fr denna kurs</p> :\n              <div className=\"markedRed warning-box\"><div className=\"warningFlag\">\n                <i className=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i>\n              </div><p>Modulernas kunskapskrav tcker inte skolverkets krav fr denna kurs.</p>\n              </div>)}\n            {sanityCheckWarnings.map(warning => <div key={warning} className=\"markedRed warning-box\"><div className=\"warningFlag\">\n                <i className=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i>\n              </div><p>{warning}</p></div>)}\n            <br />\n            {!course.isTemplate && (origCourse ? <div\n              className=\"btn btn-warning btn-large pull-right\"\n              onClick={()=>{\n                if (confirm(L`Bekrfta borttagning av kursen \"${course.name} - ${course.description}\" fr skolan ${course.school}\\n\\nKursen kommar att raderas helt!\\n\\nr du sker?`))\n                  host.deleteCourse().catch(showError);\n              }}\n            >Ta bort kurs</div>:<div\n              className=\"btn btn-warning btn-large pull-right\"\n              onClick={()=>history.go(-1)}\n            >Avbryt\n              </div>)}\n            <div className=\"btn btn-large\" onClick={() => host.save()}>\n              Spara\n            </div>\n            {course.active ?\n              <div className=\"btn btn-info btn-large\"\n                onClick={() => host.inactivateAndSave()}>\n                Inaktivera och spara\n              </div> :\n              <div className=\"btn btn-info btn-large\"\n                onClick={() => host.activateAndSave()}>\n                Aktivera och spara\n              </div>}\n          </div>\n        </div>\n      </div>\n      <div className=\"sv-layout sv-column-5\">\n        <SchoolCourses />\n      </div>\n    </div>\n  }\n}","import * as React from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { L, showInfo, showError, flatten, compareProp } from '../../../utils/utils';\nimport { Course, Resource, KnowledgeRequirement, Subject, Ability, Task, School } from 'kedbackend/models';\nimport { BatchRunner, HttpError, createUUID } from 'kedbackend/client';\nimport env from '../../../globals/KED.env';\nimport { CourseBanner } from './course-banner';\nimport { InnerEditCourse } from './inner-edit-course';\nimport moment from 'moment';\nimport update from 'react-addons-update';\nimport { updateDocumentGraphs, applyEtags, updateCourseBuilderStatus, loadCourse, updateModificationAndCreationStamps, updateCreationStamp, updateModificationStamp } from '../utils';\nimport { ICourseEditorHost, Dialog, DialogContainer } from '../interfaces/course-editor-host';\nimport { RemoveItem } from '../sub-components/remove-item';\nimport $ from 'jquery';\nimport { getUncoveredKnowledgeRequirements, getIdsNotCoveredByTasks } from './business-logic';\nimport cfg from '../../../globals/KED.cfg';\nimport { Spinner } from \"../sub-components/spinner\";\nimport { mySchoolCoursesRepo } from '../../../repos/school-courses';\nimport { preserveImpersonationQuery } from \"../../../access-control\";\n\nconst catcher = cfg.ENVIRONMENT === 'production' ?\n  showError : null;\n\ninterface Props {\n  id?: string;\n  subjectId?: string;\n  isTemplate?: boolean;\n  templateId?: string;\n  view?: 'studentPage' | 'courseBuilder' | 'templateBuilder';\n  viewCourseUrl: string;\n  feedbackUrl: string;\n}\n\ninterface State {\n  origCourse: Course | null;\n  origTemplate: Course | null;\n  course: Course;\n  allCourses?: Course[];\n  dialogContainers: DialogContainer[]; // When editing items, it may show as a dialog\n  hasUnsavedData: boolean;\n  view: 'studentPage' | 'courseBuilder' | 'templateBuilder';\n}\n\nconst CONFIRM_NAVIGATE_MESSAGE =\n  L`Du har osparat data. Vlj avbryt och tryck CTRL+S om du vill spara frst.`;\n  \nconst DEFAULT_STATE: State = {\n  origCourse: null,\n  origTemplate: null,\n  course: null,\n  dialogContainers: [],\n  hasUnsavedData: false,\n  view: 'courseBuilder'\n};\n\nexport class EditCourse extends React.Component<Props,State> implements ICourseEditorHost {\n  pageYOffset: number;\n  contentDiv: HTMLDivElement;\n  contentYPos: number;\n  isSaving: boolean;\n  dialogs: Dialog[];\n\n  setStatePromised (state: Partial<State>) : Promise<any> {\n    return this._setState({hasUnsavedData: true, ...state});\n  }\n\n  setNonSaveableDataState (state: Partial<State>) : Promise<any> {\n    return this._setState(state);\n  }\n\n  _setState (state: Partial<State>) : Promise<any> {\n    if (state.course) {\n      {\n        //\n        // Maintain course task links (remove links to tasks that are not used\n        // by any module)\n        //\n        const {tasks, modules} = state.course;\n        const usedTaskIds = {};\n        modules.forEach(module => module.taskIds.forEach(id => usedTaskIds[id] = true));\n        const filteredCourseTasks = tasks.filter(t => usedTaskIds[t.id]);\n        const modifiedCourse = {...state.course};\n        modifiedCourse.tasks = filteredCourseTasks;\n        state = {...state, course: modifiedCourse};\n      }\n    }\n\n    // Invoke our course into state property allCourses so that the\n    // right-hand side list of courses gets update immediately with\n    // the publishable state of this course.\n    let allCourses = state.allCourses || this.state.allCourses;\n    const course = state.course || this.state.course;\n    if (allCourses) {\n      const idxOurCourse = allCourses.findIndex(c => c.id === this.props.id);\n      allCourses = update(allCourses, {$splice: [[idxOurCourse, 1, course]]});\n      state = {...state};\n      state.allCourses = allCourses;\n    }\n\n    return new Promise(resolve => super.setState(()=>state as State, resolve));\n  }\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {...DEFAULT_STATE};\n    this.update = this.update.bind(this);\n    this.refDialog = this.refDialog.bind(this);\n    this.contentYPos = 0;\n    this.onKeyDown = this.onKeyDown.bind(this);\n    this.beforeUnload = this.beforeUnload.bind(this);\n    this.onClickPreventUnload = this.onClickPreventUnload.bind(this);\n    this.isSaving = false;\n    this.dialogs = [];\n    if (props.view) this.state = {\n      ...this.state,\n      view: props.view\n    };\n  }\n\n  componentWillMount() {\n    this.load().catch(catcher);\n    window.addEventListener('keydown', this.onKeyDown);\n    window.addEventListener('beforeunload', this.beforeUnload);\n    document.body.addEventListener('click', this.onClickPreventUnload);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('keydown', this.onKeyDown);\n    window.removeEventListener('beforeunload', this.beforeUnload);\n    document.body.removeEventListener('click', this.onClickPreventUnload);\n    updateCourseBuilderStatus('');\n  }\n\n  componentWillReceiveProps(nextProps: Props) {\n    if (this.state && this.state.course) {\n      if (nextProps.id !== this.props.id || nextProps.templateId !== this.props.templateId) {\n        this.setStatePromised(DEFAULT_STATE);\n      }\n    }\n    if (nextProps.view !== this.props.view) {\n      this.setNonSaveableDataState({view: nextProps.view});\n    }\n  }\n\n  componentDidUpdate(prevProps: Props, prevState: State) {\n    if (this.contentDiv) {\n      const contentDiv: HTMLDivElement = findDOMNode(this.contentDiv);\n      if (contentDiv) {\n        this.contentYPos = contentDiv.getBoundingClientRect().top;\n      }\n    }\n\n    if (prevState && prevState.course) {\n      // This was not the initial update.\n      // If props have been updated to point out another course or template, reset component:\n      if (this.props.id !== prevProps.id || this.props.templateId !== prevProps.templateId) {\n        this.load().catch(catcher);\n      }\n    }\n\n    if (!prevState.hasUnsavedData && this.state.hasUnsavedData) {\n      updateCourseBuilderStatus('unsaved');\n    }\n  }\n\n  async loadFromTemplate(templateId: string) {\n    showInfo(\"Laddar data frn mall...\");\n    const template = await loadCourse(templateId, {includeTemplateChain: true});\n    const course = updateCreationStamp(Date.now(), template, env.currentUser);\n    course.id = createUUID();\n    course.parentId = templateId;\n    course.active = false;\n    course.isTemplate = false;\n    course.templateChain = [...course.templateChain];\n    course.templateChain.push({id: templateId, $meta: 'ref'} as Course);\n    const mySchool = env.currentUser.school;\n    course.school = mySchool;\n    course.description = \"\";\n    course.responsibleTeachers = [];\n    course.acl = [\n      \"role:USER:R\", // All users may view it. (Could have restricted it to school, but not nescessary!)\n      `schoolRole:${mySchool}/EMPLOYEE:S` // Other teachers at same school should be able to modify the course.\n    ];\n    delete course.$etag;\n    delete course.createdBy;\n    delete course.createdDate;\n    delete course.modifiedBy;\n    delete course.modifiedDate;\n    delete course.activatedBy;\n    delete course.activatedDate;\n    delete course.googleClassRoomCode;\n    delete course.googleClassRoomURL;\n    await this.setStatePromised({ course, origCourse: null, origTemplate: template });\n    showInfo(\"\");\n  }\n\n  async load() {\n    updateCourseBuilderStatus('');\n    if (this.props.id) {\n      await this.loadExistingCourse(this.props.id);\n    } else if (this.props.templateId) {\n      await this.loadFromTemplate(this.props.templateId);\n    } else {\n      throw new Error(L`Ogiltig parameter. id eller templateId mste anges`);\n    }\n  }\n\n  async loadExistingCourse(courseId: string) {\n    showInfo(\"Laddar kurs\");\n    const course = await loadCourse(courseId);\n    if (!course.responsibleTeachers) course.responsibleTeachers = [];\n    await this.setNonSaveableDataState({ course, origCourse: course });\n    showInfo(\"\");\n  }\n\n  async update(courseUpdates) {\n    await this.setStatePromised({ course: update(this.state.course, courseUpdates) });\n  }\n\n  async deleteCourse() {\n    showInfo(\"Raderar kursen...\");\n    const courseSchool = this.state.course.school;\n    const parentId = this.state.course.parentId;\n    const courseId = this.props.id;\n\n    const children = await env.kedBackendClient.list<Course>(\"courses\", {\n      hasEdgesTo: [this.props.id]\n    });\n    const br = new BatchRunner();\n    for (const childCourse of children) {\n      /* CANNOT DO THIS. MAY NOT HAVE ACCESS! if (childCourse.parentId === courseId) {\n        // Reconnect child with my parent instead, as I will be disappearing...\n        childCourse.parentId = parentId;\n        br.put(\"courses\", childCourse);\n      }*/\n    }\n\n    br.delete(\"courses\", courseId);\n    await env.kedBackendClient.batch(br.mutationRequests);\n    if (courseSchool === env.currentUser.school) {\n      mySchoolCoursesRepo.delete(courseId);\n    }\n    showInfo(\"\");\n    location.hash = \"#/courses/new\";\n  }\n\n  async save () {\n    if (this.isSaving) return;\n    try {\n      this.isSaving = true;\n      await this._save();\n    } catch (err) {\n      let errorMessage = err && err.message ? err.message : L`Ett oknt fel har intrffat...`;\n      if (err) {\n        if (err.name === 'http409' || err.name === 'http412' || err.name === 'http404') {\n          // Conflict. Show a nicer error message:\n          errorMessage = L`Kursen har redigerad av annan anvndare. Ladda om sidan och gr om ndrinarna.`;\n        } else if (err.name === 'http403') {\n          if (this.state.course.isTemplate)\n            errorMessage = L`Ingen behrighet att spara kursmallen. Endast administratrer kan redigera kursmallar.`;\n          else if (this.state.course.school)\n            errorMessage = L`Ingen behrighet att spara kursen ${this.state.course.name}. Kursen kan bara redigeras av anstllda p ${this.state.course.school}`;\n        }\n      }\n      showError(errorMessage);\n      updateCourseBuilderStatus('error');\n    } finally {\n      this.isSaving = false;\n    }\n  }\n\n  private async _save() {\n    const { course, origCourse, origTemplate } = this.state;\n    const doesAllTasksCoverAllRequirements = getUncoveredKnowledgeRequirements(course).length === 0;\n\n    showInfo(L`Sparar...`);\n    let modifiedCourse: Course = updateModificationStamp(Date.now(), course, env.currentUser);\n\n    const batch = new BatchRunner();\n\n    // Resolve manipulated graphs of each task and remove $meta, generate UUID etc for\n    // each added / updated task.\n    // The result of this operation is two-fold:\n    //  1) Remove $meta and create id for each task. To be reflected into next state.\n    //  2) Generate mutation requests into 'batch' to include in the single batch request to the server.\n    const orig = origCourse || origTemplate;\n    const newCourseTasks = modifiedCourse.tasks.map(task => {\n      if (task.$meta === 'add' || task.$meta === 'update') {\n        const origTask = orig.tasks.find(t => t.id === task.id);\n        return updateDocumentGraphs(origTask || {}, task, \"tasks\", {\n          knowledgeRequirements: 'knowledge-requirements',\n          centralContent: 'central-content',\n          abilities: 'abilities'\n        }, batch);\n      } else {\n        const updatedTask = {...task};\n        delete updatedTask.$meta;\n        return updatedTask;\n      }\n    });\n    modifiedCourse = update(modifiedCourse, {tasks: {$set: newCourseTasks}});\n\n    modifiedCourse = updateDocumentGraphs(origCourse || {}, modifiedCourse, 'courses', {\n      templateChain: 'courses',\n      centralContent: 'central-content',\n      knowledgeRequirements: 'knowledge-requirements',\n      abilities: 'abilities',\n      images: 'images',\n      tasks: 'tasks'\n    }, batch);\n\n    modifiedCourse = {...modifiedCourse };\n    modifiedCourse.publishable = doesAllTasksCoverAllRequirements;\n    const tags = (modifiedCourse.tags || []).filter(tag => tag !== 'incomplete');\n    modifiedCourse.tags = modifiedCourse.publishable ?\n      tags : tags.concat(\"incomplete\");\n\n    if (!origCourse) {\n      // A new course should be added:\n      batch.add('courses', modifiedCourse);\n      if (course.school) {\n        const schoolId = await mySchoolCoursesRepo.getSchoolId();\n        batch.link(\"schools\", schoolId, \"courses\", course.id, \"courses\");\n        if (course.active) {\n          batch.link(\"schools\", schoolId, \"courses\", course.id, \"activeCourses\");\n        }\n      }\n    } else {\n      // An existing course should be updated:\n      batch.put('courses', modifiedCourse);\n      if (!origCourse.active && course.active) {\n        // Course was activated. Add a reference to the course on school.activeCourses.\n        const schoolId = await mySchoolCoursesRepo.getSchoolId();\n        batch.link(\"schools\", schoolId, \"courses\", course.id, \"activeCourses\");\n      } else if (origCourse.active && !course.active) {\n        // Course was inactivated. Remove from school.activeCourses.\n        const schoolId = await mySchoolCoursesRepo.getSchoolId();\n        batch.unlink(\"schools\", schoolId, \"courses\", course.id, \"activeCourses\");\n      }\n    }\n\n    // Perform the entire batch through a single POST request:\n    const res = await env.kedBackendClient.batch(batch.mutationRequests);\n    showInfo (origCourse ?\n      L`ndringarna har sparats` :\n      L`Kursen har skapats`);\n    // Update state to reflect what has been posted:\n    if (res && res.newEtags)\n        modifiedCourse = applyEtags(modifiedCourse, res.newEtags, [\"images\", \"tasks\"]) as Course;\n    \n    if (course.school === env.currentUser.school) {\n      // Update mySchoolCoursesRepo\n      if (!origCourse) {\n        mySchoolCoursesRepo.insert(modifiedCourse);\n      } else {\n        mySchoolCoursesRepo.update(modifiedCourse);\n      }\n    }\n\n    await this.setNonSaveableDataState({course: modifiedCourse, origCourse: modifiedCourse, hasUnsavedData: false});\n    updateCourseBuilderStatus('');\n    if (!origCourse) {\n      // This was the creation of a new course. Correct the route now when the user enters an edit state:\n      location.hash = `#/courses/${modifiedCourse.id}/edit`;\n    }\n  }\n\n  activateAndSave() {\n    const course = {...this.state.course};\n    if (!course.active) {\n      /*const uncoveredRequirements = getUncoveredKnowledgeRequirements(course);\n      if (uncoveredRequirements.length > 0) \n        return showError (L`Det finns kunskapskrav som inte uppfylls av ngon modul. Kan inte aktivera kursen frrn alla kunskapskrav finns med.`);\n      */\n\n      course.active = true;\n      course.activatedBy = {\n        name: env.currentUser.displayName,\n        url: \"mailto:\" +  env.currentUser.mail\n      };\n      course.activatedDate = Date.now();\n      this.setStatePromised({course})\n        .then(()=>this.save())\n        .catch(catcher);\n    }\n  }\n\n  inactivateAndSave() {\n    const course = {...this.state.course};\n    if (course.active) {\n      course.active = false;\n      course.inactivatedBy = {\n        name: env.currentUser.displayName,\n        url: \"mailto:\" +  env.currentUser.mail\n      };\n      course.inactivatedDate = Date.now();\n      this.setStatePromised({course})\n        .then(()=>this.save())\n        .catch(catcher);\n    }\n  }\n\n  openDialog(dialogContainer: DialogContainer) {\n    this.setNonSaveableDataState({dialogContainers: this.state.dialogContainers.concat(dialogContainer)});\n  }\n\n  closeDialog() {\n    const {dialogContainers} = this.state;\n    const {length} = dialogContainers;\n    length && this.setNonSaveableDataState({dialogContainers: dialogContainers.slice(0, length - 1)});\n    // Now sync the direct 'dialogs' property with the new state:\n    while (this.dialogs.length >= length) this.dialogs.pop();\n  }\n\n  refDialog(dialog: Dialog & React.Component, index: number) {\n    this.dialogs[index] = dialog; // Setting per index instead of push(). Works even if the ref attribute could be invoked multiple times.\n  }\n\n  onKeyDown (ev: KeyboardEvent) {\n    if (ev.which === 83 && (ev.ctrlKey || ev.metaKey)) { // CTRL-S\n      ev.preventDefault();\n      if (this.state.dialogContainers.length > 0) {\n        this.saveDialog();\n        return;\n      }\n      this.save();\n    } else if (ev.which === 27 && this.state.dialogContainers.length > 0) {\n      this.closeDialog();\n      ev.preventDefault();\n    } else if (ev.which === 13) {\n      const targetElem = ev.target as HTMLElement;\n      if (this.state.dialogContainers.length > 0 &&\n        targetElem.tagName !== 'TEXTAREA' &&\n        targetElem.tagName !== 'INPUT' &&\n        targetElem.tagName !== 'SELECT' &&\n        targetElem.tagName !== 'OPTION' &&\n        !targetElem.contentEditable)\n      {\n        this.saveDialog();\n      }\n    }\n  }\n\n  beforeUnload(ev: Event) {\n    if (this.state.dialogContainers.length > 0 || this.state.hasUnsavedData) {\n      if (!env.kedBackendClient.http.bearerProvider.wantsRedirect) {\n        ev.returnValue = CONFIRM_NAVIGATE_MESSAGE;\n        return ev.returnValue;\n      }\n    }\n  }\n\n  onClickPreventUnload(ev: Event) {\n    if (ev.target && (''+(ev.target as any).tagName).toLowerCase() === 'a') {\n      const a: HTMLAnchorElement = ev.target as HTMLAnchorElement;\n      if (a.href && a.getAttribute('href') !== '#' && !a.target) {\n        if (this.state.dialogContainers.length > 0 || this.state.hasUnsavedData) {\n          if (!confirm(CONFIRM_NAVIGATE_MESSAGE)) {\n            ev.preventDefault();\n            ev.stopPropagation();\n            return false;\n          }\n        }\n      }\n    }\n  }\n\n  saveDialog() {\n    if (this.state.dialogContainers.length > 0) {\n      const dialog = this.dialogs[this.state.dialogContainers.length-1]; // YES, should reference this.dialogs by length of dialogContainers. Strange yes, but leave it so!\n      dialog && dialog.save(); \n    }\n  }\n\n  render() {\n    const isAdmin = env.currentUser.roles.indexOf(\"ADMIN\") >= 0;\n    const course = this.state.course;\n    return !this.state.course ? <div style={{outline: 0}}>\n      <CourseBanner\n        title=\"\"\n        activePage={this.state.view}\n        routes={{feedback: this.props.feedbackUrl}}\n      /><p><Spinner/>V.g. vnta medan kursen laddas...</p>\n      </div> :\n      <div style={{outline: 0}}>\n      <CourseBanner\n        title={course.name + \" - \" + course.points + \"p\"}\n        activePage={this.state.view}\n        routes={{\n          studentPage: preserveImpersonationQuery(this.props.viewCourseUrl, {courseId: this.props.id}),\n          feedback: this.props.feedbackUrl\n        }}\n        host={this}\n        course={course}\n        origCourse={this.state.origCourse}\n        backgroundImage={course.images.filter(img => img.id === course.imageId).map(img=>img.url)[0]}\n        isTemplate={course.isTemplate}\n       />\n      <div className=\"sv-row sv-layout\">\n        <div className=\"sv-layout sv-skip-spacer sv-column-12\">\n          <div className=\"sv-spacer-20pxvt sv-vertical sv-layout sv-skip-spacer\">\n            <div className=\"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer\" ref={\n              div => this.contentDiv = div}>\n              <InnerEditCourse\n                course={this.state.course}\n                origCourse={this.state.origCourse}\n                host={this} />\n              <br/>\n              {this.state.dialogContainers.map(({Component, props}, i) => {\n                return <div key={i}>\n                  <div className=\"darken\">\n                  </div>\n                  <div className=\"modal-page-wrap\">\n                    <div className=\"modal-page\">\n                      <Component ref={dialog=>this.refDialog(dialog, i)} {...props} />\n                      <RemoveItem onClick={()=>this.closeDialog()} />\n                    </div>\n                  </div>\n                </div>\n              })}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  }\n}\n","import * as React from 'react';\nimport { Course } from 'kedbackend/models';\nimport { L } from '../../../utils/utils';\nimport { Link } from 'react-router-dom';\n\nexport const ListCourseTemplates = (props: { courses: Course[], selectedCourseId? }) => {\n  const { courses } = props;\n  return <div>\n    <h2>{L`Vlj kursmall att redigera: `}</h2>\n    <ul className=\"entity-list\">\n      {courses.map(({ id, name, code, publishable, points, subjectId }) =>\n        <li key={id} className={\n          (publishable ? \"complete\" : \"incomplete\") +\n          (props.selectedCourseId === id ? \" selected\" : \"\")}>\n          <Link to={`/course-templates/${subjectId}/${id}`}>{name} - {points}</Link></li>)}\n    </ul>\n  </div>\n}\n\n","import * as React from 'react';\nimport { CourseBanner } from \"./course-banner\";\nimport { L, showError, flatten, compareProp, showInfo, maxLength, capitalizeFirst } from \"../../../utils/utils\";\nimport { Course, Subject } from \"kedbackend/models\";\nimport env from '../../../globals/KED.env';\nimport { Link } from 'react-router-dom';\nimport { Spinner } from \"../sub-components/spinner\";\nimport { SchoolCourses } from \"../sub-components/school-courses\";\n\ninterface Props {\n  feedbackUrl: string;\n}\n\ninterface State {\n  courseOptions: CourseOption[];\n  selectedTemplateId: string;\n  courses: CourseOption[] | null;\n  selectedCourseId: string;\n}\n\ninterface CourseOption {\n  id: string;\n  name: string;\n}\n\nexport class CreateNewCourse extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      courseOptions: null,\n      selectedTemplateId: \"--\",\n      courses: null,\n      selectedCourseId: \"\"\n    }\n  }\n\n  componentDidMount() {\n    this.load().catch(showError);\n  }\n\n  async load() {\n    showInfo(\"Laddar kurser\");\n    const subjects = await env.kedBackendClient.list<Subject>(\"subjects\", { include: \"courseTemplates\" });\n    const courses = flatten(subjects.map(s => s.courseTemplates)).sort(compareProp(\"name\"));\n    const courseOptions: CourseOption[] =\n      [{ id: \"--\", name: \"--\" }].concat(courses);\n    showInfo(\"\");\n    this.setState({ courseOptions });\n  }\n\n  async onSelectCourse(id: string) {\n    const derivedCourses = await env.kedBackendClient.list<Course>(\"courses\", { hasEdgesTo: [id] });\n    const courseOptions = derivedCourses\n      .filter(course => course.active)\n      .map(({ id, school, description, createdBy, modifiedBy }) => {\n        if (description) description = maxLength(description, 80);\n        let descriptionOrAuthor = description ||\n          (createdBy ? `${createdBy.name}s version` :\n          modifiedBy && `${modifiedBy.name}s version`);\n        return {\n          id,\n          name: school === 'standard' ?\n            description ? `Standard - ${description}` : \"Standard\" :\n            `${school} - ${maxLength(descriptionOrAuthor, 90)}`,\n          school\n        };\n      }).sort(compareProp(\"name\"));\n    const kedStandardOptions = courseOptions.filter(option => option.school === \"standard\");\n    const teacherMade = courseOptions.filter(option => option.school !== \"standard\");\n    const courses = [\n      ...kedStandardOptions,\n      { id, name: \"Tom\" },\n      ...teacherMade];\n    this.setState({\n      courses,\n      selectedTemplateId: id,\n      selectedCourseId: courses[0].id\n    });\n  }\n\n  render() {\n    const { courseOptions, selectedTemplateId, courses, selectedCourseId } = this.state;\n    return <div style={{ outline: 0 }}>\n      <CourseBanner\n        title={L`Kursbyggaren`}\n        activePage=\"courseBuilder\"\n        routes={{feedback: this.props.feedbackUrl}}\n      />\n      <div className=\"sv-row sv-layout\">\n        <div className=\"sv-layout sv-skip-spacer sv-column-12\">\n          <div className=\"sv-spacer-20pxvt sv-vertical sv-layout sv-skip-spacer\">\n            <div className=\"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer\">\n\n              <div className=\"sv-row sv-layout sv-skip-spacer\">\n                <div className={\"sv-layout sv-skip-spacer sv-column-7\"}>\n                  <div className=\"sv-html-portlet sv-portlet sv-skip-spacer\">\n                    <h2>Skapa ny kurs</h2>\n                    <hr />\n                    <div className=\"align-horizontal spaced\">\n                      <div className=\"horizontalItem top\">\n                        <p>Vlj gymnasiekurs :</p>\n                      </div>\n                    </div>\n                    <div className=\"align-horizontal spaced\">\n                      <div className=\"horizontalItem top\">\n                        {!courseOptions ?\n                          <div><Spinner /><select disabled value=\"\"><option>--</option></select></div> :\n                          <select\n                            value={this.state.selectedTemplateId}\n                            onChange={ev => this.onSelectCourse(ev.target.value).catch(showError)}\n                          >\n                            {courseOptions.map(course =>\n                              <option key={course.id} value={course.id}>{course.name}</option>\n                            )}\n                          </select>}\n                      </div>\n                    </div>\n                    {courses && <div className=\"align-horizontal spaced\">\n                      <div className=\"horizontalItem top\">\n                        <p>Utg frn version: </p>\n                      </div>\n                    </div>}\n                    {courses && <div className=\"align-horizontal spaced\">\n                      <div className=\"horizontalItem top\">\n                        <select value={selectedCourseId} onChange={ev => this.setState({\n                          selectedCourseId: ev.target.value\n                        })}>\n                          {courses.map(course =>\n                            <option key={course.id} value={course.id}>{course.name}</option>\n                          )}\n                        </select>\n                      </div>\n                    </div>}\n                    <br /><br />\n                    {courses && selectedCourseId && <Link\n                      to={`/courses/create-from-template/${this.state.selectedCourseId}`}\n                      className=\"btn btn-large\"\n                    >Skapa</Link>}\n                  </div>\n                </div>\n                <div className=\"sv-layout sv-column-5\">\n                  <SchoolCourses />\n                </div>\n              </div>\n\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  }\n}","import * as React from 'react';\nimport { L } from '../../../utils/utils';\nimport { Course, Subject } from 'kedbackend/models';\nimport env from '../../../globals/KED.env';\nexport { EditCourse } from './edit-course';\nimport { HashRouter as Router, Route, Link, Redirect } from 'react-router-dom';\nimport { CourseBanner } from \"./course-banner\";\nimport { ListCourseTemplates } from './list-course-templates';\nimport { Spinner } from \"../sub-components/spinner\";\n\ninterface Props {\n  selectedCourseId?: string;\n  selectedCoursePublishable?: string;\n  feedbackUrl: string;\n}\n\ninterface State {\n  subjects: Subject[] | null;\n}\n\nexport class Courses extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      subjects: null\n    };\n  }\n\n  componentWillMount() {\n    this.load();\n  }\n\n  async load() {\n    const subjects = await env.kedBackendClient.list<Subject>('subjects', { include: 'standardCourses' });\n    this.setState({ subjects });\n  }\n\n  render() {\n    const courses: Course[] = [];\n    this.state.subjects && this.state.subjects.forEach(s => courses.push.apply(courses, s.standardCourses));\n    courses.sort((c1, c2) => c1.name > c2.name ? 1 : c1.name < c2.name ? -1 : 0);\n    return <div>\n      <CourseBanner\n        title={L`Kursmallar`}\n        activePage=\"templateBuilder\"\n        routes={{feedback: this.props.feedbackUrl}}\n      />\n      {!this.state.subjects ?\n        <p><Spinner />V.g. vnta medan kurser laddas</p> :\n        <ListCourseTemplates courses={courses} />}\n      </div>\n  }\n}\n","import $ from 'jquery';\n\nconst HEARTBEAT_INTERVAL = 5 * 60 * 1000; // 5 minutes.\nconst HEARTBEAT_URL = \"/4.4b4cce2a160e445593f16043.html\"; // Could be any protected resource. BUGBUG: Configurable.\n\nlet lastActivity = Date.now();\n\nexport function keepSessionAlive() {\n  setInterval(onTimeout, HEARTBEAT_INTERVAL);\n  setTimeout(()=>$('body')\n    .mousemove(onUserActive)\n    .keypress(onUserActive)\n    .scroll(onUserActive), 100);\n}\n\nfunction onUserActive() {\n  lastActivity = Date.now();\n}\n\nfunction onTimeout() {\n  const inactivityTime = Date.now() - lastActivity;\n  if (inactivityTime < HEARTBEAT_INTERVAL) {\n    heartbeat();\n  }\n}\n\nasync function heartbeat() {\n  console.log(`Sending heartbeat request to ${HEARTBEAT_URL}`);\n  try {\n    const res = await fetch(HEARTBEAT_URL, {\n      cache: 'no-cache',\n      credentials: 'same-origin'\n    });\n    console.log(`Response from ${HEARTBEAT_URL}: ${res.status} ${res.statusText}`);\n  } catch (err) {\n    console.warn(`Request to ${HEARTBEAT_URL} failed: ${err}`);\n  }\n}\n","import * as React from 'react';\nimport { L } from '../../utils/utils';\nimport { HashRouter as Router, Route, Link, Redirect } from 'react-router-dom';\nimport { ErrorSuccessFeedback } from '../../utils/error-success-feedback';\nimport { Schools } from './schools';\nimport { NewSchool } from './schools/new-school';\nimport env from '../../globals/KED.env';\n\n// Views\nimport { Subjects, ShowSubject } from './subjects';\nimport { Courses, EditCourse } from './courses';\nimport { EditSchool } from \"./schools/edit-school\";\nimport { CourseBanner } from \"./courses/course-banner\";\nimport { CreateNewCourse } from \"./courses/create-new\";\nimport { Spinner } from \"./sub-components/spinner\";\n\n// Keep Session Alive\nimport { keepSessionAlive } from '../../utils/keep-session-alive';\nkeepSessionAlive();\n\ninterface Props {\n  viewCourseUrl: string;\n  feedbackUrl: string;\n}\n\ninterface State {\n}\n\nexport class CourseBuilder extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n  }\n\n  render() {\n    const isAuthorized = env.currentUser.roles.some(role => role === \"ADMIN\" || role === \"EMPLOYEE\");\n    const isAdmin = env.currentUser.roles.some(role => role === \"ADMIN\");\n    return <div className=\"course-builder\">\n      <Router>\n        {isAuthorized ? <div>\n          <Route exact path=\"/\" render={({ match }) => isAdmin ?\n            <Schools viewCourseUrl={this.props.viewCourseUrl} feedbackUrl={this.props.feedbackUrl} /> :\n            <CreateNewCourse feedbackUrl={this.props.feedbackUrl} />} />\n          <Route exact path=\"/schools\" render={({ match }) =>\n            <Schools\n              viewCourseUrl={this.props.viewCourseUrl}\n              feedbackUrl={this.props.feedbackUrl} />} />\n          <Route exact path=\"/schools/new\" render={()=><NewSchool feedbackUrl={this.props.feedbackUrl} />} />\n          <Route exact path=\"/schools/:id/edit\" render={({ match }) => <EditSchool\n            id={match.params.id}\n            title={L`Editera skola`}\n            feedbackUrl={this.props.feedbackUrl} />} />\n          <Route exact path=\"/subjects\" render={()=><Subjects feedbackUrl={this.props.feedbackUrl} />} />\n          <Route path=\"/subjects/:id\" render={({ match }) => <ShowSubject\n            id={match.params.id}\n            feedbackUrl={this.props.feedbackUrl} />} />\n          <Route exact path=\"/courses/new\" render={()=> <CreateNewCourse\n          feedbackUrl={this.props.feedbackUrl} />} />\n          <Route path=\"/courses/create-from-template/:templateId\" render={({match}) => <EditCourse\n            templateId={match.params.templateId}\n            view=\"courseBuilder\"\n            viewCourseUrl={this.props.viewCourseUrl}\n            feedbackUrl={this.props.feedbackUrl}\n          />}/>\n          <Route path=\"/courses/:id/edit\" render={({match}) => <EditCourse\n            id={match.params.id}\n            view=\"courseBuilder\"\n            viewCourseUrl={this.props.viewCourseUrl}\n            feedbackUrl={this.props.feedbackUrl}\n          />} />\n        </div> : <div>\n            <Route path=\"/\" render={() => <div>\n              <CourseBanner title=\"Kursbyggaren\" activePage=\"courseBuilder\" routes={{feedback: this.props.feedbackUrl}} />\n              <h2>Behrighet saknas</h2>\n              <p>Detta verktyg r endast till fr anstllda p Kunskapsskolan.</p>\n              <h3>Anvndarattribut</h3>\n              <table className=\"ked_boxed\" style={{border: \"1px solid #eee\"}}>\n                <thead>\n                  <tr>\n                    <th>Attribut</th>\n                    <th>Vrde</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {Object.keys(env.currentUser).map(attr => <tr key={attr}>\n                    <td>{attr}</td>\n                    <td>{env.currentUser[attr]}</td>\n                  </tr>)}\n                </tbody></table>\n            </div>} />\n          </div>}\n      </Router>\n      <ErrorSuccessFeedback />\n    </div>\n  }\n}\n","import '../../global-setters/set-bearer-providers';\nconst bearerPromise = env.bearerProvider.getBearer(); // Start getting bearer as soon as possible.\nimport '../../global-setters/set-ked-backend-client';\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport env from '../../globals/KED.env';\nimport { CourseBuilder } from '../../components/course-builder';\nimport $ from 'jquery';\nimport { showError, showInfo } from \"../../utils/utils\";\nimport { Spinner } from \"../../components/course-builder/sub-components/spinner\";\n\ninterface Props {\n  viewCourseUrl: string;\n  feedbackUrl: string;\n}\n\ninterface State {\n  isTokenLoaded: boolean;\n}\n\nexport class KEDAppCourseBuilder extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      isTokenLoaded: false\n    }\n  }\n\n  componentWillMount() {\n    bearerPromise.then(()=>{\n      this.setState({isTokenLoaded: true});\n    }).catch(err => {\n      showError(err);\n    });\n  }\n\n  render() {\n    return this.state.isTokenLoaded ?\n      <CourseBuilder\n        viewCourseUrl={this.props.viewCourseUrl}\n        feedbackUrl={this.props.feedbackUrl} /> :\n      <p><Spinner/>V.g. vnta... autenticerar...</p>\n  }\n}\n","import KED from '../../globals/KED';\nimport * as components from './app.coursebuilder.client';\nKED.components = {...KED.components, ...components};\n"],"sourceRoot":""}