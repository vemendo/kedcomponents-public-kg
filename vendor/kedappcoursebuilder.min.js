var kedappcoursebuilder=function(e){function t(t){for(var r,s,i=t[0],l=t[1],c=t[2],d=0,m=[];d<i.length;d++)s=i[d],a[s]&&m.push(a[s][0]),a[s]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);for(u&&u(t);m.length;)m.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,i=1;i<n.length;i++){var l=n[i];0!==a[l]&&(r=!1)}r&&(o.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},a={5:0},o=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="";var i=window.webpackJsonp_name_=window.webpackJsonp_name_||[],l=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var u=l;return o.push([86,0]),n()}([function(e,t){e.exports=React},,function(e,t,n){"use strict";function r(e){for(var t=0,n=e.length;t<n;++t)if(e.charCodeAt(t)<8192)return e.substr(0,t)+e[t].toLocaleUpperCase()+e.substr(t+1);return e}function a(e,t){return"object"!=typeof t?e:(Object.keys(t).forEach(function(n){e[n]=t[n]}),e)}function o(e,t){var n={};return Object.getOwnPropertyNames(e).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}),t&&a(n,t),n}n.d(t,"d",function(){return r}),n.d(t,"f",function(){return o}),n.d(t,"k",function(){return i}),n.d(t,"g",function(){return l}),n.d(t,"h",function(){return c}),n.d(t,"a",function(){return u}),n.d(t,"i",function(){return d}),n.d(t,"n",function(){return m}),n.d(t,"m",function(){return p}),n.d(t,"l",function(){return h}),n.d(t,"b",function(){return f}),n.d(t,"c",function(){return v}),n.d(t,"e",function(){return g}),n.d(t,"j",function(){return b});var s=[].concat;function i(e){return s.apply([],e)}function l(e){return function(t,n){var r=t[e],a=n[e];return r>a?1:r<a?-1:0}}function c(e,t,n){return(e=Array.isArray(e)?e:[e]).map(function(e){return function(r,a){return function(e,r){return"string"==typeof e?e.localeCompare(r,t,n):e<r?-1:e>r?1:0}(r[e],a[e])}}).reduce(function(e,t){return function(n,r){return e(n,r)||t(n,r)}})}function u(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];e[0];return function(e,t){for(var n=e[0],r=1,a=e.length;r<a;++r)n+=t[r-1]+e[r];return n}(e,t)}function d(e,t){var n;return"string"==typeof t&&(n=/\/Date\((\d*)\)\//.exec(t))?new Date(+n[1]):t}function m(e){var t=new CustomEvent("info",{detail:e});window.dispatchEvent(t)}function p(e){var t="string"==typeof e?e:e.message,n=new CustomEvent("customerror",{detail:t});console.error(e),window.dispatchEvent(n)}function h(e,t){return e.length>t?e.substr(0,t-3)+"...":e}function f(e,t){for(var n={},r=0,a=e.length;r<a;++r){var o=e[r],s=t(o),i=n[s];i?i.push(o):n[s]=[o]}return n}function v(e,t){for(var n={},r=0,a=e.length;r<a;++r){var o=e[r];n[t(o)]=o}return n}function g(e,t){for(var n={},r=0,a=t;r<a.length;r++){var o=a[r];o in e&&(n[o]=e[o])}return n}function b(e,t){var n=v(e,t);return Object.keys(n).map(function(e){return n[e]})}},function(e,t,n){"use strict";var r="undefined"==typeof KED?{}:KED;"undefined"!=typeof window&&"undefined"==typeof KED&&(window.KED=r);var a=r;a.env||(a.env={});t.a=a.env},,,function(e,t,n){"use strict";var r=n(23);n.d(t,"a",function(){return r.a}),n.d(t,"b",function(){return r.b}),n.d(t,"c",function(){return r.c}),n.d(t,"d",function(){return r.e}),n.d(t,"e",function(){return r.f}),n.d(t,"f",function(){return r.g})},,function(e,t){e.exports=jQuery},function(e,t,n){"use strict";var r=n(21);r.a.cfg||(r.a.cfg={}),t.a=r.a.cfg},function(e,t,n){"use strict";function r(e,t){var n=(t||{}).toLower,r={};return e&&e.length>1&&e.substr(1).split("&").map(function(e){return e.split("=").map(function(e){return decodeURIComponent(e.trim())})}).forEach(function(e){var t=e[0],a=e[1];return r[n?t.toLowerCase():t]=a}),r}function a(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}function o(e){return"?"+a(e)}function s(e){var t=e.indexOf("?");return t>=0?[e.substr(0,t),e.substr(t)]:[e,""]}n.d(t,"b",function(){return r}),n.d(t,"a",function(){return o}),n.d(t,"c",function(){return s})},function(e,t,n){"use strict";n.d(t,"j",function(){return m}),n.d(t,"c",function(){return p}),n.d(t,"g",function(){return h}),n.d(t,"l",function(){return f}),n.d(t,"i",function(){return v}),n.d(t,"k",function(){return g}),n.d(t,"b",function(){return b}),n.d(t,"f",function(){return E}),n.d(t,"e",function(){return y}),n.d(t,"a",function(){return w}),n.d(t,"h",function(){return C}),n.d(t,"d",function(){return N});var r=n(1),a=n(5),o=n.n(a),s=n(6),i=n(22),l=n.n(i),c=n(8),u=n.n(c),d=n(3);function m(e,t,n,a,o){for(var i={},c=t.id,u=function(l){var u=a[l],d=e[l]||[],m=t[l];if(!m)return"continue";for(var p=m.map(function(e,t){return{doc:e,idx:t}}),h=0,f=p.filter(function(e){return!d.some(function(t){return t.id===e.doc.id})});h<f.length;h++){var v=f[h],g=(C=r.a({},v.doc)).$meta;delete C.$meta,"add"===g?(C.id||(C.id=Object(s.e)()),o.add(u,C)):"update"===g&&o.put(u,C),o.link(n,c,u,C.id,l),i[l]||(i[l]={}),i[l][v.idx]={$set:C}}for(var b=0,k=d.filter(function(e){return!m.some(function(t){return t.id===e.id})});b<k.length;b++){var E=k[b];o.unlink(n,c,u,E.id,l)}for(var y=0,w=p.filter(function(e){return d.some(function(t){return t.id===e.doc.id&&"update"===e.doc.$meta})});y<w.length;y++){var C,N=w[y];delete(C=r.a({},N.doc)).$meta,o.put(u,C),i[l]||(i[l]={}),i[l][N.idx]={$set:C}}},d=0,m=Object.keys(a);d<m.length;d++){u(m[d])}return l()(t,i)}function p(e){return o()(e).format("YYMMDD HH:mm")}function h(e){return o()(e).format("YYMMDD")}function f(e,t,n){return l()(t,{dateTime:{$set:e},modifiedDate:{$set:e},modifiedBy:{$set:{name:n.displayName,url:"mailto:"+n.mail}}})}function v(e,t,n){return l()(t,{createdDate:{$set:Date.now()},createdBy:{$set:{name:n.displayName,url:"mailto:"+n.mail}}})}function g(e,t){var n=Date.now();return(e=f(n,e,t)).createdBy||(e=v(0,e,t)),e}function b(e,t,n){var a=r.a({},e),o=t[e.id];o&&(a.$etag=o);for(var s=0,i=n;s<i.length;s++){var l=i[s],c=e[l].map(function(e){return b(e,t,[])});a[l]=c}return a}function k(e,t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(t){return e(t.target.result)},r.onabort=function(e){return n(new Error("file read aborted"))},r.onerror=function(e){return n(e.target.error)},t(r)})}function E(e){return k(0,function(t){return t.readAsText(e)})}function y(e){return k(0,function(t){return t.readAsDataURL(e)})}function w(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}function C(e){var t=u()("div.course-builder")[0];t&&(t.className="course-builder"+(e?" status "+e:""))}function N(e,t){return r.b(this,void 0,void 0,function(){var n,a,o,s,i,l;return r.d(this,function(r){switch(r.label){case 0:return n=d.a.kedBackendClient,a=t&&t.includeTemplateChain,[4,Promise.all([n.get("courses",e,{include:["centralContent","knowledgeRequirements","abilities","images","acl"]}),n.list("tasks",{hasEdgesFrom:e,include:["knowledgeRequirements","centralContent","abilities","acl"],flags:["includeIdsOnly"]}),a&&n.list("courses",{hasEdgesFrom:e,flags:["idsOnly"]})])];case 1:return o=r.sent(),s=o[0],i=o[1],l=o[2],s.tasks=i,s.knowledgeRequirementsOrder&&(s.knowledgeRequirements=s.knowledgeRequirementsOrder.map(function(e){return s.knowledgeRequirements.find(function(t){return t.id===e})})),s.centralContentOrder&&(s.centralContent=s.centralContentOrder.map(function(e){return s.centralContent.find(function(t){return t.id===e})})),a&&(s.templateChain=l),[2,s]}})})}},function(e,t,n){"use strict";var r=n(1),a=n(6);function o(e){return[{type:"email",value:e.mail},{type:"school",value:e.school}].concat(e.roles.map(function(e){return{type:"role",value:e}})).concat(e.roles.map(function(t){return{type:"schoolRole",value:e.school+"/"+t}}))}var s=n(3),i=n(10);n.d(t,"a",function(){return l}),n.d(t,"c",function(){return u}),n.d(t,"d",function(){return d}),n.d(t,"b",function(){return p}),n.d(t,"e",function(){return h}),n.d(t,!1,function(){return o});var l=["user","role","school","debug","testVersion","testversion","schoolType","schooltype"];function c(e,t){var n=o(s.a.currentUser);return Object(a.f)(a.b.fromStringArray(e.acl||[]),n,t)}function u(e){return c(e,"W")}function d(e){var t=s.a.currentUser.roles.some(function(e){return"EMPLOYEE"===e||"ADMIN"===e}),n=(e||"").toLowerCase()===s.a.currentUser.school.toLowerCase();return t&&n}var m={actAs:function(e){var t=e.role,n=e.school,a=e.url,o=Object(i.b)(location.search),s=r.a({},o,{role:t,school:n}),l=Object(i.a)(s);a?location.href=""+a+l:(location.hash="#",location.search=l)}};function p(e){m.actAs(e)}function h(e,t){for(var n=Object(i.b)(location.search),a=r.a({},t),o=0,s=l;o<s.length;o++){var c=s[o];n[c]&&(a[c]=n[c])}return""+e+Object(i.a)(a)}},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(0),a=function(){return r.createElement("span",null,r.createElement("i",{className:"fa fa-spinner fa-spin","aria-hidden":"true"})," ")}},function(e,t,n){"use strict";function r(){var e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:7&n|8).toString(16)})}function a(e){var t=null;return function(){return t||(t=e.apply(this,arguments).then(function(e){return t=null,e})),t}}n.d(t,"b",function(){return r}),n.d(t,"a",function(){return a})},,,function(e,t,n){"use strict";var r=n(23),a=function(){function e(){}return e.prototype.save=function(e,t){sessionStorage.setItem("bearer-"+e,JSON.stringify(t))},e.prototype.load=function(e){try{var t=sessionStorage.getItem("bearer-"+e);return Promise.resolve(t?JSON.parse(t):{token:null,expires:0})}catch(e){return Promise.resolve({token:null,expires:0})}},e}(),o=n(14);function s(e){e.resources||(e.resources=[])}function i(e,t,n){switch(t){case"courses":!function(e,t){e.modules||(e.modules=[]),e.modules.forEach(function(e){e.resources||(e.resources=[]),e.taskIds||(e.taskIds=[])}),e.responsibleTeachers||(e.responsibleTeachers=[]),"resourses"in e&&!("resources"in e)&&(e.resources=e.resourses,delete e.resourses),e.resources||(e.resources=[]),t&&t.forEach(function(t){switch(t){case"tasks":e.tasks.forEach(function(e){return s(e)})}})}(e,n);break;case"tasks":s(e)}}var l,c=(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),u=function(e,t,n,r){return new(n||(n=Promise))(function(a,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function i(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(s,i)}l((r=r.apply(e,t||[])).next())})},d=function(e,t){var n,r,a,o,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(a=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[0,a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=(a=s.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}};!function(e){if(!e.__migrator_mixed_in){e.__migrator_mixed_in=!0;var t=e.get,n=e.list;e.get=function(e,n,r){var a=r&&r.include;return t.apply(this,arguments).then(function(t){return i(t,e,a&&a.toString().split(",")),t})},e.list=function(e,t){var r=t&&t.include;return n.apply(this,arguments).then(function(t){return t.forEach(function(t){return i(t,e,r&&r.toString().split(","))}),t})}}}(r.d.prototype);var m=new a,p=Date.now(),h=function(){function e(e,t,n){this.tokenPath=e,this.tokenResponseMapper=t,this.tokenId=n,this.tokenInfo={token:null,expires:0},this.getBearer=Object(o.a)(this.getBearer.bind(this)),this.refreshBearer=Object(o.a)(this.refreshBearer.bind(this))}return e.prototype.getBearer=function(){return u(this,void 0,void 0,function(){var e;return d(this,function(t){switch(t.label){case 0:return this.tokenInfo.token?[3,2]:this.tokenId?(e=this,[4,m.load(this.tokenId)]):[3,2];case 1:e.tokenInfo=t.sent(),t.label=2;case 2:return this.tokenInfo.expires<Date.now()?[4,this.refreshBearer()]:[3,4];case 3:t.sent(),t.label=4;case 4:return[2,this.tokenInfo]}})})},e.prototype.refreshBearer=function(){return u(this,void 0,void 0,function(){var e,t,n,r,a;return d(this,function(o){switch(o.label){case 0:return[4,fetch(this.tokenPath,{headers:{Accept:"text/plain; application/json"},redirect:"manual",cache:"no-cache",credentials:"same-origin"})];case 1:return(302===(e=o.sent()).status||!e.status&&"opaqueredirect"===e.type)&&Date.now()-p>6e4&&(this.wantsRedirect=!0,console.log("Redirect wanted. Reload page."),window.location.reload(!0)),200==e.status?[3,3]:(t=Error.bind,n="HTTP"+e.status+" ",[4,e.text()]);case 2:throw new(t.apply(Error,[void 0,n+o.sent()]));case 3:return r=this,a=this.tokenResponseMapper,[4,e.text()];case 4:return r.tokenInfo=a.apply(this,[o.sent()]),m.save(this.tokenId,this.tokenInfo),[2,this.tokenInfo]}})})},e}(),f={fetch:fetch.bind(self),btoa:btoa.bind(self)},v=function(e){function t(t,n,r){var a="string"!=typeof n?n:new h(n,r&&r.tokenResponseMapper||function(e){return{token:e,expires:Date.now()+212400}},r&&r.tokenId);return e.call(this,f,a,t)||this}return c(t,e),t}(r.d);n.d(t,"d",function(){return m}),n.d(t,"b",function(){return h}),n.d(t,"c",function(){return f}),n.d(t,"a",function(){return v})},,function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(14),a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},o=function(e,t,n,r){return new(n||(n=Promise))(function(a,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function i(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(s,i)}l((r=r.apply(e,t||[])).next())})},s=function(e,t){var n,r,a,o,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(a=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[0,a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=(a=s.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},i=function(){function e(e,t,n){this.isomorphic=e,this.baseUrl=t,this.options=n,this.fetchOptions={mode:"cors"},this.authHeader=n.bearer?"Bearer "+n.bearer:n.username?"Basic "+e.btoa(n.username+":"+(n.password||"")):null,this.bearerProvider=n.bearerProvider||null}return e.prototype.fetch=function(e,t,n,i,l){return o(this,void 0,void 0,function(){var o,c,u,d,m,p,h,f,v,g,b;return s(this,function(s){switch(s.label){case 0:return l&&"no-cache"===l.cache&&(i=a({},i,{nocache:Object(r.b)()})),o=i&&Object.keys(i).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(i[e])}).join("&"),u=(c=this).authHeader,d=c.tokenInfo,m=c.bearerProvider,u||d||!m?[3,2]:(p=this,[4,m.getBearer()]);case 1:p.tokenInfo=d=s.sent(),s.label=2;case 2:return d?d.expires<Date.now()?(console.log("Token expired. Refresh it:"),h=this,[4,m.refreshBearer()]):[3,4]:[3,5];case 3:h.tokenInfo=d=s.sent(),s.label=4;case 4:u="Bearer "+d.token,s.label=5;case 5:return u&&(n.Authorization=u),f=this.baseUrl+e+(o?"?"+o:""),[4,this.isomorphic.fetch(f,a({},this.fetchOptions,{headers:n,method:t},l))];case 6:return 401==(v=s.sent()).status&&this.bearerProvider?(g=v.headers.get("www-authenticate"),console.log("Got "+v.status+" from "+(this.baseUrl+e)),g&&/Bearer/i.test(g)?(b=this,[4,this.bearerProvider.refreshBearer()]):[3,9]):[3,9];case 7:return b.tokenInfo=s.sent(),n.Authorization="Bearer "+this.tokenInfo.token,[4,this.isomorphic.fetch(f,a({},this.fetchOptions,{headers:n,method:t},l))];case 8:v=s.sent(),s.label=9;case 9:return[2,v]}})})},e.prototype.get=function(e,t,n){return this.fetch(e,"GET",{Accept:"application/json; text/plain"},t,n)},e.prototype.post=function(e,t,n){return this.fetch(e,"POST",{"Content-Type":"application/json",Accept:"application/json"},null,a({},n,{body:JSON.stringify(t)}))},e.prototype.delete=function(e,t,n,r){return this.fetch(e,"DELETE",{Accept:"application/json; text/plain"},t,a({},r,{body:n}))},e}()},function(e,t){e.exports=ReactDOM},function(e,t,n){"use strict";var r="undefined"==typeof KED?{}:KED;"undefined"!=typeof window&&"undefined"==typeof KED&&(window.KED=r),t.a=r},,function(e,t,n){"use strict";var r=n(19),a=n(14),o=function(e,t,n,r){return new(n||(n=Promise))(function(a,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function i(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(s,i)}l((r=r.apply(e,t||[])).next())})},s=function(e,t){var n,r,a,o,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(a=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[0,a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=(a=s.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},i=function(){function e(e,t,n,o,s,i,l){this.isomorphic=e,this.storage=t,this.tokenId=n,this.clientId=o,this.clientSecret=s,this.tokenUrl=i,this.tokenQuery=l,this.tokenInfo={token:null,expires:0},this.client=new r.a(e,"",{username:this.clientId,password:this.clientSecret}),this.getBearer=Object(a.a)(this.getBearer.bind(this)),this.refreshBearer=Object(a.a)(this.refreshBearer.bind(this))}return e.prototype.getBearer=function(){return o(this,void 0,void 0,function(){var e,t,n,r;return s(this,function(a){switch(a.label){case 0:if(e=this.tokenInfo,t=e.token,n=e.expires,t&&n>=Date.now())return[2,this.tokenInfo];a.label=1;case 1:return a.trys.push([1,4,,6]),r=this,[4,this.storage.load(this.clientId+"/"+this.tokenId)];case 2:return r.tokenInfo=a.sent(),this.tokenInfo.token&&this.tokenInfo.expires>=Date.now()?[2,this.tokenInfo]:[4,this.refreshBearer()];case 3:return a.sent(),[2,this.tokenInfo];case 4:return a.sent(),[4,this.refreshBearer()];case 5:return a.sent(),[2,this.tokenInfo];case 6:return[2]}})})},e.prototype.refreshBearer=function(){return o(this,void 0,void 0,function(){var e,t,n,r;return s(this,function(a){switch(a.label){case 0:t=0,a.label=1;case 1:return t<6?(console.log("Retrieving token for "+this.tokenId),[4,this.client.get(this.tokenUrl,this.tokenQuery,{cache:"reload"})]):[3,5];case 2:return 200!==(e=a.sent()).status?(console.warn("Got "+e.status+" "+e.statusText),[3,4]):(n=this,r={},[4,e.text()]);case 3:return n.tokenInfo=(r.token=a.sent(),r.expires=Date.now()+354e4,r),console.log("Got token for "+this.tokenId+": "+JSON.stringify(this.tokenInfo)),this.storage.save(this.clientId+"/"+this.tokenId,this.tokenInfo),[2,this.tokenInfo];case 4:return++t,[3,1];case 5:throw new Error("Failed to retrieve token for "+JSON.stringify(this.tokenId))}})})},e}(),l=function(){function e(e,t,n){this.accessClaimType=e,this.accessClaimValue=t,this.right=n}return e.fromString=function(t){if(!t)return null;var n=t.split(":");if(n.length<3)throw new Error("Invalid access string: "+t);var r=e.unescape(n[0]),a=e.unescape(n[1]),o=n[2];if("R"!==o&&"W"!==o&&"S"!==o)throw new Error("Invalid access string: "+t);return new e(r,a,o)},e.escape=function(e){return e.replace(/\%/g,"%25").replace(/\:/g,"%3A")},e.unescape=function(e){return e.replace(/\%3A/g,":").replace(/\%25/g,"%")},e.prototype.toString=function(){return e.escape(this.accessClaimType)+":"+e.escape(this.accessClaimValue)+":"+this.right},e.fromStringArray=function(t){return t.map(function(t){return e.fromString(t)}).filter(function(e){return e})},e.toStringArray=function(e){return e.map(function(e){return e.toString()})},e}();function c(e,t,n){return!!t.some(function(e){return"role"===e.type&&"ADMIN"===e.value})||e.some(function(e){return t.some(function(t){return e.accessClaimType===t.type&&e.accessClaimValue===t.value&&("R"===e.right&&"R"===n||"W"===e.right&&["R","W"].indexOf(n)>=0||"S"===e.right)})})}var u,d=(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),m=function(e){function t(t,n){var r=e.call(this,"HTTP"+t+" "+n)||this;return r.code=t,r.message=n,r.name="http"+t,r}return d(t,e),t}(Error);n.d(t,"d",function(){return v}),n.d(t,"a",function(){return g}),n.d(t,"f",function(){return a.b}),n.d(t,"e",function(){return i}),n.d(t,"b",function(){return l}),n.d(t,"g",function(){return c}),n.d(t,"c",function(){return m});var p=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},h=function(e,t,n,r){return new(n||(n=Promise))(function(a,o){function s(e){try{l(r.next(e))}catch(e){o(e)}}function i(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(s,i)}l((r=r.apply(e,t||[])).next())})},f=function(e,t){var n,r,a,o,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(a=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[0,a.value]),o[0]){case 0:case 1:a=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(a=(a=s.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){s.label=o[1];break}if(6===o[0]&&s.label<a[1]){s.label=a[1],a=o;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(o);break}a[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},v=function(){function e(e,t,n){this.http=new r.a(e,n,{bearerProvider:t})}return e.prototype.getMyClaims=function(e,t){return h(this,void 0,void 0,function(){var n,r,a;return f(this,function(o){switch(o.label){case 0:return[4,this.http.get("me/claims/"+(e||""),null,t)];case 1:return 200==(n=o.sent()).status?[3,3]:(r=m.bind,a=[void 0,n.status],[4,n.text()]);case 2:throw new(r.apply(m,a.concat([o.sent()])));case 3:return[4,n.json()];case 4:return[2,o.sent()]}})})},e.prototype.get=function(e,t,n,r){return h(this,void 0,void 0,function(){var a,o,s;return f(this,function(i){switch(i.label){case 0:return[4,this.http.get(e+"/"+t,n,r)];case 1:return 200==(a=i.sent()).status?[3,3]:(o=m.bind,s=[void 0,a.status],[4,a.text()]);case 2:throw new(o.apply(m,s.concat([i.sent()])));case 3:return[4,a.json()];case 4:return[2,i.sent()]}})})},e.prototype.list=function(e,t,n){return h(this,void 0,void 0,function(){var r,a,o;return f(this,function(s){switch(s.label){case 0:return[4,this.http.get(""+e,t,n)];case 1:return 200==(r=s.sent()).status?[3,3]:(a=m.bind,o=[void 0,r.status],[4,r.text()]);case 2:throw new(a.apply(m,o.concat([s.sent()])));case 3:return[4,r.json()];case 4:return[2,s.sent()]}})})},e.prototype.batch=function(e,t){return h(this,void 0,void 0,function(){var n,r,a;return f(this,function(o){switch(o.label){case 0:return e=e.slice().sort(function(e,t){return"add"===e.op?-1:"add"===t.op?1:"delete"===e.op?1:"delete"===t.op?-1:0}),[4,this.http.post("batch",e,t)];case 1:return 200==(n=o.sent()).status?[3,3]:(r=m.bind,a=[void 0,n.status],[4,n.text()]);case 2:throw new(r.apply(m,a.concat([o.sent()])));case 3:return[4,n.json()];case 4:return[2,o.sent()]}})})},e.prototype.do=function(e){return h(this,void 0,void 0,function(){var t;return f(this,function(n){switch(n.label){case 0:return t=new g,e(t),[4,this.batch(t.mutationRequests)];case 1:return[2,n.sent()]}})})},e.prototype.deleteRealm=function(e){return h(this,void 0,void 0,function(){var t,n,r;return f(this,function(a){switch(a.label){case 0:return[4,this.http.delete("realms/"+e)];case 1:return 200==(t=a.sent()).status?[3,3]:(n=m.bind,r=[void 0,t.status],[4,t.text()]);case 2:throw new(n.apply(m,r.concat([a.sent()])));case 3:return[4,t.json()];case 4:return[2,a.sent()]}})})},e.prototype.add=function(e,t){return this.do(function(n){return n.add(e,t)})},e.prototype.put=function(e,t){return this.do(function(n){return n.put(e,t)})},e.prototype.delete=function(e,t){return this.do(function(n){return n.delete(e,t)})},e.prototype.share=function(e,t,n){return this.do(function(r){return r.share(e,t,n)})},e.prototype.unshare=function(e,t,n){return this.do(function(r){return r.unshare(e,t,n)})},e.prototype.link=function(e,t,n,r,a){return this.do(function(o){return o.link(e,t,n,r,a)})},e.prototype.link2=function(e,t,n,r){return this.do(function(a){return a.link2(e,t,r,n)})},e.prototype.unlink=function(e,t,n,r,a){return this.do(function(o){return o.unlink(e,t,n,r,a)})},e.prototype.unlink2=function(e,t,n,r){return this.do(function(a){return a.unlink2(e,t,r,n)})},e}(),g=function(){function e(){this.mutationRequests=[]}return e.prototype.add=function(e,t){return this.mutationRequests.push({op:"add",table:e,doc:t}),this},e.prototype.put=function(e,t){return delete(t=p({},t)).acl,this.mutationRequests.push({op:"put",table:e,doc:t}),this},e.prototype.delete=function(e,t){return this.mutationRequests.push({op:"delete",table:e,id:t}),this},e.prototype.share=function(e,t,n){return this.mutationRequests.push({op:"share",table:e,id:t,acl:n}),this},e.prototype.unshare=function(e,t,n){return this.mutationRequests.push({op:"unshare",table:e,id:t,acl:n}),this},e.prototype.link=function(e,t,n,r,a){return this.mutationRequests.push({op:"link",sourceTable:e,sourceId:t,targetTable:n,targetId:r,label:a}),this},e.prototype.link2=function(e,t,n,r){this.mutationRequests.push({op:"link",sourceTable:e,sourceId:t,targetId:r,label:n})},e.prototype.unlink=function(e,t,n,r,a){return this.mutationRequests.push({op:"unlink",sourceTable:e,sourceId:t,targetTable:n,targetId:r,label:a}),this},e.prototype.unlink2=function(e,t,n,r){return this.mutationRequests.push({op:"unlink",sourceTable:e,sourceId:t,targetId:r,label:n}),this},e}()},,function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(1),a=n(0),o=function(e){function t(t){var n=e.call(this,t)||this;return n.state={headerOpen:t.headerOpen||!1},n}return r.c(t,e),t.prototype.componentWillReceiveProps=function(e){e.headerOpen!==this.props.headerOpen&&this.setState({headerOpen:e.headerOpen})},t.prototype.render=function(){var e=this,t=this.props,n=t.title,r=t.className,o=t.children,s=t.headerClassName,i=t.contentClassName,l=this.state.headerOpen;return a.createElement("div",{className:(r||"")+" openClose"+(l?" open":"")},a.createElement("div",{className:"openHeader"+(s?" "+s:""),onClick:function(){e.props.onOpenClose&&e.props.onOpenClose(!e.state.headerOpen),e.setState({headerOpen:!e.state.headerOpen})}},n),a.createElement("div",{className:"openContent"+(i?" "+i:"")},o))},t}(a.Component)},,function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(1),a=n(0),o=n(8),s=n.n(o),i=function(e){function t(t){var n=e.call(this,t)||this;return n.state={editMode:!1,runtimeStyle:null,text:t.text||""},n}return r.c(t,e),t.prototype.componentWillReceiveProps=function(e){this.props.text!==e.text&&this.setState({text:e.text||""})},t.prototype.render=function(){var e=this,t=this.state.text||"";return a.createElement("div",{className:"renameable-text"+(t?"":" unnamed")+(this.props.readOnly?" disabled":""),tabIndex:!this.state.editMode&&0,onFocus:function(t){e.rename()},style:{width:"100%"}},a.createElement("div",{ref:function(t){return e.label=t},style:{display:this.state.editMode?"none":""}},t||this.props.clickAdvertiseText),"textarea"===this.props.tag?a.createElement("textarea",{ref:function(t){return e.input=t},maxLength:this.props.maxChars,style:r.a({},this.state.runtimeStyle,{display:this.state.editMode?"":"none"}),onFocus:function(e){return s()(e.target).select()},onBlur:this.onBlur.bind(this),value:t,onKeyDown:this.onKeyDown.bind(this),onChange:this.onChange.bind(this),tabIndex:this.state.editMode&&0,placeholder:this.props.placeholder}):a.createElement("input",{ref:function(t){return e.input=t},type:"text",maxLength:this.props.maxChars,style:r.a({},this.state.runtimeStyle,{display:this.state.editMode?"":"none"}),onFocus:function(e){return s()(e.target).select()},onBlur:this.onBlur.bind(this),value:t,onKeyDown:this.onKeyDown.bind(this),onChange:this.onChange.bind(this),tabIndex:this.state.editMode?0:void 0,placeholder:this.props.placeholder}))},t.prototype.onKeyDown=function(e){27===e.keyCode?(this.input.value=this.props.text||"",this.input.blur(),e.stopPropagation()):13===e.keyCode&&(this.propagateOnChange(this.input.value),this.setState({editMode:!1,text:this.input.value}))},t.prototype.onBlur=function(e){this.propagateOnChange(this.input.value),this.setState({editMode:!1,text:this.input.value})},t.prototype.propagateOnChange=function(e){this.propagatedOnChange!=e&&(this.propagatedOnChange=e,this.props.onChange(e))},t.prototype.onChange=function(e){this.setState({text:this.input.value}),this.props.eager&&this.propagateOnChange(this.input.value)},t.prototype.rename=function(e){var t=this;if(!this.state.editMode&&!this.props.readOnly){e=e||this.state.text||"";var n=s()(this.label);this.setState({text:e,editMode:!0,runtimeStyle:{textAlign:n.css("textAlign"),fontSize:n.css("font-size"),paddingTop:n.css("paddingTop"),paddingBottom:n.css("paddingBottom"),paddingLeft:n.css("paddingLeft"),paddingRight:n.css("paddingRight"),marginTop:n.css("marginTop"),marginBottom:n.css("marginBottom"),marginLeft:n.css("marginLeft"),marginRight:n.css("marginRight"),borderRadius:n.css("borderRadius"),backgroundColor:n.css("backgroundColor"),lineHeight:n.css("lineHeight"),fontWeight:n.css("fontWeight"),outLine:0,borderStyle:"none",height:"100%",width:"100%",boxSizing:"border-box"}},function(){return s()(t.input).focus()})}},t}(a.Component)},,,,function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r,a=n(1),o=n(0),s=n(2),i=function(e){var t=e.onClick,n=e.className,i=e.style,l=e.title;return o.createElement("div",{title:l||Object(s.a)(r||(r=a.e(["Radera"],["Radera"]))),className:"removeItem "+(n||""),onClick:t,style:i})}},,,,,function(e,t,n){"use strict";var r=n(10),a=n(3),o=function(){return function(){var e=a.a.currentUser,t=Object(r.b)(location.search,{toLower:!0});(t.features||"").split(",").map(function(e){return e.toLowerCase()}),this.EditUserTasksViaPenOnly="Grundskolor"!==e.schoolType&&"Grundskolor"!==t.schooltype,this.SubTasks="Grundskolor"!==e.schoolType&&"Grundskolor"!==t.schooltype,this.AssignmentTasks=!!t.testversion}}();n.d(t,"a",function(){return o})},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(1),a=function(){function e(e){this.comm=e,this.listPromise=null,this.items=null,this.subscribers=[]}return e.prototype.subscribe=function(e){var t=this;return this.ensureHasData().then(function(){e(t.items),t.subscribers.push(e)})},e.prototype.unsubscribe=function(e){this.subscribers=this.subscribers.filter(function(t){return t!==e})},e.prototype.notifySubscribers=function(){var e=this;this.subscribers.forEach(function(t){return t(e.items)})},e.prototype.ensureHasData=function(){return this.listPromise||this.refreshFromServer(),this.listPromise},e.prototype.refreshFromServer=function(){var e=this;return this.listPromise=this.comm.query().then(function(t){e.items=t,e.notifySubscribers()}),this.listPromise},e.prototype.update=function(e){return r.b(this,void 0,void 0,function(){var t;return r.d(this,function(n){switch(n.label){case 0:return[4,this.ensureHasData()];case 1:return n.sent(),t=Array.isArray(e)?e:[e],this.items=this.items.map(function(e){var n=t.find(function(t){var n=t.id;return e.id===n});return n?Object.assign({},n):e}),this.notifySubscribers(),[2]}})})},e.prototype.insert=function(e){var t=this;return this.ensureHasData().then(function(){t.items=t.items.concat(e),t.notifySubscribers()})},e.prototype.delete=function(e){var t=this,n=Array.isArray(e)?e:[e];return this.ensureHasData().then(function(){t.items=t.items.filter(function(e){return!n.some(function(t){return e.id===t})}),t.notifySubscribers()})},e}()},,,,,,,,,,,,function(e,t,n){"use strict";var r=n(3),a=n(9),o=n(17);r.a.kedBackendClient=new o.a(a.a.KED_API_URL,r.a.bearerProvider)},function(e,t,n){"use strict";var r=n(1),a=n(10),o=n(17),s=n(6),i=n(9),l=n(3),c=n(12),u=n(2);function d(e,t,n){var o=Object(a.b)(t),s=Object(u.e)(o,c.a),i=Object(a.c)(e),l=i[0],d=i[1],m=Object(a.b)(d);return l+Object(a.a)(r.a({},m,s,{scopes:n.join(",")}))}function m(e,t){return e+"/"+t}function p(e,t,n){return new s.d(o.c,o.d,e+t.mail+location.search,i.a.KED_CLIENT_ID,i.a.KED_CLIENT_SECRET,e,{email:t.mail.toLowerCase(),roles:t.roles,school:t.school,schoolType:t.schoolType,scopes:n})}var h,f,v=l.a.currentUser&&l.a.currentUser.mail;if(v)if(i.a.KED_TOKEN_PATH){var g=d(i.a.KED_TOKEN_PATH,location.search,["kedbackend","EDS"]);l.a.bearerProvider=function(e,t){var n=m(e,t);return new o.b(e,function(e){var t=JSON.parse(e);if(!t.ok)throw new Error(t.error);return t.user&&function(e,t){l.a.currentUser=e,sessionStorage.setItem("userInfo"+t,JSON.stringify(e))}(t.user,n),{token:t.token,expires:Date.now()+354e4}},n)}(g,v),h=m(g,v),(f=sessionStorage.getItem("userInfo"+h))&&(l.a.currentUser=JSON.parse(f));var b=d(i.a.KED_TOKEN_PATH,location.search,["https://www.googleapis.com/auth/calendar.readonly"]);l.a.googleTokenProvider=function(e,t){var n=m(e,t);return new o.b(e,function(e){var t=JSON.parse(e);if(!t.ok)throw new Error(t.error);return{token:t.token,expires:Date.now()+354e4}},n)}(b,v)}else{if(!(i.a.KED_TOKEN_URL&&i.a.KED_CLIENT_ID&&i.a.KED_CLIENT_SECRET))throw new Error("Missing configuration parameter KED_TOKEN_PATH");l.a.bearerProvider=p(i.a.KED_TOKEN_URL,l.a.currentUser,["kedbackend","EDS"]),l.a.googleTokenProvider=p(i.a.KED_TOKEN_URL+"/google",l.a.currentUser,["https://www.googleapis.com/auth/calendar.readonly"])}},,function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r,a,o=n(1),s=n(0),i=n(2),l=function(e){function t(t){var n=e.call(this,t)||this;return n.state={error:void 0,info:void 0},n._unhandledRejection=n._unhandledRejection.bind(n),n._error=n._error.bind(n),n._customError=n._customError.bind(n),n._onInfo=n._onInfo.bind(n),n}return o.c(t,e),t.prototype.componentDidMount=function(){window.addEventListener("unhandledrejection",this._unhandledRejection),window.addEventListener("error",this._error),window.addEventListener("customerror",this._customError),window.addEventListener("info",this._onInfo)},t.prototype.componentWillUnmount=function(){window.removeEventListener("unhandledrejection",this._unhandledRejection),window.removeEventListener("error",this._error),window.removeEventListener("customerror",this._customError),window.removeEventListener("info",this._onInfo)},t.prototype._unhandledRejection=function(e){var t=this;this.setState({error:e.reason?e.reason.message:Object(i.a)(r||(r=o.e(["Ett okänt fel inträffade..."],["Ett okänt fel inträffade..."]))),info:null}),setTimeout(function(){return t.setState({error:null})},1e4)},t.prototype._error=function(e){var t=this;this.setState({error:e.error?e.error.message:Object(i.a)(a||(a=o.e(["Ett okänt fel inträffade..."],["Ett okänt fel inträffade..."]))),info:null}),setTimeout(function(){return t.setState({error:null})},1e4)},t.prototype._customError=function(e){var t=this;this.setState({error:e.detail,info:null}),setTimeout(function(){return t.setState({error:null})},1e4)},t.prototype._onInfo=function(e){var t=this;this.setState({error:null,info:e.detail}),setTimeout(function(){return t.setState({info:null})},1e4)},t.prototype.render=function(){return s.createElement("div",{className:"error-success-feedback",style:{position:"fixed",left:0,top:0,width:"100%",pointerEvents:"none"}},s.createElement("div",{style:{display:"table",margin:"0 auto"}},s.createElement("p",{className:"error",style:{display:this.state.error?"":"none"}},this.state.error&&this.state.error),s.createElement("p",{className:"info",style:{display:this.state.info?"":"none"}},this.state.info)))},t}(s.Component)},,,,,,function(e,t,n){var r={"./en-au":47,"./en-au.js":47,"./en-ca":46,"./en-ca.js":46,"./en-gb":45,"./en-gb.js":45,"./en-ie":44,"./en-ie.js":44,"./en-nz":43,"./en-nz.js":43,"./sv":42,"./sv.js":42};function a(e){var t=o(e);return n(t)}function o(e){var t=r[e];if(!(t+1)){var n=new Error('Cannot find module "'+e+'".');throw n.code="MODULE_NOT_FOUND",n}return t}a.keys=function(){return Object.keys(r)},a.resolve=o,e.exports=a,a.id=58},,,,,,,,,,,function(e,t,n){"use strict";var r=n(1),a=n(0),o=n(2),s=n(16),i=n(52),l=n(11),c=n(6),u=n(3),d=[{name:"schools",text:Object(o.a)(h||(h=r.e(["Skolor"],["Skolor"]))),route:"/schools"},{name:"subjects",text:Object(o.a)(f||(f=r.e(["Ämnen"],["Ämnen"]))),route:"/subjects"}],m=[{name:"courseBuilder",text:Object(o.a)(v||(v=r.e(["Kursbyggaren"],["Kursbyggaren"]))),route:"/courses/new"},{name:"studentPage",text:Object(o.a)(g||(g=r.e(["Elevsida"],["Elevsida"]))),route:""},{name:"feedback",text:a.createElement("span",null,a.createElement("i",{className:"fa fa-commenting-o","aria-hidden":"true"})," Feedback"),route:"https://kg.kunskapsporten.se/kursbyggaren/"}];function p(e,t,n,r){var a=Object(c.e)();n.update({imageId:{$set:a},images:{$set:[{id:a,url:r,acl:["role:USER:R","schoolRole:"+u.a.currentUser.school+"/EMPLOYEE:S"],$meta:"add"}]}})}var h,f,v,g,b,k,E,y,w,C,N,O,S,I,x,j=function(e){var t=e.title,n=(e.isTemplate,e.host),i=e.course,c=(e.origCourse,e.backgroundImage),h=e.activePage,f=u.a.currentUser.roles.some(function(e){return"ADMIN"===e}),v=m;return f&&(v=d.concat(v)),a.createElement("div",{className:"sv-row sv-layout sv-skip-spacer"},a.createElement("div",{className:"sv-layout sv-skip-spacer sv-column-12"},a.createElement("div",{className:"sv-script-portlet sv-portlet sv-skip-spacer"},c&&a.createElement("style",null,"\n        .pageHeader {\n          background-image: url('"+c+"') !important;\n        }\n      "),a.createElement("div",{className:"pageHeader",onDragOver:i&&l.a,onDrop:i&&function(e){return function(e,t,n,a){return r.b(this,void 0,void 0,function(){var n,a,s,i,c,u;return r.d(this,function(d){switch(d.label){case 0:return e.stopPropagation(),e.preventDefault(),n=e.dataTransfer.files,a=null,s=Array.from(e.dataTransfer.items),n.length>0?(i=n[0]).size>2097152?(Object(o.m)(Object(o.a)(b||(b=r.e(["Kan inte ladda upp bilder större än 2 MB"],["Kan inte ladda upp bilder större än 2 MB"])))),[2]):[4,Object(l.e)(i)]:[3,2];case 1:return a=d.sent(),[3,6];case 2:c=function(e){var t;return r.d(this,function(n){switch(n.label){case 0:return(t=s[e]).type.match("^text/uri-list")?[4,new Promise(function(e){return t.getAsString(e)})]:[3,2];case 1:a=n.sent(),n.label=2;case 2:return[2]}})},u=0,d.label=3;case 3:return u<s.length?[5,c(u)]:[3,6];case 4:d.sent(),d.label=5;case 5:return++u,[3,3];case 6:return null==a?(Object(o.m)(Object(o.a)(k||(k=r.e(["Kunde inte hitta någon bild i innehållet"],["Kunde inte hitta någon bild i innehållet"])))),[2]):(p(0,0,t,a),[2])}})})}(e,n)}},a.createElement("a",null,a.createElement("h1",null,t)),a.createElement("div",{className:"buttonsField"},a.createElement("div",{className:"buttonsContainer"},a.createElement("div",{className:"align-horizontal"}),a.createElement("div",{className:"horizontalMenu"},a.createElement("ul",null,v.map(function(t){return{item:t,isActive:h===t.name,callback:e.callbacks&&e.callbacks[t.name],givenRoute:e.routes&&e.routes[t.name],defaultRoute:t.route}}).filter(function(e){return e.callback||e.defaultRoute||e.givenRoute}).map(function(e){var t=e.item,n=e.isActive,r=e.callback,o=e.defaultRoute,i=e.givenRoute;return a.createElement("li",{key:t.name,className:n?"activePage":"",onClick:r},r?a.createElement("a",null,t.text):o||i?i||/^http[s]\:\/\//i.test(o)?a.createElement("a",{href:i||o},t.text):a.createElement(s.b,{to:o},t.text):a.createElement("a",null,t.text))})))))))))},D=n(12),R=n(13),T=function(e){var t=e.schools,n=e.viewCourseUrl,r=u.a.currentUser.roles.some(function(e){return"ADMIN"===e});return a.createElement("div",{className:"editable-school-list"},a.createElement("div",null,t?a.createElement("table",null,a.createElement("tbody",null,t.map(function(e){return a.createElement("tr",{className:"align-horizontal",key:e.id},a.createElement("td",null,a.createElement(s.b,{className:"editItem",to:"/schools/"+e.id+"/edit"})),a.createElement("td",null,a.createElement("p",null,e.name)),a.createElement("td",null,a.createElement("p",null,a.createElement("a",{style:{cursor:"pointer"},onClick:function(){return Object(D.b)({role:"EMPLOYEE",school:e.name})}},"Agera som lärare på denna skola"))),a.createElement("td",null,a.createElement("p",null,a.createElement("a",{style:{cursor:"pointer"},onClick:function(){return Object(D.b)({role:"STUDENT",school:e.name,url:n})}},"Agera som elev på denna skola"))))}))):a.createElement("p",null,a.createElement(R.a,null),"V.g. vänta medan skolor laddas")),a.createElement("br",null),t&&r&&a.createElement(s.b,{to:"/schools/new",className:"btn"},"Lägg till skola"))},U=function(e){function t(t){var n=e.call(this,t)||this;return n.state={schools:null},n}return r.c(t,e),t.prototype.componentDidMount=function(){this.load().catch(function(e){return Object(o.m)(e.message||e)})},t.prototype.load=function(){return r.b(this,void 0,void 0,function(){var e;return r.d(this,function(t){switch(t.label){case 0:return[4,u.a.kedBackendClient.list("schools")];case 1:return e=t.sent(),this.setState({schools:e}),[2]}})})},t.prototype.render=function(){var e=this.state.schools;return e&&e.sort(Object(o.g)("name")),a.createElement("div",{style:{outline:0}},a.createElement(j,{title:"Skolor",activePage:"schools",routes:{feedback:this.props.feedbackUrl}}),a.createElement("div",{className:"sv-row sv-layout"},a.createElement("div",{className:"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer"},a.createElement(T,{schools:e,viewCourseUrl:this.props.viewCourseUrl}))))},t}(a.Component),M=function(e){function t(t){var n=e.call(this,t)||this;return n.state=null,n}return r.c(t,e),t.prototype.componentDidMount=function(){this.load().catch(function(e){return Object(o.m)(e)})},t.prototype.load=function(){return r.b(this,void 0,void 0,function(){var e,t;return r.d(this,function(n){switch(n.label){case 0:return this.props.id?(e=this.props.id,[4,u.a.kedBackendClient.get("schools",e)]):[3,2];case 1:return t=n.sent(),this.origSchool=r.a({},t),this.setState(r.a({},t)),[3,3];case 2:this.setState({id:Object(c.e)()}),n.label=3;case 3:return[2]}})})},t.prototype.save=function(){return r.b(this,void 0,void 0,function(){var e,t;return r.d(this,function(n){switch(n.label){case 0:return e=new c.a,t=r.a({},this.state),this.origSchool?[3,1]:(t.acl=["role:USER:R"],t.acl.push(new c.b("schoolRole",t.name+"/EMPLOYEE","W").toString()),e.add("schools",t),[3,5]);case 1:return this.origSchool.name===this.state.name?[3,4]:(e.unshare("schools",t.id,[new c.b("schoolRole",this.origSchool.name+"/EMPLOYEE","W")].map(function(e){return e.toString()})),this.origSchool.name.toLowerCase()!==this.state.name.toLowerCase()?[3,3]:[4,u.a.kedBackendClient.batch(e.mutationRequests)]);case 2:n.sent(),e.mutationRequests=[],n.label=3;case 3:return e.share("schools",this.state.id,[new c.b("schoolRole",this.state.name+"/EMPLOYEE","W")].map(function(e){return e.toString()})),e.put("schools",t),[3,5];case 4:e.put("schools",t),n.label=5;case 5:return[4,u.a.kedBackendClient.batch(e.mutationRequests)];case 6:return n.sent(),location.hash="#/schools",[2]}})})},t.prototype.deleteSchool=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){switch(e.label){case 0:return confirm(Object(o.a)(E||(E=r.e(['Är du säker på att ta bort skolan "','"'],['Är du säker på att ta bort skolan "','"'])),this.state.name))?[4,u.a.kedBackendClient.delete("schools",this.state.id)]:[3,2];case 1:e.sent(),location.hash="#/schools",e.label=2;case 2:return[2]}})})},t.prototype.render=function(){var e=this,t=this.props,n=t.title,i=!!t.id,l=this.state,c=this.origSchool,d=u.a.currentUser.roles.some(function(e){return"ADMIN"===e});return a.createElement("div",{style:{outline:0}},a.createElement(j,{title:"Skolor",activePage:"schools",callbacks:{schools:function(){return location.hash="#/schools"}},routes:{feedback:this.props.feedbackUrl}}),a.createElement("div",{className:"sv-row sv-layout"},a.createElement("div",{className:"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer"},a.createElement("h2",null,n),a.createElement("hr",null),a.createElement("div",{className:"align-horizontal"},a.createElement("div",{className:"horizontalItem top"},"Namn:"),a.createElement("div",{className:"horizontalItem top"},a.createElement("input",{type:"text",autoFocus:!0,disabled:!d,tabIndex:1,size:50,value:l?l.name:"",onChange:function(t){return e.setState({name:t.target.value})}})),a.createElement("div",{className:"horizontalItem top spaced"})),d&&i&&a.createElement("div",{tabIndex:2,className:"btn btn-warning btn-large pull-right",onClick:function(){return e.deleteSchool().catch(o.m)}},"Ta bort skola"),a.createElement("div",{className:"pull-right"}," "),a.createElement(s.b,{className:"btn btn-warning btn-large pull-right",to:"/schools"},"Avbryt"),d&&a.createElement("a",{tabIndex:1,className:"btn btn-large",onClick:function(){c&&c.name!==l.name&&!confirm(Object(o.a)(y||(y=r.e(["Är du säker på att du vill döpa om skolan? Detta påverkar portalens funktion för lärare och elever som tillhör skolan. Namnet måste stämma exakt överens med namngivningen av skolan på användarobjekten.\n\nDet som händer annars är att elever och lärare på skolan inte längre hittar några kurser.\n\nBlir det fel kan du dock alltid bara döpa tillbaka skolans namn."],["Är du säker på att du vill döpa om skolan? Detta påverkar portalens funktion för lärare och elever som tillhör skolan. Namnet måste stämma exakt överens med namngivningen av skolan på användarobjekten.\n\nDet som händer annars är att elever och lärare på skolan inte längre hittar några kurser.\n\nBlir det fel kan du dock alltid bara döpa tillbaka skolans namn."]))))||e.save().catch(o.m)}},"Spara"))))},t}(a.Component),L=function(e){return a.createElement(M,{title:"Lägg till skola",feedbackUrl:e.feedbackUrl})},B=n(8),P=n.n(B),A=function(e){function t(t){var n=e.call(this,t)||this;return n.coursesElems={},n.centralContentElems=[],n.knowledgeRequirementElems=[],n.state={showFullText:!1,changes:[],isWorking:!0,isImporting:!1},n}return r.c(t,e),t.prototype.componentDidMount=function(){return r.b(this,void 0,void 0,function(){var e;return r.d(this,function(t){switch(t.label){case 0:this.addClassesForCherryPickedElements(),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,this.diffWithExisting()];case 2:return e=t.sent(),this.setState({changes:e}),[3,4];case 3:return this.setState({isWorking:!1}),[7];case 4:return[2]}})})},t.prototype.addClassesForCherryPickedElements=function(){var e=P()(this.purposeElem).find("li").first().parent().children("li");e.addClass("ability");var t=P()(this.centralContentElems).find("li");t.addClass("central-content");var n=P()(this.knowledgeRequirementElems).find("p");n.addClass("knowledge-requirement"),P()([e,t,n]).addClass("marked-area")},t.prototype.cherryPickData=function(){var e=this,t=this.props,n=Array.from(P()(this.purposeElem).find("li").first().parent().children("li"));return{name:t.name,code:t.code,abilities:n.map(function(e,t){return t+1+". "+P()(e).html()}),courses:Object.keys(this.coursesElems).map(function(t){return e.coursesElems[t]}).map(function(e){var t=e.course,n=e.elem;return{name:t.name,code:t.code,points:t.points,centralContent:Array.from(P()(n).find(".central-content")).map(function(e){return P()(e).html()}),knowledgeRequirements:Array.from(P()(n).find(".grade-step-E .knowledge-requirement")).map(function(e){return P()(e).html()}).map(function(e){return{gradeStep:"E",html:e}}).concat(Array.from(P()(n).find(".grade-step-C .knowledge-requirement")).map(function(e){return P()(e).html()}).map(function(e){return{gradeStep:"C",html:e}})).concat(Array.from(P()(n).find(".grade-step-A .knowledge-requirement")).map(function(e){return P()(e).html()}).map(function(e){return{gradeStep:"A",html:e}}))}})}},t.prototype.diffWithExisting=function(){return r.b(this,void 0,void 0,function(){var e,t,n,a,o,s,i,l,d,m,p,h,f,v,g,b,k,E,y,w,C,N,O=this;function S(){var e=i;return i+=2,e}return r.d(this,function(I){switch(I.label){case 0:return e=this.cherryPickData(),t=[],[4,u.a.kedBackendClient.list("subjects")];case 1:return n=I.sent(),a=n.filter(function(e){return e.code===O.props.code})[0],o=[],s=[],i=Date.now(),a?[4,u.a.kedBackendClient.get("subjects",a.id,{include:"courseTemplates"})]:[3,8];case 2:return a=I.sent(),[4,Promise.all(a.courseTemplates.map(function(e){return u.a.kedBackendClient.get("courses",e.id,{include:["centralContent","knowledgeRequirements"]})}))];case 3:l=I.sent(),d=function(n){var a,o,s,i,l,c,d,m;return r.d(this,function(p){switch(p.label){case 0:if(a=e.courses.find(function(e){return e.name===n.name}),(o=a.centralContent.map(function(e){return n.centralContent.filter(function(t){return t.name===e}).map(function(e){return e.id})[0]})).some(function(e){return!e}))throw new Error("Could not lookup all central contents!");if((s=a.knowledgeRequirements.map(function(e){return n.knowledgeRequirements.filter(function(t){return t.name===e.html&&t.gradeStep===e.gradeStep}).map(function(e){return e.id})[0]})).some(function(e){return!e}))throw new Error("Could not lookup all knowledge requirements!");return[4,u.a.kedBackendClient.list("courses",{name:n.name})];case 1:for(i=(i=p.sent()).filter(function(t){return t.subjectCode===e.code}),l=function(e){e.centralContentOrder&&e.knowledgeRequirementsOrder&&e.centralContentOrder.join(",")===o.join(",")&&e.knowledgeRequirementsOrder.join(",")===s.join(",")||(e.centralContentOrder=o,e.knowledgeRequirementsOrder=s,t.push({change:"Uppdatera ordningen för centralt innehåll och kunskapskrav",content:e.name+" på "+e.school+" ("+e.description+")",mutations:function(t){t.put("courses",r.a({},e))}}))},c=0,d=i;c<d.length;c++)m=d[c],l(m);return[2]}})},m=0,p=l,I.label=4;case 4:return m<p.length?(h=p[m],[5,d(h)]):[3,7];case 5:I.sent(),I.label=6;case 6:return m++,[3,4];case 7:return[3,9];case 8:for(f=a={id:Object(c.e)(),acl:["role:USER:R"],code:e.code,name:e.name,publishable:!1,dateTime:S()},t.push({change:"Nytt ämne",content:e.name+" ("+e.code+")",mutations:function(e){return e.add("subjects",f)}}),v=[],g=function(e){var n={id:Object(c.e)(),name:e,acl:["role:USER:R"],dateTime:S()};v.push(n),t.push({change:"Ny förmåga",content:e,mutations:function(e){e.add("abilities",n),e.link("subjects",f.id,"abilities",n.id,"abilities")}})},b=0,k=e.abilities;b<k.length;b++)E=k[b],g(E);for(y=function(e){var n={id:Object(c.e)(),subjectCode:f.code,tags:["sub:"+f.code],dateTime:S(),isTemplate:!0,acl:["role:EMPLOYEE:R"],name:e.name,code:e.code,points:e.points,modules:[],subjectId:f.id,resources:[],createdBy:{name:u.a.currentUser.displayName,url:"mailto:"+u.a.currentUser.mail},createdDate:Date.now(),knowledgeRequirementsOrder:[],centralContentOrder:[]};t.push({change:"Ny kurs",content:e.name,mutations:function(e){e.add("courses",n),e.link("subjects",f.id,"courses",n.id,"courseTemplates")}});for(var r=function(e){var r=o.filter(function(t){return t.name===e})[0];r?t.push({mutations:function(e){e.link("courses",n.id,"central-content",r.id,"centralContent")}}):(r={id:Object(c.e)(),dateTime:S(),name:e,acl:["role:USER:R"]},o.push(r),t.push({change:"Nytt centralt innehåll",content:e,mutations:function(e){e.add("central-content",r),e.link("courses",n.id,"central-content",r.id,"centralContent")}})),n.centralContentOrder.push(r.id)},a=0,i=e.centralContent;a<i.length;a++){r(i[a])}for(var l=function(e){var r=s.filter(function(t){return t.name===e.html&&t.gradeStep===e.gradeStep})[0];r?t.push({mutations:function(e){e.link("courses",n.id,"knowledge-requirements",r.id,"knowledgeRequirements")}}):(r={id:Object(c.e)(),dateTime:S(),name:e.html,gradeStep:e.gradeStep,acl:["role:USER:R"]},s.push(r),t.push({change:"Nytt kunskapskrav för betyget "+e.gradeStep,content:e.html,mutations:function(e){e.add("knowledge-requirements",r),e.link("courses",n.id,"knowledge-requirements",r.id,"knowledgeRequirements")}})),n.knowledgeRequirementsOrder.push(r.id)},d=0,m=e.knowledgeRequirements;d<m.length;d++){l(m[d])}for(var p=function(e){t.push({mutations:function(t){t.link("courses",n.id,"abilities",e.id,"abilities")}})},h=0,g=v;h<g.length;h++){p(g[h])}},w=0,C=e.courses;w<C.length;w++)N=C[w],y(N);I.label=9;case 9:return[2,t]}})})},t.prototype.cancel=function(){this.props.onCancel()},t.prototype.import=function(){return r.b(this,void 0,void 0,function(){var e;return r.d(this,function(t){switch(t.label){case 0:this.setState({isWorking:!0,isImporting:!0}),e=this.state.changes.map(function(e){return e.mutations}),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,u.a.kedBackendClient.do(function(t){e.forEach(function(e){return e(t)})})];case 2:return t.sent(),[3,4];case 3:return this.setState({isWorking:!1,isImporting:!1}),[7];case 4:return this.props.onImportSuccess(this.props.name),[2]}})})},t.prototype.fixL=function(e){return e},t.prototype.render=function(){var e=this;return a.createElement("div",null,a.createElement("h1",null,Object(o.a)(w||(w=r.e(["Uppladdat Ämne"],["Uppladdat Ämne"])))),this.state.isWorking?a.createElement("p",null,"Arbetar..."):this.state.isImporting?a.createElement("p",null,"Importerar..."):0===this.state.changes.length?a.createElement("div",null,a.createElement("p",null,"Ämnet redan importerat."),a.createElement("button",{onClick:function(){return e.cancel()}}," OK ")):a.createElement("div",null,a.createElement("table",null,a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",{colSpan:2},"Granskning av ändringar i grund-data")),a.createElement("tr",null,a.createElement("th",null,"Ändring"),a.createElement("th",null,"Innehåll"))),a.createElement("tbody",null,this.state.changes.filter(function(e){return e.change}).map(function(e){return a.createElement("tr",{key:e.change+e.content},a.createElement("td",null,e.change),a.createElement("td",{dangerouslySetInnerHTML:{__html:e.content}}))}))),a.createElement("button",{onClick:function(){return e.cancel()},disabled:this.state.isImporting},"Avbryt"),a.createElement("button",{onClick:function(){return e.import()},disabled:this.state.isImporting},"Importera"),a.createElement("br",null)),a.createElement("button",{onClick:function(){return e.setState({showFullText:!e.state.showFullText})}},this.state.showFullText?Object(o.a)(C||(C=r.e(["Dölj nedan"],["Dölj nedan"]))):Object(o.a)(N||(N=r.e(["Visa hela texten från Skolverket"],["Visa hela texten från Skolverket"])))),a.createElement("table",{style:{display:this.state.showFullText?"":"none"}},a.createElement("tbody",null,a.createElement("tr",null,a.createElement("th",null,"Namn"),a.createElement("td",null,this.props.name)),a.createElement("tr",null,a.createElement("th",null,"Ämneskod"),a.createElement("td",null,this.props.code)),a.createElement("tr",null,a.createElement("th",null,"Syfte"),a.createElement("td",{ref:function(t){return e.purposeElem=t},dangerouslySetInnerHTML:{__html:this.fixL(this.props.purpose)}})),a.createElement("tr",null,a.createElement("th",null,"Kurser"),a.createElement("td",null,this.props.courses.map(function(t){return a.createElement("table",{key:t.code,ref:function(n){return e.coursesElems[t.code]={course:t,elem:n}}},a.createElement("tbody",null,a.createElement("tr",null,a.createElement("th",null,"Kursens namn"),a.createElement("td",null,t.name)),a.createElement("tr",null,a.createElement("th",null,"Kurskod"),a.createElement("td",null,t.code)),a.createElement("tr",null,a.createElement("th",null,"Poäng"),a.createElement("td",null,t.points)),a.createElement("tr",null,a.createElement("th",null,"Centralt innehåll"),a.createElement("td",{ref:function(t){return e.centralContentElems.push(t)},dangerouslySetInnerHTML:{__html:e.fixL(t.centralContent)}})),a.createElement("tr",null,a.createElement("th",null,"Kunskapskrav Betyg E"),a.createElement("td",{className:"grade-step-E",ref:function(t){return e.knowledgeRequirementElems.push(t)},dangerouslySetInnerHTML:{__html:e.fixL(t.knownledgeRequirements.filter(function(e){return"E"===e.gradeStep})[0].text)}})),a.createElement("tr",null,a.createElement("th",null,"Kunskapskrav Betyg C"),a.createElement("td",{className:"grade-step-C",ref:function(t){return e.knowledgeRequirementElems.push(t)},dangerouslySetInnerHTML:{__html:e.fixL(t.knownledgeRequirements.filter(function(e){return"C"===e.gradeStep})[0].text)}})),a.createElement("tr",null,a.createElement("th",null,"Kunskapskrav Betyg A"),a.createElement("td",{className:"grade-step-A",ref:function(t){return e.knowledgeRequirementElems.push(t)},dangerouslySetInnerHTML:{__html:e.fixL(t.knownledgeRequirements.filter(function(e){return"A"===e.gradeStep})[0].text)}}))))}))))))},t}(a.Component),_=function(e){function t(t){var n=e.call(this,t)||this;return n.state={subject:null},n}return r.c(t,e),t.prototype.componentWillMount=function(){this.load()},t.prototype.load=function(){return r.b(this,void 0,void 0,function(){var e;return r.d(this,function(t){switch(t.label){case 0:return[4,u.a.kedBackendClient.get("subjects",this.props.id,{include:"courseTemplates"})];case 1:return e=t.sent(),this.setState({subject:e}),[2]}})})},t.prototype.render=function(){if(!this.state.subject)return a.createElement("p",null,a.createElement(R.a,null));var e=this.state.subject,t=e.name,n=e.code,r=e.courseTemplates;return a.createElement("div",null,a.createElement(j,{title:t,activePage:"subjects",routes:{feedback:this.props.feedbackUrl}}),a.createElement("h2",null,"Kurser för ämnet ",t," (",n,")"),a.createElement("ul",{className:"entity-list"},r.map(function(e){var t=e.id,n=e.name,r=(e.code,e.publishable,e.points);return a.createElement("li",{key:t,className:"complete"},n," - ",r,"p")})))},t}(a.Component),z=function(e){function t(t){var n=e.call(this,t)||this;return n.state={isListingSubjects:!0,subjects:[],uploadedSubject:null},n}return r.c(t,e),t.prototype.componentWillMount=function(){this.load()},t.prototype.load=function(){return r.b(this,void 0,void 0,function(){var e;return r.d(this,function(t){switch(t.label){case 0:return[4,u.a.kedBackendClient.list("subjects")];case 1:return(e=t.sent()).sort(Object(o.g)("name")),this.setState({subjects:e,isListingSubjects:!1}),[2]}})})},t.prototype.handleFileSelect=function(e){return r.b(this,void 0,void 0,function(){var t,n,a,o,s,i,c,u;return r.d(this,function(r){switch(r.label){case 0:return e.stopPropagation(),e.preventDefault(),t=e.dataTransfer.files,[4,Object(l.f)(t[0])];case 1:for(n=r.sent(),a=P()(P.a.parseXML(n)),o={name:a.find("subject>name").text(),code:a.find("subject>code").text(),purpose:a.find("subject>purpose").text(),courses:[]},s=a.find("subject>courses"),i=0;i<s.length;++i)c=P()(s[i]),u=[].slice.call(c.find("knowledgeRequirements")).map(function(e){return{gradeStep:P()(e).find("gradeStep").text(),text:P()(e).find("text").text()}}),o.courses.push({name:c.find("name").text(),code:c.find("code").text(),centralContent:c.find("centralContent").text(),points:parseInt(c.find("point").text()),knownledgeRequirements:u});return this.setState({uploadedSubject:o}),[2]}})})},t.prototype.onImportSuccess=function(e){Object(o.n)(Object(o.a)(O||(O=r.e(["Importen av "," lyckades"],["Importen av "," lyckades"])),e)),this.setState({uploadedSubject:null}),this.load()},t.prototype.render=function(){var e=this;return a.createElement("div",null,a.createElement(j,{title:Object(o.a)(S||(S=r.e(["Ämnen"],["Ämnen"]))),activePage:"subjects",routes:{feedback:this.props.feedbackUrl}}),this.state.uploadedSubject?a.createElement(A,r.a({onCancel:function(){return e.setState({uploadedSubject:null})},onImportSuccess:function(t){return e.onImportSuccess(t)}},this.state.uploadedSubject)):this.state.isListingSubjects?a.createElement("div",null,a.createElement("p",null,a.createElement(R.a,null),"Var god vänta medan ämnen hämtas...")):a.createElement("div",null,a.createElement("h2",null,Object(o.a)(I||(I=r.e(["Ämnen"],["Ämnen"])))),a.createElement("ul",null,this.state.subjects.map(function(e){return a.createElement("li",{key:e.id,className:e.publishable?"complete":"incomplete"},a.createElement(s.b,{to:"/subjects/"+e.id},e.name))})),a.createElement("div",{className:"drop-zone",onDragOver:l.a,onDrop:function(t){return e.handleFileSelect(t)}},"Droppa Subject-fil här från skolverket (Hämtas från ",a.createElement("a",{href:"http://opendata.skolverket.se",target:"skolverket"},"opendata.skolverket.se"),")")))},t}(a.Component),K=n(20),q=n(35),H=n.n(q),$=function(e){function t(t){var n=e.call(this,t)||this;return n.state=n.props.resource||{name:"",url:""},n}return r.c(t,e),t.prototype.save=function(){var e=this.state;if(!H.a.isUri(e.url))throw new Error(Object(o.a)(x||(x=r.e(["Angiven URL '","' är ogiltig. Ska börja med exempelvis http:, https: eller mailto:"],["Angiven URL '","' är ogiltig. Ska börja med exempelvis http:, https: eller mailto:"])),e.url));this.props.onSave(e)},t.prototype.render=function(){var e=this,t=this.props,n=t.title,r=t.onSave,o=t.onDelete,s=this.state,i=H.a.isUri(this.state.url);return a.createElement("div",null,a.createElement("div",{className:"sv-html-portlet sv-portlet sv-skip-spacer"},a.createElement("h2",null,n),a.createElement("hr",null),a.createElement("div",{className:"align-horizontal"},a.createElement("div",{className:"horizontalItem top"},"Namn:"),a.createElement("div",{className:"horizontalItem top"},a.createElement("input",{type:"text",autoFocus:!0,tabIndex:1,size:50,value:s.name,onChange:function(t){return e.setState({name:t.target.value})}})),a.createElement("div",{className:"horizontalItem top spaced"})),a.createElement("div",{className:"align-horizontal"},a.createElement("div",{className:"horizontalItem top"},"Länk:"),a.createElement("div",{className:"horizontalItem top "},a.createElement("input",{type:"text",tabIndex:1,size:50,value:s.url,onChange:function(t){return e.setState({url:t.target.value})}})),a.createElement("div",{className:"horizontalItem top spaced"})),a.createElement("br",null)),a.createElement("div",{className:"sv-html-portlet sv-portlet"},(s.createdDate||s.modifiedDate)&&a.createElement("div",null,s.createdDate&&a.createElement("p",null,"Resursen/Länken skapades ",Object(l.c)(s.createdDate)," av ",a.createElement("strong",null,s.createdBy.name),"."),s.modifiedDate&&a.createElement("p",null,"Resursen/Länken redigerades senast ",Object(l.c)(s.modifiedDate)," av ",a.createElement("strong",null,s.modifiedBy.name),"."),a.createElement("br",null),a.createElement("br",null)),o&&a.createElement("div",{tabIndex:2,className:"btn btn-warning btn-large pull-right",onClick:function(){return o()}},"Ta bort resurs/länk"),a.createElement("a",{tabIndex:1,className:"btn btn-large"+(i?"":" btn-inactive"),onClick:i&&function(){return r(s)}},"Spara")))},t}(a.Component),F=function(e){function t(t){var n=e.call(this,t)||this;return n.state={},n}return r.c(t,e),t.prototype.render=function(){var e=this.props,t=e.host,n=e.onUpdate,r=e.resources;return a.createElement("div",null,a.createElement("div",{className:"taskContainer"},r.map(function(e,r){return a.createElement("div",{className:"align-horizontal",key:r},a.createElement("div",{className:"horizontalItem top"},a.createElement("a",{className:"editItem",onClick:function(){return t.openDialog({Component:$,props:{title:"Redigera resurs",resource:e,onSave:function(e){var a=Object(l.k)(e,u.a.currentUser);n({$splice:[[r,1,a]]}),t.closeDialog()},onDelete:function(){n({$splice:[[r,1]]}),t.closeDialog()}}})}})),a.createElement("div",{className:"horizontalItem top"},a.createElement("a",{href:e.url,target:"_blank"},e.name)))})),a.createElement("a",{className:"btn",onClick:function(){return t.openDialog({Component:$,props:{title:"Lägg till resurs",onSave:function(e){var r=Object(l.k)(e,u.a.currentUser);n({$push:[r]}),t.closeDialog()}}})}},a.createElement("i",{className:"fa fa-paperclip","aria-hidden":!0})," Lägg till resurs"))},t}(a.Component),W=function(e){function t(t){return e.call(this,t)||this}return r.c(t,e),t.prototype.render=function(){for(var e=this.props,t=e.knowledgeRequirements,n=e.markedIds,r=this.props,o=r.idsToMarkNotOk,s=r.markMode,i=r.onMarkChanged,l=["E","C","A"],c=[],u=t.slice(),d=null;!(d=l.map(function(e){var t=u.findIndex(function(t){return t.gradeStep.toUpperCase()===e});if(t<0)return null;var n=u[t];return u.splice(t,1),n})).every(function(e){return null===e});)c.push(d);return a.createElement("div",null,a.createElement("table",null,a.createElement("thead",null,a.createElement("tr",null,l.map(function(e){return a.createElement("th",{key:e},e)}))),a.createElement("tbody",null,c.map(function(e,t){return a.createElement("tr",{key:t},e.map(function(e,t){var r=e&&n&&n.indexOf(e.id)>=0,l=e&&o&&o[e.id];return a.createElement("td",{key:t,dangerouslySetInnerHTML:{__html:e?e.name:""},className:(s?"selectable":"")+(r?" markedGreen":l?" markedRed":""),onClick:s&&e?function(){return i(e.id,!r)}:void 0})}))}))))},t}(a.Component),V=n(22),Y=n.n(V),G=n(25),J=function(e){function t(t){var n=e.call(this,t)||this;return n.state={},n}return r.c(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.options,r=t.title,o=t.markedIds,s=t.markMode;return a.createElement(G.a,{title:a.createElement("p",null,r),className:"larger"},n.map(function(t){var n=o.some(function(e){return e===t.id});return a.createElement("div",{className:"align-horizontal",key:t.id,onClick:function(){return s&&e.props.onMarkChanged(t.id,!n)}},a.createElement("div",{className:"horizontalItem top spaced"+(s?" selectable":"")+(n?" markedGreen":"")},a.createElement("p",{dangerouslySetInnerHTML:{__html:t.name}}),a.createElement("br",null)))}))},t}(a.Component),X=function(){function e(e){this.queryer=e,this.promise=null,this.result=null}return e.prototype.query=function(){var e=this;return this.promise?this.promise:this.promise=this.queryer().then(function(t){return e.result=t})},e.prototype.reset=function(){this.promise=null},e}(),Q=(function(){}(),["Lära att lära","Samarbeta","Agera globalt","Visa handlingskraft","Vara innovativ","Leva digitalt"]),Z=new DOMParser,ee={b:{},i:{},p:{},u:{},strike:{},pre:{},h1:{},h2:{},h3:{},h4:{},h5:{},img:{src:!0,class:!0,style:!0,tabindex:!0},a:{href:!0,target:!0},ul:{},ol:{},li:{},hr:{},br:{},div:{},span:{},table:{border:!0},tbody:{},thead:{},tfoot:{},tr:{},td:{headers:!0,colspan:!0,rowspan:!0},th:{abbr:!0,headers:!0,scope:!0,sorted:!0,colspan:!0,rowspan:!0}};function te(e){for(var t=Z.parseFromString(e,"text/html"),n=t.body.childNodes,r=!1,a=0;a<n.length;++a)ne(n.item(a))&&(r=!0);return r?t.body.innerHTML:e}function ne(e){var t=!1;return function(e){return!!e.tagName}(e)&&function(e){var t=e.tagName&&ee[e.tagName.toLowerCase()];if(!t)return console.warn("Wysiwyg: not allowed tag",e.tagName),re(e),function(e){for(var t=e.childNodes,n=0;n<t.length;++n)e.parentNode.insertBefore(t.item(n),e);e.remove()}(e),!0;for(var n=!1,r=0;r<e.attributes.length;++r){var a=e.attributes.item(r),o=a.name&&!!t[a.name.toLowerCase()];o||(n=!0,console.warn("Wysiwyg: not allowed attribute",a.name),e.removeAttribute(a.name))}return n}(e)&&(t=!0),re(e)&&(t=!0),t}function re(e){for(var t=!1,n=e.childNodes,r=0;r<n.length;++r)ne(n.item(r))&&(t=!0);return t}var ae=function(e,t){void 0===t&&(t=null),document.execCommand(e,!1,t)},oe={bold:{icon:"<b>B</b>",title:"Bold",result:function(){return ae("bold")}},italic:{icon:"<i>I</i>",title:"Italic",result:function(){return ae("italic")}},underline:{icon:"<u>U</u>",title:"Underline",result:function(){return ae("underline")}},strikethrough:{icon:"<strike>S</strike>",title:"Strike-through",result:function(){return ae("strikeThrough")}},heading1:{icon:"<b>H<sub>1</sub></b>",title:"Heading 1",result:function(){return ae("formatBlock","<H1>")}},heading2:{icon:"<b>H<sub>2</sub></b>",title:"Heading 2",result:function(){return ae("formatBlock","<H2>")}},heading3:{icon:"<b>H<sub>3</sub></b>",title:"Heading 3",result:function(){return ae("formatBlock","<H3>")}},paragraph:{icon:"&#182;",title:"Paragraph",result:function(){return ae("formatBlock","<P>")}},quote:{icon:"&#8220; &#8221;",title:"Quote",result:function(){return ae("formatBlock","<BLOCKQUOTE>")}},olist:{icon:"&#35;",title:"Ordered List",result:function(){return ae("insertOrderedList")}},ulist:{icon:"&#8226;",title:"Unordered List",result:function(){return ae("insertUnorderedList")}},code:{icon:"&lt;/&gt;",title:"Code",result:function(){return ae("formatBlock","<PRE>")}},line:{icon:"&#8213;",title:"Horizontal Line",result:function(){return ae("insertHorizontalRule")}},link:{icon:"&#128279;",title:"Link",result:function(){var e=window.prompt("Enter the link URL");e&&ae("createLink",e)}},image:{icon:"&#128247;",title:"Image",result:function(){var e=window.prompt("Enter the image URL");e&&ae("insertImage",e)}}},se="wysiwyg-actionbar",ie="wysiwyg-button",le="wysiwyg-content",ce="wysiwyg-focusrect",ue="wysiwyg-focuspoint",de="wysiwyg-content readonly",me=function(e){function t(t){var n=e.call(this,t)||this;return n.state={focusRect:null},n.onFocus=n.onFocus.bind(n),n.onBlur=n.onBlur.bind(n),n.onMouseDown=n.onMouseDown.bind(n),n.onMouseMove=n.onMouseMove.bind(n),n.onMouseUp=n.onMouseUp.bind(n),n}return r.c(t,e),t.prototype.componentDidMount=function(){var e=this;Array.from(this.contentDiv.querySelectorAll("img,a")).map(function(e){return e}).forEach(function(t){t.tabIndex=1,t.onfocus=e.onFocus,t.onblur=e.onBlur}),document.addEventListener("mousedown",this.onMouseDown),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)},t.prototype.componentDidUpdate=function(){var e=this;Array.from(this.contentDiv.querySelectorAll("img,a")).map(function(e){return e}).forEach(function(t){t.tabIndex=1,t.onfocus=e.onFocus,t.onblur=e.onBlur})},t.prototype.componentWillUnmount=function(){document.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)},t.prototype.shouldComponentUpdate=function(e,t){return!this.contentDiv||t!=this.state||e.readOnly!==this.props.readOnly||e.html!==this.contentDiv.innerHTML},t.prototype.triggerOnChange=function(e){this.props.onChange&&this.props.onChange(te(e))},t.prototype.onFocus=function(e){var t=e.target;if(t&&t.tagName&&("IMG"===t.tagName||"A"===t.tagName)){var n={focusRect:pe(this.contentDiv.parentElement,t)};t.tagName,this.setState(n),this.focusElem=t}},t.prototype.onBlur=function(e){(e.target===this.focusElem&&e.relatedTarget!==this.focusRectDiv||e.target===this.focusRectDiv)&&this.setState({focusRect:null})},t.prototype.makeClickable=function(e){e.tabIndex=1},t.prototype.onMouseDown=function(e){if((e.target.className||"").split(" ").indexOf(ue)>=0){var t=this.getRectCorner(e);this.corner=t,this.resizeStartX=e.clientX}},t.prototype.onMouseMove=function(e){if(this.corner&&this.state.focusRect&&this.focusElem){e.preventDefault();var t=this.focusRectDiv.getBoundingClientRect();if(t.width<32)return;var n=Math.max(32,this.corner.endsWith("l")?t.width+(this.resizeStartX-e.clientX):t.width-(this.resizeStartX-e.clientX));this.resizeStartX=e.clientX;var r=n/t.width,a=t.height*r;this.focusElem.style.width=n+"px",this.focusElem.style.height=a+"px",this.setState({focusRect:pe(this.contentDiv.parentElement,this.focusElem)})}},t.prototype.onMouseUp=function(e){this.corner&&this.state.focusRect&&this.focusElem&&(this.corner=null,this.triggerOnChange(this.contentDiv.innerHTML))},t.prototype.getRectCorner=function(e){for(var t=0,n=(e.target.className||"").split(" ");t<n.length;t++){switch(n[t]){case"fpul":return"ul";case"fpur":return"fpur";case"fplr":return"lr";case"fpll":return"ll"}}return null},t.prototype.execImageEditAction=function(e){if(this.focusElem){switch(e){case"float-left":this.focusElem.style.cssFloat="left";break;case"float-right":this.focusElem.style.cssFloat="right";break;case"unfloat":this.focusElem.style.cssFloat=""}this.triggerOnChange(this.contentDiv.innerHTML),this.setState({focusRect:pe(this.contentDiv.parentElement,this.focusElem)})}},t.prototype.render=function(){var e,t=this,n=this.props.defaultActions||oe,o=this.props.actions?this.props.actions.map(function(e){return"string"==typeof e?n[e]:n[e.name]?r.a({},n[e.name],e):e}):Object.keys(n).map(function(e){return n[e]});this.state.focusRect&&(o=o.concat((e=function(e){return t.execImageEditAction(e)},[{name:"float-left",icon:'<div style="position:relative">\n      <i class="fa fa-align-right" aria-hidden="true"></i>\n      <div style="position:absolute; left:-4px;top:0; transform: scale(0.5); transform-origin: left top">\n        <i class="fa fa-picture-o" aria-hidden="true"></i>\n      </div>\n    </div>',title:"Låt bilden flyta vänster om text",result:function(){return e("float-left")}},{name:"float-right",icon:'<div style="position:relative">\n      <i class="fa fa-align-left" aria-hidden="true"></i>\n      <div style="position:absolute; right:-4px;top:0; transform: scale(0.5); transform-origin: right top">\n        <i class="fa fa-picture-o" aria-hidden="true"></i>\n      </div>\n    </div>',title:"Låt bilden flyta höger om text",result:function(){return e("float-right")}},{name:"unfloat",icon:'<div style="position:relative;" aria-hidden="true">\n      <div style="position:absolute;top:0;left:0">&#8254;</div>\n      <div style="position:absolute;top:0:left:0;transform: scale(0.5); transform-origin: left bottom">\n        <i class="fa fa-picture-o" aria-hidden="true"></i>\n      </div>\n      <div style="position:absolute;top:0;left:0">_</div>\n    </div>',title:"Placera bilden på egen rad",result:function(){return e("unfloat")}}])));var s=this.state.focusRect,i=this.props.readOnly;return a.createElement("div",{className:this.props.className},!i&&a.createElement("div",{className:se},o.map(function(e,n){return a.createElement("button",{key:n,className:ie,dangerouslySetInnerHTML:{__html:e.icon},title:e.title,onMouseDown:function(n){e.result(n,t)},onMouseUp:function(e){return setTimeout(function(){return t.contentDiv.focus()},10)}})})),a.createElement("div",{className:i?de:le,style:{position:"relative",top:0,left:0}},a.createElement("div",{className:"editor",ref:function(e){return t.contentDiv=e},dangerouslySetInnerHTML:{__html:te(this.props.html)},contentEditable:!i,onInput:function(e){return t.triggerOnChange(e.target.innerHTML)},onKeyDown:function(e){i||(e.which>=35&&e.which<=40&&e.stopPropagation(),9===e.which&&e.preventDefault(),(8===e.keyCode||46===e.keyCode)&&t.focusElem&&t.state.focusRect&&(t.focusElem&&t.focusElem.parentElement&&t.focusElem.parentElement.removeChild(t.focusElem),t.focusElem=null,t.setState({focusRect:null}),t.triggerOnChange(t.contentDiv.innerHTML)))}}),s&&a.createElement("div",{ref:function(e){return t.focusRectDiv=e},className:ce,onBlur:this.onBlur,tabIndex:1,style:{outline:0,position:"absolute",top:this.state.focusRect.top,left:this.state.focusRect.left,width:this.state.focusRect.width,height:this.state.focusRect.height}},a.createElement("div",{className:ue+" fpul",style:{position:"absolute",top:0,left:0}}),a.createElement("div",{className:ue+" fpur",style:{position:"absolute",top:0,right:0}}),a.createElement("div",{className:ue+" fplr",style:{position:"absolute",bottom:0,right:0}}),a.createElement("div",{className:ue+" fpll",style:{position:"absolute",bottom:0,left:0}}))))},t}(a.Component);function pe(e,t){var n=e.getBoundingClientRect(),r=t.getBoundingClientRect();return{top:r.top-n.top+e.scrollTop,left:r.left-n.left+e.scrollLeft,bottom:r.bottom-n.top+e.scrollTop,right:r.right-n.left+e.scrollLeft,width:r.width,height:r.height}}var he={bold:{icon:"<b>F</b>",title:"Fetstil",result:function(){return ae("bold")}},italic:{icon:"<i>K</i>",title:"Kursiv",result:function(){return ae("italic")}},underline:{icon:"<u>U</u>",title:"Understruken",result:function(){return ae("underline")}},strikethrough:{icon:"<strike>S</strike>",title:"Struken",result:function(){return ae("strikeThrough")}},heading1:{icon:"<b>H<sub>1</sub></b>",title:"Rubrik 1",result:function(){return ae("formatBlock","<H1>")}},heading2:{icon:"<b>H<sub>2</sub></b>",title:"Rubrik 2",result:function(){return ae("formatBlock","<H2>")}},heading3:{icon:"<b>H<sub>3</sub></b>",title:"Rubrik 3",result:function(){return ae("formatBlock","<H3>")}},paragraph:{icon:"&#182;",title:"Paragraf",result:function(){return ae("formatBlock","<P>")}},quote:{icon:"&#8220; &#8221;",title:"Citat",result:function(){return ae("formatBlock","<BLOCKQUOTE>")}},olist:{icon:'<i class="fa fa-list-ol" aria-hidden="true"></i>',title:"Ordnad lista",result:function(){return ae("insertOrderedList")}},ulist:{icon:'<i class="fa fa-list" aria-hidden="true"></i>',title:"Punktlista",result:function(){return ae("insertUnorderedList")}},code:{icon:"&lt;/&gt;",title:"Programkod",result:function(){return ae("formatBlock","<PRE>")}},line:{icon:"&#8213;",title:"Vågrät linje",result:function(){return ae("insertHorizontalRule")}},link:{icon:'<i class="fa fa-link" aria-hidden="true"></i>',title:"Infoga länk",result:function(){var e=window.prompt("Ange länkens URL");e&&ae("createLink",e)}},image:{icon:'<i class="fa fa-picture-o" aria-hidden="true"></i>',title:"Infoga bild",result:function(e,t){var n,r,a,o=window.prompt("Ange bildens URL");if(o){var s=document.createElement("img");s.src=o,s.tabIndex=1,n=s,window.getSelection&&(r=window.getSelection()).rangeCount&&((a=r.getRangeAt(0)).collapse(!0),a.insertNode(n),a.setStartAfter(n),a.collapse(!0),r.removeAllRanges(),r.addRange(a)),s.onfocus=t.onFocus,s.onblur=t.onBlur,t.props.onChange(t.contentDiv.innerHTML)}}}};var fe,ve,ge,be,ke,Ee,ye,we,Ce,Ne,Oe,Se,Ie,xe,je,De,Re=n(48),Te=n(5),Ue=n.n(Te),Me=n(36),Le=function(e){function t(t){var n=e.call(this,t)||this;n.features=new Me.a;var a=!t.task||Object(D.c)(t.task);return n.state={title:t.task?a?Object(o.a)(fe||(fe=r.e(['Redigera uppgift till "','"'],['Redigera uppgift till "','"'])),t.module.name):Object(o.a)(ve||(ve=r.e(['Visa uppgift till "','"'],['Visa uppgift till "','"'])),t.module.name):t.searchMode?Object(o.a)(ge||(ge=r.e(['Sök ny uppgift till "','"'],['Sök ny uppgift till "','"'])),t.module.name):Object(o.a)(be||(be=r.e(['Lägg till egen uppgift till "','"'],['Lägg till egen uppgift till "','"'])),t.module.name),futureAbilitiesOpen:!1,taskCustomization:t.taskCustomization||{},task:t.task?r.a({$meta:t.task.$meta||"update"},t.task):t.searchMode?null:{id:Object(c.e)(),$meta:"add",tags:["sub:"+t.course.subjectCode],school:!t.course.isTemplate&&u.a.currentUser.school,resources:[],abilities:[],centralContent:[],futureAbilities:[],knowledgeRequirements:[],name:"",url:"",acl:t.course.isTemplate?["role:USER:R"]:["role:USER:R","schoolRole:"+u.a.currentUser.school+"/EMPLOYEE:S"]},searchMarkedIds:t.searchMode&&[],searchResult:t.searchMode&&[],isSearching:t.searchMode},t.searchMode&&(n.searchResponse=new X(function(){return u.a.kedBackendClient.list("tasks",{tags:"sub:"+t.course.subjectCode,include:["knowledgeRequirements","abilities","centralContent"],flags:["includeIdsOnly"]})})),n}return r.c(t,e),t.prototype.setStatePromised=function(t){var n=this;return new Promise(function(r){return e.prototype.setState.call(n,function(){return t},r)})},t.prototype.componentDidMount=function(){return r.b(this,void 0,void 0,function(){var e;return r.d(this,function(t){switch(t.label){case 0:if(!this.props.searchMode)return[3,8];this.setStatePromised({isSearching:!0}),t.label=1;case 1:return t.trys.push([1,5,6,8]),[4,this.searchResponse.query()];case 2:return t.sent(),this.state.searchMarkedIds&&0===this.state.searchMarkedIds.length?[4,this.updateSearchResult(this.state.searchMarkedIds)]:[3,4];case 3:t.sent(),t.label=4;case 4:return[3,8];case 5:return e=t.sent(),Object(o.m)(e),[3,8];case 6:return[4,this.setStatePromised({isSearching:!1})];case 7:return t.sent(),[7];case 8:return[2]}})})},t.prototype.updateSearchMarkedIds=function(e){return r.b(this,void 0,void 0,function(){var t;return r.d(this,function(n){switch(n.label){case 0:return t=this.setStatePromised({task:null,searchMarkedIds:e,previewTaskContent:null}),this.searchResponse.result?[3,3]:[4,this.searchResponse.promise];case 1:return n.sent(),[4,t];case 2:n.sent(),e=this.state.searchMarkedIds,n.label=3;case 3:return[4,this.updateSearchResult(e)];case 4:return n.sent(),[2]}})})},t.prototype.updateSearchResult=function(e){return r.b(this,void 0,void 0,function(){var t,n;return r.d(this,function(r){switch(r.label){case 0:return[4,this.searchResponse.query()];case 1:return t=r.sent(),n=t.filter(function(t){return e.every(function(e){return t.knowledgeRequirements.some(function(t){return t.id===e})||t.abilities.some(function(t){return t.id===e})||t.centralContent.some(function(t){return t.id===e})})}),this.setStatePromised({searchResult:n}),[2]}})})},t.prototype.onMarkChanged=function(e,t){if(this.props.searchMode){var n=this.state.searchMarkedIds;this.updateSearchMarkedIds(t?n.concat(e):n.filter(function(t){return t!==e})).catch(o.m)}else{var a=this.props.course,s=this.state.task,i=a.abilities.find(function(t){return t.id===e}),l=a.knowledgeRequirements.find(function(t){return t.id===e}),c=a.centralContent.find(function(t){return t.id===e}),u=i?["abilities",i]:l?["knowledgeRequirements",l]:c?["centralContent",c]:[null,null],d=u[0],m=u[1];if(d){var p=s[d].slice();t?p.push(m):p.splice(p.findIndex(function(t){return t.id===e}),1);var h=r.a({},s);h[d]=p,this.setStatePromised({task:h})}else console.error("Could not find marked id "+e)}},t.prototype.save=function(){return r.b(this,void 0,void 0,function(){var e,t,n;return r.d(this,function(a){switch(a.label){case 0:if(e=this.state,t=e.task,n=e.taskCustomization,!Object(D.c)(t))return[3,5];if(!t.url&&!t.content)throw new Error(Object(o.a)(ke||(ke=r.e(["Uppgiften måste antingen ha en URL eller ett innehåll"],["Uppgiften måste antingen ha en URL eller ett innehåll"]))));if(t.url&&!H.a.isUri(t.url))throw new Error(Object(o.a)(Ee||(Ee=r.e(["Angiven URL '","' är ogiltig. Den ska börja med http: eller https:"],["Angiven URL '","' är ogiltig. Den ska börja med http: eller https:"])),t.url));return this.props.task&&this.props.task.id!==t.id?[4,this.props.onReplace(this.props.task.id,t)]:[3,2];case 1:return a.sent(),[3,4];case 2:return[4,this.props.onSave(t,null)];case 3:a.sent(),a.label=4;case 4:return[3,9];case 5:return this.props.searchMode?[4,this.props.onSave(t,n)]:[3,7];case 6:return a.sent(),[3,9];case 7:if(this.props.course.isTemplate&&"add"===t.$meta)throw new Error(Object(o.a)(ye||(ye=r.e(["Du saknar behörighet för att spara nya versioner av uppgifter i kursmallen"],["Du saknar behörighet för att spara nya versioner av uppgifter i kursmallen"]))));return[4,this.props.onSaveCustomization(n)];case 8:a.sent(),a.label=9;case 9:return[2]}})})},t.prototype.copyTask=function(){return r.b(this,void 0,void 0,function(){var e;return r.d(this,function(t){switch(t.label){case 0:return(e=r.a({},this.state.task,this.state.taskCustomization||{},{id:Object(c.e)(),acl:this.props.course.isTemplate?["role:USER:R"]:["role:USER:R","schoolRole:"+u.a.currentUser.school+"/EMPLOYEE:S"]})).$meta="add",[4,this.setStatePromised({task:e,title:Object(o.a)(we||(we=r.e(['Redigera kopierad uppgift till "','"'],['Redigera kopierad uppgift till "','"'])),this.props.module.name),taskCustomization:void 0})];case 1:return t.sent(),[2]}})})},t.prototype.getTaskProp=function(e){var t=this.state,n=t.task,r=t.taskCustomization,a=r&&r[e];return void 0!==a?a:n[e]},t.prototype.updateTaskOrCustomization=function(e,t){var n=this.state,a=n.task,o=n.taskCustomization;if(!(a&&Object(D.c)(a))||o&&void 0!==o[e]){var s=r.a({},o);s[e]=Y()(s[e]||a[e],t),this.setStatePromised({taskCustomization:s})}else{var i=r.a({},a);i[e]=Y()(a[e],t),this.setStatePromised({task:i})}},t.prototype.render=function(){var e=this,t=this.props,n=t.course,s=(t.module,t.onCancel,t.onDelete,t.idsNotCoveredByAnyTask),i=t.searchMode,c=this.state,u=c.task,d=c.taskCustomization,m=c.title,p=c.searchResult,h=c.searchMarkedIds,f=c.isSearching,v=i?h:u.centralContent.map(function(e){return e.id}).concat(u.abilities.map(function(e){return e.id})).concat(u.knowledgeRequirements.map(function(e){return e.id})),g=u&&Object(D.c)(u),b=(u&&H.a.isUri(u.url),this.features);return a.createElement("div",{className:"sv-spacer-20pxvt sv-vertical sv-layout sv-skip-spacer"},a.createElement("div",{className:"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer"},a.createElement("div",{className:"sv-text-portlet sv-use-margins sv-skip-spacer"},a.createElement("div",{className:"sv-text-portlet-content"},a.createElement("h1",{className:"h1"},m))),a.createElement("div",{className:"sv-fluid-grid sv-grid-ksgs12 sv-layout"},a.createElement("div",{className:"sv-layout sv-skip-spacer sv-column-6"},a.createElement("div",{className:"sv-html-portlet sv-portlet sv-skip-spacer"},a.createElement("div",{className:"ked_boxed"},a.createElement("h3",null,i?"Filtrera på kunskapskrav":g?"Välj kunskapskrav":"Kunskapskrav"),i?a.createElement("p",null,"Markera de kunskapskrav som uppgiften måste täcka."):g&&a.createElement("p",null,"Markera de kunskapskrav som din uppgift täcker."),a.createElement(W,{knowledgeRequirements:n.knowledgeRequirements,markedIds:v,idsToMarkNotOk:s,markMode:i||g,onMarkChanged:this.onMarkChanged.bind(this)}))),a.createElement("div",{className:"sv-html-portlet sv-portlet"},a.createElement(J,{options:n.abilities,title:g||i?"Välj förmågor":"Förmågor",markedIds:v,markMode:g||i,onMarkChanged:this.onMarkChanged.bind(this)})),a.createElement("div",{className:"sv-html-portlet sv-portlet"},a.createElement(J,{options:n.centralContent,title:g||i?"Välj centralt innehåll":"Centralt innehåll",markedIds:v,markMode:g||i,onMarkChanged:this.onMarkChanged.bind(this)})),!i&&a.createElement("div",{className:"sv-html-portlet sv-portlet"},a.createElement("div",{className:"openClose larger"+(this.state.futureAbilitiesOpen?" open":"")},a.createElement("div",{className:"openHeader",onClick:function(){return e.setStatePromised({futureAbilitiesOpen:!e.state.futureAbilitiesOpen})}},g?a.createElement("p",null,"Välj ytterligare alternativ"):a.createElement("p",null,"Ytterligare alternativ")),a.createElement("div",{className:"openContent"},a.createElement("h4",null,"Framtidsförmågor"),a.createElement("div",{className:"taskContainer"},Q.map(function(t){var n=u.futureAbilities.indexOf(t)>=0;return a.createElement("div",{className:"align-horizontal",key:t},a.createElement("div",{className:"horizontalItem top"},a.createElement("div",{className:"checkBox"+(n?" checked":""),onClick:g?function(){var a=r.a({},u);a.futureAbilities=n?u.futureAbilities.filter(function(e){return e!=t}):u.futureAbilities.concat(t),e.setStatePromised({task:a})}:void 0})),a.createElement("div",{className:"horizontalItem top"},t))})))))),a.createElement("div",{className:"sv-layout sv-column-6"},a.createElement("div",{className:"sv-html-portlet sv-portlet sv-skip-spacer"},f&&a.createElement("p",null,a.createElement(R.a,null)," Laddar uppgifter..."),p?a.createElement("div",{className:"task-search-result"+(this.state.task||this.state.previewTaskContent?"":" fixed")},0===h.length?a.createElement("h2",null,"Samtliga uppgifter för ämnet"):a.createElement("h2",null,"Uppgifter som täcker valda filter"),a.createElement("div",{className:"taskContainer"},p.map(function(t){return a.createElement("div",{key:t.id,className:"align-horizontal"},a.createElement("div",{className:"horizontalItem top"},a.createElement("div",{className:"checkBox"+(u&&u.id===t.id?" checked":""),onClick:function(){return Object(K.findDOMNode)(e).parentElement.scrollTop=e.setStatePromised({task:t,previewTaskContent:null})}})),a.createElement("div",{className:"horizontalItem top"},t.content?a.createElement("a",{href:"#",onClick:function(n){e.setState({previewTaskContent:t.content,task:null}),n.preventDefault(),n.stopPropagation()}},t.name):a.createElement("a",{href:t.url,target:"_blank"},t.name)))})),a.createElement("br",null),a.createElement("hr",null)):u&&a.createElement("div",null,a.createElement("h2",null,"Uppgiftens namn och länk"),a.createElement("div",{className:"align-horizontal spaced"},a.createElement("div",{className:"horizontalItem top"},a.createElement("p",null,"Uppgiftens namn:")),a.createElement("div",{className:"horizontalItem top"},a.createElement("input",{autoFocus:!0,type:"text",size:35,value:u.name,disabled:!g,readOnly:!g,onChange:function(t){var n=r.a({},u);n.name=t.target.value,e.setStatePromised({task:n})}}))),a.createElement("div",{className:"align-horizontal spaced"},a.createElement("div",{className:"horizontalItem top"},a.createElement("p",null,"URL:")),a.createElement("div",{className:"horizontalItem top"},a.createElement("input",{type:"text",size:35,value:u.url,disabled:!g,readOnly:!g,onChange:function(t){var n=r.a({},u);n.url=t.target.value,e.setStatePromised({task:n})}}))),b.AssignmentTasks&&a.createElement(a.Fragment,null,a.createElement("h2",null,"Inlämningsuppgift"),a.createElement("div",{className:"align-horizontal"},a.createElement("div",{className:"horizontalItem top"},a.createElement("div",{className:"checkBox"+(this.getTaskProp("assignment")?" checked":""),onClick:function(){e.updateTaskOrCustomization("assignment",{$set:!e.getTaskProp("assignment")})}})),a.createElement("div",{className:"horizontalItem top"},a.createElement("p",null,"Den här uppgiften är en inlämningsuppgift"))),this.getTaskProp("assignment")&&a.createElement(a.Fragment,null,a.createElement("p",null,"Inlämningsdatum"),a.createElement("div",{className:"align-horizontal"},a.createElement("div",{className:"horizontalItem top"},a.createElement(Re.a,{selected:this.getTaskProp("deadline")&&Ue()(this.getTaskProp("deadline")),dateFormat:"YYYY-MM-DD",locale:"sv",popperPlacement:"bottom-start",onChange:function(t){e.updateTaskOrCustomization("deadline",{$set:t.format("YYYY-MM-DD")})}})),a.createElement("div",{className:"horizontalItem top"},this.getTaskProp("deadline")&&a.createElement("a",{className:"deleteDate",href:"#",title:"Ta bort inlämningsdatum",onClick:function(t){t.preventDefault(),e.updateTaskOrCustomization("deadline",{$set:null})}})))))),this.state.previewTaskContent?a.createElement("div",{dangerouslySetInnerHTML:{__html:this.state.previewTaskContent}}):u&&a.createElement(a.Fragment,null,a.createElement("h3",null,"Uppgiftens lärandemål"),a.createElement("div",null,a.createElement("textarea",{className:"inputTextBox learning-goal-box",disabled:!g,value:u.learningGoal,onChange:function(t){var n=r.a({},u);n.learningGoal=t.target.value,e.setStatePromised({task:n})}})),a.createElement("br",null),(g||!!u.content)&&a.createElement(a.Fragment,null,a.createElement("h3",null,"Uppgiftens innehåll"),g&&a.createElement("p",null,"Om uppgiften inte länkar till något dokument kan du lägga innehåll här."),a.createElement(me,{actions:["bold","italic","underline","strikethrough","heading2","heading3","olist","ulist","line","link","image"],defaultActions:he,readOnly:!g,html:u.content,onChange:function(t){var n=r.a({},u);n.content=t,e.setState({task:n})}})),d&&d.resources?a.createElement("h3",null,"Resurser för uppgiften (modifierad för denna kursinstans)"):a.createElement("h3",null,"Resurser kopplade till uppgiften"),a.createElement(F,{resources:d&&d.resources||u.resources,host:this.props.host,onUpdate:function(t){e.updateTaskOrCustomization("resources",t)}}))),u&&a.createElement("div",{className:"sv-html-portlet sv-portlet"},a.createElement("hr",null),a.createElement("h3",null,"Uppgiftens status"),u.createdBy&&u.createdDate&&a.createElement("p",null,"Uppgiften skapades ",Object(l.c)(u.createdDate)," av ",a.createElement("strong",null,u.createdBy.name),"."),u.modifiedBy&&u.modifiedDate&&a.createElement("p",null,"Uppgiften redigerades senast ",Object(l.c)(u.modifiedDate)," av ",a.createElement("strong",null,u.modifiedBy.name),"."),a.createElement("br",null),!!this.props.onDelete&&a.createElement("div",{className:"btn btn-warning btn-large pull-right",onClick:function(){return e.props.onDelete()}},"Ta bort från kursmodul"),a.createElement("div",{className:"pull-right"}," "),a.createElement("div",{className:"btn btn-warning btn-large pull-right",onClick:function(){return e.props.onCancel()}},"Avbryt"),a.createElement("div",{className:"btn btn-large",onClick:function(){return e.save().catch(o.m)}},"Spara"),!g&&a.createElement("div",{className:"btn btn-large",onClick:function(){return e.copyTask().catch(o.m)}},"Skapa kopia av den här uppgiften")))),a.createElement("div",{className:"sv-layout"},a.createElement("div",{className:"sv-html-portlet sv-portlet sv-skip-spacer"}))))},t}(a.Component),Be=function(e){function t(t){var n=e.call(this,t)||this;return n.state={},n}return r.c(t,e),t.prototype.openTaskDialog=function(e){var t=this.props,n=t.taskCustomizations,r=t.course,a=t.host,o=t.module,s=(t.taskIds,t.onTaskAdded,t.onTaskUpdated),i=t.onTaskCustomizationUpdated,c=t.onTaskDeleted,d=t.idsNotCoveredByAnyTask,m=t.onTaskReplaced;a.openDialog({Component:Le,props:{task:e,taskCustomization:n&&n[e.id],module:o,course:r,host:a,idsNotCoveredByAnyTask:d,onSave:function(e){var t=Object(l.k)(e,u.a.currentUser);s(t),a.closeDialog()},onSaveCustomization:function(t){i(e.id,t),a.closeDialog()},onDelete:function(){c(e.id),a.closeDialog()},onReplace:function(e,t){m(e,t),a.closeDialog()},onCancel:function(){return a.closeDialog()}}})},t.prototype.render=function(){var e=this,t=this.props;return a.createElement("div",null,a.createElement("div",{className:"taskContainer"},t.taskIds.map(function(e){return t.course.tasks.find(function(t){return t.id===e})}).map(function(t){var n=Object(D.c)(t);return a.createElement("div",{className:"align-horizontal",key:t.id},a.createElement("div",{className:"horizontalItem top"},a.createElement("div",{className:n?"editItem":"viewItem",onClick:function(){return e.openTaskDialog(t)}})),a.createElement("div",{className:"horizontalItem top"},t.content?a.createElement("a",{href:"#",onClick:function(n){n.preventDefault(),e.openTaskDialog(t)}},t.name):a.createElement("a",{href:t.url,target:"_blank"},t.name)))})),a.createElement("br",null),a.createElement("a",{className:"btn",onClick:function(){var n=e.props,r=n.course,a=n.host,o=n.idsNotCoveredByAnyTask,s=n.module,i=n.onTaskAdded;n.onTaskCustomizationUpdated;t.host.openDialog({Component:Le,props:{searchMode:!0,module:s,course:r,host:a,idsNotCoveredByAnyTask:o,onSave:function(e,t){e=Object(l.k)(e,u.a.currentUser),i(e,t),a.closeDialog()},onCancel:function(){return a.closeDialog()}}})}},a.createElement("i",{className:"fa fa-search","aria-hidden":!0})," Sök uppgift")," ",a.createElement("a",{onClick:function(){var t=e.props,n=t.course,r=t.host,a=t.module,o=(t.taskIds,t.onTaskAdded),s=(t.onTaskUpdated,t.onTaskDeleted,t.idsNotCoveredByAnyTask);r.openDialog({Component:Le,props:{module:a,course:n,host:r,idsNotCoveredByAnyTask:s,onSave:function(e){e=Object(l.k)(e,u.a.currentUser),o(e),r.closeDialog()},onCancel:function(){return r.closeDialog()}}})},className:"btn"},a.createElement("i",{className:"fa fa-plus","aria-hidden":!0})," Lägg till egen uppgift"))},t}(a.Component),Pe=n(27),Ae=n(31),_e=function(e){function t(t){var n=e.call(this,t)||this;return n.state={editMandatoryContent:!1},n}return r.c(t,e),t.prototype.getModuleIndex=function(){var e=this.props,t=e.course,n=e.module;return t.modules.findIndex(function(e){return e.id===n.id})},t.prototype.getModuleOrderIndex=function(){var e=this.props,t=(e.course,e.module);return this.props.getOrderedModules().findIndex(function(e){return e.id===t.id})},t.prototype.updateModule=function(e){var t=this.props.module,n=Y()(t,e),r=this.getModuleIndex();this.props.host.update({modules:{$splice:[[r,1,n]]}})},t.prototype.onTaskAdded=function(e,t){var n={},a=this.props.module.taskIds.slice();a.push(e.id),this.props.course.tasks.some(function(t){return t.id===e.id})||(n.tasks={$push:[e]});var o=r.a({},this.props.module.taskCustomizations||{});t&&(o[e.id]=t);var s=this.getModuleIndex();n.modules={},n.modules[s]={taskIds:{$set:a},taskCustomizations:{$set:o}},this.props.host.update(n)},t.prototype.onTaskUpdated=function(e){if(!e.$meta)throw new Error(Object(o.a)(Ce||(Ce=r.e(["Hoppsan, blev lite knas. Fel ID: ",""],["Hoppsan, blev lite knas. Fel ID: ",""])),"Pa7Dq"));var t=this.props.course.tasks.findIndex(function(t){return t.id===e.id});t>=0&&this.props.host.update({tasks:{$splice:[[t,1,e]]}})},t.prototype.onTaskCustomized=function(e,t){var n=r.a({},this.props.module.taskCustomizations||{});n[e]=t,this.updateModule({taskCustomizations:{$set:n}})},t.prototype.onTaskDeleted=function(e){this.updateModule({taskIds:{$set:this.props.module.taskIds.filter(function(t){return t!==e})},taskCustomizations:{$apply:function(t){var n=r.a({},t);return delete n[e],n}}})},t.prototype.onTaskReplaced=function(e,t){var n=this.props.module.taskIds.indexOf(e);if(n<0)Object(o.m)(Object(o.a)(Ne||(Ne=r.e(["Kunde inte spara uppgift. Felkod d72kQ"],["Kunde inte spara uppgift. Felkod d72kQ"]))));else{var a={taskIds:{$splice:[[n,1,t.id]]},taskCustomizations:{$apply:function(t){var n=r.a({},t);return delete n[e],n}}},s=Y()(this.props.module,a),i=this.getModuleIndex();this.props.host.update({modules:{$splice:[[i,1,s]]},tasks:{$set:this.props.course.tasks.concat(t)}})}},t.prototype.render=function(){for(var e=this,t=this.props,n=t.course,s=t.host,i=t.module,l=t.idsNotCoveredByAnyTask,c=this.getModuleIndex(),u=this.getModuleOrderIndex(),d=this.updateModule.bind(this),m=1,p=["--"],h=["--"],f=0;f<51;++f)p.push(""+m),h.push(""+ ++m);return a.createElement("div",{className:"course-module ked_boxed",style:{position:"relative"}},a.createElement("h3",null,a.createElement(Pe.a,{eager:!0,clickAdvertiseText:"Namnlös modul",maxChars:100,text:i.name,onChange:function(e){return d({name:{$set:e}})}})),a.createElement("div",{className:"align-horizontal spaced"},a.createElement("div",{className:"horizontalItem center"},a.createElement("p",null,"Startvecka")),a.createElement("div",{className:"horizontalItem center"},a.createElement("select",{value:i.startWeek||"--",onChange:function(e){return d({startWeek:{$set:"--"===e.target.value?void 0:parseInt(e.target.value)}})}},p.map(function(e){return a.createElement("option",{key:e,value:e},e)}))),a.createElement("div",{className:"horizontalItem center"},a.createElement("p",null,"Slutvecka")),a.createElement("div",{className:"horizontalItem center"},a.createElement("select",{value:i.endWeek||"--",onChange:function(e){return d({endWeek:{$set:"--"===e.target.value?void 0:parseInt(e.target.value)}})}},h.map(function(e){return a.createElement("option",{key:e,value:e},e)})))),a.createElement("h4",null,"Kursmodulens introduktion"),a.createElement(me,{actions:["bold","italic","underline","strikethrough","heading2","heading3","olist","ulist","line","link","image"],defaultActions:he,html:i.mandatoryContent,onChange:function(e){d({mandatoryContent:{$set:e}})}}),a.createElement("h4",null,"Uppgifter"),a.createElement(Be,{taskIds:i.taskIds,taskCustomizations:i.taskCustomizations,course:n,module:i,host:s,idsNotCoveredByAnyTask:l,onTaskAdded:function(t,n){return e.onTaskAdded(t,n)},onTaskUpdated:function(t){return e.onTaskUpdated(t)},onTaskCustomizationUpdated:function(t,n){return e.onTaskCustomized(t,n)},onTaskDeleted:function(t){return e.onTaskDeleted(t)},onTaskReplaced:function(t,n){return e.onTaskReplaced(t,n)}}),a.createElement("h4",null,"Modulresurser"),a.createElement("p",{className:"subHeader"},"(Eventuella resuser för redovisning av modulen samt för modulen som helhet)"),a.createElement(F,{resources:i.resources,onUpdate:function(e){return d({resources:e})},host:s}),a.createElement("div",{style:{position:"absolute",top:0,right:0}},u>0&&a.createElement("span",null,a.createElement("i",{className:"fa fa-arrow-circle-up selectable","aria-hidden":"true",onClick:function(){return e.props.onReorder(-1)}})," "),u<n.modules.length-1&&a.createElement("span",null,a.createElement("i",{className:"fa fa-arrow-circle-down selectable","aria-hidden":"true",onClick:function(){return e.props.onReorder(1)}})," "),a.createElement(Ae.a,{title:"Ta bort modulen",style:{display:"inline-block"},onClick:function(){return confirm(Object(o.a)(Oe||(Oe=r.e(["Ta bort modul ","?"],["Ta bort modul ","?"])),i.name))&&s.update({modules:{$splice:[[c,1]]}})}})))},t}(a.Component),ze=function(e){function t(t){var n=e.call(this,t)||this;return n._moduleRefs={},n.state={},n}return r.c(t,e),t.prototype.addModule=function(){this.props.host.update({modules:{$push:[{name:"Ny kursmodul",id:Object(c.e)(),resources:[],taskIds:[]}]}})},t.prototype.getOrderedModules=function(){var e=this.props.course,t=e.moduleOrder||e.modules.map(function(e){return e.id});return t.map(function(t){return e.modules.find(function(e){return e.id===t})}).filter(function(e){return!!e}).concat(e.modules.filter(function(e){return!t.find(function(t){return e.id===t})}))},t.prototype.reorder=function(e,t){return r.b(this,void 0,void 0,function(){var n,a,o,s,i,l,c;return r.d(this,function(r){switch(r.label){case 0:return this.props.course,n=this.getOrderedModules(),a=n.findIndex(function(t){return t.id===e}),(o=a+t)<0||o>=n.length?[2]:(s=n[o],(i=n.map(function(e){return e.id}))[o]=e,i[a]=s.id,l=document.documentElement.scrollTop,[4,this.props.host.update({moduleOrder:{$set:i}})]);case 1:if(r.sent(),c=Object(K.findDOMNode)(this._moduleRefs[e]))try{window.scrollTo({top:l}),c.scrollIntoView({behavior:"smooth",block:"start"})}catch(e){window.scrollTo(null,l),c.scrollIntoView(!0)}return[2]}})})},t.prototype.render=function(){var e=this,t=this.props,n=t.course,r=t.host,o=t.idsNotCoveredByAnyTask,s=(n.moduleOrder||n.modules.map(function(e){return e.id}),this.getOrderedModules());return a.createElement("div",{className:"sv-html-portlet sv-portlet",ref:function(t){return e._elem=t}},s.map(function(t){return a.createElement(_e,{ref:function(n){return e._moduleRefs[t.id]=n},key:t.id,course:n,module:t,onReorder:function(n){return e.reorder(t.id,n)},getOrderedModules:function(){return e.getOrderedModules()},host:r,idsNotCoveredByAnyTask:o})}),a.createElement("div",{className:"btn btn-large",onClick:function(){return e.addModule()}},"Lägg till kursmodul"))},t}(a.Component),Ke=new(function(e){function t(t){var n=e.call(this,{query:function(){return r.b(n,void 0,void 0,function(){var e,n;return r.d(this,function(a){switch(a.label){case 0:return e=t(),[4,u.a.kedBackendClient.list("schools",{name:e,include:["courses"]})];case 1:if(n=a.sent(),this._schoolId=n.length>0&&n[0].id,!this._schoolId)throw new Error(Object(o.a)(Se||(Se=r.e(["Skolan ",' finns inte registrerad i systemet.\n          Kontakta en administratör för Kursbyggarverktyget och be om att lägga till skolan med namnet "','"'],["Skolan ",' finns inte registrerad i systemet.\n          Kontakta en administratör för Kursbyggarverktyget och be om att lägga till skolan med namnet "','"'])),e,e));return[2,Object(o.k)(n.map(function(e){return e.courses}))]}})})}})||this;return n}return r.c(t,e),t.prototype.getSchoolId=function(){var e=this;return this.ensureHasData().then(function(){return e._schoolId})},t}(n(37).a))(function(){return u.a.currentUser.school}),qe=function(e){function t(t){var n=e.call(this,t)||this;return n.state={schoolCourses:null},n.onSchoolCoursesUpdated=n.onSchoolCoursesUpdated.bind(n),n}return r.c(t,e),t.prototype.componentDidMount=function(){Ke.subscribe(this.onSchoolCoursesUpdated).catch(o.m)},t.prototype.componentWillUnmount=function(){Ke.unsubscribe(this.onSchoolCoursesUpdated)},t.prototype.onSchoolCoursesUpdated=function(e){var t=Object(o.g)("name"),n=Object(o.g)("createdDate");e.sort(function(e,r){return t(e,r)||n(e,r)}),this.setState({schoolCourses:e})},t.prototype.render=function(){var e=this.state.schoolCourses;return a.createElement("div",{className:"sv-html-portlet sv-portlet sv-skip-spacer"},a.createElement("div",{className:"ked_boxed"},a.createElement("h3",null,"Skolans kurser"),a.createElement("div",{className:"taskContainer odd-even"},e?e.map(function(e){return a.createElement("div",{className:"schoolCourse",key:e.id},a.createElement("div",{className:"align-horizontal"},a.createElement("div",{className:"horizontalItem top pull-right"},a.createElement(s.b,{to:"/courses/"+e.id+"/edit",className:"editItem"})),a.createElement("div",{className:"horizontalItem top"},a.createElement(s.b,{to:"/courses/"+e.id+"/edit"},e.name)),a.createElement("div",{className:"horizontalItem top"},e.active&&a.createElement("div",{className:"pill active"},"Aktiv")),e.active&&!e.publishable&&a.createElement("div",{className:"horizontalItem top"},a.createElement("div",{className:"pill incomplete"},"Inkomplett"))),a.createElement("div",{className:"horizontalItem top"},a.createElement("p",null,e.description)),a.createElement("div",{className:"horizontalItem top"},e.modifiedBy?a.createElement("p",{className:"small"},"Redigerad av ",e.modifiedBy.name," / ",Object(l.g)(e.modifiedDate)):a.createElement("p",{className:"small",style:{fontStyle:"italic"}}," ")))}):a.createElement("p",null,a.createElement(R.a,null)," Laddar skolans kurser")),"#/courses/new"!==location.hash&&a.createElement(s.b,{className:"btn",to:"/courses/new",onClick:function(){return window.scroll(0,0)}},"Skapa ny kurs")))},t}(a.Component);function He(e){var t=e.knowledgeRequirements.reduce(function(e,t){return e[t.id]=t,e},{});return e.tasks.forEach(function(e){e.knowledgeRequirements.forEach(function(e){delete t[e.id]})}),Object.keys(t).map(function(e){return t[e]})}var $e,Fe,We,Ve,Ye,Ge,Je,Xe,Qe,Ze,et,tt,nt,rt,at=function(e){function t(t){var n=e.call(this,t)||this;return n.state={addEmtpyRow:0===t.teachers.length},n}return r.c(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.teachers,o=t.onUpdate,s=this.state.addEmtpyRow;return s&&(n=n.concat({name:"",url:""})),a.createElement("div",{className:"teachers-list"},a.createElement("h3",null,"Ansvariga lärare"),a.createElement("table",{tabIndex:1,style:{width:"100%"},onBlur:function(t){return(!t.relatedTarget||"INPUT"!==t.relatedTarget.tagName)&&e.props.teachers.length>0&&e.setState({addEmtpyRow:!1})}},a.createElement("thead",null,n.length>0&&a.createElement("tr",null,a.createElement("th",{style:{width:"20%"}},"Namn"),a.createElement("th",null,"Länk eller E-postadress"))),a.createElement("tbody",null,n.map(function(t,i){return a.createElement("tr",{key:i},a.createElement("td",null,a.createElement("input",{type:"text",ref:function(t){return e.nameElem=t},value:t.name,autoFocus:!t.name&&i>0,onChange:function(a){s&&i==n.length-1?(o({$push:[r.a({},t,{name:a.target.value})]}),e.setState({addEmtpyRow:!1})):a.target.value||t.url?o({$splice:[[i,1,r.a({},t,{name:a.target.value})]]}):(1===e.props.teachers.length&&e.setState({addEmtpyRow:!0}),o({$splice:[[i,1]]}))}})),a.createElement("td",null,a.createElement("input",{type:"text",style:{width:"100%"},value:t.url,onKeyDown:function(t){return 9===t.which&&!t.shiftKey&&i===n.length-1&&(n.length<1||!!n[n.length-1].name&&(e.setState({addEmtpyRow:!0}),t.preventDefault()))},onChange:function(a){s&&i==n.length-1?(o({$push:[r.a({},t,{url:a.target.value})]}),e.setState({addEmtpyRow:!1})):a.target.value||t.name?o({$splice:[[i,1,r.a({},t,{url:a.target.value})]]}):(1===e.props.teachers.length&&e.setState({addEmtpyRow:!0}),o({$splice:[[i,1]]}))}})))}))),a.createElement("br",null),a.createElement("a",{className:"btn",onClick:function(){return e.state.addEmtpyRow?e.nameElem.focus():e.setState({addEmtpyRow:!0})}},a.createElement("i",{className:"fa fa-user-plus","aria-hidden":!0})," Lägg till ansvarig lärare"))},t}(a.Component),ot=function(e){function t(t){var n=e.call(this,t)||this;return n.state={isOpen:!1},n}return r.c(t,e),t.prototype.render=function(){var e=this.props.course,t=(this.state.isOpen,[]),n=function(e){var t={};function n(e,n){(t[e]||(t[e]=[])).push(n)}return e.tasks.forEach(function(e){e.abilities.forEach(function(t){return n(t.id,e)}),e.centralContent.forEach(function(t){return n(t.id,e)}),e.futureAbilities.forEach(function(t){return n(t,e)})}),t}(e);return t.push(a.createElement("tr",{key:"centralContent",className:"covered-item-label"},a.createElement("td",{colSpan:2},"Centralt innehåll"))),e.centralContent.forEach(function(e,r){return t.push(a.createElement("tr",{key:e.id,className:r%2?"tableOdd":""},a.createElement("td",null,a.createElement("p",{className:"criteriaText",dangerouslySetInnerHTML:{__html:e.name}})),a.createElement("td",null,a.createElement("p",null,(n[e.id]||[]).length))))}),t.push(a.createElement("tr",{key:"abilities",className:"covered-item-label"},a.createElement("td",{colSpan:2},"Förmågor"))),e.abilities.forEach(function(e,r){return t.push(a.createElement("tr",{key:e.id,className:r%2?"tableOdd":""},a.createElement("td",null,a.createElement("p",{className:"abilityText",dangerouslySetInnerHTML:{__html:e.name}})),a.createElement("td",null,a.createElement("p",null,(n[e.id]||[]).length))))}),t.push(a.createElement("tr",{key:"futureAbilities",className:"covered-item-label"},a.createElement("td",{colSpan:2},"Framtidsförmågor"))),Q.forEach(function(e,r){return t.push(a.createElement("tr",{key:e,className:r%2?"tableOdd":""},a.createElement("td",null,a.createElement("p",{className:"abilityText"},e)),a.createElement("td",null,a.createElement("p",null,(n[e]||[]).length))))}),a.createElement(G.a,{className:"larger",title:a.createElement("p",null,"Kursens täckningstabell"),contentClassName:"weighted-items-table"},a.createElement("p",null,"Tabellen anger hur många uppgifter som berör varje del."),a.createElement("table",null,a.createElement("tbody",null,t)))},t}(a.Component),st=function(e){function t(t){var n=e.call(this,t)||this;return n.state={url:n.props.url||""},n}return r.c(t,e),t.prototype.save=function(){var e=this.state.url;if(!H.a.isUri(e))throw new Error(Object(o.a)($e||($e=r.e(["Angiven URL '","' är ogiltig. Ska börja med http: eller https:"],["Angiven URL '","' är ogiltig. Ska börja med http: eller https:"])),e));this.props.onSave(e)},t.prototype.render=function(){var e=this,t=this.props,n=t.onSave,r=t.onDelete,o=this.state,s=H.a.isUri(this.state.url);return a.createElement("div",null,a.createElement("div",{className:"sv-html-portlet sv-portlet sv-skip-spacer"},a.createElement("h2",null,"Koppla en arbetsgång till kursen"),a.createElement("p",null,"Det går bara att lägga in en arbetsgång per kurs."),a.createElement("br",null),a.createElement("div",{className:"align-horizontal"},a.createElement("div",{className:"horizontalItem top"},"Länk:"),a.createElement("div",{className:"horizontalItem top "},a.createElement("input",{type:"text",tabIndex:1,size:50,value:o.url,onChange:function(t){return e.setState({url:t.target.value})}})),a.createElement("div",{className:"horizontalItem top spaced"})),a.createElement("br",null)),a.createElement("div",{className:"sv-html-portlet sv-portlet",id:"svid12_492422d515badf36646e4ff1"},r&&a.createElement("div",{tabIndex:2,className:"btn btn-warning btn-large pull-right",onClick:function(){return r()}},"Ta bort arbetsgång"),a.createElement("a",{tabIndex:1,className:"btn btn-large"+(s?"":" btn-inactive"),onClick:s&&function(){return n(o.url)}},"Spara")))},t}(a.Component),it=function(e){function t(t){var n=e.call(this,t)||this;return n.state={},n}return r.c(t,e),t.prototype.render=function(){var e=this.props,t=e.host,n=e.onUpdate,r=e.url;return a.createElement("div",null,a.createElement("div",{className:"taskContainer"},r&&a.createElement("div",{className:"align-horizontal"},a.createElement("div",{className:"horizontalItem top"},a.createElement("a",{className:"editItem",onClick:function(){return t.openDialog({Component:st,props:{url:r,onSave:function(e){n({$set:e}),t.closeDialog()},onDelete:function(){n({$set:void 0}),t.closeDialog()}}})}})),a.createElement("div",{className:"horizontalItem top"},a.createElement("a",{href:r,target:"_blank"},"Nuvarande arbetsgång")))),!r&&a.createElement("a",{className:"btn",onClick:function(){return t.openDialog({Component:st,props:{onSave:function(e){n({$set:e}),t.closeDialog()}}})}},a.createElement("i",{className:"fa fa-paperclip","aria-hidden":!0})," Koppla en arbetsgång till kursen"))},t}(a.Component),lt=function(e){function t(t){var n=e.call(this,t)||this;return n.state={changeImageUrl:!1},n}return r.c(t,e),t.prototype.setImageUrl=function(e){this.props.course.imageId},t.prototype.render=function(){var e=this.props,t=e.course,n=e.origCourse,s=e.host,i=He(t),c=function(e){var t={};return e.knowledgeRequirements.forEach(function(e){t[e.id]=!0}),e.abilities.forEach(function(e){t[e.id]=!0}),e.centralContent.forEach(function(e){t[e.id]=!0}),e.tasks.forEach(function(e){e.knowledgeRequirements.forEach(function(e){delete t[e.id]}),e.abilities.forEach(function(e){delete t[e.id]}),e.centralContent.forEach(function(e){delete t[e.id]})}),t}(t),u=function(e){return Object(o.k)([function(e){var t={};return Object(o.k)(e.modules.map(function(n){return n.taskIds.map(function(n){if(t[n]){var a=e.tasks.find(function(e){return e.id===n});return Object(o.a)(Ie||(Ie=r.e(['Samma uppgift förekommer flera gånger: "','"'],['Samma uppgift förekommer flera gånger: "','"'])),a.name)}t[n]=!0}).filter(function(e){return e})}))}(e),function(e){var t={};return e.tasks.map(function(e){if(e.url){if(t[e.url])return Object(o.a)(xe||(xe=r.e(['Två uppgifter pekar på samma URL: "','" samt "','"'],['Två uppgifter pekar på samma URL: "','" samt "','"'])),t[e.url].name,e.name);t[e.url]=e}}).filter(function(e){return e})}(e),function(e){return e.modules.some(function(e){return""===e.name})&&Object(o.a)(je||(je=r.e(["Det finns minst en modul utan angivet namn"],["Det finns minst en modul utan angivet namn"])))}(e),function(e){var t={};return e.modules.map(function(e){if(e.name&&t[e.name])return Object(o.a)(De||(De=r.e(["Modulen med namn "," förekommer flera gånger"],["Modulen med namn "," förekommer flera gånger"])),e.name);e.name&&(t[e.name]=!0)})}(e)]).filter(function(e){return e})}(t),d=t.images.find(function(e){return e.id===t.imageId}),m=d&&d.url.startsWith("data:");return a.createElement("div",{className:"sv-row sv-layout sv-skip-spacer"},a.createElement("div",{className:"sv-layout sv-skip-spacer sv-column-7"},a.createElement("div",{className:"sv-html-portlet sv-portlet sv-skip-spacer"},t.isTemplate&&a.createElement("h1",null,"Kursmall"),a.createElement("h2",null,"Kursövergripande"),a.createElement("hr",null),a.createElement("div",{className:"ked_boxed"},a.createElement("div",null,a.createElement("h3",null,"Kursens bild"),m?a.createElement("p",null,"Kursens bild ligger i databasen. För att ändra bild måste du dra och släppa en ny bild ovanpå den gamla högst upp på denna sida. Bilden kan antingen vara från en annan webbsida. Lokala bildfiler går också bra att dra och släppa."):d?a.createElement("div",null,a.createElement("textarea",{value:d.url,style:{width:"100%",height:"30px"},onChange:function(e){return p(0,0,s,e.target.value)}}),a.createElement("p",null,"Bilden som visas högst upp hämtas från angiven URL. För att ändra bild kan du redigera URL ovan. Ett annat sätt att ändra bild är att dra och släppa en ny bild över den gamla högst upp på sidan.")):a.createElement("p",null,"Kursen saknar egen bild. Lägg till en bild genom att dra och släppa en bild på kurs-bannern högst upp på den här sidan."),a.createElement("br",null)),!t.isTemplate&&a.createElement("div",null,a.createElement("h3",null,"Beskrivning"),a.createElement("p",{className:"subHeader"},"(Beskrivning av kursen. För att skilja mellan olika varianter av samma gymnasiekurs)"),a.createElement("textarea",{className:"inputTextBox inputTextSmall",value:t.description,onChange:function(e){return s.update({description:{$set:e.target.value}})}}),a.createElement("br",null)),a.createElement("div",null,a.createElement("h3",null,"Upptaktstext"),a.createElement("p",{className:"subHeader"},"(texten ska visas på kursens upptaktssektion)"),a.createElement(me,{html:t.runUpText,defaultActions:he,actions:["bold","italic","underline","strikethrough","heading2","heading3","olist","ulist","line","link","image"],onChange:function(e){return s.update({runUpText:{$set:e}})}}),a.createElement("br",null)),a.createElement("h3",null,"Kursresurser"),a.createElement("p",{className:"subHeader"},"(Resurser för upptakt och kursen som helhet)"),a.createElement(F,{resources:t.resources,onUpdate:function(e){return s.update({resources:e})},host:s}),a.createElement("br",null),a.createElement("h3",null,"Arbetsgång"),a.createElement("p",{className:"subHeader"},"(Eventuell länk till arbetsgång för kursen)"),a.createElement(it,{url:t.workFlowLink,onUpdate:function(e){return s.update({workFlowLink:e})},host:s}),a.createElement("br",null),!t.isTemplate&&a.createElement("div",null,a.createElement("h3",null,"Google Classroom"),a.createElement("div",{className:"align-horizontal spaced"},a.createElement("div",{className:"horizontalItem top"},a.createElement("input",{placeholder:"Google classroom URL",type:"text",size:30,value:t.googleClassRoomURL,onChange:function(e){return s.update({googleClassRoomURL:{$set:e.target.value}})}})),a.createElement("div",{className:"horizontalItem top"},a.createElement("input",{placeholder:"kod",type:"text",size:8,value:t.googleClassRoomCode,onChange:function(e){return s.update({googleClassRoomCode:{$set:e.target.value}})}})))),a.createElement("br",null),!t.isTemplate&&a.createElement(a.Fragment,null,a.createElement(at,{teachers:t.responsibleTeachers,onUpdate:function(e){s.update({responsibleTeachers:e})}}),a.createElement("br",null),a.createElement("h3",null,"Inlämnings E-post"),a.createElement("table",{tabIndex:1,style:{width:"100%"}},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,"E-postaddress"))),a.createElement("tbody",null,a.createElement("tr",null,a.createElement("td",null,a.createElement(Pe.a,{eager:!0,clickAdvertiseText:"Klicka här för att ange vem som tar emot inlämningsuppgifter",text:t.assignmentEmails?t.assignmentEmails[0]:"",placeholder:"Ange mottagare av inlämningsuppgifter",tag:"input",onChange:function(e){return s.update({assignmentEmails:{$set:[e]}})}}))))))),a.createElement("div",{className:"sv-html-portlet sv-portlet",id:"svid12_6ab4811f15b13c706b43bb47"},a.createElement("div",{id:"Kursensmoduler"}),a.createElement("h2",null,"Kursens moduler"),a.createElement("hr",null)),a.createElement(ze,{host:s,course:t,idsNotCoveredByAnyTask:c}),a.createElement("div",null,a.createElement("br",null),a.createElement(ot,{course:t})),a.createElement("div",{className:"sv-html-portlet sv-portlet"},a.createElement("h2",null,"Kursens status"),a.createElement("hr",null),t.createdBy&&t.createdDate&&a.createElement("p",null,"Kursen skapades ",Object(l.c)(t.createdDate)," av ",a.createElement("strong",null,t.createdBy.name),"."),t.modifiedBy&&t.modifiedDate&&a.createElement("p",null,"Kursen redigerades senast ",Object(l.c)(t.modifiedDate)," av ",a.createElement("strong",null,t.modifiedBy.name),"."),t.active?a.createElement("p",null,"Kursen är ",a.createElement("strong",null,"AKTIV")," sedan ",Object(l.c)(t.activatedDate)," av ",a.createElement("strong",null,t.activatedBy.name),"."):a.createElement("p",null,"Kursen är ",a.createElement("strong",null,"INAKTIV"),t.inactivatedBy?a.createElement("span",null,"sedan ",Object(l.c)(t.inactivatedDate)," av ",a.createElement("strong",null,t.inactivatedBy.name),"."):a.createElement("span",null,".")),0===i.length?a.createElement("p",{className:"markedGreen"},"Modulernas kunskapskrav täcker skolverkets krav för denna kurs"):a.createElement("div",{className:"markedRed warning-box"},a.createElement("div",{className:"warningFlag"},a.createElement("i",{className:"fa fa-exclamation-triangle","aria-hidden":"true"})),a.createElement("p",null,"Modulernas kunskapskrav täcker inte skolverkets krav för denna kurs.")),u.map(function(e){return a.createElement("div",{key:e,className:"markedRed warning-box"},a.createElement("div",{className:"warningFlag"},a.createElement("i",{className:"fa fa-exclamation-triangle","aria-hidden":"true"})),a.createElement("p",null,e))}),a.createElement("br",null),!t.isTemplate&&(n?a.createElement("div",{className:"btn btn-warning btn-large pull-right",onClick:function(){confirm(Object(o.a)(Fe||(Fe=r.e(['Bekräfta borttagning av kursen "'," - ",'" för skolan ',"\n\nKursen kommar att raderas helt!\n\nÄr du säker?"],['Bekräfta borttagning av kursen "'," - ",'" för skolan ',"\\n\\nKursen kommar att raderas helt!\\n\\nÄr du säker?"])),t.name,t.description,t.school))&&s.deleteCourse().catch(o.m)}},"Ta bort kurs"):a.createElement("div",{className:"btn btn-warning btn-large pull-right",onClick:function(){return history.go(-1)}},"Avbryt")),a.createElement("div",{className:"btn btn-large",onClick:function(){return s.save()}},"Spara"),t.active?a.createElement("div",{className:"btn btn-info btn-large",onClick:function(){return s.inactivateAndSave()}},"Inaktivera och spara"):a.createElement("div",{className:"btn btn-info btn-large",onClick:function(){return s.activateAndSave()}},"Aktivera och spara")))),a.createElement("div",{className:"sv-layout sv-column-5"},a.createElement(qe,null)))},t}(a.Component),ct="production"===n(9).a.ENVIRONMENT?o.m:null,ut=Object(o.a)(We||(We=r.e(["Du har osparat data. Välj avbryt och tryck CTRL+S om du vill spara först."],["Du har osparat data. Välj avbryt och tryck CTRL+S om du vill spara först."]))),dt={origCourse:null,origTemplate:null,course:null,dialogContainers:[],hasUnsavedData:!1,view:"courseBuilder"},mt=function(e){function t(t){var n=e.call(this,t)||this;return n.state=r.a({},dt),n.update=n.update.bind(n),n.refDialog=n.refDialog.bind(n),n.contentYPos=0,n.onKeyDown=n.onKeyDown.bind(n),n.beforeUnload=n.beforeUnload.bind(n),n.onClickPreventUnload=n.onClickPreventUnload.bind(n),n.isSaving=!1,n.dialogs=[],t.view&&(n.state=r.a({},n.state,{view:t.view})),n}return r.c(t,e),t.prototype.setStatePromised=function(e){return this._setState(r.a({hasUnsavedData:!0},e))},t.prototype.setNonSaveableDataState=function(e){return this._setState(e)},t.prototype._setState=function(t){var n=this;if(t.course){var a=t.course,o=a.tasks,s={};a.modules.forEach(function(e){return e.taskIds.forEach(function(e){return s[e]=!0})});var i=o.filter(function(e){return s[e.id]}),l=r.a({},t.course);l.tasks=i,t=r.a({},t,{course:l})}var c=t.allCourses||this.state.allCourses,u=t.course||this.state.course;if(c){var d=c.findIndex(function(e){return e.id===n.props.id});c=Y()(c,{$splice:[[d,1,u]]}),(t=r.a({},t)).allCourses=c}return new Promise(function(r){return e.prototype.setState.call(n,function(){return t},r)})},t.prototype.componentWillMount=function(){this.load().catch(ct),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("beforeunload",this.beforeUnload),document.body.addEventListener("click",this.onClickPreventUnload)},t.prototype.componentWillUnmount=function(){window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("beforeunload",this.beforeUnload),document.body.removeEventListener("click",this.onClickPreventUnload),Object(l.h)("")},t.prototype.componentWillReceiveProps=function(e){this.state&&this.state.course&&(e.id===this.props.id&&e.templateId===this.props.templateId||this.setStatePromised(dt)),e.view!==this.props.view&&this.setNonSaveableDataState({view:e.view})},t.prototype.componentDidUpdate=function(e,t){if(this.contentDiv){var n=Object(K.findDOMNode)(this.contentDiv);n&&(this.contentYPos=n.getBoundingClientRect().top)}t&&t.course&&(this.props.id===e.id&&this.props.templateId===e.templateId||this.load().catch(ct)),!t.hasUnsavedData&&this.state.hasUnsavedData&&Object(l.h)("unsaved")},t.prototype.loadFromTemplate=function(e){return r.b(this,void 0,void 0,function(){var t,n,a;return r.d(this,function(r){switch(r.label){case 0:return Object(o.n)("Laddar data från mall..."),[4,Object(l.d)(e,{includeTemplateChain:!0})];case 1:return t=r.sent(),(n=Object(l.i)(Date.now(),t,u.a.currentUser)).id=Object(c.e)(),n.parentId=e,n.active=!1,n.isTemplate=!1,n.templateChain=n.templateChain.slice(),n.templateChain.push({id:e,$meta:"ref"}),a=u.a.currentUser.school,n.school=a,n.description="",n.responsibleTeachers=[],n.acl=["role:USER:R","schoolRole:"+a+"/EMPLOYEE:S"],delete n.$etag,delete n.createdBy,delete n.createdDate,delete n.modifiedBy,delete n.modifiedDate,delete n.activatedBy,delete n.activatedDate,delete n.googleClassRoomCode,delete n.googleClassRoomURL,[4,this.setStatePromised({course:n,origCourse:null,origTemplate:t})];case 2:return r.sent(),Object(o.n)(""),[2]}})})},t.prototype.load=function(){return r.b(this,void 0,void 0,function(){return r.d(this,function(e){switch(e.label){case 0:return Object(l.h)(""),this.props.id?[4,this.loadExistingCourse(this.props.id)]:[3,2];case 1:return e.sent(),[3,5];case 2:return this.props.templateId?[4,this.loadFromTemplate(this.props.templateId)]:[3,4];case 3:return e.sent(),[3,5];case 4:throw new Error(Object(o.a)(Ve||(Ve=r.e(["Ogiltig parameter. id eller templateId måste anges"],["Ogiltig parameter. id eller templateId måste anges"]))));case 5:return[2]}})})},t.prototype.loadExistingCourse=function(e){return r.b(this,void 0,void 0,function(){var t;return r.d(this,function(n){switch(n.label){case 0:return Object(o.n)("Laddar kurs"),[4,Object(l.d)(e)];case 1:return(t=n.sent()).responsibleTeachers||(t.responsibleTeachers=[]),[4,this.setNonSaveableDataState({course:t,origCourse:t})];case 2:return n.sent(),Object(o.n)(""),[2]}})})},t.prototype.update=function(e){return r.b(this,void 0,void 0,function(){return r.d(this,function(t){switch(t.label){case 0:return[4,this.setStatePromised({course:Y()(this.state.course,e)})];case 1:return t.sent(),[2]}})})},t.prototype.deleteCourse=function(){return r.b(this,void 0,void 0,function(){var e,t,n,a,s,i;return r.d(this,function(r){switch(r.label){case 0:return Object(o.n)("Raderar kursen..."),e=this.state.course.school,this.state.course.parentId,t=this.props.id,[4,u.a.kedBackendClient.list("courses",{hasEdgesTo:[this.props.id]})];case 1:for(n=r.sent(),a=new c.a,s=0,i=n;s<i.length;s++)i[s];return a.delete("courses",t),[4,u.a.kedBackendClient.batch(a.mutationRequests)];case 2:return r.sent(),e===u.a.currentUser.school&&Ke.delete(t),Object(o.n)(""),location.hash="#/courses/new",[2]}})})},t.prototype.save=function(){return r.b(this,void 0,void 0,function(){var e,t;return r.d(this,function(n){switch(n.label){case 0:if(this.isSaving)return[2];n.label=1;case 1:return n.trys.push([1,3,4,5]),this.isSaving=!0,[4,this._save()];case 2:return n.sent(),[3,5];case 3:return e=n.sent(),t=e&&e.message?e.message:Object(o.a)(Ye||(Ye=r.e(["Ett okänt fel har inträffat..."],["Ett okänt fel har inträffat..."]))),e&&("http409"===e.name||"http412"===e.name||"http404"===e.name?t=Object(o.a)(Ge||(Ge=r.e(["Kursen har redigerad av annan användare. Ladda om sidan och gör om ändrinarna."],["Kursen har redigerad av annan användare. Ladda om sidan och gör om ändrinarna."]))):"http403"===e.name&&(this.state.course.isTemplate?t=Object(o.a)(Je||(Je=r.e(["Ingen behörighet att spara kursmallen. Endast administratörer kan redigera kursmallar."],["Ingen behörighet att spara kursmallen. Endast administratörer kan redigera kursmallar."]))):this.state.course.school&&(t=Object(o.a)(Xe||(Xe=r.e(["Ingen behörighet att spara kursen ",". Kursen kan bara redigeras av anställda på ",""],["Ingen behörighet att spara kursen ",". Kursen kan bara redigeras av anställda på ",""])),this.state.course.name,this.state.course.school)))),Object(o.m)(t),Object(l.h)("error"),[3,5];case 4:return this.isSaving=!1,[7];case 5:return[2]}})})},t.prototype._save=function(){return r.b(this,void 0,void 0,function(){var e,t,n,a,s,i,d,m,p,h,f,v;return r.d(this,function(g){switch(g.label){case 0:return e=this.state,t=e.course,n=e.origCourse,a=e.origTemplate,s=0===He(t).length,Object(o.n)(Object(o.a)(Qe||(Qe=r.e(["Sparar..."],["Sparar..."])))),i=Object(l.l)(Date.now(),t,u.a.currentUser),d=new c.a,m=n||a,p=i.tasks.map(function(e){if("add"===e.$meta||"update"===e.$meta){var t=m.tasks.find(function(t){return t.id===e.id});return Object(l.j)(t||{},e,"tasks",{knowledgeRequirements:"knowledge-requirements",centralContent:"central-content",abilities:"abilities"},d)}var n=r.a({},e);return delete n.$meta,n}),i=Y()(i,{tasks:{$set:p}}),i=Object(l.j)(n||{},i,"courses",{templateChain:"courses",centralContent:"central-content",knowledgeRequirements:"knowledge-requirements",abilities:"abilities",images:"images",tasks:"tasks"},d),(i=r.a({},i)).publishable=s,h=(i.tags||[]).filter(function(e){return"incomplete"!==e}),i.tags=i.publishable?h:h.concat("incomplete"),n?[3,3]:(d.add("courses",i),t.school?[4,Ke.getSchoolId()]:[3,2]);case 1:f=g.sent(),d.link("schools",f,"courses",t.id,"courses"),t.active&&d.link("schools",f,"courses",t.id,"activeCourses"),g.label=2;case 2:return[3,7];case 3:return d.put("courses",i),n.active||!t.active?[3,5]:[4,Ke.getSchoolId()];case 4:return f=g.sent(),d.link("schools",f,"courses",t.id,"activeCourses"),[3,7];case 5:return!n.active||t.active?[3,7]:[4,Ke.getSchoolId()];case 6:f=g.sent(),d.unlink("schools",f,"courses",t.id,"activeCourses"),g.label=7;case 7:return[4,u.a.kedBackendClient.batch(d.mutationRequests)];case 8:return v=g.sent(),Object(o.n)(n?Object(o.a)(Ze||(Ze=r.e(["Ändringarna har sparats"],["Ändringarna har sparats"]))):Object(o.a)(et||(et=r.e(["Kursen har skapats"],["Kursen har skapats"])))),v&&v.newEtags&&(i=Object(l.b)(i,v.newEtags,["images","tasks"])),t.school===u.a.currentUser.school&&(n?Ke.update(i):Ke.insert(i)),[4,this.setNonSaveableDataState({course:i,origCourse:i,hasUnsavedData:!1})];case 9:return g.sent(),Object(l.h)(""),n||(location.hash="#/courses/"+i.id+"/edit"),[2]}})})},t.prototype.activateAndSave=function(){var e=this,t=r.a({},this.state.course);t.active||(t.active=!0,t.activatedBy={name:u.a.currentUser.displayName,url:"mailto:"+u.a.currentUser.mail},t.activatedDate=Date.now(),this.setStatePromised({course:t}).then(function(){return e.save()}).catch(ct))},t.prototype.inactivateAndSave=function(){var e=this,t=r.a({},this.state.course);t.active&&(t.active=!1,t.inactivatedBy={name:u.a.currentUser.displayName,url:"mailto:"+u.a.currentUser.mail},t.inactivatedDate=Date.now(),this.setStatePromised({course:t}).then(function(){return e.save()}).catch(ct))},t.prototype.openDialog=function(e){this.setNonSaveableDataState({dialogContainers:this.state.dialogContainers.concat(e)})},t.prototype.closeDialog=function(){var e=this.state.dialogContainers,t=e.length;for(t&&this.setNonSaveableDataState({dialogContainers:e.slice(0,t-1)});this.dialogs.length>=t;)this.dialogs.pop()},t.prototype.refDialog=function(e,t){this.dialogs[t]=e},t.prototype.onKeyDown=function(e){if(83===e.which&&(e.ctrlKey||e.metaKey)){if(e.preventDefault(),this.state.dialogContainers.length>0)return void this.saveDialog();this.save()}else if(27===e.which&&this.state.dialogContainers.length>0)this.closeDialog(),e.preventDefault();else if(13===e.which){var t=e.target;this.state.dialogContainers.length>0&&"TEXTAREA"!==t.tagName&&"INPUT"!==t.tagName&&"SELECT"!==t.tagName&&"OPTION"!==t.tagName&&!t.contentEditable&&this.saveDialog()}},t.prototype.beforeUnload=function(e){if((this.state.dialogContainers.length>0||this.state.hasUnsavedData)&&!u.a.kedBackendClient.http.bearerProvider.wantsRedirect)return e.returnValue=ut,e.returnValue},t.prototype.onClickPreventUnload=function(e){if(e.target&&"a"===(""+e.target.tagName).toLowerCase()){var t=e.target;if(t.href&&"#"!==t.getAttribute("href")&&!t.target&&(this.state.dialogContainers.length>0||this.state.hasUnsavedData)&&!confirm(ut))return e.preventDefault(),e.stopPropagation(),!1}},t.prototype.saveDialog=function(){if(this.state.dialogContainers.length>0){var e=this.dialogs[this.state.dialogContainers.length-1];e&&e.save()}},t.prototype.render=function(){var e=this,t=(u.a.currentUser.roles.indexOf("ADMIN"),this.state.course);return this.state.course?a.createElement("div",{style:{outline:0}},a.createElement(j,{title:t.name+" - "+t.points+"p",activePage:this.state.view,routes:{studentPage:Object(D.e)(this.props.viewCourseUrl,{courseId:this.props.id}),feedback:this.props.feedbackUrl},host:this,course:t,origCourse:this.state.origCourse,backgroundImage:t.images.filter(function(e){return e.id===t.imageId}).map(function(e){return e.url})[0],isTemplate:t.isTemplate}),a.createElement("div",{className:"sv-row sv-layout"},a.createElement("div",{className:"sv-layout sv-skip-spacer sv-column-12"},a.createElement("div",{className:"sv-spacer-20pxvt sv-vertical sv-layout sv-skip-spacer"},a.createElement("div",{className:"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer",ref:function(t){return e.contentDiv=t}},a.createElement(lt,{course:this.state.course,origCourse:this.state.origCourse,host:this}),a.createElement("br",null),this.state.dialogContainers.map(function(t,n){var o=t.Component,s=t.props;return a.createElement("div",{key:n},a.createElement("div",{className:"darken"}),a.createElement("div",{className:"modal-page-wrap"},a.createElement("div",{className:"modal-page"},a.createElement(o,r.a({ref:function(t){return e.refDialog(t,n)}},s)),a.createElement(Ae.a,{onClick:function(){return e.closeDialog()}}))))})))))):a.createElement("div",{style:{outline:0}},a.createElement(j,{title:"",activePage:this.state.view,routes:{feedback:this.props.feedbackUrl}}),a.createElement("p",null,a.createElement(R.a,null),"V.g. vänta medan kursen laddas..."))},t}(a.Component),pt=function(e){var t=e.courses;return a.createElement("div",null,a.createElement("h2",null,Object(o.a)(tt||(tt=r.e(["Välj kursmall att redigera: "],["Välj kursmall att redigera: "])))),a.createElement("ul",{className:"entity-list"},t.map(function(t){var n=t.id,r=t.name,o=(t.code,t.publishable),i=t.points,l=t.subjectId;return a.createElement("li",{key:n,className:(o?"complete":"incomplete")+(e.selectedCourseId===n?" selected":"")},a.createElement(s.b,{to:"/course-templates/"+l+"/"+n},r," - ",i))})))},ht=(function(e){function t(t){var n=e.call(this,t)||this;return n.state={subjects:null},n}r.c(t,e),t.prototype.componentWillMount=function(){this.load()},t.prototype.load=function(){return r.b(this,void 0,void 0,function(){var e;return r.d(this,function(t){switch(t.label){case 0:return[4,u.a.kedBackendClient.list("subjects",{include:"standardCourses"})];case 1:return e=t.sent(),this.setState({subjects:e}),[2]}})})},t.prototype.render=function(){var e=[];return this.state.subjects&&this.state.subjects.forEach(function(t){return e.push.apply(e,t.standardCourses)}),e.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),a.createElement("div",null,a.createElement(j,{title:Object(o.a)(nt||(nt=r.e(["Kursmallar"],["Kursmallar"]))),activePage:"templateBuilder",routes:{feedback:this.props.feedbackUrl}}),this.state.subjects?a.createElement(pt,{courses:e}):a.createElement("p",null,a.createElement(R.a,null),"V.g. vänta medan kurser laddas"))}}(a.Component),function(e){function t(t){var n=e.call(this,t)||this;return n.state={courseOptions:null,selectedTemplateId:"--",courses:null,selectedCourseId:""},n}return r.c(t,e),t.prototype.componentDidMount=function(){this.load().catch(o.m)},t.prototype.load=function(){return r.b(this,void 0,void 0,function(){var e,t,n;return r.d(this,function(r){switch(r.label){case 0:return Object(o.n)("Laddar kurser"),[4,u.a.kedBackendClient.list("subjects",{include:"courseTemplates"})];case 1:return e=r.sent(),t=Object(o.k)(e.map(function(e){return e.courseTemplates})).sort(Object(o.g)("name")),n=[{id:"--",name:"--"}].concat(t),Object(o.n)(""),this.setState({courseOptions:n}),[2]}})})},t.prototype.onSelectCourse=function(e){return r.b(this,void 0,void 0,function(){var t,n,a,s,i;return r.d(this,function(r){switch(r.label){case 0:return[4,u.a.kedBackendClient.list("courses",{hasEdgesTo:[e]})];case 1:return t=r.sent(),n=t.filter(function(e){return e.active}).map(function(e){var t=e.id,n=e.school,r=e.description,a=e.createdBy,s=e.modifiedBy;r&&(r=Object(o.l)(r,80));var i=r||(a?a.name+"s version":s&&s.name+"s version");return{id:t,name:"standard"===n?r?"Standard - "+r:"Standard":n+" - "+Object(o.l)(i,90),school:n}}).sort(Object(o.g)("name")),a=n.filter(function(e){return"standard"===e.school}),s=n.filter(function(e){return"standard"!==e.school}),i=a.concat([{id:e,name:"Tom"}],s),this.setState({courses:i,selectedTemplateId:e,selectedCourseId:i[0].id}),[2]}})})},t.prototype.render=function(){var e=this,t=this.state,n=t.courseOptions,i=(t.selectedTemplateId,t.courses),l=t.selectedCourseId;return a.createElement("div",{style:{outline:0}},a.createElement(j,{title:Object(o.a)(rt||(rt=r.e(["Kursbyggaren"],["Kursbyggaren"]))),activePage:"courseBuilder",routes:{feedback:this.props.feedbackUrl}}),a.createElement("div",{className:"sv-row sv-layout"},a.createElement("div",{className:"sv-layout sv-skip-spacer sv-column-12"},a.createElement("div",{className:"sv-spacer-20pxvt sv-vertical sv-layout sv-skip-spacer"},a.createElement("div",{className:"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer"},a.createElement("div",{className:"sv-row sv-layout sv-skip-spacer"},a.createElement("div",{className:"sv-layout sv-skip-spacer sv-column-7"},a.createElement("div",{className:"sv-html-portlet sv-portlet sv-skip-spacer"},a.createElement("h2",null,"Skapa ny kurs"),a.createElement("hr",null),a.createElement("div",{className:"align-horizontal spaced"},a.createElement("div",{className:"horizontalItem top"},a.createElement("p",null,"Välj gymnasiekurs :"))),a.createElement("div",{className:"align-horizontal spaced"},a.createElement("div",{className:"horizontalItem top"},n?a.createElement("select",{value:this.state.selectedTemplateId,onChange:function(t){return e.onSelectCourse(t.target.value).catch(o.m)}},n.map(function(e){return a.createElement("option",{key:e.id,value:e.id},e.name)})):a.createElement("div",null,a.createElement(R.a,null),a.createElement("select",{disabled:!0,value:""},a.createElement("option",null,"--"))))),i&&a.createElement("div",{className:"align-horizontal spaced"},a.createElement("div",{className:"horizontalItem top"},a.createElement("p",null,"Utgå från version: "))),i&&a.createElement("div",{className:"align-horizontal spaced"},a.createElement("div",{className:"horizontalItem top"},a.createElement("select",{value:l,onChange:function(t){return e.setState({selectedCourseId:t.target.value})}},i.map(function(e){return a.createElement("option",{key:e.id,value:e.id},e.name)})))),a.createElement("br",null),a.createElement("br",null),i&&l&&a.createElement(s.b,{to:"/courses/create-from-template/"+this.state.selectedCourseId,className:"btn btn-large"},"Skapa"))),a.createElement("div",{className:"sv-layout sv-column-5"},a.createElement(qe,null))))))))},t}(a.Component)),ft=3e5,vt="/4.4b4cce2a160e445593f16043.html",gt=Date.now();function bt(){gt=Date.now()}function kt(){Date.now()-gt<ft&&function(){r.b(this,void 0,void 0,function(){var e,t;return r.d(this,function(n){switch(n.label){case 0:console.log("Sending heartbeat request to "+vt),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,fetch(vt,{cache:"no-cache",credentials:"same-origin"})];case 2:return e=n.sent(),console.log("Response from "+vt+": "+e.status+" "+e.statusText),[3,4];case 3:return t=n.sent(),console.warn("Request to "+vt+" failed: "+t),[3,4];case 4:return[2]}})})}()}n.d(t,"a",function(){return yt}),setInterval(kt,ft),setTimeout(function(){return P()("body").mousemove(bt).keypress(bt).scroll(bt)},100);var Et,yt=function(e){function t(t){return e.call(this,t)||this}return r.c(t,e),t.prototype.render=function(){var e=this,t=u.a.currentUser.roles.some(function(e){return"ADMIN"===e||"EMPLOYEE"===e}),n=u.a.currentUser.roles.some(function(e){return"ADMIN"===e});return a.createElement("div",{className:"course-builder"},a.createElement(s.a,null,t?a.createElement("div",null,a.createElement(s.c,{exact:!0,path:"/",render:function(t){t.match;return n?a.createElement(U,{viewCourseUrl:e.props.viewCourseUrl,feedbackUrl:e.props.feedbackUrl}):a.createElement(ht,{feedbackUrl:e.props.feedbackUrl})}}),a.createElement(s.c,{exact:!0,path:"/schools",render:function(t){t.match;return a.createElement(U,{viewCourseUrl:e.props.viewCourseUrl,feedbackUrl:e.props.feedbackUrl})}}),a.createElement(s.c,{exact:!0,path:"/schools/new",render:function(){return a.createElement(L,{feedbackUrl:e.props.feedbackUrl})}}),a.createElement(s.c,{exact:!0,path:"/schools/:id/edit",render:function(t){var n=t.match;return a.createElement(M,{id:n.params.id,title:Object(o.a)(Et||(Et=r.e(["Editera skola"],["Editera skola"]))),feedbackUrl:e.props.feedbackUrl})}}),a.createElement(s.c,{exact:!0,path:"/subjects",render:function(){return a.createElement(z,{feedbackUrl:e.props.feedbackUrl})}}),a.createElement(s.c,{path:"/subjects/:id",render:function(t){var n=t.match;return a.createElement(_,{id:n.params.id,feedbackUrl:e.props.feedbackUrl})}}),a.createElement(s.c,{exact:!0,path:"/courses/new",render:function(){return a.createElement(ht,{feedbackUrl:e.props.feedbackUrl})}}),a.createElement(s.c,{path:"/courses/create-from-template/:templateId",render:function(t){var n=t.match;return a.createElement(mt,{templateId:n.params.templateId,view:"courseBuilder",viewCourseUrl:e.props.viewCourseUrl,feedbackUrl:e.props.feedbackUrl})}}),a.createElement(s.c,{path:"/courses/:id/edit",render:function(t){var n=t.match;return a.createElement(mt,{id:n.params.id,view:"courseBuilder",viewCourseUrl:e.props.viewCourseUrl,feedbackUrl:e.props.feedbackUrl})}})):a.createElement("div",null,a.createElement(s.c,{path:"/",render:function(){return a.createElement("div",null,a.createElement(j,{title:"Kursbyggaren",activePage:"courseBuilder",routes:{feedback:e.props.feedbackUrl}}),a.createElement("h2",null,"Behörighet saknas"),a.createElement("p",null,"Detta verktyg är endast till för anställda på Kunskapsskolan."),a.createElement("h3",null,"Användarattribut"),a.createElement("table",{className:"ked_boxed",style:{border:"1px solid #eee"}},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,"Attribut"),a.createElement("th",null,"Värde"))),a.createElement("tbody",null,Object.keys(u.a.currentUser).map(function(e){return a.createElement("tr",{key:e},a.createElement("td",null,e),a.createElement("td",null,u.a.currentUser[e]))}))))}}))),a.createElement(i.a,null))},t}(a.Component)},,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t);var r={};n.d(r,"KEDAppCourseBuilder",function(){return m});var a=n(1),o=n(21),s=(n(50),n(49),n(0)),i=n(3),l=n(69),c=n(2),u=n(13),d=i.a.bearerProvider.getBearer(),m=function(e){function t(t){var n=e.call(this,t)||this;return n.state={isTokenLoaded:!1},n}return a.c(t,e),t.prototype.componentWillMount=function(){var e=this;d.then(function(){e.setState({isTokenLoaded:!0})}).catch(function(e){Object(c.m)(e)})},t.prototype.render=function(){return this.state.isTokenLoaded?s.createElement(l.a,{viewCourseUrl:this.props.viewCourseUrl,feedbackUrl:this.props.feedbackUrl}):s.createElement("p",null,s.createElement(u.a,null),"V.g. vänta... autenticerar...")},t}(s.Component);o.a.components=a.a({},o.a.components,r)}]);
//# sourceMappingURL=kedappcoursebuilder.min.js.map