{"version":3,"sources":["webpack://[name]/webpack/bootstrap","webpack://[name]/external \"React\"","webpack://[name]/./src/utils/utils.ts","webpack://[name]/./src/globals/ked.ts","webpack://[name]/./src/globals/KED.env.ts","webpack://[name]/external \"jQuery\"","webpack://[name]/./src/globals/KED.cfg.ts","webpack://[name]/./src/utils/query-string.ts","webpack://[name]/./src/components/course-builder/utils.ts","webpack://[name]/./src/access-control/get-user-claims.ts","webpack://[name]/./src/access-control/index.ts","webpack://[name]/./src/components/course-builder/sub-components/spinner.tsx","webpack://[name]/../kedbackend/js/ked-backend-client/utils.ts","webpack://[name]/./src/utils/school-moment.ts","webpack://[name]/../kedbackend/js/ked-backend-client-web/bearer-storage-sessionstorage.ts","webpack://[name]/../kedbackend/js/ked-model-migrator/migrate-task.ts","webpack://[name]/../kedbackend/js/ked-model-migrator/migrate.ts","webpack://[name]/../kedbackend/js/ked-model-migrator/migrate-course.ts","webpack://[name]/../kedbackend/js/ked-model-migrator/index.ts","webpack://[name]/../kedbackend/js/ked-backend-client-web/index.ts","webpack://[name]/../kedbackend/js/ked-backend-client/restclient.ts","webpack://[name]/external \"ReactDOM\"","webpack://[name]/./src/globals/KED.ts","webpack://[name]/../kedbackend/js/ked-backend-client/ked-bearer-provider.ts","webpack://[name]/../kedbackend/js/ked-backend-client/access-control.ts","webpack://[name]/../kedbackend/js/ked-backend-client/http-error.ts","webpack://[name]/../kedbackend/js/ked-backend-client/index.ts","webpack://[name]/./src/apis/eds-stubdata/ActiveCourses.ts","webpack://[name]/./src/apis/eds-stubdata/LatestAssessments.ts","webpack://[name]/./src/apis/eds-stubdata/StudentGoals.ts","webpack://[name]/./src/apis/edsclient.ts","webpack://[name]/./src/components/utility-components/open-close-box.tsx","webpack://[name]/./src/components/utility-components/renameable-text.tsx","webpack://[name]/./src/utils/school-term.ts","webpack://[name]/./src/components/course-builder/sub-components/remove-item.tsx","webpack://[name]/./src/features/features.ts","webpack://[name]/./src/repos/repo.ts","webpack://[name]/./src/test/data/users.ts","webpack://[name]/./src/global-setters/set-ked-backend-client.ts","webpack://[name]/./src/global-setters/set-bearer-providers.ts","webpack://[name]/./src/utils/error-success-feedback.tsx","webpack://[name]/./src/global-setters/set-eds-client.ts","webpack://[name]/./src/test/utils/choose-user.tsx","webpack://[name]/./node_modules/moment/locale sync sv|en","webpack://[name]/./src/global-setters/set-all.ts","webpack://[name]/./src/test/configure.ts","webpack://[name]/./src/components/course-builder/courses/course-banner.tsx","webpack://[name]/./src/components/course-builder/schools/editable-school-list.tsx","webpack://[name]/./src/components/course-builder/schools/index.tsx","webpack://[name]/./src/components/course-builder/schools/edit-school.tsx","webpack://[name]/./src/components/course-builder/schools/new-school.tsx","webpack://[name]/./src/components/course-builder/subjects/uploaded-subject.tsx","webpack://[name]/./src/components/course-builder/subjects/show-subject.tsx","webpack://[name]/./src/components/course-builder/subjects/index.tsx","webpack://[name]/./src/components/course-builder/modal-pages/edit-resource.tsx","webpack://[name]/./src/components/course-builder/sub-components/editable-resource-list.tsx","webpack://[name]/./src/components/course-builder/sub-components/knowledge-matrix.tsx","webpack://[name]/./src/components/course-builder/sub-components/select-related-docs.tsx","webpack://[name]/./src/utils/cached-response.ts","webpack://[name]/./src/contracts/ked-models.ts","webpack://[name]/./src/components/utility-components/wysiwyg/wash-html.ts","webpack://[name]/./src/components/utility-components/wysiwyg/exec.ts","webpack://[name]/./src/components/utility-components/wysiwyg/actions.ts","webpack://[name]/./src/components/utility-components/wysiwyg/index.tsx","webpack://[name]/./src/components/utility-components/wysiwyg/image-edit-actions.ts","webpack://[name]/./src/components/utility-components/wysiwyg/actions-sv.ts","webpack://[name]/./src/components/course-builder/modal-pages/edit-task.tsx","webpack://[name]/./src/components/course-builder/sub-components/editable-task-list.tsx","webpack://[name]/./src/components/course-builder/courses/course-module.tsx","webpack://[name]/./src/components/course-builder/courses/course-module-list.tsx","webpack://[name]/./src/repos/school-courses.ts","webpack://[name]/./src/components/course-builder/sub-components/school-courses.tsx","webpack://[name]/./src/components/course-builder/courses/business-logic.ts","webpack://[name]/./src/components/course-builder/sub-components/editable-teacher-list.tsx","webpack://[name]/./src/components/course-builder/sub-components/weighted-items-table.tsx","webpack://[name]/./src/components/course-builder/modal-pages/edit-workflow-link.tsx","webpack://[name]/./src/components/course-builder/sub-components/editable-workflow-link.tsx","webpack://[name]/./src/components/course-builder/courses/inner-edit-course.tsx","webpack://[name]/./src/components/course-builder/courses/edit-course.tsx","webpack://[name]/./src/components/course-builder/courses/list-course-templates.tsx","webpack://[name]/./src/components/course-builder/courses/create-new.tsx","webpack://[name]/./src/components/course-builder/courses/index.tsx","webpack://[name]/./src/utils/keep-session-alive.ts","webpack://[name]/./src/components/course-builder/index.tsx","webpack://[name]/./src/test/testpage-coursebuilder.tsx"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","2","exports","module","l","m","c","d","name","getter","o","defineProperty","configurable","enumerable","get","r","value","n","__esModule","object","property","p","jsonpArray","window","oldJsonpFunction","bind","slice","React","capitalizeFirst","str","charCodeAt","substr","toLocaleUpperCase","extend","obj","extension","keys","forEach","key","clone","getOwnPropertyNames","getOwnPropertyDescriptor","concat","flatten","a","compareProp","prop","b","aProp","bProp","compareProps","props","locales","options","Array","isArray","map","localeCompare","reduce","cmp1","cmp2","L","text","args","_i","arguments","rv","buildMessage","dateTimeReviver","exec","Date","showInfo","msg","event","CustomEvent","detail","dispatchEvent","showError","errMsg","message","console","error","maxLength","maxLen","arrayToLookup","keyAccessor","item","array","arrayToMap","cherryPickProps","propsToPick","propsToPick_1","param","distinct","KED","ked","env","__webpack_exports__","jQuery","_KED__WEBPACK_IMPORTED_MODULE_0__","cfg","parseQueryString","locationSearch","toLower","split","part","decodeURIComponent","trim","_a","toLowerCase","encodeParams","params","encodeURIComponent","join","generateQueryString","splitUrlAndQuery","urlWithPossibleQuery","pQuery","indexOf","updateDocumentGraphs","oldDoc","newDoc","table","graphs","batch","docUpdates","docId","id","navProp","foreignTable","oldList","newList","tuples","doc","idx","added_1","filter","tuple","some","meta","mutatedSubDoc","tslib__WEBPACK_IMPORTED_MODULE_0__","$meta","kedbackend_client__WEBPACK_IMPORTED_MODULE_2__","add","put","link","$set","removed_1","unlink","_b","updated_1","u","react_addons_update__WEBPACK_IMPORTED_MODULE_3___default","dtFormat","dateTime","moment__WEBPACK_IMPORTED_MODULE_1___default","format","shortDateFormat","updateModificationStamp","now","user","modifiedDate","modifiedBy","displayName","url","mail","updateCreationStamp","createdDate","createdBy","updateModificationAndCreationStamps","applyEtags","newEtags","res","etag","$etag","graphs_1","label","readBlob","blob","Promise","resolve","reject","reader","FileReader","onload","ev","target","onabort","Error","onerror","readBlobAsText","readAsText","readBlobAsDataUrl","readAsDataURL","allowCopy","e","stopPropagation","preventDefault","dataTransfer","dropEffect","updateCourseBuilderStatus","status","div","jquery__WEBPACK_IMPORTED_MODULE_4___default","className","loadCourse","client","_globals_KED_env__WEBPACK_IMPORTED_MODULE_5__","kedBackendClient","includeTemplateChain","all","include","list","hasEdgesFrom","flags","sent","course","courseTasks","templateChain","tasks","knowledgeRequirementsOrder","knowledgeRequirements","find","centralContentOrder","centralContent","cc","getUserClaims","type","school","roles","role","access_control_IMPERSONATION_QUERY_PARAMS","access_control_hasAccess","requestedRight","claims","KED_env","currentUser","fromStringArray","acl","access_control_hasWriteAccess","access_control_isTeacherAtSchool","isTeacher","belongsToSchool","access_control_impersonationEnv","actAs","currentQuery","query_string","location","search","newQuery","tslib_es6","newQueryString","href","hash","access_control_actAs","access_control_preserveImpersonationQuery","query","IMPERSONATION_QUERY_PARAMS_1","Spinner","react__WEBPACK_IMPORTED_MODULE_0__","aria-hidden","createUUID","replace","Math","random","floor","toString","avoidSimultanousCalls","method","ongoingPromise","this","then","getFirstAndLastWeekOfTerm","term","getTermStartAndEnd","month","moment__WEBPACK_IMPORTED_MODULE_0___default","year","getSchoolMoment","thisYear","isAutumn","academicYear","week","addYear","aYear","numYearsToAdd","yearStr","parseInt","BearerStorageSessionStorage","save","tokenInfo","sessionStorage","setItem","JSON","stringify","load","json","getItem","parse","token","expires","ex","migrateTask","task","resources","migrate_migrate","taskIds","responsibleTeachers","resourses","migrate_course_migrateCourse","__migrator_mixed_in","ked_model_migrator_KedModelMigratorMixin","ked_backend_client","ked_backend_client_web_storage","ked_backend_client_web_timeOfPageLoad","ked_backend_client_web_WebServerBearerProvider","WebServerBearerProvider","tokenPath","tokenResponseMapper","tokenId","getBearer","utils","refreshBearer","fetch","headers","Accept","redirect","cache","credentials","_e","wantsRedirect","log","reload","_c","_d","ked_backend_client_web_isomorphic","self","btoa","ked_backend_client_web_KedBackendClientWeb","_super","KedBackendClientWeb","apiBaseUrl","providerOrTokenPath","bearerProvider","x","ked_backend_client_web_extends","_utils__WEBPACK_IMPORTED_MODULE_0__","RestClient","isomorphic","baseUrl","fetchOptions","mode","authHeader","bearer","username","password","path","__assign","nocache","queryStr","Authorization","wwwauth","test","post","Content-Type","body","delete","ReactDOM","ked_bearer_provider_KedBearerProvider","KedBearerProvider","storage","clientId","clientSecret","tokenUrl","tokenQuery","restclient","retries","warn","statusText","DocumentAccess","accessClaimType","accessClaimValue","right","fromString","ac","claimType","unescape","claimValue","escape","accessComponent","toStringArray","hasAccess","userClaims","claim","HttpError","code","_this","__extends","ked_backend_client_KedBackendClient","KedBackendClient","http","getMyClaims","reqs","sort","req1","req2","op","do","scopeFn","runner","ked_backend_client_BatchRunner","mutationRequests","deleteRealm","realm","share","unshare","sourceTable","sourceId","targetTable","targetId","link2","unlink2","BatchRunner","ked_backend_client_assign","courses","courseId","periodName","periodGoalGrade","shortName","courseSteps","stepId","isCompleted","completedDate","assessments","publishDateTime","gradeName","courseUnitName","studyPlans","StudyPlans","finalGoalGrade","strategyText","periodGoals","edsclient_privatizingCacheBust","edsclient_EdsClient","EdsClient","getActiveCourses","edsclient_avoidSimultanousCalls","getLatestAssessments","getStudentGoals","getStudentFutureAbilities","q","courseCode","CourseCode","PeriodName","ex_1","edsclient_templateObject_1","limit","isNaN","Count","studentGoals","studentFutureAbilities","edsclient_EDSPeriod","EDSPeriod","periodStringOrSchoolTerm","period","startsWith","schoolTerm","school_term","valueOf","StubEdsClient","ongoingPromises","argsJson","react__WEBPACK_IMPORTED_MODULE_1__","OpenCloseBox","state","headerOpen","componentWillReceiveProps","nextProps","setState","render","title","children","headerClassName","contentClassName","onClick","onOpenClose","RenameableText","editMode","runtimeStyle","readOnly","tabIndex","onFocus","rename","style","width","ref","display","clickAdvertiseText","tag","input","maxChars","jquery__WEBPACK_IMPORTED_MODULE_2___default","select","onBlur","onKeyDown","onChange","placeholder","undefined","keyCode","blur","propagateOnChange","newValue","propagatedOnChange","eager","txt","textAlign","css","fontSize","paddingTop","paddingBottom","paddingLeft","paddingRight","marginTop","marginBottom","marginLeft","marginRight","borderRadius","backgroundColor","lineHeight","fontWeight","outLine","borderStyle","height","boxSizing","focus","SchoolTerm","dateOrSchoolMoment","schoolMoment","_school_moment__WEBPACK_IMPORTED_MODULE_1__","nextTerm","prevTerm","toLocaleString","shortYear","locales_1","RemoveItem","_utils_utils__WEBPACK_IMPORTED_MODULE_2__","templateObject_1","features_Features","features","feature","EditUserTasksViaPenOnly","schoolType","schooltype","SubTasks","AssignmentTasks","testversion","Repo","comm","listPromise","items","subscribers","subscribe","subscriber","ensureHasData","unsubscribe","notifySubscribers","refreshFromServer","update","it","assign","insert","ids","users","schoolGrade","_globals_KED_env__WEBPACK_IMPORTED_MODULE_0__","kedbackend_clientweb__WEBPACK_IMPORTED_MODULE_2__","_globals_KED_cfg__WEBPACK_IMPORTED_MODULE_1__","KED_API_URL","getMergedTokenPath","scopes","_utils_query_string__WEBPACK_IMPORTED_MODULE_1__","impersonationProps","_utils_utils__WEBPACK_IMPORTED_MODULE_7__","_access_control_index__WEBPACK_IMPORTED_MODULE_6__","tokenPathWithoutQuery","tokenQueryString","tokenPathQuery","getTokenId","mergedTokenPath","userEmail","createTestTokenProvider","kedbackend_client__WEBPACK_IMPORTED_MODULE_3__","_globals_KED_cfg__WEBPACK_IMPORTED_MODULE_4__","KED_CLIENT_ID","KED_CLIENT_SECRET","email","storedSessionUser","initialUserEmail","KED_TOKEN_PATH","responseText","ok","saveUserInfo","createBearerProvider","googleMergedPath","googleTokenProvider","createGoogleTokenProvider","KED_TOKEN_URL","ErrorSuccessFeedback","info","_unhandledRejection","_error","_customError","_onInfo","componentDidMount","addEventListener","componentWillUnmount","removeEventListener","reason","_utils__WEBPACK_IMPORTED_MODULE_2__","setTimeout","templateObject_2","position","left","top","pointerEvents","margin","edsClient","_apis_edsclient__WEBPACK_IMPORTED_MODULE_3__","EDS_API_URL","ChooseUser","_data_users__WEBPACK_IMPORTED_MODULE_1__","fontStyle","./en-au","./en-au.js","./en-ca","./en-ca.js","./en-gb","./en-gb.js","./en-ie","./en-ie.js","./en-nz","./en-nz.js","./sv","./sv.js","webpackContext","req","webpackContextResolve","_globals_KED_cfg__WEBPACK_IMPORTED_MODULE_0__","ENVIRONMENT","_utils_query_string__WEBPACK_IMPORTED_MODULE_3__","_data_users__WEBPACK_IMPORTED_MODULE_2__","_globals_KED_env__WEBPACK_IMPORTED_MODULE_1__","course_banner_AdminMenuItems","course_banner_templateObject_1","route","course_banner_templateObject_2","course_banner_NonAdminMenuItems","course_banner_templateObject_3","course_banner_templateObject_4","external_React_","course_banner_setCourseImage","origCourse","host","imageId","images","course_banner_CourseBanner","isTemplate","backgroundImage","activePage","isAdmin","menuItems","onDragOver","course_builder_utils","onDrop","files","from","file","size","course_banner_templateObject_5","match","getAsString","course_banner_templateObject_6","course_banner_onDropImage","isActive","callback","callbacks","givenRoute","routes","defaultRoute","es","to","editable_school_list_EditableSchoolList","schools","viewCourseUrl","cursor","access_control","spinner","schools_Schools","Schools","catch","err","outline","feedback","feedbackUrl","edit_school_EditSchool","EditSchool","origSchool","deleteSchool","confirm","edit_school_templateObject_1","editExisting","autoFocus","disabled","edit_school_templateObject_2","new_school_NewSchool","uploaded_subject_UploadedSubject","UploadedSubject","coursesElems","centralContentElems","knowledgeRequirementElems","showFullText","changes","isWorking","isImporting","addClassesForCherryPickedElements","diffWithExisting","abilities","external_jQuery_default","purposeElem","first","parent","addClass","centralContents","cherryPickData","skolSubject","html","elem","points","gradeStep","ct","createTime","subjectToImport","existingSubjects","existingSubject","courseTemplates","expandedCourseTemplates","courseTemplate","xmlCourse","xmlKR","kr","derivedCourses","subjectCode","change","content","description","mutations","derivedCourses_1","expandedCourseTemplates_1","newSubject_1","publishable","subjectAbilities","newAbility","newCourse","tags","subjectId","newCentralContent","cr","newKnowledgeRequirement","subjectAbilities_1","cancel","onCancel","import","allMutations","mut","onImportSuccess","fixL","uploaded_subject_templateObject_1","colSpan","dangerouslySetInnerHTML","__html","uploaded_subject_templateObject_2","uploaded_subject_templateObject_3","purpose","knownledgeRequirements","show_subject_ShowSubject","ShowSubject","subject","componentWillMount","subjects_Subjects","Subjects","isListingSubjects","subjects","uploadedSubject","handleFileSelect","xml","parseXML","model","subjects_templateObject_1","subjects_templateObject_2","subjects_templateObject_3","edit_resource_EditResource","EditResource","resource","valid_url_default","isUri","edit_resource_templateObject_1","onSave","onDelete","isValidUrl","editable_resource_list_EditableResourceList","EditableResourceList","onUpdate","openDialog","Component","editedResource","updatedResource","$splice","closeDialog","newResource","$push","knowledge_matrix_KnowledgeMatrix","KnowledgeMatrix","markedIds","idsToMarkNotOk","markMode","onMarkChanged","columns","rows","row","grade","pNext","findIndex","toUpperCase","every","requirement","isMarkedOK","isMarkedNotOK","select_related_docs_SelectRelatedDocs","SelectRelatedDocs","open_close_box","option","isMarked","CachedResponse","queryer","promise","reset","futureAbilities","parser","DOMParser","HTML_WASH_POLICY","strike","pre","h1","h2","h3","h4","h5","img","src","class","tabindex","ul","ol","li","hr","br","span","border","tbody","thead","tfoot","tr","td","colspan","rowspan","th","abbr","scope","sorted","washHtml","parseFromString","childNodes","modified","washNode","innerHTML","node","tagName","isElement","element","policy","washChildNodes","parentNode","insertBefore","remove","removeMiddleElement","attributes","attr","allowed","removeAttribute","washElement","command","document","execCommand","actions","bold","icon","italic","underline","strikethrough","heading1","heading2","heading3","paragraph","quote","olist","ulist","line","prompt","image","wysiwyg_classes","wysiwyg_Wysiwyg","Wysiwyg","focusRect","onMouseDown","onMouseMove","onMouseUp","contentDiv","querySelectorAll","onfocus","onblur","componentDidUpdate","shouldComponentUpdate","nextState","triggerOnChange","newState","wysiwyg_getRelatativeClientRect","parentElement","focusElem","relatedTarget","focusRectDiv","makeClickable","corner","getRectCorner","resizeStartX","clientX","getBoundingClientRect","newWidth","max","endsWith","factor","newHeight","execImageEditAction","cmd","cssFloat","cb","defaultActions","actionsToUse","action","contentEditable","onInput","which","removeChild","bottom","child","parentRect","childRect","scrollTop","scrollLeft","actions_sv","component","sel","range","createElement","getSelection","rangeCount","getRangeAt","collapse","insertNode","setStartAfter","removeAllRanges","addRange","edit_task_EditTask","EditTask","src_features","writeAccess","edit_task_templateObject_1","edit_task_templateObject_2","searchMode","edit_task_templateObject_3","edit_task_templateObject_4","futureAbilitiesOpen","taskCustomization","searchMarkedIds","searchResult","isSearching","searchResponse","setStatePromised","updateSearchResult","err_1","updateSearchMarkedIds","setStatePromise","previewTaskContent","allTasksForSubject","t","ability","knowledgeRequirement","collectionProp","updatedCollection","updatedTask","edit_task_templateObject_5","edit_task_templateObject_6","onReplace","edit_task_templateObject_7","onSaveCustomization","copyTask","taskCopy","edit_task_templateObject_8","getTaskProp","taskProp","customization","updateTaskOrCustomization","updates","newCustomization","react_addons_update_default","newTask","idsNotCoveredByAnyTask","fa","selected","foundTask","external_ReactDOM_","react_datepicker_es","moment_default","dateFormat","locale","popperPlacement","learningGoal","resourceUpdates","editable_task_list_EditableTaskList","EditableTaskList","openTaskDialog","taskCustomizations","onTaskUpdated","onTaskAdded","onTaskCustomizationUpdated","onTaskDeleted","onTaskReplaced","taskId","canUpdateTask","choosenTask","course_module_CourseModuleComponent","CourseModuleComponent","editMandatoryContent","getModuleIndex","getModuleOrderIndex","getOrderedModules","updateModule","moduleUpdates","updatedModule","moduleIndex","courseUpdates","customizations","course_module_templateObject_1","taskIndex","onTaskCustomized","tid","$apply","copy","idxTask","course_module_templateObject_2","moduleOrderedIndex","startWeekOptions","endWeekOptions","renameable_text","newName","startWeek","endWeek","mandatoryContent","resourcesUpdates","onReorder","remove_item","course_module_templateObject_3","course_module_list_CourseModuleList","CourseModuleList","_moduleRefs","addModule","moduleOrder","reorder","direction","orderedModules","newModuleIndex","currentModuleAtPosition","origScrollPos","documentElement","elemModule","scrollTo","scrollIntoView","behavior","block","_elem","school_courses_mySchoolCoursesRepo","SchoolCoursesRepo","getSchoolName","schoolName","_schoolId","school_courses_templateObject_1","getSchoolId","school_courses_SchoolCourses","SchoolCourses","schoolCourses","onSchoolCoursesUpdated","compareName","compareCreatedDate","active","scroll","business_logic_getUncoveredKnowledgeRequirements","uncoveredRequirements","editable_teacher_list_EditableTeacherList","EditableTeacherList","addEmtpyRow","teachers","teacher","nameElem","shiftKey","weighted_items_table_WeightedItemsTable","WeightedItemsTable","isOpen","tasksPerId","business_logic_getTasksPerId","futureAbilityText","edit_workflow_link_EditWorkflowLink","EditWorkflowLink","edit_workflow_link_templateObject_1","editable_workflow_link_EditableWorkFlowLink","EditableWorkFlowLink","newUrl","inner_edit_course_InnerEditCourse","InnerEditCourse","changeImageUrl","setImageUrl","imageUrl","uncoveredKnowledgeRequirements","uncoveredIds","business_logic_getIdsNotCoveredByTasks","sanityCheckWarnings","business_logic_templateObject_1","hasDuplicateTasks","taskUrls","business_logic_templateObject_2","tasksWithSameUrl","business_logic_templateObject_3","hasEmptyModuleNames","moduleNames","business_logic_templateObject_4","hasDuplicateModuleNames","business_logic_sanityCheck","courseImage","courseImageIsUploaded","runUpText","newHtml","workFlowLink","googleClassRoomURL","googleClassRoomCode","teachersUpdate","assignmentEmails","activatedDate","activatedBy","inactivatedBy","inactivatedDate","warning","inner_edit_course_templateObject_1","deleteCourse","history","go","inactivateAndSave","activateAndSave","edit_course_catcher","edit_course_CONFIRM_NAVIGATE_MESSAGE","edit_course_templateObject_1","edit_course_DEFAULT_STATE","origTemplate","dialogContainers","hasUnsavedData","view","edit_course_EditCourse","EditCourse","refDialog","contentYPos","beforeUnload","onClickPreventUnload","isSaving","dialogs","_setState","setNonSaveableDataState","usedTaskIds_1","filteredCourseTasks","modifiedCourse","allCourses","idxOurCourse","templateId","prevProps","prevState","loadFromTemplate","template","parentId","mySchool","loadExistingCourse","edit_course_templateObject_2","courseSchool","hasEdgesTo","children_1","_save","errorMessage","edit_course_templateObject_3","edit_course_templateObject_4","edit_course_templateObject_5","edit_course_templateObject_6","doesAllTasksCoverAllRequirements","edit_course_templateObject_7","orig","newCourseTasks","origTask","schoolId","edit_course_templateObject_8","edit_course_templateObject_9","dialogContainer","pop","dialog","index","ctrlKey","metaKey","saveDialog","targetElem","returnValue","getAttribute","studentPage","list_course_templates_ListCourseTemplates","list_course_templates_templateObject_1","selectedCourseId","create_new_CreateNewCourse","Courses","standardCourses","c1","c2","courses_templateObject_1","CreateNewCourse","courseOptions","selectedTemplateId","onSelectCourse","descriptionOrAuthor","kedStandardOptions","teacherMade","create_new_templateObject_1","keep_session_alive_HEARTBEAT_INTERVAL","keep_session_alive_HEARTBEAT_URL","keep_session_alive_lastActivity","keep_session_alive_onUserActive","keep_session_alive_onTimeout","keep_session_alive_heartbeat","setInterval","mousemove","keypress","course_builder_CourseBuilder","CourseBuilder","isAuthorized","exact","course_builder_templateObject_1","error_success_feedback","App","_globals_KED_env__WEBPACK_IMPORTED_MODULE_3__","react__WEBPACK_IMPORTED_MODULE_4__","_components_course_builder__WEBPACK_IMPORTED_MODULE_5__","_utils_choose_user__WEBPACK_IMPORTED_MODULE_6__"],"mappings":"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","file":"testpagecoursebuilder.min.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \tvar installedChunks = {\n \t\t2: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp_name_\"] = window[\"webpackJsonp_name_\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([89,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","module.exports = React;","\nexport function capitalizeFirst (str) {\n    for (let i=0, l=str.length; i<l; ++i) {\n        if (str.charCodeAt(i) < 0x2000) {\n            return str.substr(0, i) + str[i].toLocaleUpperCase() + str.substr(i + 1);\n        }\n    }\n    return str;\n}\n\nexport function extend(obj, extension) {\n    if (typeof extension !== 'object') return obj;\n    Object.keys(extension).forEach(key => {\n        obj[key] = extension[key];\n    });\n    return obj;\n}\n\nexport function clone<T,E> (obj : T, extension?: E) {\n    let clone = {};\n    Object.getOwnPropertyNames(obj).forEach(key => {\n        Object.defineProperty(clone, key, Object.getOwnPropertyDescriptor(obj, key));\n    });\n    if (extension) extend(clone, extension);\n    return clone as (T & E);\n}\n\nconst concat = [].concat;\nexport function flatten<T> (a : (T | T[])[]) {\n    return concat.apply([], a) as T[];\n}\n\nexport function compareProp(prop:string) {\n    return (a,b) => {\n        const aProp = a[prop], bProp = b[prop];\n        return aProp > bProp ? 1 : aProp < bProp ? -1 : 0;\n    }\n}\n\nexport function compareProps(props: string | string[], locales?: string | string[], options?: Intl.CollatorOptions) {\n    props = Array.isArray(props) ? props : [props];\n\n    const localeCompare = (a,b) =>\n        typeof a === 'string' ?\n            a.localeCompare(b, locales, options) :\n            a < b ? -1 : a > b ? 1 : 0;\n\n    return props\n        .map(prop => (a,b) => localeCompare(a[prop], b[prop]))\n        .reduce((cmp1, cmp2) =>\n            (a,b) => cmp1(a,b) || cmp2(a,b));\n}\n\nexport function L(text, ...args) {\n    let first = text[0];\n    return buildMessage(text, args);\n}\n\nfunction buildMessage (text, args) {\n    let rv = text[0];\n    for (let i=1, l=text.length; i<l; ++i) {\n        rv += args[i-1] + text[i];\n    }\n    return rv;\n}\n\nexport class TC<T> {\n    constructor(template: T) {\n        extend(this, template);\n    }\n}\n\nexport function dateTimeReviver (key, value) {\n    var a;\n    if (typeof value === 'string') {\n        a = /\\/Date\\((\\d*)\\)\\//.exec(value);\n        if (a) {\n            return new Date(+a[1]);\n        }\n    }\n    return value;\n}\n\nexport function showInfo (msg) {\n    var event = new CustomEvent('info', { 'detail': msg });\n    window.dispatchEvent(event);\n}\n\nexport function showError (errMsg: string | Error) {\n    const msg = typeof errMsg === 'string' ? errMsg : errMsg.message;\n    var event = new CustomEvent('customerror', { 'detail': msg });\n    console.error(errMsg);\n    window.dispatchEvent(event);\n}\n\nexport function maxLength(str: string, maxLen: number) {\n    return str.length > maxLen ?\n        str.substr(0, maxLen - 3) + \"...\" :\n        str;\n}\n\nexport function arrayToLookup<T>(a: T[], keyAccessor: (item: T) => string | number) {\n    const result : {[key: string] : T[]} = {};\n    for (let i=0, l=a.length; i<l; ++i) {\n        const item = a[i];\n        const key = keyAccessor(item);\n        let array = result[key];\n        if (array) array.push(item);\n        else result[key] = [item];\n    }\n    return result;\n}\n\nexport function arrayToMap<T>(a: T[], keyAccessor: (item: T) => string | number) {\n    const result : {[key: string] : T} = {};\n    for (let i=0, l=a.length; i<l; ++i) {\n        const item = a[i];\n        const key = keyAccessor(item);\n        result[key] = item;\n    }\n    return result;\n}\n\nexport function cherryPickProps<T> (obj: T, propsToPick: string[]): Partial<T> {\n    const result = {};\n    for (const param of propsToPick) {\n      if (param in obj) result[param] = obj[param];\n    }\n    return result as Partial<T>;\n}\n\nexport function distinct<T> (a: T[], keyAccessor: (item: T) => any) {\n    const map = arrayToMap(a, keyAccessor);\n    return Object.keys(map).map(key => map[key]);\n}\n","\nexport const KED_NAMESPACE = \"KED\";\n\ndeclare var KED: any;\n\nvar result = typeof KED === 'undefined' ? {} : KED;\n\nif (typeof window !== 'undefined' && typeof KED === 'undefined') {\n    window[KED_NAMESPACE] = result;\n}\n\nexport default result;\n","import {User, LearningModuleTasks} from '../contracts/ked-models';\nimport { KedBackendClient, BearerProvider } from 'kedbackend/client';\nimport {UserTask} from 'kedbackend/models';\nimport {KedRepo} from '../repos/ked-repo';\nimport {EdsClient} from '../apis/edsclient';\nimport KED from './ked';\n\nexport interface Env {\n    currentUser?: User;\n    learningModuleTasks?: LearningModuleTasks;\n    bearerProvider?: BearerProvider;\n    googleTokenProvider?: BearerProvider;\n    kedBackendClient?: KedBackendClient;\n    edsClient?: EdsClient;\n    userTasksRepo?;\n    hiddenCoursesRepo?;\n}\n\nif (!KED.env) KED.env = {};\n\nexport default KED.env as Env;\n","module.exports = jQuery;","import KED from './KED';\n\n/* This default configuration is used as a fallback.\nNormally both test pages and production pages will override these configrations\n*/\n/*const defaultConfiguration = {\n  // Environment\n  ENVIRONMENT: 'development' as 'production' | 'development' | 'test',\n  // Authentication Server:\n  KED_TOKEN_URL: 'https://kedauthtest.azurewebsites.net/token',\n  KED_TOKEN_PATH: '/api/token.Skript.portlet?sv.contenttype=application/json',\n  KED_CLIENT_ID: 'devclient',\n  KED_CLIENT_SECRET: '4fRdfQpWtJqjTWf',\n  // Services:\n  KED_API_URL: 'https://kedbackendtest.azurewebsites.net/api/',  \n  EDS_API_URL: 'https://edsportalowinapi.azurewebsites.net/api/'\n}*/\n\nexport interface IKedConfiguration {\n  ENVIRONMENT: 'production' | 'development' | 'test';\n  KED_TOKEN_URL: string;\n  KED_TOKEN_PATH: string;\n  KED_CLIENT_ID: string;\n  KED_CLIENT_SECRET: string;\n  KED_API_URL: string;\n  EDS_API_URL: string;\n};\n\nif (!KED.cfg) KED.cfg = {};\n\nexport default KED.cfg as IKedConfiguration;\n","export interface ParseQueryStringOptions {\n  toLower?: boolean;\n}\n\nexport function parseQueryString(locationSearch: string, options?: ParseQueryStringOptions): { [key: string]: string } {\n  const {toLower} = (options || {}) as ParseQueryStringOptions;\n  const result = {};\n  if (locationSearch && locationSearch.length > 1)\n    locationSearch.substr(1)\n      .split('&')\n      .map(part => part.split('=').map(s => decodeURIComponent(s.trim())))\n      .forEach(([key, value]) => result[toLower ? key.toLowerCase() : key] = value);\n  return result;\n}\n\nfunction encodeParams(params: {[key: string]:string}) {\n  return Object.keys(params).map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`).join('&');\n}\n\nexport function generateQueryString(params: {[key: string]:string}) {\n  return \"?\" + encodeParams(params);\n}\n\nexport function parseHashQueryString(locationHash: string, options?: ParseQueryStringOptions) {\n  return parseQueryString(locationHash, options);\n}\n\nexport function generateHashQueryString(params: {[key: string]:string}) {\n  return \"#\" + encodeParams(params);\n}\n\nexport function splitUrlAndQuery (urlWithPossibleQuery: string) {\n  const pQuery = urlWithPossibleQuery.indexOf('?');\n  return pQuery >= 0 ?\n    [urlWithPossibleQuery.substr(0, pQuery), urlWithPossibleQuery.substr(pQuery)] :\n    [urlWithPossibleQuery, \"\"];\n}\n","import moment from 'moment';\nimport { L } from '../../utils/utils';\nimport { Document, Resource, ModificationTracked, Course, Task } from 'kedbackend/models';\nimport { BatchRunner, createUUID } from 'kedbackend/client';\nimport update from 'react-addons-update';\nimport { User } from '../../contracts/ked-models';\nimport $ from 'jquery';\nimport env from '../../globals/KED.env';\n\nexport function updateDocumentGraphs(oldDoc, newDoc, table: string, graphs: { [label: string]: string }, batch: BatchRunner) {\n  const docUpdates = {};\n  const docId = newDoc.id;\n  for (let navProp of Object.keys(graphs)) {\n    const foreignTable = graphs[navProp];\n    const oldList: Document[] = oldDoc[navProp] || [];\n    const newList: Document[] = newDoc[navProp];\n    if (!newList) continue;\n    const tuples = newList\n      .map((doc, idx)=>({doc, idx})); // Create tubles of {doc, array-index} so we can update result\n    const added = tuples.filter(tuple => !oldList.some(o => o.id === tuple.doc.id)); // Find added items\n\n    for (let a of added) {\n      const mutatedSubDoc = {...a.doc};\n      const meta = mutatedSubDoc.$meta;\n      delete mutatedSubDoc.$meta; // Delete $meta so that \"add\" or \"update\" does not persiste to next state.\n      if (meta === 'add') {\n        if (!mutatedSubDoc.id) mutatedSubDoc.id = createUUID(); // Generate ID if not done yet.\n        // Now put an 'add' mutation in the batch queue.\n        batch.add(foreignTable, mutatedSubDoc);\n      } else if (meta === 'update') {\n        batch.put(foreignTable, mutatedSubDoc);\n      }\n      batch.link(table, docId, foreignTable, mutatedSubDoc.id, navProp);\n\n      // Update result so that state is reflected after succesful POST to server.\n      if (!docUpdates[navProp]) docUpdates[navProp] = {};\n      docUpdates[navProp][a.idx] = {$set: mutatedSubDoc};\n    }\n    const removed = oldList.filter(o => !newList.some(n => n.id === o.id));\n    for (let r of removed) {\n      batch.unlink(table, docId, foreignTable, r.id, navProp);\n    }\n    const updated = tuples.filter(tuple => oldList.some(o => o.id === tuple.doc.id && tuple.doc.$meta === 'update'));\n    for (let u of updated) {\n      const mutatedSubDoc = {...u.doc};\n      delete mutatedSubDoc.$meta;\n      batch.put(foreignTable, mutatedSubDoc);\n\n      // Update result so that $meta is removed from navigation prop after successful POST to server.\n      if (!docUpdates[navProp]) docUpdates[navProp] = {};\n      docUpdates[navProp][u.idx] = {$set: mutatedSubDoc};\n    }\n  }\n  return update(newDoc, docUpdates);\n}\n\nexport function dtFormat(dateTime: number | Date | moment.Moment) {\n  return moment(dateTime).format('YYMMDD HH:mm');\n}\n\nexport function shortDateFormat(dateTime: number | Date | moment.Moment) {\n  return moment(dateTime).format('YYMMDD');\n}\n\nexport function updateModificationStamp (now: number, obj: ModificationTracked, user: User) {\n  return update(obj, {\n    dateTime: {$set: now}, // For queries...\n    modifiedDate: {$set: now},\n    modifiedBy: {\n      $set: {\n        name: user.displayName,\n        url: \"mailto:\" + user.mail\n      }\n    }\n  });\n}\n\nexport function updateCreationStamp (now: number, obj: ModificationTracked, user: User) {\n  return update(obj, {\n    createdDate: {$set: Date.now()},\n    createdBy: {\n      $set: {\n        name: user.displayName,\n        url: \"mailto:\" + user.mail\n      }\n    }\n  });\n}\n\nexport function updateModificationAndCreationStamps(obj: ModificationTracked, user: User) {\n  const now = Date.now();\n  obj = updateModificationStamp(now, obj, user);\n  if (!obj.createdBy) obj = updateCreationStamp(now, obj, user);\n  return obj;\n}\n\nexport function applyEtags(doc: Document, newEtags: {[id: string]: string}, graphs: string[]) {\n  const res = {...doc};\n  const etag = newEtags[doc.id];\n  if (etag)\n    res.$etag = etag;\n  for (let label of graphs) {\n    const newList = doc[label].map(d => applyEtags(d, newEtags, []));\n    res[label] = newList;\n  }\n  return res;\n}\n\nexport function readBlob(blob: Blob, m: (r:FileReader)=>void) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = ev => resolve((ev.target as any).result);\n    reader.onabort = ev => reject(new Error(\"file read aborted\"));\n    reader.onerror = ev => reject((ev.target as any).error);\n    m(reader);\n  });\n}\n\nexport function readBlobAsText (blob: Blob) {\n  return readBlob(blob, r=>r.readAsText(blob));\n}\n\nexport function readBlobAsDataUrl (blob: Blob) {\n  return readBlob(blob, r=>r.readAsDataURL(blob));\n}\n\nexport function allowCopy(e: React.DragEvent<HTMLDivElement>) {\n  e.stopPropagation();\n  e.preventDefault();\n  e.dataTransfer.dropEffect = 'copy';\n}\n\nexport function updateCourseBuilderStatus(status: 'unsaved' | 'saved' | 'error' | '') {\n  const div = $('div.course-builder')[0];\n  if (div) div.className = \"course-builder\" + (status ? \" status \" + status : \"\");\n}\n\nexport async function loadCourse(id: string, options?: {\n    includeTemplateChain?: boolean\n  }): Promise<Course>\n{\n  const client = env.kedBackendClient;\n  const includeTemplateChain = options && options.includeTemplateChain;\n  const [course, courseTasks, templateChain] = (await Promise.all([\n    client.get(\"courses\", id, {\n      include: [\n        \"centralContent\",\n        \"knowledgeRequirements\",\n        \"abilities\",\n        \"images\",\n        \"acl\" // Don't include tasks here...\n      ]\n    }),\n    // ... but include tasks here instead so that we can load the graphs for the\n    // tasks as well!\n    client.list(\"tasks\", {\n      hasEdgesFrom: id,\n      include: ['knowledgeRequirements', 'centralContent', 'abilities', 'acl'],\n      flags: ['includeIdsOnly'] // Don't need redundant info that's already on course\n    }),\n    includeTemplateChain && client.list(\"courses\", {\n      hasEdgesFrom: id,\n      flags: ['idsOnly']\n    })\n  ])) as [Course, Task[], Course[]];\n  course.tasks = courseTasks;\n\n  // Correct the order of KnowledgeRequirements\n  if (course.knowledgeRequirementsOrder) {\n    course.knowledgeRequirements = course.knowledgeRequirementsOrder.map(id =>\n      course.knowledgeRequirements.find(c => c.id === id));\n  }\n\n  // Correct the order of CentralContent\n  if (course.centralContentOrder) {\n    course.centralContent = course.centralContentOrder.map(id =>\n      course.centralContent.find(cc => cc.id === id));\n  }\n  \n  // Include template chain if requested.\n  if (includeTemplateChain) course.templateChain = templateChain;\n  return course;\n}\n\n","import { User } from \"../contracts/ked-models\";\n\nexport default function getUserClaims (user: User) {\n  return [{\n    type: \"email\",\n    value: user.mail\n  },{\n    type: \"school\",\n    value: user.school\n  }].concat(user.roles.map(role => ({\n    type: \"role\",\n    value: role\n  }))).concat(user.roles.map(role => ({\n    type: \"schoolRole\",\n    value: user.school + \"/\" + role\n  })));\n}\n","import { AccessClaim, DocumentAccess, hasAccess as _hasAccess, AccessRight } from 'kedbackend/client';\nimport { Document } from 'kedbackend/models';\nimport getUserClaims from './get-user-claims';\nimport env from '../globals/KED.env';\nimport { parseQueryString, generateQueryString } from \"../utils/query-string\";\nexport { getUserClaims };\n\nexport const IMPERSONATION_QUERY_PARAMS = [\"user\",\"role\",\"school\",\"debug\",\"testVersion\",\"testversion\",\"schoolType\",\"schooltype\"];\n\nexport function hasAccess(doc: Document, requestedRight: AccessRight) {\n  var claims = getUserClaims(env.currentUser);\n  var result = _hasAccess(DocumentAccess.fromStringArray(doc.acl || []), claims, requestedRight);\n  //console.log(`Has ${requestedRight} access to ${doc.name}/${doc.id}: ${result}`);\n  return result;\n}\n\nexport function hasReadAccess(doc: Document) {\n  return hasAccess(doc, 'R');\n}\n\nexport function hasWriteAccess(doc: Document) {\n  return hasAccess(doc, 'W');\n}\n\nexport function hasShareAccess(doc: Document) {\n  return hasAccess(doc, 'S');\n}\n\nexport function isTeacherAtSchool(school: string) {\n  const isTeacher = env.currentUser.roles.some(role => role === 'EMPLOYEE' || role === 'ADMIN');\n  const belongsToSchool = (school||\"\").toLowerCase() === env.currentUser.school.toLowerCase();\n  return (isTeacher && belongsToSchool);\n}\n\nexport const impersonationEnv = {\n  actAs (options: {role, school, url?}) {\n    const {role, school, url} = options;\n    const currentQuery = parseQueryString(location.search);\n    const newQuery = {...currentQuery, role, school};\n    const newQueryString = generateQueryString(newQuery);\n    if (url) {\n      location.href = `${url}${newQueryString}`;\n    } else {\n      location.hash = \"#\";\n      location.search = newQueryString;\n    }\n  }\n}\n\nexport function actAs(options: {role, school, url?}) {\n  impersonationEnv.actAs(options);\n}\n\nexport function preserveImpersonationQuery (url: string, query: {[name: string] : string}) {\n  const currentQuery = parseQueryString(location.search);\n  const newQuery = {...query};\n  for (const param of IMPERSONATION_QUERY_PARAMS) {\n    if (currentQuery[param]) newQuery[param] = currentQuery[param];\n  }\n  const newQueryString = generateQueryString(newQuery);\n  return `${url}${newQueryString}`;\n}\n","import * as React from 'react';\n\nexport const Spinner = ()=> <span><i className=\"fa fa-spinner fa-spin\" aria-hidden=\"true\"></i>&nbsp;</span>;\n","\nexport function createUUID() {\n  // Decent solution from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\n  var d = Date.now();\n  var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\n    var r = (d + Math.random() * 16) % 16 | 0;\n    d = Math.floor(d / 16);\n    return (c === 'x' ? r : (r & 0x7 | 0x8)).toString(16);\n  });\n  return uuid;\n}\n\nexport function avoidSimultanousCalls<T,A>(method: (...args:A[])=>Promise<T>) : (...args:A[])=>Promise<T> {\n  let ongoingPromise: Promise<T> = null;\n  return function() {\n      if (!ongoingPromise) {\n          ongoingPromise = method.apply(this, arguments).then(result=>{\n              ongoingPromise = null;\n              return result;\n          });\n      }\n      return ongoingPromise;\n  }\n}\n","import moment from 'moment';\nimport { Term, AcademicYear } from '../contracts/ked-models';\n\nexport interface SchoolMoment {\n  academicYear: AcademicYear;\n  term: Term;\n  week?: number;\n}\n\nexport function getFirstAndLastWeekOfTerm(term: Term) {\n  return term === 'AT' ?\n    [32, 51] :\n    [1, 25];\n}\n\nexport function getTermStartAndEnd(now: moment.Moment) : moment.Moment[] {\n  return now.month() >= 7 ? // 7 = August in JS Dates and in moment as well!\n    [moment(new Date(now.year(), 7, 1)), moment(new Date(now.year(), 11, 31))] : // aug1 - dec31\n    [moment(new Date(now.year(), 0, 1)), moment(new Date(now.year(), 6, 31))]; // jan1 - july31\n}\n\nexport function getSchoolMoment(m: moment.Moment): SchoolMoment {\n  const thisYear = m.year();\n  const isAutumn = m.month() >= 7;\n  const [autumnYear, springYear] = isAutumn ?\n    [thisYear, thisYear + 1] :\n    [thisYear - 1, thisYear];\n  const academicYear = '' + autumnYear + '/' + springYear;\n  const term = isAutumn ? 'AT' : 'ST';\n  const week = m.week();\n  return { academicYear, term, week };\n}\n\nexport function addYear(aYear: AcademicYear, numYearsToAdd: number): AcademicYear {\n  return aYear.split('/')\n    .map(yearStr => parseInt(yearStr) + numYearsToAdd)\n    .map(year => '' + year)\n    .join('/');\n}\n\nexport function nextAcademicYear(aYear: AcademicYear): AcademicYear {\n  return addYear(aYear, 1);\n}\n\nexport function prevAcademicYear(aYear: AcademicYear): AcademicYear {\n  return addYear(aYear, -1);\n}\n","import {BearerPersistentStorage, BearerTokenInfo} from '../ked-backend-client';\n\nexport class BearerStorageSessionStorage implements BearerPersistentStorage {\n    save(id: string, tokenInfo: BearerTokenInfo) {\n        sessionStorage.setItem(\"bearer-\" + id, JSON.stringify(tokenInfo));\n    }\n\n    load(id: string): Promise<BearerTokenInfo> {\n        try {\n            const json = sessionStorage.getItem(\"bearer-\" + id);\n            return Promise.resolve(json ? JSON.parse(json) : {token: null, expires: 0});\n        } catch (ex) {\n            return Promise.resolve({token: null, expires: 0});\n        }\n    }\n}\n","import { Task } from '../../KED.Backend.API/schema';\n\nexport default function migrateTask(task: Task) {\n    if (!task.resources) task.resources = [];\n}\n","import * as model from '../../KED.Backend.API/schema';\nimport migrateCourse from './migrate-course';\nimport migrateTask from './migrate-task';\n\nexport default function migrate(doc, table: string, graphs?: string[]) {\n  switch (table) {\n    case \"courses\":\n      migrateCourse(doc, graphs);\n      break;\n    case \"tasks\":\n      migrateTask(doc);\n      break;\n  }\n}\n","import { Course } from '../../KED.Backend.API/schema';\nimport migrateTask from './migrate-task';\n\nexport default function migrateCourse(course: Course, graphs?: string[]) {\n  if (!course.modules) course.modules = [];\n  course.modules.forEach(module => {\n    if (!module.resources) {\n      module.resources = [];\n    }\n    if (!module.taskIds) {\n      module.taskIds = [];\n    }\n  });\n\n  if (!course.responsibleTeachers) {\n    course.responsibleTeachers = []\n  }\n\n  // Earlier wrong spelling of resources\n  if ('resourses' in (course as any) && !('resources' in (course as any))) {\n    course.resources = (course as any).resourses;\n    delete (course as any).resourses;\n  }\n  if (!course.resources) {\n    course.resources = [];\n  }\n\n  if (graphs) {\n    graphs.forEach(label => {\n      switch (label) {\n        case 'tasks':\n          course.tasks.forEach(task => migrateTask(task));\n          break;\n      }\n    });\n  }\n}\n","import { KedBackendClient } from '../ked-backend-client';\nimport migrate from './migrate';\n\nexport const KedModelMigratorMixin = (client: KedBackendClient) => {\n    if ((client as any).__migrator_mixed_in) return;\n    (client as any).__migrator_mixed_in = true;\n    \n    const get = client.get;\n    const list = client.list;\n\n    client.get = function (table, id, options) {\n        const include = options && options.include;\n        return get.apply(this, arguments).then(result => {\n            migrate(result, table, include && include.toString().split(','));\n            return result;\n        });\n    }\n\n    client.list = function (table, options) {\n        const include = options && options.include;\n        return list.apply(this, arguments).then(result => {\n            result.forEach(doc => migrate(doc, table, include && include.toString().split(',')));\n            return result;\n        });\n    }\n\n    return client;\n}\n\n","import { KedBackendClient, BearerProvider, BearerTokenInfo, IsomorphicEnv } from '../ked-backend-client';\nimport { BearerStorageSessionStorage } from \"./bearer-storage-sessionstorage\";\nimport { avoidSimultanousCalls } from '../ked-backend-client/utils';\nimport { KedModelMigratorMixin } from '../ked-model-migrator';\nKedModelMigratorMixin(KedBackendClient.prototype);\n\nexport const storage = new BearerStorageSessionStorage();\n\nconst timeOfPageLoad = Date.now();\n\nexport class WebServerBearerProvider implements BearerProvider {\n    tokenInfo: BearerTokenInfo;\n    wantsRedirect: boolean;\n\n    constructor (\n        public tokenPath: string,\n        public tokenResponseMapper: (responseText: string) => BearerTokenInfo,\n        public tokenId: string)\n    {\n        this.tokenInfo = {token: null, expires: 0};\n        this.getBearer = avoidSimultanousCalls(this.getBearer.bind(this));\n        this.refreshBearer = avoidSimultanousCalls(this.refreshBearer.bind(this));\n    }\n\n    async getBearer() {\n        if (!this.tokenInfo.token) {\n            if (this.tokenId) this.tokenInfo = await storage.load(this.tokenId);\n        }\n        if (this.tokenInfo.expires < Date.now()) {\n            await this.refreshBearer();\n        }\n        return this.tokenInfo;\n    }\n\n    async refreshBearer() {\n        const res = await fetch(this.tokenPath, {\n            headers: {Accept: \"text/plain; application/json\"},\n            redirect: 'manual',\n            cache: 'no-cache',\n            credentials: \"same-origin\"\n        });\n        if (res.status === 302 || (!res.status && res.type === \"opaqueredirect\")) {\n            // User session timed out and server wants to redirect entire page to login page\n            // Time to reload current page to force a redirect of the entire page instead for\n            // just redirecting to /api/token or whatever.\n            if (Date.now() - timeOfPageLoad > 60000) {// prohibit endless loop of reloading self.\n                this.wantsRedirect = true; // So that listeners to onbeforeunload could show alternate message.\n                console.log(\"Redirect wanted. Reload page.\")\n                window.location.reload(true);\n            }\n        }\n        if (res.status != 200) throw new Error(\"HTTP\"+res.status + \" \" + await res.text());\n        this.tokenInfo = this.tokenResponseMapper(await res.text());\n        storage.save(this.tokenId, this.tokenInfo);\n        return this.tokenInfo;\n    }\n}\n\nexport const isomorphic = {fetch: fetch.bind(self), btoa: btoa.bind(self)};\n\nexport class KedBackendClientWeb extends KedBackendClient {\n    constructor(\n        apiBaseUrl: string,\n        providerOrTokenPath: string | BearerProvider,\n        options?: {\n            tokenResponseMapper?: (responseText: string) => BearerTokenInfo,\n            tokenId?: string\n        })\n    {\n        const bearerProvider = typeof providerOrTokenPath !== 'string' ?\n            providerOrTokenPath :\n            new WebServerBearerProvider(\n                providerOrTokenPath,\n                (options && options.tokenResponseMapper) || (x=>({token: x, expires: Date.now() + 59 * 60 * 60})),\n                options && options.tokenId);\n        super(isomorphic, bearerProvider, apiBaseUrl);\n    }\n}\n","/*\ndeclare var Buffer; // node built-in\n\n\nfunction basicAuthHeader(username, password) {\n    return \"Basic \" + new Buffer(username + \":\" + password).toString(\"base64\");\n}\n*/\n\nimport {IsomorphicEnv} from './isomorphic-env';\nimport { createUUID } from \"./utils\";\n\nexport interface BearerTokenInfo {\n    token: string;\n    expires: number;\n}\n\nexport interface BearerProvider {\n    getBearer(): Promise<BearerTokenInfo>;\n    refreshBearer(): Promise<BearerTokenInfo>;\n    wantsRedirect?: boolean;\n}\n\nexport class RestClient {\n    authHeader?: string;\n    tokenInfo?: BearerTokenInfo;\n    bearerProvider?: BearerProvider;\n    fetchOptions: RequestInit;\n\n    constructor(\n        public isomorphic: IsomorphicEnv,\n        public baseUrl: string,\n        public options: {\n            username?,\n            password?,\n            bearer?,\n            bearerProvider?: BearerProvider\n        },\n    ) {\n        this.fetchOptions = {mode: 'cors'};\n        this.authHeader = options.bearer ?\n            \"Bearer \" + options.bearer :\n            options.username ?\n                \"Basic \" + isomorphic.btoa(options.username + \":\" + (options.password || \"\")) :\n                null;\n        this.bearerProvider = options.bearerProvider || null;\n    }\n\n    async fetch(path: string, method: string, headers, query?, fetchOptions?: RequestInit): Promise<Response> {\n        if (fetchOptions && fetchOptions.cache === 'no-cache') {\n            // Workaround for back-button not respecting cache control in Chrome/Opera.\n            // Append a query parameter to force a cache entry\n            query = {...query, nocache: createUUID()}\n        }\n        const queryStr = query && Object.keys(query).map(key =>\n            encodeURIComponent(key) +\n            \"=\" +\n            encodeURIComponent(query[key]))\n            .join('&');\n\n        let {authHeader, tokenInfo, bearerProvider} = this;\n\n        // {username, password or bearer} not specified in options, but bearerProvider specified:\n        if (!authHeader && !tokenInfo && bearerProvider) {\n            this.tokenInfo = tokenInfo = await bearerProvider.getBearer();\n        }\n        // Either because we've just specified bearerProvider in options, OR, we've got a 401\n        // in earlier response with www-authenticate: Bearer, and we had a BearerProvider,\n        // so we saved the tokenInfo. Now use it regardless of whether username,password or bearer was given\n        // to options in constructor:\n        if (tokenInfo) {\n            if (tokenInfo.expires < Date.now()) {\n                console.log(\"Token expired. Refresh it:\");\n                this.tokenInfo = tokenInfo = await bearerProvider.refreshBearer();\n            }\n            authHeader = \"Bearer \" + tokenInfo.token;            \n        }\n\n        // In one way or another, we've concluded an Authorization header to use:\n        if (authHeader) {\n            headers.Authorization = authHeader;\n        }\n\n        const url = this.baseUrl + path + (queryStr ? \"?\" + queryStr : \"\");\n        let res: Response = await this.isomorphic.fetch(url, { ...this.fetchOptions, headers, method, ...fetchOptions });\n        if (res.status == 401 && this.bearerProvider) {\n            const wwwauth = res.headers.get(\"www-authenticate\");\n            console.log(`Got ${res.status} from ${this.baseUrl + path}`);\n            if (wwwauth && /Bearer/i.test(wwwauth)) {\n                this.tokenInfo = await this.bearerProvider.refreshBearer();\n                headers.Authorization = \"Bearer \" + this.tokenInfo.token;\n                res = await this.isomorphic.fetch(url, { ...this.fetchOptions, headers, method, ...fetchOptions });\n            }\n        }\n        return res;\n    }\n\n    get(path: string, query?, fetchOptions?: RequestInit) {\n        return this.fetch(path, \"GET\", { Accept: \"application/json; text/plain\" }, query, fetchOptions);\n    }\n\n    post(path: string, data, fetchOptions?: RequestInit): Promise<Response> {\n        return this.fetch(path, \"POST\", {\n            \"Content-Type\": \"application/json\",\n            \"Accept\": \"application/json\"\n        }, null, {...fetchOptions, body: JSON.stringify(data)});\n    }\n\n    delete(path: string, query?, body?, fetchOptions?: RequestInit) {\n        return this.fetch(path, \"DELETE\", { Accept: \"application/json; text/plain\" }, query, {...fetchOptions, body});\n    }\n}\n","module.exports = ReactDOM;","\nexport const KED_NAMESPACE = \"KED\";\n\ndeclare var KED: any;\n\nvar result = typeof KED === 'undefined' ? {} : KED;\n\nif (typeof window !== 'undefined' && typeof KED === 'undefined') {\n    window[KED_NAMESPACE] = result;\n}\n\nexport default result;\n","import {BearerProvider, RestClient, BearerTokenInfo} from './restclient';\nimport {IsomorphicEnv} from './isomorphic-env';\nimport {TokenQuery} from './token-query';\nimport {avoidSimultanousCalls} from './utils';\n\nexport interface BearerPersistentStorage {\n    save(id: string, tokenInfo: BearerTokenInfo);\n    load(id: string) : Promise<BearerTokenInfo>;\n}\n\nexport class KedBearerProvider implements BearerProvider {\n    tokenInfo: BearerTokenInfo;\n    client: RestClient;\n    \n    constructor (\n        public isomorphic: IsomorphicEnv,\n        public storage: BearerPersistentStorage,\n        public tokenId:string,\n        public clientId: string,\n        public clientSecret: string,\n        public tokenUrl: string,\n        public tokenQuery: TokenQuery)\n    {\n        this.tokenInfo = {token: null, expires: 0};\n        this.client = new RestClient(isomorphic, \"\", {\n            username: this.clientId,\n            password: this.clientSecret\n        });\n        this.getBearer = avoidSimultanousCalls(this.getBearer.bind(this));\n        this.refreshBearer = avoidSimultanousCalls(this.refreshBearer.bind(this));\n    }\n\n    async getBearer(): Promise<BearerTokenInfo> {\n        const {token, expires} = this.tokenInfo;\n        if (token && expires >= Date.now()) return this.tokenInfo;\n        try {\n            this.tokenInfo = await this.storage.load(this.clientId + \"/\" + this.tokenId);\n            if (this.tokenInfo.token && this.tokenInfo.expires >= Date.now()) return this.tokenInfo;\n            await this.refreshBearer();\n            return this.tokenInfo;\n        } catch (e) {\n            await this.refreshBearer();\n            return this.tokenInfo;\n        }\n    }\n\n    async refreshBearer(): Promise<BearerTokenInfo> {\n        let res: Response;\n        for (let retries=0;retries<6;++retries) {\n            console.log(`Retrieving token for ${this.tokenId}`);\n            res = await this.client.get(this.tokenUrl, this.tokenQuery, {cache: 'reload'});\n            if (res.status !== 200) {\n                console.warn(`Got ${res.status} ${res.statusText}`);\n                continue;\n            }\n            this.tokenInfo = {token: await res.text(), expires: Date.now() + 59 * 60 * 1000};\n            console.log(`Got token for ${this.tokenId}: ${JSON.stringify(this.tokenInfo)}`);\n            this.storage.save(this.clientId + \"/\" + this.tokenId, this.tokenInfo);\n            return this.tokenInfo;\n        }\n        throw new Error(\"Failed to retrieve token for \" + JSON.stringify(this.tokenId));\n    }\n}\n","export interface AccessClaim {\n  type: string;\n  value: string;\n}\n\nexport type AccessRight = 'R' | 'W' | 'S';\n\nexport class DocumentAccess {\n  constructor(\n    public accessClaimType: string,\n    public accessClaimValue: string,\n    public right: AccessRight\n  ) { }\n\n  static fromString(ac: string) {\n    if (!ac) return null;\n    var split = ac.split(':');\n    if (split.length < 3) throw new Error(\"Invalid access string: \" + ac);\n    var claimType = DocumentAccess.unescape(split[0]);\n    var claimValue = DocumentAccess.unescape(split[1]);\n    var right = split[2];\n    if (right !== 'R' && right !== 'W' && right !== 'S')\n      throw new Error(\"Invalid access string: \" + ac);\n    return new DocumentAccess(\n      claimType,\n      claimValue,\n      right);\n  }\n\n  static escape(accessComponent: string) {\n    return accessComponent.replace(/\\%/g, \"%25\").replace(/\\:/g, \"%3A\");\n  }\n\n  static unescape(accessComponent: string) {\n    return accessComponent.replace(/\\%3A/g, \":\").replace(/\\%25/g, \"%\");\n  }\n\n  toString() {\n    return DocumentAccess.escape(this.accessClaimType) + \":\" +\n      DocumentAccess.escape(this.accessClaimValue) + \":\" +\n      this.right;\n  }\n\n  static fromStringArray(acl: string[]) {\n    return acl\n      .map(ac => DocumentAccess.fromString(ac))\n      .filter(ac => ac);\n  }\n\n  static toStringArray(acl: DocumentAccess[]) {\n    return acl.map(ac => ac.toString());\n  }\n}\n\nexport function hasAccess(acl: DocumentAccess[], userClaims: AccessClaim[], requestedRight: AccessRight) {\n  if (userClaims.some(claim => claim.type === 'role' && claim.value === \"ADMIN\"))\n    return true;\n\n  return acl.some(a =>\n    userClaims.some(c =>\n      a.accessClaimType === c.type &&\n      a.accessClaimValue === c.value && (\n        (a.right === 'R' && requestedRight === 'R') ||\n        (a.right === 'W' && ['R','W'].indexOf(requestedRight) >= 0) ||\n        (a.right === 'S'))));\n}\n","\nexport class HttpError extends Error {\n    constructor (public code: number, public message: string) {\n      super(\"HTTP\" + code + \" \" + message)\n      this.name = \"http\" + code;\n    }\n}\n","import {RestClient, BearerProvider, BearerTokenInfo} from './restclient';\nexport {BearerProvider, BearerTokenInfo};\nexport {BearerPersistentStorage} from './ked-bearer-provider';\nexport {createUUID} from './utils';\nexport {KedBearerProvider} from './ked-bearer-provider';\nimport {IsomorphicEnv} from './isomorphic-env';\nexport {IsomorphicEnv};\nexport {TokenQuery} from './token-query';\nexport * from './access-control';\nimport {HttpError} from './http-error';\nexport {HttpError}\n\nexport interface ListOptions {\n    from?: number,\n    to?: number,\n    include?: string | string[],\n    role?: string | string[],\n    hasEdgesTo?: string | string[],\n    hasEdgesFrom?: string | string[],\n    ids?: string[],\n    name?: string,\n    tags?: string | string[],\n    flags?: QueryFlag[],\n    cacheBust?: string | number\n};\n\nexport type QueryFlag = 'idsOnly' | 'includeIdsOnly' | 'idsAndNamesOnly' | 'includeIdsAndNamesOnly'; // | 'otherFlag' | 'thirdFlag';...\n\nexport class KedBackendClient {\n    http: RestClient;\n\n    constructor (\n        isomorphic: IsomorphicEnv,\n        bearerProvider: BearerProvider,\n        baseUrl: string)\n    {\n        this.http = new RestClient(\n            isomorphic,\n            baseUrl,\n            {bearerProvider});\n    }\n\n    async getMyClaims(table?: string, fetchOptions?: RequestInit) : Promise<any> // TODO: Specify what you get here\n    {\n        const res = await this.http.get(\"me/claims/\" + (table ||\"\"), null, fetchOptions);\n        if (res.status != 200) throw new HttpError(res.status, await res.text());\n        return await res.json();\n    }\n\n    async get<T = any>(table, id, options?: {include?: string | string[]}, fetchOptions?: RequestInit) : Promise<T> {\n        const res = await this.http.get(`${table}/${id}`, options, fetchOptions);\n        if (res.status != 200) throw new HttpError(res.status, await res.text());\n        return await res.json();\n    }    \n\n    async list<T = any>(table: string, options?: ListOptions, fetchOptions?: RequestInit) : Promise<T[]>\n    {\n        const res = await this.http.get(`${table}`, options, fetchOptions);\n        if (res.status != 200) throw new HttpError(res.status, await res.text());\n        return await res.json();\n    }\n\n    async batch(reqs: MutationRequest[], fetchOptions?: RequestInit) : Promise<BatchResponse> {\n        // Reorder operations so that 'add's come first and 'delete's come last:\n        reqs = reqs.slice().sort((req1, req2) =>\n            req1.op === 'add' ? -1 : req2.op === 'add' ? 1 : \n            req1.op === 'delete' ? 1 : req2.op === 'delete' ? -1 : 0);\n        const res = await this.http.post(`batch`, reqs, fetchOptions);\n        if (res.status != 200) throw new HttpError(res.status, await res.text());\n        return await res.json();\n    }\n\n    async do(scopeFn: (r:BatchRunner)=>void) : Promise<BatchResponse> {\n        const runner = new BatchRunner();\n        scopeFn(runner);\n        return await this.batch(runner.mutationRequests);\n    }\n\n    async deleteRealm(realm: string) : Promise<number> {\n        const res = await this.http.delete(\"realms/\" + realm);\n        if (res.status != 200) throw new HttpError(res.status, await res.text());\n        return await res.json();\n    }\n\n    add(table:string, doc) {\n        return this.do(r=>r.add(table, doc));\n    }\n    put(table:string, doc) {\n        return this.do(r=>r.put(table, doc));\n    }\n    delete (table:string, id:string) {\n        return this.do(r=>r.delete(table, id));\n    }\n    share(table:string, id:string, acl: string[]) {\n        return this.do(r=>r.share(table, id, acl));\n    }\n    unshare (table:string, id:string, acl: string[]) {\n        return this.do(r=>r.unshare(table, id, acl));\n    }\n    link (sourceTable:string, sourceId:string, targetTable:string, targetId:string, label:string) {\n        return this.do(r=>r.link(sourceTable, sourceId, targetTable, targetId, label));\n    }\n    link2 (sourceTable:string, sourceId:string, targetId:string, label:string) {\n        return this.do(r=>r.link2(sourceTable, sourceId, label, targetId));\n    } \n    unlink (sourceTable:string, sourceId:string, targetTable:string, targetId:string, label:string) {\n        return this.do(r=>r.unlink(sourceTable, sourceId, targetTable, targetId, label));\n    }\n    unlink2 (sourceTable:string, sourceId:string, targetId:string, label:string) {\n        return this.do(r=>r.unlink2(sourceTable, sourceId, label, targetId));\n    }\n}\n\nexport class BatchRunner {\n    mutationRequests: MutationRequest[];\n\n    constructor() {\n        this.mutationRequests = [];\n    }\n\n    add (table:string, doc) {\n        this.mutationRequests.push({op: 'add', table, doc});\n        return this;\n    }\n    put (table:string, doc) {\n        doc = {...doc};\n        delete doc.acl; // Forbidden to send acl with put() calls.\n        this.mutationRequests.push({op: 'put', table, doc});\n        return this;\n    }\n    delete (table:string, id:string) {\n        this.mutationRequests.push({op: 'delete', table, id});\n        return this;\n    }\n    share (table:string, id:string, acl:string[]) {\n        this.mutationRequests.push({op: 'share', table, id, acl});\n        return this;\n    }\n    unshare (table:string, id:string, acl:string[]) {\n        this.mutationRequests.push({op: 'unshare', table, id, acl});\n        return this;\n    }\n    link (sourceTable:string, sourceId:string, targetTable:string, targetId:string, label:string) {\n        this.mutationRequests.push({op: 'link', sourceTable, sourceId, targetTable, targetId, label});\n        return this;\n    }\n    link2 (sourceTable:string, sourceId:string, label:string, targetId:string) {\n        this.mutationRequests.push({op: 'link', sourceTable, sourceId, targetId, label});\n    }\n    unlink (sourceTable:string, sourceId:string, targetTable:string, targetId:string, label:string) {\n        this.mutationRequests.push({op: 'unlink', sourceTable, sourceId, targetTable, targetId, label});\n        return this;\n    }\n    unlink2 (sourceTable:string, sourceId:string, label:string, targetId:string) {\n        this.mutationRequests.push({op: 'unlink', sourceTable, sourceId, targetId, label});\n        return this;\n    }\n}\n\nexport interface AddRequest {\n    op: 'add';\n    table: string;\n    doc: {id?: string, acl?: string[], name?: string, dateTime?: number};\n}\n\nexport interface PutRequest {\n    op: 'put';\n    table: string;\n    doc: {id: string, name?: string, dateTime?: number};\n}\n\nexport interface DeleteRequest {\n    op: 'delete';\n    table: string;\n    id: string;\n}\n\nexport interface ShareRequest {\n    op: 'share';\n    table: string;\n    id: string;\n    acl: string[];\n}\n\nexport interface UnshareRequest {\n    op: 'unshare';\n    table: string;\n    id: string;\n    acl: string[];\n}\n\nexport interface LinkRequest {\n    op: 'link';\n    sourceTable: string;\n    sourceId: string;\n    targetTable?: string;\n    targetId: string;\n    label: string;\n}\n\nexport interface UnlinkRequest {\n    op: 'unlink';\n    sourceTable: string;\n    sourceId: string;\n    targetTable?: string;\n    targetId: string;\n    label: string;\n}\n\nexport type MutationRequest =\n    AddRequest |\n    PutRequest |\n    DeleteRequest |\n    ShareRequest |\n    UnshareRequest |\n    LinkRequest |\n    UnlinkRequest;\n\nexport interface BatchResponse {\n    newEtags: {[id:string] : string};\n}\n\n","import {EDSCourse} from '../../contracts/eds';\n\nexport const courses: {courses: EDSCourse[]} =\n\n{\n    \"courses\": [\n        // Test data for Gymnasium students (made-up!)\n        {\n            \n            \"courseId\": \"2070d120-30ad-49e9-89c3-9c584a6cfa29\",\n            \"periodName\": \"HT2017\",\n            \"periodGoalGrade\": \"A\",\n            \"name\": \"Naturkunskap 1b\",\n            \"shortName\": \"XXX\",\n            \"courseSteps\": []\n        },\n        // Test data once retrieved from EDS test API for ground-school students:\n        {\n            \"courseId\": \"2070d120-30ad-49e9-89c3-9c584a6cfa2c\",\n            \"periodName\": \"VT2017\",\n            \"periodGoalGrade\": \"A\",\n            \"name\": \"Engelska\",\n            \"shortName\": \"EN\",\n            \"courseSteps\": [\n                {\n                    \"stepId\": \"61f02bc7-1a0d-4b80-9bf1-07b6280379db\",\n                    \"name\": \"1. Lära känna varandra\",\n                    \"shortName\": \"1\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472111903600)\\/\"\n                },\n                {\n                    \"stepId\": \"a34c07c7-3932-4f64-87f9-feb5646db3db\",\n                    \"name\": \"10. En saga\",\n                    \"shortName\": \"10\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472111903740)\\/\"\n                },\n                {\n                    \"stepId\": \"e931f2bb-5727-4d99-b9e5-1bababfbc2e9\",\n                    \"name\": \"11. Det här är jag\",\n                    \"shortName\": \"11\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472111903757)\\/\"\n                },\n                {\n                    \"stepId\": \"ab823339-90ac-4b7f-a895-869d25cef504\",\n                    \"name\": \"12. Jag och min familj\",\n                    \"shortName\": \"12\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472111903770)\\/\"\n                },\n                {\n                    \"stepId\": \"53e00313-4980-4ab2-84ff-abe80ecd72d2\",\n                    \"name\": \"13. Jag och mina vänner\",\n                    \"shortName\": \"13\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472111903787)\\/\"\n                },\n                {\n                    \"stepId\": \"828796e9-84ad-4496-aa78-7850dd5bb23a\",\n                    \"name\": \"14. Jag och min fritid\",\n                    \"shortName\": \"14\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472111903803)\\/\"\n                },\n                {\n                    \"stepId\": \"31e08f37-4ec5-4366-9af6-bca5b9070198\",\n                    \"name\": \"15. The Blog\",\n                    \"shortName\": \"15\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472111904117)\\/\"\n                },\n                {\n                    \"stepId\": \"4f88e9a3-9b36-47af-9686-d28b00ca98fc\",\n                    \"name\": \"16. Sport\",\n                    \"shortName\": \"16\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1474888651180)\\/\"\n                },\n                {\n                    \"stepId\": \"abb57443-be68-48b7-a719-3454afbf3daa\",\n                    \"name\": \"17. Musik\",\n                    \"shortName\": \"17\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1477656328037)\\/\"\n                },\n                {\n                    \"stepId\": \"964f7ac3-8cf7-4042-912f-58ffb6812ddb\",\n                    \"name\": \"18. Vykort\",\n                    \"shortName\": \"18\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"3002e95c-8de0-4914-a754-0773a18606bf\",\n                    \"name\": \"19. Läsa noveller\",\n                    \"shortName\": \"19\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"d8708a56-e4fb-4ad3-84ef-bb40481eaf80\",\n                    \"name\": \"2. Veckans aktiviteter\",\n                    \"shortName\": \"2\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472111903613)\\/\"\n                },\n                {\n                    \"stepId\": \"46915f18-288c-44df-b224-1852d221b6ca\",\n                    \"name\": \"20. Summer camp\",\n                    \"shortName\": \"20\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"db22d300-0126-4a32-950d-aaf2f7142627\",\n                    \"name\": \"21. Hus och hem\",\n                    \"shortName\": \"21\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"68111c18-e610-45c0-b290-9dd3cede1e48\",\n                    \"name\": \"22. Sightseeing\",\n                    \"shortName\": \"22\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"4c84dd89-66f2-4ea1-bce8-3fde1724dcc9\",\n                    \"name\": \"23. Vid matbordet\",\n                    \"shortName\": \"23\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1488205880703)\\/\"\n                },\n                {\n                    \"stepId\": \"75943640-f031-41da-8495-9d87b5804a3e\",\n                    \"name\": \"24. Traditioner\",\n                    \"shortName\": \"24\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"72021bc2-0ea8-4d39-87fa-11cc976e9c9f\",\n                    \"name\": \"25. Staying with a host family\",\n                    \"shortName\": \"25\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"574e1626-cad3-4220-8ba7-b443f03830b4\",\n                    \"name\": \"26. Det engelska språket\",\n                    \"shortName\": \"26\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"50a3682e-057d-45b1-81b5-e2eaa8b6d16b\",\n                    \"name\": \"27. Skolan och framtidsdrömmar\",\n                    \"shortName\": \"27\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"15a47a71-989a-4348-8fcb-a10683d263ec\",\n                    \"name\": \"28. Identitet\",\n                    \"shortName\": \"28\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"5717f099-477f-433d-b10a-c2bf0dfe6f8e\",\n                    \"name\": \"29. Att läsa en bok\",\n                    \"shortName\": \"29\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"0443638f-a546-40d8-a533-e2d12abef609\",\n                    \"name\": \"3. Fira ett speciellt tillfälle\",\n                    \"shortName\": \"3\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472111903630)\\/\"\n                },\n                {\n                    \"stepId\": \"54ff6488-f0ae-4fb6-b4e4-0f29d9274b23\",\n                    \"name\": \"30. The World Today\",\n                    \"shortName\": \"30\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"2ab8a527-cd74-4847-97a6-79f629e22e84\",\n                    \"name\": \"31. Entertainment\",\n                    \"shortName\": \"31\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"1b5d42ff-9615-439a-9ae2-89779040bf91\",\n                    \"name\": \"32. Interview\",\n                    \"shortName\": \"32\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"29ffc098-d26d-4f3b-a295-b5f065923bf2\",\n                    \"name\": \"33. Filmed books\",\n                    \"shortName\": \"33\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"4d5fe734-9af9-42b8-8c50-920c9a450bc1\",\n                    \"name\": \"34. See the film\",\n                    \"shortName\": \"34\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"dd87c548-4a3a-4a62-9114-70ec7e713aee\",\n                    \"name\": \"35. Write a bestseller\",\n                    \"shortName\": \"35\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"1fb5ce80-faf0-465c-9be8-c9bc722297bb\",\n                    \"name\": \"36. The English-speaking World\",\n                    \"shortName\": \"36\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"f0007f75-0d1f-48c7-8f19-bb2e9f2c5377\",\n                    \"name\": \"37. Poetry\",\n                    \"shortName\": \"37\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"addebfcc-5b3c-4360-b819-0de0269a5e2d\",\n                    \"name\": \"38. Rhetoric\",\n                    \"shortName\": \"38\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"23c16db5-d435-49d3-8daa-c2b6433366b7\",\n                    \"name\": \"39. An important issue\",\n                    \"shortName\": \"39\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"e4d22285-735a-4bab-8884-ca5b736ebb88\",\n                    \"name\": \"4. Åka någonstans\",\n                    \"shortName\": \"4\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472111903647)\\/\"\n                },\n                {\n                    \"stepId\": \"4c489a2b-ee79-4f89-9818-787632abfba8\",\n                    \"name\": \"40. Write a speech\",\n                    \"shortName\": \"40\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"9667976c-83ab-4b9e-8a76-d330983c28f5\",\n                    \"name\": \"41. Changing world\",\n                    \"shortName\": \"41\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"6bb14af9-9094-4938-be2d-2725a931895c\",\n                    \"name\": \"42. An organization\",\n                    \"shortName\": \"42\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"fe313a1a-dc5c-4890-b11e-b8e109db689b\",\n                    \"name\": \"43. The written word\",\n                    \"shortName\": \"43\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"f1a592ec-6095-4ae4-9b9e-ebd527c18a2a\",\n                    \"name\": \"44. Communication\",\n                    \"shortName\": \"44\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"5f6a5e15-462b-40ab-981b-b93e5fc0ee22\",\n                    \"name\": \"45. Giving a lecture\",\n                    \"shortName\": \"45\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"8c9b57c1-cf05-4465-84b2-68cf353b1075\",\n                    \"name\": \"5. Min semester\",\n                    \"shortName\": \"5\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472111903660)\\/\"\n                },\n                {\n                    \"stepId\": \"1bd11f36-6438-40b5-ad4c-4b02b6f481d0\",\n                    \"name\": \"6. Låt oss prata om det\",\n                    \"shortName\": \"6\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472111903677)\\/\"\n                },\n                {\n                    \"stepId\": \"d49c08ee-c0e6-4599-b79f-5efd811fe33c\",\n                    \"name\": \"7. Jag är en turist\",\n                    \"shortName\": \"7\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472111903693)\\/\"\n                },\n                {\n                    \"stepId\": \"2def3414-de65-46c0-8f48-f8aa18be7b7c\",\n                    \"name\": \"8. Vänner över hela världen\",\n                    \"shortName\": \"8\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472111903707)\\/\"\n                },\n                {\n                    \"stepId\": \"ea8ff1a0-4bad-43ac-b328-62dff3e4d08e\",\n                    \"name\": \"9. Hjältar och kända personer\",\n                    \"shortName\": \"9\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472111903723)\\/\"\n                }\n            ]\n        },\n        {\n            \"courseId\": \"9d129e6a-9557-4849-a53f-416725502895\",\n            \"periodName\": \"VT2017\",\n            \"periodGoalGrade\": \"C\",\n            \"name\": \"Matematik\",\n            \"shortName\": \"MA\",\n            \"courseSteps\": [\n                {\n                    \"stepId\": \"f1af6c2c-799a-4a3d-9985-c423940e91c0\",\n                    \"name\": \"1. Tal och mönster\",\n                    \"shortName\": \"1\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1474401815917)\\/\"\n                },\n                {\n                    \"stepId\": \"4a34c53d-93d0-4247-ba19-9ce9dbed6de5\",\n                    \"name\": \"10. Lägesmått och diagram\",\n                    \"shortName\": \"10\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1474401816200)\\/\"\n                },\n                {\n                    \"stepId\": \"0816a2b0-3aa7-41a9-bc39-971ccc7bd79c\",\n                    \"name\": \"11. Räknesätt\",\n                    \"shortName\": \"11\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1476103754013)\\/\"\n                },\n                {\n                    \"stepId\": \"fdc90a9c-b06a-48b1-9781-606c230c425c\",\n                    \"name\": \"12. Geometri\",\n                    \"shortName\": \"12\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1481279716607)\\/\"\n                },\n                {\n                    \"stepId\": \"bfd77c92-6636-45fa-9002-d813beaa56c3\",\n                    \"name\": \"13. Rymdgeometri\",\n                    \"shortName\": \"13\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1489669353170)\\/\"\n                },\n                {\n                    \"stepId\": \"58a619a1-b99a-487b-bbd5-abd31a903e5a\",\n                    \"name\": \"14. Räknemetoder och algebra\",\n                    \"shortName\": \"14\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"55b88760-22aa-452a-8a57-131346669aad\",\n                    \"name\": \"15. Problemet\",\n                    \"shortName\": \"15\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"47f16476-ea47-40a2-a073-7ac4b36c4bf0\",\n                    \"name\": \"16. Delen och det hela\",\n                    \"shortName\": \"16\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"704e3d5b-fce7-409b-b989-340b2d7b2e18\",\n                    \"name\": \"17. Geometri och vinklar\",\n                    \"shortName\": \"17\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"db5693ea-48ef-44ce-8107-be9915ef5256\",\n                    \"name\": \"18. Funktioner\",\n                    \"shortName\": \"18\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"f9250c97-d932-4bf6-989e-204c0ef582c9\",\n                    \"name\": \"19. Proportionalitet\",\n                    \"shortName\": \"19\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"d0411b1d-c9b4-452f-9fb6-ea7206755ecd\",\n                    \"name\": \"2. Längd och räknesätt\",\n                    \"shortName\": \"2\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1474401815930)\\/\"\n                },\n                {\n                    \"stepId\": \"616b742e-b175-45c3-a926-fda3e4d8af80\",\n                    \"name\": \"20. Förflyttningsgraf\",\n                    \"shortName\": \"20\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"f8a9b467-6ba6-4d9a-8174-87e369062621\",\n                    \"name\": \"21. Likformighet\",\n                    \"shortName\": \"21\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"8fe483d7-b78b-4d9d-9402-15d57da05832\",\n                    \"name\": \"22. Bråk, sannolikhet och kombinatorik\",\n                    \"shortName\": \"22\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"7eb39090-6461-4ce4-b008-dd98f8a57679\",\n                    \"name\": \"23. Negativa tal, procentsatser och förändringsfaktor\",\n                    \"shortName\": \"23\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"34cb3911-3a78-4773-a823-2f9054a9a925\",\n                    \"name\": \"24. Algebra och ekvationer\",\n                    \"shortName\": \"24\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"49abad1a-dd4b-4b0b-8d1f-752796723ca1\",\n                    \"name\": \"25. Lotteriet\",\n                    \"shortName\": \"25\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"6756d8bc-e31a-4139-8d95-8f47916a361b\",\n                    \"name\": \"26. Geometriska samband\",\n                    \"shortName\": \"26\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"0f0efee5-e617-4bca-b84e-e50e32aac90b\",\n                    \"name\": \"27. Rymdgeometri\",\n                    \"shortName\": \"27\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"de4e12d1-f678-4b1a-ac7b-5d62cdaeb52d\",\n                    \"name\": \"28. Storheter och proportionella samband\",\n                    \"shortName\": \"28\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"80323de8-fe66-4750-bb2e-d0dbabbb3dac\",\n                    \"name\": \"29. Funktioner och grafer\",\n                    \"shortName\": \"29\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"68894968-8a16-497a-8b97-711df61fca71\",\n                    \"name\": \"3. Tal och enheter\",\n                    \"shortName\": \"3\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1474401815947)\\/\"\n                },\n                {\n                    \"stepId\": \"fa32d170-ab25-466d-91a8-a88f955cc5bc\",\n                    \"name\": \"30. Förpackning\",\n                    \"shortName\": \"30\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"4c31e00f-aeda-409f-8583-9805c0bb4f7f\",\n                    \"name\": \"31. Negativa tal och statistik\",\n                    \"shortName\": \"31\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"691bb48b-070d-4227-8fb6-2edce2fc6be4\",\n                    \"name\": \"32. Bråk\",\n                    \"shortName\": \"32\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"320481da-e417-4c52-af23-0076b694794d\",\n                    \"name\": \"33. Procent och förändringsfaktor\",\n                    \"shortName\": \"33\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"f3a4338d-504e-4092-9610-ef2775b5b411\",\n                    \"name\": \"34. Potenser\",\n                    \"shortName\": \"34\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"f43d7931-158c-4759-b7be-b14cf68c939a\",\n                    \"name\": \"35. Solsystemet\",\n                    \"shortName\": \"35\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"8931fc26-693a-41bd-8040-e01a6d22b2b5\",\n                    \"name\": \"36. Ekvationer och algebra\",\n                    \"shortName\": \"36\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"94370d70-dcbd-4eef-baf1-e92f6680b966\",\n                    \"name\": \"37. Funktioner och grafer\",\n                    \"shortName\": \"37\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"ab0535df-68cc-4c10-86eb-afba3e199d0a\",\n                    \"name\": \"38. Geometri\",\n                    \"shortName\": \"38\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"4ba66c7a-7d8f-4576-aefa-c09397b99db0\",\n                    \"name\": \"39. Sannolikhet\",\n                    \"shortName\": \"39\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"c4e12bc8-1428-4d1b-a273-e947fa0574f3\",\n                    \"name\": \"4. Multiplikation och division\",\n                    \"shortName\": \"4\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1474401815963)\\/\"\n                },\n                {\n                    \"stepId\": \"0b75ce2b-89de-432a-9eee-d6a7b74b6f38\",\n                    \"name\": \"40. Chokladfabriken\",\n                    \"shortName\": \"40\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"dba4a055-c143-4bd4-b436-3eb508ebe658\",\n                    \"name\": \"41. Genrella lösningsmetoder\",\n                    \"shortName\": \"41\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"db193873-0a8c-4073-8618-99c5a56f710b\",\n                    \"name\": \"42. Avancerad ekvationslösning\",\n                    \"shortName\": \"42\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"357ee123-1d77-4568-8fa1-78b5662e12b3\",\n                    \"name\": \"43. Problemlösning\",\n                    \"shortName\": \"43\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"015cdd58-7b31-4a89-a9fe-cd0bb45e7434\",\n                    \"name\": \"44. Avancerad problemlösning\",\n                    \"shortName\": \"44\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"785e12ac-4a71-4acf-bf40-27652faf20ff\",\n                    \"name\": \"45. Vad är matematik?\",\n                    \"shortName\": \"45\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"6372cdb6-91cf-4f0f-ac9c-8578c00760ff\",\n                    \"name\": \"5. Form och storlek\",\n                    \"shortName\": \"5\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1474401815977)\\/\"\n                },\n                {\n                    \"stepId\": \"c781e529-fefa-43ce-99fb-d232585a1e1a\",\n                    \"name\": \"6. Tid och räknesätt\",\n                    \"shortName\": \"6\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1474401815993)\\/\"\n                },\n                {\n                    \"stepId\": \"5df2975c-f84e-4620-abe9-5c47ebcb0f90\",\n                    \"name\": \"7. Bråk och decimaltal\",\n                    \"shortName\": \"7\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1474401816007)\\/\"\n                },\n                {\n                    \"stepId\": \"9cbb966f-32df-48cf-be77-5e00d466d63a\",\n                    \"name\": \"8. Procent och bråk\",\n                    \"shortName\": \"8\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1474401816023)\\/\"\n                },\n                {\n                    \"stepId\": \"b1b59f38-63c6-428a-a512-220b7d838e5f\",\n                    \"name\": \"9. Sannolikhet och bråk\",\n                    \"shortName\": \"9\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1474401816040)\\/\"\n                }\n            ]\n        },\n        {\n            \"courseId\": \"cfdc5bc0-ea41-4683-b941-d980de4e82a5\",\n            \"periodName\": \"VT2017\",\n            \"periodGoalGrade\": \"D\",\n            \"name\": \"Spanska, språkval\",\n            \"shortName\": \"M2SP\",\n            \"courseSteps\": [\n                {\n                    \"stepId\": \"16bb0ce6-60ac-4937-8e60-dd633cd7c5f0\",\n                    \"name\": \"1. Första mötet\",\n                    \"shortName\": \"1\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1476255771933)\\/\"\n                },\n                {\n                    \"stepId\": \"f3504ab6-386c-42d2-882b-668719f329b5\",\n                    \"name\": \"10. Turist\",\n                    \"shortName\": \"10\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"d2de4e01-44dd-4ba7-a69f-075450c627a7\",\n                    \"name\": \"11. Skolan\",\n                    \"shortName\": \"11\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"58e4d577-05f5-4071-8745-a41571df3019\",\n                    \"name\": \"12. Fritiden\",\n                    \"shortName\": \"12\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"d8a079f9-3fef-4fbc-b868-6b050e3832d1\",\n                    \"name\": \"13. Stämma träff\",\n                    \"shortName\": \"13\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"d62f63a1-3806-4650-b6a9-354eccd056b9\",\n                    \"name\": \"14. Sport och musik\",\n                    \"shortName\": \"14\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"b475dc9d-e694-4eb9-8c78-b150494dfe84\",\n                    \"name\": \"15. Presentera dig själv\",\n                    \"shortName\": \"15\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"009c68f6-db7e-44a3-bc5c-d1e2e78d327c\",\n                    \"name\": \"16. När och fjärran\",\n                    \"shortName\": \"16\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"a124f250-2fb7-4b57-b2bc-b72e0e8fd21a\",\n                    \"name\": \"17. Mat och traditioner\",\n                    \"shortName\": \"17\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"ec6ccef4-58b5-4111-b152-8a7a7f546bb8\",\n                    \"name\": \"18. Planera en resa\",\n                    \"shortName\": \"18\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"ec96d506-112e-4b38-8946-6f19130bd741\",\n                    \"name\": \"19. Etikett och regler\",\n                    \"shortName\": \"19\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"0b52b5e6-bbc7-4c78-815c-efc30fa984af\",\n                    \"name\": \"2. Min familj\",\n                    \"shortName\": \"2\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1488368769260)\\/\"\n                },\n                {\n                    \"stepId\": \"e05c674b-1097-4646-ac47-1d8c4342a343\",\n                    \"name\": \"20. Resan\",\n                    \"shortName\": \"20\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"f6f8cffb-69ae-4148-81fa-35e1f984f836\",\n                    \"name\": \"21. Boende\",\n                    \"shortName\": \"21\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"aee9167c-2f65-4f8d-a94b-684458c300bc\",\n                    \"name\": \"22. Familjeliv\",\n                    \"shortName\": \"22\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"115f28de-fe33-435e-a7fb-36fea0a37cce\",\n                    \"name\": \"23. Bostadsläge\",\n                    \"shortName\": \"23\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"d5e8b9e2-b84e-4af7-8b20-e37896dec41d\",\n                    \"name\": \"24. Min stad\",\n                    \"shortName\": \"24\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"c2f15857-a682-4b02-8d00-ec042858e799\",\n                    \"name\": \"25. Presentera någon annan\",\n                    \"shortName\": \"25\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"1bc87327-1e3f-42f6-b839-e9b385200149\",\n                    \"name\": \"26. Media\",\n                    \"shortName\": \"26\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"36f23967-f30b-4cbc-a69c-4191094e182d\",\n                    \"name\": \"27. En tv-kväll\",\n                    \"shortName\": \"27\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"32ead07a-fa58-4770-ac20-3a31f27069cf\",\n                    \"name\": \"28. Tidningar\",\n                    \"shortName\": \"28\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"598d7b7e-97b6-4ff3-b7a7-8f5c45c164cd\",\n                    \"name\": \"29. Film\",\n                    \"shortName\": \"29\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"12e8d03b-7d80-434c-9201-7f852f5c114c\",\n                    \"name\": \"3. Fler siffror, månader och väder\",\n                    \"shortName\": \"3\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"98f0825e-e200-43f4-9f4b-866bb50d28dd\",\n                    \"name\": \"30. Tidningen\",\n                    \"shortName\": \"30\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"956757b9-979f-4d12-be01-8b30970b603e\",\n                    \"name\": \"31. Min framtid\",\n                    \"shortName\": \"31\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"c2003358-0ce9-409b-82fa-e7a0bff891fc\",\n                    \"name\": \"32. Ung i framtiden\",\n                    \"shortName\": \"32\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"1c1ca040-f96d-46af-862b-a978698e2745\",\n                    \"name\": \"33. Insändare\",\n                    \"shortName\": \"33\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"64f620bb-8c77-4de2-88e2-feaa21f4c41e\",\n                    \"name\": \"34. På gymnasiet\",\n                    \"shortName\": \"34\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"4c3c19eb-0447-47cf-bb72-8d1176118c71\",\n                    \"name\": \"35. Framtiden\",\n                    \"shortName\": \"35\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"c3779788-030e-46f3-89a7-a15015931a51\",\n                    \"name\": \"4. Det här är jag\",\n                    \"shortName\": \"4\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"a6628c06-443a-481d-96fc-c019800e8e4e\",\n                    \"name\": \"5. Boken\",\n                    \"shortName\": \"5\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"f34e1dee-1dd3-4bcd-89b4-f0ba6638c65c\",\n                    \"name\": \"6. På café\",\n                    \"shortName\": \"6\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"9ffb3665-0e3a-423a-af93-c5006a2a4839\",\n                    \"name\": \"7. Att handla\",\n                    \"shortName\": \"7\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"63e62432-ba1e-4f96-911c-52bd756c803e\",\n                    \"name\": \"8. I staden\",\n                    \"shortName\": \"8\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"3c93cf1d-2e82-452b-9333-16b336fdda6d\",\n                    \"name\": \"9. På hotellet\",\n                    \"shortName\": \"9\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                }\n            ]\n        },\n        {\n            \"courseId\": \"3cc7c710-63fb-49bd-8dc5-b95be6374122\",\n            \"periodName\": \"VT2017\",\n            \"periodGoalGrade\": \"C\",\n            \"name\": \"Svenska\",\n            \"shortName\": \"SV\",\n            \"courseSteps\": [\n                {\n                    \"stepId\": \"379585a4-f602-4086-920d-d506d2e93fed\",\n                    \"name\": \"1. Min bästa sak\",\n                    \"shortName\": \"1\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472559179490)\\/\"\n                },\n                {\n                    \"stepId\": \"5d90747a-d5ff-4c12-818c-d301e4cf2405\",\n                    \"name\": \"10. Quizkampen\",\n                    \"shortName\": \"10\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472559179630)\\/\"\n                },\n                {\n                    \"stepId\": \"fb271830-5368-43dc-b911-3d65af082e26\",\n                    \"name\": \"11. Ta kontakt\",\n                    \"shortName\": \"11\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472559179647)\\/\"\n                },\n                {\n                    \"stepId\": \"bf7a93a6-24af-4d01-8839-aa4f3f6b438d\",\n                    \"name\": \"12. Samla fakta och presentera\",\n                    \"shortName\": \"12\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472559179660)\\/\"\n                },\n                {\n                    \"stepId\": \"2a712108-e5d7-4ffb-a55f-80ff195ea946\",\n                    \"name\": \"13. Påverka och uttrycka åsikter\",\n                    \"shortName\": \"13\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472559179943)\\/\"\n                },\n                {\n                    \"stepId\": \"94b5abaa-0471-4ab4-be3c-c0b0d4098609\",\n                    \"name\": \"14. Språk i Sverige\",\n                    \"shortName\": \"14\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1475049857367)\\/\"\n                },\n                {\n                    \"stepId\": \"e0169353-8ac0-4fcd-8a45-4cfffc5fe55e\",\n                    \"name\": \"15. Min förebild\",\n                    \"shortName\": \"15\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1480951054357)\\/\"\n                },\n                {\n                    \"stepId\": \"e12c8fa6-8aaa-4598-8e6f-5c6d318163db\",\n                    \"name\": \"16. Förstå, minnas och lära\",\n                    \"shortName\": \"16\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1490605558217)\\/\"\n                },\n                {\n                    \"stepId\": \"1a19c53b-36f0-4309-adfd-26a307b43dbd\",\n                    \"name\": \"17. Använda språket i olika sammanhang\",\n                    \"shortName\": \"17\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"31aa5b91-59d0-41db-ab2e-0bdec6342dfe\",\n                    \"name\": \"18. Sammanfatta och presentera\",\n                    \"shortName\": \"18\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"48747057-835d-40fd-811f-dde4fd48f3a0\",\n                    \"name\": \"19. Den moderna ungdomen\",\n                    \"shortName\": \"19\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"4708aedf-3b7d-4ec0-80c9-769de4cdda9b\",\n                    \"name\": \"2. Författare\",\n                    \"shortName\": \"2\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472559179507)\\/\"\n                },\n                {\n                    \"stepId\": \"4258123d-d122-4058-8120-9de7d1fb3d66\",\n                    \"name\": \"20. Att vara ungdom idag\",\n                    \"shortName\": \"20\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"3d94e56d-9d38-4d3c-a3cb-d4f2d13814c9\",\n                    \"name\": \"21. Upplysningstiden och romantiken\",\n                    \"shortName\": \"21\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"5d8c3d70-e996-4236-9326-982ed128340c\",\n                    \"name\": \"22. Realismen och modernismen\",\n                    \"shortName\": \"22\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"02037ab3-ffdf-4fe2-a172-26de404c58bc\",\n                    \"name\": \"23. Våga utanför ramarna\",\n                    \"shortName\": \"23\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"7c376d37-0170-49ac-865d-5479d82ce806\",\n                    \"name\": \"24. Modern litteratur\",\n                    \"shortName\": \"24\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"7131b28d-89d1-40f6-8d87-80fd0c15486d\",\n                    \"name\": \"25. Budskapet\",\n                    \"shortName\": \"25\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"30c876a6-48a7-4fc7-a49f-ad44bac3d4bb\",\n                    \"name\": \"26. Övertyga och påverka\",\n                    \"shortName\": \"26\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"97b328ea-3342-41d6-a1c5-91e9c1d17a08\",\n                    \"name\": \"27. Språkbruk genom tiderna\",\n                    \"shortName\": \"27\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"e4ec472d-b31c-4d20-886c-0162e1159e55\",\n                    \"name\": \"28. Tidningstexter\",\n                    \"shortName\": \"28\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"47ccf40e-28a1-4432-91ed-f3013eb97aa8\",\n                    \"name\": \"29. Samtala om texter\",\n                    \"shortName\": \"29\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"6c89c307-adff-46b8-9d75-2ecb1fc714ce\",\n                    \"name\": \"3. Leka med ord\",\n                    \"shortName\": \"3\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472559179520)\\/\"\n                },\n                {\n                    \"stepId\": \"2145d4aa-60db-42f9-918b-49f3bf714786\",\n                    \"name\": \"30. Språkets möjligheter\",\n                    \"shortName\": \"30\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"c211ba3d-b8fa-4c5c-bbe1-bcfea2a243b5\",\n                    \"name\": \"31. Dikt och diktanalys\",\n                    \"shortName\": \"31\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"fbeb356a-5c9d-4114-9a4b-9ac2325913d0\",\n                    \"name\": \"32. Berättarteknik i skönlitteratur\",\n                    \"shortName\": \"32\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"4446df13-5bb8-4cf1-beb4-4d2b43bf97b8\",\n                    \"name\": \"33. Utveckla ditt skönlitterära skrivande\",\n                    \"shortName\": \"33\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"47e0c5bf-2898-4cc3-8119-2346d4c6c78f\",\n                    \"name\": \"34. Noveller\",\n                    \"shortName\": \"34\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"3b072a72-9f2c-4439-b095-33edb5ae3276\",\n                    \"name\": \"35. Det fria ordet - En skönlitterär djupdykning\",\n                    \"shortName\": \"35\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"56a2b991-63f5-4f1c-8e48-1bc1f83fa9a9\",\n                    \"name\": \"36. Debatt och retorik\",\n                    \"shortName\": \"36\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"7b0e633b-65b5-407d-8bdd-d77673d1be1f\",\n                    \"name\": \"37. Argumenterande texter\",\n                    \"shortName\": \"37\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"d76356c9-2fdd-4845-aa7a-1bf54547a34e\",\n                    \"name\": \"38. Analysera tal\",\n                    \"shortName\": \"38\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"eb312838-f59b-4815-987f-d7f11973a95f\",\n                    \"name\": \"39. Tal\",\n                    \"shortName\": \"39\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"48559f29-37cb-451f-8f40-354101a413af\",\n                    \"name\": \"4. Skrivarskola\",\n                    \"shortName\": \"4\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472559179537)\\/\"\n                },\n                {\n                    \"stepId\": \"a054f1e2-b296-4185-b9b7-dac94f600ab3\",\n                    \"name\": \"40. Muntlig argumentation\",\n                    \"shortName\": \"40\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"2e5ff9f3-ac8e-4fea-abe2-a7534e64e25f\",\n                    \"name\": \"41. Modern lyrik\",\n                    \"shortName\": \"41\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"ceed4cee-dd38-40b9-af97-43b0af244a41\",\n                    \"name\": \"42. Nobelpriset i litteratur\",\n                    \"shortName\": \"42\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"2df27363-1a57-4129-96dc-5e2a26dc0209\",\n                    \"name\": \"43. Analysmetod i akademiska uppsatser\",\n                    \"shortName\": \"43\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"71062f38-2874-4d6a-96b9-8128a10e3559\",\n                    \"name\": \"44. Litteratur som väckt debatt genom tiderna\",\n                    \"shortName\": \"44\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"d0e40b55-4638-45fd-b9f3-924c68c673cc\",\n                    \"name\": \"45. Analysera vetenskapligt\",\n                    \"shortName\": \"45\",\n                    \"isCompleted\": null,\n                    \"completedDate\": null\n                },\n                {\n                    \"stepId\": \"5954c057-cdc2-4293-bb9e-8b96ec27e04c\",\n                    \"name\": \"5. Min bästa sak på äventyr\",\n                    \"shortName\": \"5\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472559179553)\\/\"\n                },\n                {\n                    \"stepId\": \"5b9e5c30-c9de-4092-b7e6-0dbb4e3513ff\",\n                    \"name\": \"6. Faktatext\",\n                    \"shortName\": \"6\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472559179567)\\/\"\n                },\n                {\n                    \"stepId\": \"2b823257-8dad-4f6b-8f2b-539e4dae0bd4\",\n                    \"name\": \"7. Tal- och skriftspråk\",\n                    \"shortName\": \"7\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472559179583)\\/\"\n                },\n                {\n                    \"stepId\": \"28e73fd2-c40a-4319-8b93-ec0f1b658c81\",\n                    \"name\": \"8. Dikter\",\n                    \"shortName\": \"8\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472559179600)\\/\"\n                },\n                {\n                    \"stepId\": \"35a5926a-8cb3-4c9d-a7ef-714761935755\",\n                    \"name\": \"9. Olika texttyper\",\n                    \"shortName\": \"9\",\n                    \"isCompleted\": true,\n                    \"completedDate\": \"\\/Date(1472559179613)\\/\"\n                }\n            ]\n        }\n    ]\n}\n","import {EDSAssessment} from '../../contracts/eds';\n\nexport const assessments: {assessments: EDSAssessment[]} =\n\n{\n    \"assessments\": [\n      {\n        \"publishDateTime\": \"2017-08-28T09:05:43.16\",\n        \"text\": \"Testbedömning Engelsa 5\",\n        \"gradeName\": \"C\",\n        \"courseUnitName\": \"1. Ready, steady, go!\"\n      },\n      {\n        \"publishDateTime\": \"2017-08-28T08:59:21.253\",\n        \"text\": \"Testbedömning...\\r\\n/ Kim test\",\n        \"gradeName\": \"C\",\n        \"courseUnitName\": \"Tema 1\"\n      },\n      {\n        \"publishDateTime\": \"2017-08-10T09:43:36.797\",\n        \"text\": \"Test\",\n        \"gradeName\": \"D\",\n        \"courseUnitName\": \"Block 1\"\n      }\n    ]\n  }","import {EDSStudyPlan} from '../../contracts/eds';\n\nexport const studyPlans: {StudyPlans: EDSStudyPlan[]} =\n\n{\n    \"StudyPlans\": [\n        {\n            \"courseUnitName\": \"Hem- och konsumentkunskap\",\n            \"finalGoalGrade\": \"B\",\n            \"strategyText\": \"\",\n            \"periodGoals\": [\n                {\n                    \"periodName\": \"VT2017\",\n                    \"gradeName\": \"C\"\n                },\n                {\n                    \"periodName\": \"HT2016\",\n                    \"gradeName\": \"C\"\n                }\n            ]\n        },\n        {\n            \"courseUnitName\": \"Historia\",\n            \"finalGoalGrade\": \"C\",\n            \"strategyText\": \"\",\n            \"periodGoals\": [\n                {\n                    \"periodName\": \"VT2017\",\n                    \"gradeName\": \"D\"\n                },\n                {\n                    \"periodName\": \"HT2016\",\n                    \"gradeName\": \"C\"\n                }\n            ]\n        },\n        {\n            \"courseUnitName\": \"Fysik\",\n            \"finalGoalGrade\": \"C\",\n            \"strategyText\": \"\",\n            \"periodGoals\": [\n                {\n                    \"periodName\": \"VT2017\",\n                    \"gradeName\": \"D\"\n                },\n                {\n                    \"periodName\": \"HT2016\",\n                    \"gradeName\": \"C\"\n                }\n            ]\n        },\n        {\n            \"courseUnitName\": \"Geografi\",\n            \"finalGoalGrade\": \"C\",\n            \"strategyText\": \"\",\n            \"periodGoals\": [\n                {\n                    \"periodName\": \"VT2017\",\n                    \"gradeName\": \"D\"\n                },\n                {\n                    \"periodName\": \"HT2016\",\n                    \"gradeName\": \"D\"\n                }\n            ]\n        },\n        {\n            \"courseUnitName\": \"Matematik\",\n            \"finalGoalGrade\": \"C\",\n            \"strategyText\": \"\",\n            \"periodGoals\": [\n                {\n                    \"periodName\": \"VT2017\",\n                    \"gradeName\": \"C\"\n                },\n                {\n                    \"periodName\": \"HT2016\",\n                    \"gradeName\": \"C\"\n                }\n            ]\n        },\n        {\n            \"courseUnitName\": \"Samhällskunskap\",\n            \"finalGoalGrade\": \"B\",\n            \"strategyText\": \"\",\n            \"periodGoals\": [\n                {\n                    \"periodName\": \"VT2017\",\n                    \"gradeName\": \"C\"\n                },\n                {\n                    \"periodName\": \"HT2016\",\n                    \"gradeName\": \"D\"\n                }\n            ]\n        },\n        {\n            \"courseUnitName\": \"Engelska\",\n            \"finalGoalGrade\": \"A\",\n            \"strategyText\": \"\",\n            \"periodGoals\": [\n                {\n                    \"periodName\": \"VT2017\",\n                    \"gradeName\": \"A\"\n                },\n                {\n                    \"periodName\": \"HT2016\",\n                    \"gradeName\": \"B\"\n                }\n            ]\n        },\n        {\n            \"courseUnitName\": \"Religionskunskap\",\n            \"finalGoalGrade\": \"B\",\n            \"strategyText\": \"\",\n            \"periodGoals\": [\n                {\n                    \"periodName\": \"VT2017\",\n                    \"gradeName\": \"C\"\n                },\n                {\n                    \"periodName\": \"HT2016\",\n                    \"gradeName\": \"C\"\n                }\n            ]\n        },\n        {\n            \"courseUnitName\": \"Idrott och hälsa\",\n            \"finalGoalGrade\": \"C\",\n            \"strategyText\": \"\",\n            \"periodGoals\": [\n                {\n                    \"periodName\": \"VT2017\",\n                    \"gradeName\": \"D\"\n                },\n                {\n                    \"periodName\": \"HT2016\",\n                    \"gradeName\": \"D\"\n                }\n            ]\n        },\n        {\n            \"courseUnitName\": \"Biologi\",\n            \"finalGoalGrade\": \"D\",\n            \"strategyText\": \"\",\n            \"periodGoals\": [\n                {\n                    \"periodName\": \"VT2017\",\n                    \"gradeName\": \"C\"\n                },\n                {\n                    \"periodName\": \"HT2016\",\n                    \"gradeName\": \"C\"\n                }\n            ]\n        },\n        {\n            \"courseUnitName\": \"Svenska\",\n            \"finalGoalGrade\": \"C\",\n            \"strategyText\": \"\",\n            \"periodGoals\": [\n                {\n                    \"periodName\": \"VT2017\",\n                    \"gradeName\": \"C\"\n                },\n                {\n                    \"periodName\": \"HT2016\",\n                    \"gradeName\": \"C\"\n                }\n            ]\n        },\n        {\n            \"courseUnitName\": \"Teknik\",\n            \"finalGoalGrade\": \"C\",\n            \"strategyText\": \"\",\n            \"periodGoals\": [\n                {\n                    \"periodName\": \"VT2017\",\n                    \"gradeName\": \"D\"\n                },\n                {\n                    \"periodName\": \"HT2016\",\n                    \"gradeName\": \"C\"\n                }\n            ]\n        },\n        {\n            \"courseUnitName\": \"Bild\",\n            \"finalGoalGrade\": \"B\",\n            \"strategyText\": \"\",\n            \"periodGoals\": [\n                {\n                    \"periodName\": \"VT2017\",\n                    \"gradeName\": \"C\"\n                },\n                {\n                    \"periodName\": \"HT2016\",\n                    \"gradeName\": \"C\"\n                }\n            ]\n        },\n        {\n            \"courseUnitName\": \"Spanska, språkval\",\n            \"finalGoalGrade\": \"C\",\n            \"strategyText\": \"\",\n            \"periodGoals\": [\n                {\n                    \"periodName\": \"VT2017\",\n                    \"gradeName\": \"D\"\n                },\n                {\n                    \"periodName\": \"HT2016\",\n                    \"gradeName\": \"\"\n                }\n            ]\n        },\n        {\n            \"courseUnitName\": \"Kemi\",\n            \"finalGoalGrade\": \"C\",\n            \"strategyText\": \"\",\n            \"periodGoals\": [\n                {\n                    \"periodName\": \"VT2017\",\n                    \"gradeName\": \"D\"\n                },\n                {\n                    \"periodName\": \"HT2016\",\n                    \"gradeName\": \"B\"\n                }\n            ]\n        },\n        {\n            \"courseUnitName\": \"Slöjd\",\n            \"finalGoalGrade\": \"C\",\n            \"strategyText\": \"\",\n            \"periodGoals\": [\n                {\n                    \"periodName\": \"VT2017\",\n                    \"gradeName\": \"D\"\n                },\n                {\n                    \"periodName\": \"HT2016\",\n                    \"gradeName\": \"B\"\n                }\n            ]\n        },\n        {\n            \"courseUnitName\": \"Musik\",\n            \"finalGoalGrade\": \"B\",\n            \"strategyText\": \"\",\n            \"periodGoals\": [\n                {\n                    \"periodName\": \"VT2017\",\n                    \"gradeName\": \"C\"\n                },\n                {\n                    \"periodName\": \"HT2016\",\n                    \"gradeName\": \"D\"\n                }\n            ]\n        }\n    ]\n}","import { EDSCourse, EDSAssessment, EDSStudyPlan, EDSStudentFutureAbility } from '../contracts/eds';\nimport { RestClient } from 'kedbackend/js/dist/ked-backend-client/restclient';\nimport { IsomorphicEnv, BearerProvider, HttpError } from 'kedbackend/client';\nimport { SchoolMoment } from '../utils/school-moment';\nimport { SchoolTerm } from '../utils/school-term';\nimport { dateTimeReviver, L } from '../utils/utils';\nimport { courses } from './eds-stubdata/ActiveCourses';\nimport { assessments } from './eds-stubdata/LatestAssessments';\nimport { studyPlans } from './eds-stubdata/StudentGoals';\nimport env from '../globals/KED.env';\n//Gamla: const API_URL = \"https://test-dev-eds-cs.cloudapp.net/WebAPI/\";\n//NYA: const API_URL = \"https://edsportalowinapi.azurewebsites.net/api/\";\n\nfunction privatizingCacheBust () {\n  return {user: env.currentUser.mail};\n}\nexport class EdsClient {\n  http: RestClient;\n\n  constructor (\n    isomorphic: IsomorphicEnv,\n    baseUrl: string,\n    bearerProvider: BearerProvider\n  ) {\n    this.http = new RestClient (isomorphic, baseUrl, {bearerProvider});\n    this.getActiveCourses = avoidSimultanousCalls(this.getActiveCourses);\n    this.getLatestAssessments = avoidSimultanousCalls(this.getLatestAssessments);\n    this.getStudentGoals = avoidSimultanousCalls(this.getStudentGoals);\n    this.getStudentFutureAbilities = avoidSimultanousCalls(this.getStudentFutureAbilities);\n  }\n\n/**\n   * Retrieve active courses for current logged in student.\n   *\n   * @param courseCode Short-name of the course. Optional.\n   */\n  async getActiveCourses(q: {courseCode?: string, periodName: string}) {\n    try {\n      const query:any = privatizingCacheBust();\n      if (q) {\n        if (q.courseCode) query.CourseCode = q.courseCode;\n        if (q.periodName) query.PeriodName = q.periodName;\n      }\n      const res = await this.http.get(\"studentactivecourses\", query);\n      if (res.status != 200) throw new HttpError(res.status, await res.text());\n      const json = await res.json();\n      return json.courses as EDSCourse[];\n    } catch (ex) {\n      console.error(\"Error from EDS: \" + ex);\n      throw new Error(L`Kunde tyvärr inte ladda terminsmål eller avklarade steg från EDS. Försök igen senare...`);\n    }\n  }\n\n  /**\n   * Retrieve latest assessments for current logged in user.\n   * \n   * @param limit Optional limit\n   */\n  async getLatestAssessments(limit?: number) {\n    const query:any = privatizingCacheBust();\n    if (!isNaN(limit)) query.Count = limit;\n    const res = await this.http.get(\"studentassessments\", query);\n    if (res.status != 200) throw new HttpError(res.status, await res.text());\n    const json = await res.json();\n    return json.assessments as EDSAssessment[];    \n  }\n\n  /**\n   * Retrieve studyplans for current logged-in user\n   */\n  async getStudentGoals() {\n    const res = await this.http.get(\"studentgoals\", privatizingCacheBust());\n    if (res.status != 200) throw new HttpError(res.status, await res.text());\n    const json = await res.json();\n    return json.studentGoals as EDSStudyPlan[];    \n  }\n\n  async getStudentFutureAbilities() {\n    const res = await this.http.get(\"studentFutureAbilities\", privatizingCacheBust());\n    if (res.status != 200) throw new HttpError(res.status, await res.text());\n    const json = await res.json();\n    return json.studentFutureAbilities as EDSStudentFutureAbility[];\n  }\n}\n\nexport class EDSPeriod {\n  period: string;\n  term: 'AT' | 'ST';\n  year: number;\n  constructor (periodStringOrSchoolTerm: string | SchoolMoment) {\n    if (typeof periodStringOrSchoolTerm === 'string') {\n      this.period = periodStringOrSchoolTerm;\n      this.term = this.period.startsWith('HT') ? 'AT' : 'ST';\n      this.year = parseInt(this.period.substr(2));\n      if (isNaN(this.year)) throw new Error (`Invalid period: ${this.period}`);\n    } else {\n      const schoolTerm = new SchoolTerm(periodStringOrSchoolTerm);\n      this.period = (schoolTerm.term === 'AT' ? \"HT\" : \"VT\") + schoolTerm.year;\n      this.term = schoolTerm.term;\n      this.year = schoolTerm.year;\n    }\n  }\n\n  get schoolTerm () : SchoolTerm {\n    return new SchoolTerm({\n      academicYear: this.term === 'AT' ?\n        `${this.year}/${this.year + 1}` :\n        `${this.year-1}/${this.year}`,\n      term: this.term\n    });\n  }\n\n  toString() {\n    return this.period;\n  }\n\n  valueOf() {\n    return this.year + \":\" + (this.term === 'ST' ? \"1\" : \"2\");\n  }\n}\n\nexport function parseJsonDate_old (jsonDateStr: string) : Date {\n  const date = dateTimeReviver(\"\", jsonDateStr);\n  if (!(date instanceof Date)) throw new Error(\"Invalid JSON date string: \" + jsonDateStr);\n  return date;\n}\n\nexport class StubEdsClient implements EdsClient {\n  http: RestClient;\n\n  constructor () {\n    this.http = null;\n  }\n\n  async getActiveCourses(q?: { courseCode?: string; periodName?: string; }) {\n    let result = courses.courses;\n      if (q) {\n        if (q.courseCode) result = result.filter (c => c.shortName === q.courseCode);\n        if (q.periodName) result = result.filter(c => c.periodName === q.periodName);\n      }\n      return result;\n  }\n\n  async getLatestAssessments(limit?: number) {\n    return limit ?\n        assessments.assessments.slice(0, limit) :\n        assessments.assessments;\n  }\n\n  async getStudentGoals() {\n    return studyPlans.StudyPlans;\n  }\n\n  async getStudentFutureAbilities() {\n    return [] as EDSStudentFutureAbility[];\n  }  \n}\n\nfunction avoidSimultanousCalls<T,A>(method: (...args:A[])=>Promise<T>) : (...args:A[])=>Promise<T> {\n  let ongoingPromises: {[argsJson: string]: Promise<T>} = {};\n  return function() {\n    const argsJson = JSON.stringify([].slice.call(arguments));\n    if (!ongoingPromises[argsJson]) {\n      ongoingPromises[argsJson] = method.apply(this, arguments).then(result=>{\n        delete ongoingPromises[argsJson];\n        return result;\n      });\n    }\n    return ongoingPromises[argsJson];\n  }\n}\n","/* REFACTOR: Move this component outside coursebuilder!\n   This is a general-purpose component\n*/\n\nimport * as React from 'react';\n\ninterface Props {\n  title: string | JSX.Element;\n  className?: string;\n  headerClassName?: string;\n  contentClassName?: string;\n  headerOpen?: boolean;\n  onOpenClose?: (becameOpen: boolean) => void;\n  children;\n}\n\ninterface State {\n  headerOpen: boolean;\n}\n\nexport class OpenCloseBox extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      headerOpen: props.headerOpen || false\n    };\n  }\n\n  componentWillReceiveProps (nextProps: Props) {\n    if (nextProps.headerOpen !== this.props.headerOpen) {\n      this.setState({headerOpen: nextProps.headerOpen});\n    }\n  }\n\n  render() {\n    const { title, className, children, headerClassName, contentClassName } = this.props;\n    const { headerOpen } = this.state;\n\n    return <div className={(className||'') + \" openClose\" + (headerOpen ? \" open\" : \"\")}>\n      <div className={\"openHeader\" + (headerClassName ? \" \" + headerClassName : \"\")}\n        onClick={() => {\n          if (this.props.onOpenClose) this.props.onOpenClose(!this.state.headerOpen);\n          this.setState({ headerOpen: !this.state.headerOpen });\n        }} >\n        {title}\n      </div>\n      <div className={\"openContent\" + (contentClassName ? \" \" + contentClassName : \"\")}>\n        {children}\n      </div>\n    </div>;\n  }\n}\n","import * as React from 'react';\nimport { L } from '../../utils/utils';\nimport $ from 'jquery';\n\ninterface Props {\n    text: string;\n    tag?: 'input' | 'textarea'\n    eager?: boolean;\n    onChange: (newName: string) => void;\n    placeholder?: string; // If text is empty, this will be the placeholder\n    clickAdvertiseText?: string;\n    maxChars?: number;\n    readOnly?: boolean;\n}\n\ninterface State {\n    editMode: boolean;\n    runtimeStyle: Object;\n    text: string | null;\n}\n\n/** \n * Makes a text element (such as an A or P tag) possible to replace with an input element of the same CSS style, for example by clicking on it.\n * \n*/\nexport class RenameableText extends React.Component<Props,State> {\n    label: HTMLElement;\n    input: HTMLInputElement | HTMLTextAreaElement;\n\n    constructor(props: Props) {\n        super(props);\n        this.state = {\n            editMode: false,\n            runtimeStyle: null,\n            text: props.text || \"\"\n        }\n    }\n\n    componentWillReceiveProps(nextProps) {\n        if (this.props.text !== nextProps.text) {\n            this.setState({text: nextProps.text || \"\"});\n        }\n    }\n\n    render() {\n        const text = this.state.text || \"\";\n        return <div\n                className={\"renameable-text\" + (text ? \"\" : \" unnamed\") + (this.props.readOnly ? \" disabled\" : \"\")}\n                tabIndex={!this.state.editMode && 0}\n                onFocus={(e)=>{this.rename()}}\n                style={{width: \"100%\"}}\n            >\n            <div\n                ref={label => this.label = label}                \n                style={{\n                    display: this.state.editMode ? 'none' : ''\n                }}\n            >\n                {text || this.props.clickAdvertiseText}\n            </div>\n            {this.props.tag === 'textarea' ?\n                <textarea ref={input => this.input = input}\n                    maxLength={this.props.maxChars}\n                    style={{...this.state.runtimeStyle, display: this.state.editMode ? '' : 'none'}}\n                    onFocus={ev=>$(ev.target).select()}\n                    onBlur={this.onBlur.bind(this)}\n                    value={text}\n                    onKeyDown={this.onKeyDown.bind(this)}\n                    onChange={this.onChange.bind(this)}\n                    tabIndex={this.state.editMode && 0}\n                    placeholder={this.props.placeholder}\n                /> : \n                <input ref={input => this.input = input}\n                    type=\"text\"\n                    maxLength={this.props.maxChars}\n                    style={{...this.state.runtimeStyle, display: this.state.editMode ? '' : 'none'}}\n                    onFocus={ev=>$(ev.target).select()}\n                    onBlur={this.onBlur.bind(this)}\n                    value={text}\n                    onKeyDown={this.onKeyDown.bind(this)}\n                    onChange={this.onChange.bind(this)}\n                    tabIndex={this.state.editMode ? 0 : undefined}\n                    placeholder={this.props.placeholder}\n                />\n            }\n        </div>\n    }\n\n    onKeyDown(e: KeyboardEvent) {\n        if (e.keyCode === 27) { // ESC\n            this.input.value = this.props.text || \"\";\n            this.input.blur();\n            e.stopPropagation();\n        } else if (e.keyCode === 13) { // ENTER\n            this.propagateOnChange(this.input.value);\n            this.setState({ editMode: false, text: this.input.value });\n        }\n    }\n\n    onBlur(e: Event) {\n        this.propagateOnChange(this.input.value);\n        this.setState({ editMode: false, text: this.input.value });\n    }\n\n    propagatedOnChange: string;\n\n    propagateOnChange(newValue) {\n        if (this.propagatedOnChange != newValue) {\n            this.propagatedOnChange = newValue;\n            this.props.onChange(newValue);\n        }\n    }\n\n    onChange(e: Event) {\n        this.setState({ text: this.input.value });\n        if (this.props.eager) this.propagateOnChange(this.input.value);\n    }\n\n    rename(txt?: string) {\n        if (this.state.editMode || this.props.readOnly) return;\n        txt = txt || this.state.text || \"\";\n        const label = $(this.label);\n        this.setState({\n            text: txt,\n            editMode: true,\n            runtimeStyle: {\n                textAlign: label.css('textAlign'),\n                fontSize: label.css('font-size'),\n                paddingTop: label.css('paddingTop'),\n                paddingBottom: label.css('paddingBottom'),\n                paddingLeft: label.css('paddingLeft'),\n                paddingRight: label.css('paddingRight'),\n                marginTop: label.css('marginTop'),\n                marginBottom: label.css('marginBottom'),\n                marginLeft: label.css('marginLeft'),\n                marginRight: label.css('marginRight'),\n                borderRadius: label.css('borderRadius'),\n                backgroundColor: label.css('backgroundColor'),\n                lineHeight: label.css('lineHeight'),\n                fontWeight: label.css('fontWeight'),\n                outLine: 0,\n                borderStyle: 'none',\n                height: \"100%\",\n                width: \"100%\",\n                boxSizing: \"border-box\",\n            }\n        }, ()=>$(this.input).focus());\n    }\n}\n","import moment from 'moment';\nimport { SchoolMoment, getSchoolMoment, addYear } from './school-moment';\nimport { AcademicYear, Term } from '../contracts/ked-models';\n\ntype Moment = moment.Moment;\n\nfunction isSchoolMoment(obj: Date | SchoolMoment): obj is SchoolMoment {\n  return 'academicYear' in obj;\n}\n\nexport class SchoolTerm {\n  academicYear: AcademicYear;\n  term: Term;\n\n  constructor(dateOrSchoolMoment: Date | SchoolMoment) {\n    const schoolMoment = isSchoolMoment(dateOrSchoolMoment) ?\n      dateOrSchoolMoment : getSchoolMoment(moment(dateOrSchoolMoment));\n    this.academicYear = schoolMoment.academicYear;\n    this.term = schoolMoment.term;\n  }\n\n  get year() {\n    return parseInt(this.academicYear\n        .split('/')[this.term === 'AT' ? 0 : 1]);\n  }\n\n  nextTerm() {\n    return new SchoolTerm(this.term === 'AT' ?\n      {\n        term: 'ST',\n        academicYear: this.academicYear\n      } :\n      {\n        term: 'AT',\n        academicYear: addYear(this.academicYear, 1)\n      });\n  }\n\n  prevTerm() {\n    return new SchoolTerm(this.term === 'AT' ?\n      {\n        term: 'ST',\n        academicYear: addYear(this.academicYear, -1)\n      } :\n      {\n        term: 'AT',\n        academicYear: this.academicYear\n      });\n    \n  }\n\n  toLocaleString(locales: string[], shortYear?: boolean) {\n    let year = this.term === 'AT' ?\n      this.academicYear.split('/')[0]:\n      this.academicYear.split('/')[1];\n\n    if (shortYear)\n      year = year.substr(2);\n\n    for (let locale of locales) {\n      switch (locale.split('-')[0].split('_')[0].toLowerCase()) {\n        case 'en':\n          return `${this.term === 'AT' ? \"AT\" : \"ST\"} ${year}`;\n        case 'sv':\n          return `${this.term === 'AT' ? \"HT\" : \"VT\"} ${year}`;\n      }\n    }\n  }\n}\n","import * as React from 'react';\nimport { L } from \"../../../utils/utils\";\n\ninterface Props {\n  onClick,\n  className?,\n  style?,\n  title?\n};\n\nexport const RemoveItem = ({ onClick, className, style, title }: Props) =>\n\n  <div\n    title={title || L`Radera`}\n    className={\"removeItem \" + (className || \"\")}\n    onClick={onClick} style={style} />\n","import { User } from '../contracts/ked-models';\nimport { parseQueryString } from '../utils/query-string';\nimport env from '../globals/KED.env';\n\nexport class Features {\n  EditUserTasksViaPenOnly?: boolean;\n  SubTasks?: boolean;\n  AssignmentTasks?: boolean;\n\n  constructor () {\n    const user = env.currentUser!;\n    const query = parseQueryString(location.search, {toLower: true});\n    const features = ((query.features||'').split(',') as string[])\n      .map(feature => feature.toLowerCase()); // Can be used on forwards...\n\n    this.EditUserTasksViaPenOnly =\n      user.schoolType !== 'Grundskolor' && query.schooltype !== \"Grundskolor\";\n    this.SubTasks =\n      user.schoolType !== 'Grundskolor' && query.schooltype !== \"Grundskolor\";\n    this.AssignmentTasks = !!query.testversion;\n  }\n}\n","\n\nexport interface RepoCommunicator<T extends {id: string}> {\n  query(): Promise<T[]>;\n}\n\ntype Subscriber<T> = (items:T[]) => any;\n\nexport class Repo<T extends {id: string}> {\n  listPromise: Promise<void>;\n  items: T[];\n  subscribers: Subscriber<T>[];\n\n  constructor(public comm: RepoCommunicator<T>) {\n    this.listPromise = null;\n    this.items = null;\n    this.subscribers = [];\n  }\n\n  subscribe(subscriber: Subscriber<T>) {\n    return this.ensureHasData().then(()=>{\n      subscriber(this.items);\n      this.subscribers.push(subscriber);\n    });\n  }\n\n  unsubscribe(subscriber: Subscriber<T>) {\n    this.subscribers = this.subscribers.filter (s => s !== subscriber);\n  }\n\n  notifySubscribers() {\n    this.subscribers.forEach(s => s(this.items));\n  }\n\n  ensureHasData() {\n    if (!this.listPromise) this.refreshFromServer();\n    return this.listPromise;\n  }\n\n  refreshFromServer() {\n    this.listPromise = this.comm.query().then(items => {\n      this.items = items;\n      this.notifySubscribers();\n    });\n    return this.listPromise;\n  }\n  \n  async update(item: T | T[]) {\n    await this.ensureHasData();\n    const items = Array.isArray(item) ? item : [item];\n    this.items = this.items.map(it => {\n      const item = items.find(({id}) => it.id === id);\n      return item ?\n        Object.assign({}, item) :\n        it;\n    });\n    this.notifySubscribers();\n  }\n\n  insert(item: T | T[]) {\n    return this.ensureHasData().then(()=>{\n      this.items = this.items.concat(item);\n      this.notifySubscribers();\n    });\n  }\n\n  delete(id: string | string[]) {\n    const ids = Array.isArray(id) ? id : [id];\n    return this.ensureHasData().then(()=>{\n      this.items = this.items.filter(it => !ids.some(id => it.id === id));\n      this.notifySubscribers();\n    });\n  }\n}\n","import {User} from '../../contracts/ked-models';\n\nexport const users : User[] = [{\n    displayName: \"Administratör\",\n    mail: \"vemendo@kedschools.com\",\n    roles: ['ADMIN','EMPLOYEE'],\n    school: 'KED',\n    username: \"admin\"\n},{\n    displayName: \"David\",\n    mail: \"david.fahlander@vemendo.se\",\n    roles: ['ADMIN','EMPLOYEE'],\n    school: 'KED',\n    username: \"david\"\n},{\n    displayName: \"Test-Live-Elev1\",\n    mail: \"ubw6757@edu.kunskapsgymnasiet.se\",\n    roles: ['STUDENT'],\n    school: 'Uppsala',\n    username: \"ubw6757@edu.kunskapsgymnasiet.se\"\n},{\n    displayName: \"Test-Live-Elev2\",\n    mail: \"ums4302@edu.kunskapsgymnasiet.se\",\n    roles: ['STUDENT'],\n    school: 'Uppsala',\n    username: \"ums4302@edu.kunskapsgymnasiet.se\"\n},{\n    displayName: \"Test-Live-Elev3\",\n    mail: \"uhh3460@edu.kunskapsgymnasiet.se\",\n    roles: ['STUDENT'],\n    school: 'Uppsala',\n    username: \"uhh3460@edu.kunskapsgymnasiet.se\"\n},{\n    displayName: \"Test-Live-Elev4(fel goals issue)\",\n    mail: \"umt6826@edu.kunskapsskolan.se\",\n    roles: [\"STUDENT\"],\n    school: \"Uppsala\",\n    username: \"umt6826@edu.kunskapsskolan.se\"\n},{\n    displayName: \"Test-Live-Elev5(future abilities)\",\n    mail: \"ujg3833@edu.kunskapsskolan.se\",\n    roles: [\"STUDENT\"],\n    school: \"Uppsala\",\n    username: \"ujg3833@edu.kunskapsskolan.se\"\n},{\n    displayName: \"Test-Live-Elev6(future abilities)\",\n    mail: \"ujt1363@edu.kunskapsskolan.se\",\n    roles: [\"STUDENT\"],\n    school: \"Uppsala\",\n    username: \"ujt1363@edu.kunskapsskolan.se\"\n},{\n    displayName: \"Test-Live-Lärare1\",\n    mail: \"rickard.albertsson@kunskapsgymnasiet.se\",\n    roles: ['EMPLOYEE'],\n    school: 'Uppsala',\n    username: \"rickard.albertsson@kunskapsgymnasiet.se\"\n},{\n    displayName: \"EDSTestUserGymnasium\",\n    mail: \"uhh3200@edu.kunskapsgymnasiet.se\",\n    //mail: \"UHH3200@EDU.KUNSKAPSGYMNASIET.SE\",\n    roles: [\"STUDENT\"],\n    username: \"EDSTestUser1\",\n    school: \"KED\",\n    schoolType: \"Gymnasium\"\n},{\n    displayName: \"vemendo.elev@kedschools.com\",\n    mail: \"vemendo.elev@kedschools.com\",\n    roles: [\"STUDENT\"],\n    username: \"vemendo.elev@kedschools.com\",\n    school: \"KED\",\n    schoolType: \"Gymnasium\"\n},{\n    displayName: \"Medarbetare Nacka\",\n    mail: \"medarbetare.nacka@kunskapsskolan.se\",\n    roles: [\"EMPLOYEE\"],\n    username: \"medarbetare.nacka/KS\",\n    school: \"Nacka\",\n    schoolType: \"Grundskolor\"\n},{\n    displayName: \"Medarbetare Globen\",\n    mail: \"medarbetare.globen@kunskapsgymnasiet.se\",\n    roles: [\"EMPLOYEE\"],\n    username: \"medarbetare.globen/KS\",\n    school: \"Globen\",\n    schoolType: \"Gymnasium\"\n},{\n    displayName: \"Elev Globen\",\n    mail: \"elev.globen@edu.kunskapsgymnasiet.se\",\n    schoolGrade: 2,\n    roles: ['STUDENT'],\n    username: \"elev.globen\",\n    school: \"Globen\",\n    schoolType: \"Gymnasium\"\n},{\n    displayName: \"Elev Borås\",\n    mail: \"elev.boras@edu.kunskapsskolan.se\",\n    schoolGrade: 7,\n    roles: ['STUDENT'],\n    username: \"elev.boras\",\n    school: \"Borås\",\n    schoolType: \"Grundskolor\"\n},{\n    displayName: \"Elev Borlänge\",\n    mail: \"elev.borlange@edu.kunskapsskolan.se\",\n    schoolGrade: 9,\n    roles: ['STUDENT'],\n    username: 'elev.borlange/KS',\n    school: 'Borlänge',\n    schoolType: \"Gymnasium\"\n},{\n    displayName: \"Roll-lös\",\n    mail: \"none@kunskapsskolan.se\",\n    username: \"none\",\n    roles: []\n}];\n\n","import env from '../globals/KED.env';\nimport cfg from '../globals/KED.cfg';\nimport { KedBackendClientWeb } from 'kedbackend/clientweb';\n\nenv.kedBackendClient = new KedBackendClientWeb (\n  cfg.KED_API_URL,\n  env.bearerProvider);\n\n","import { parseQueryString, generateQueryString, splitUrlAndQuery } from \"../utils/query-string\";\nimport { KedBackendClientWeb, WebServerBearerProvider, isomorphic, storage } from 'kedbackend/clientweb';\nimport { BearerProvider, KedBearerProvider } from 'kedbackend/client';\nimport cfg from '../globals/KED.cfg';\nimport env from '../globals/KED.env';\nimport { User } from \"../contracts/ked-models\";\nimport { IMPERSONATION_QUERY_PARAMS } from \"../access-control/index\";\nimport { cherryPickProps } from \"../utils/utils\";\n\nfunction getMergedTokenPath(tokenPath: string, locationSearch: string, scopes: string[]) {\n  // Merge configured query params of token path with params given to current page\n  const currentQuery = parseQueryString(locationSearch);\n  const impersonationProps = cherryPickProps(currentQuery, IMPERSONATION_QUERY_PARAMS);\n  const [tokenPathWithoutQuery, tokenQueryString] = splitUrlAndQuery(tokenPath);\n  const tokenPathQuery = parseQueryString(tokenQueryString);\n  return tokenPathWithoutQuery + generateQueryString({\n    ...tokenPathQuery,\n    ...impersonationProps,\n    scopes: scopes.join(',')\n  });\n}\n\nfunction getTokenId(mergedTokenPath: string, userEmail: string) {\n  return mergedTokenPath + \"/\" + userEmail;\n}\n\nfunction saveUserInfo(user: User, tokenId: string) {\n  env.currentUser = user;\n  sessionStorage.setItem(\"userInfo\" + tokenId, JSON.stringify(user));\n}\n\nfunction loadUserInfo(tokenId: string) {\n  const storedSessionUser = sessionStorage.getItem(\"userInfo\" + tokenId);\n  if (storedSessionUser) {\n    env.currentUser = JSON.parse(storedSessionUser);\n  }\n}\n\nfunction createBearerProvider(mergedTokenPath: string, userEmail: string) {\n  const tokenId = getTokenId(mergedTokenPath, userEmail);\n  return new WebServerBearerProvider(mergedTokenPath, responseText => {\n    const res = JSON.parse(responseText) as { ok: boolean, error?: string, token?: string, user?: User };\n    if (!res.ok) throw new Error(res.error);\n    if (res.user) {\n      saveUserInfo(res.user, tokenId);\n    }\n    return { token: res.token, expires: Date.now() + 59 * 60 * 1000 };\n  }, tokenId);\n}\n\nfunction createGoogleTokenProvider(mergedTokenPath: string, userEmail: string) {\n  const tokenId = getTokenId(mergedTokenPath, userEmail);\n  return new WebServerBearerProvider(mergedTokenPath, responseText => {\n    const res = JSON.parse(responseText) as { ok: boolean, error?: string, token?: string, user?: User };\n    if (!res.ok) throw new Error(res.error);\n    return { token: res.token, expires: Date.now() + 59 * 60 * 1000 };\n  }, tokenId);\n}\n\nfunction createTestTokenProvider(tokenUrl: string, user: User, scopes: string[]) {\n  return new KedBearerProvider(\n    isomorphic,\n    storage,\n    tokenUrl + user.mail + location.search,\n    cfg.KED_CLIENT_ID,\n    cfg.KED_CLIENT_SECRET,\n    tokenUrl, {\n      email: user.mail.toLowerCase(),\n      roles: user.roles,\n      school: user.school,\n      schoolType: user.schoolType,\n      scopes\n    });\n}\n\n// env.currentUser.mail is set by SiteVision server initially.\n// A response from /api/token may change the mail attribute of the current\n// user, so env.currentUser.mail may be different after getting a response.\n// However, the initial value is valuable always in order to distinguish the case\n// when one normal user logs out and another user logs in.\nconst initialUserEmail = env.currentUser && env.currentUser.mail; // Initial value of mail. May change.\nif (initialUserEmail) {\n  // KED\n  if (cfg.KED_TOKEN_PATH) {\n    //\n    //\n    // Production / SiteVision proxied /api/token to request tokens from:\n    //\n    //\n    const mergedTokenPath = getMergedTokenPath(\n      cfg.KED_TOKEN_PATH,\n      location.search, [\n        \"kedbackend\",\n        \"EDS\",\n      ]);\n    env.bearerProvider = createBearerProvider(mergedTokenPath, initialUserEmail);\n    loadUserInfo(getTokenId(mergedTokenPath, initialUserEmail));\n\n    // Google\n    const googleMergedPath = getMergedTokenPath(\n      cfg.KED_TOKEN_PATH,\n      location.search, [\n        \"https://www.googleapis.com/auth/calendar.readonly\",\n      ]);\n    env.googleTokenProvider = createGoogleTokenProvider(googleMergedPath, initialUserEmail);\n  } else if (cfg.KED_TOKEN_URL && cfg.KED_CLIENT_ID && cfg.KED_CLIENT_SECRET) {\n    //\n    //\n    // Test - go directly to KEDAUTH server to retrieve tokens\n    //\n    //\n    env.bearerProvider = createTestTokenProvider(cfg.KED_TOKEN_URL, env.currentUser, [\n      \"kedbackend\",\n      \"EDS\",\n    ]);\n    env.googleTokenProvider = createTestTokenProvider(cfg.KED_TOKEN_URL + \"/google\", env.currentUser, [\n      \"https://www.googleapis.com/auth/calendar.readonly\",\n    ]);\n  } else {\n    throw new Error(`Missing configuration parameter KED_TOKEN_PATH`);\n  }\n}\n","import * as React from 'react';\nimport {L} from './utils';\nimport $ from 'jquery';\n\ninterface Props {\n}\n\ninterface State {\n  error: string | undefined;\n  info: string | undefined;\n}\n\nexport class ErrorSuccessFeedback extends React.Component<Props,State> {\n  constructor (props: Props) {\n    super(props);\n    this.state={\n      error: undefined,\n      info: undefined\n    };\n    this._unhandledRejection = this._unhandledRejection.bind(this);\n    this._error = this._error.bind(this);\n    this._customError = this._customError.bind(this);\n    this._onInfo = this._onInfo.bind(this);\n  }\n\n  componentDidMount() {\n    window.addEventListener('unhandledrejection', this._unhandledRejection);\n    window.addEventListener('error', this._error);\n    window.addEventListener('customerror', this._customError);\n    window.addEventListener('info', this._onInfo);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('unhandledrejection', this._unhandledRejection);\n    window.removeEventListener('error', this._error);\n    window.removeEventListener('customerror', this._customError);\n    window.removeEventListener('info', this._onInfo);\n  }\n\n  _unhandledRejection (ev: Event & {reason: Error}) {\n    this.setState({error: ev.reason ? ev.reason.message : L`Ett okänt fel inträffade...`, info: null});\n    setTimeout(()=>this.setState({error: null}), 10000);\n  }\n\n  _error (ev: Event & {error: Error}) {\n    this.setState({error: ev.error ? ev.error.message : L`Ett okänt fel inträffade...`, info: null});\n    setTimeout(()=>this.setState({error: null}), 10000);\n  }\n\n  _customError (ev: CustomEvent) {\n    this.setState({error: ev.detail, info: null});\n    setTimeout(()=>this.setState({error: null}), 10000);\n  }\n\n  _onInfo(ev: CustomEvent) {\n    this.setState({error: null, info: ev.detail });\n    setTimeout(()=>this.setState({info: null}), 10000);\n  } \n\n  render() {\n    return <div className=\"error-success-feedback\" style={{\n      position: \"fixed\",\n      left: 0,\n      top: 0,\n      width: \"100%\",\n      pointerEvents: 'none'\n    }}>\n      <div style={{display: 'table', margin: \"0 auto\"}}>\n        <p className=\"error\" style={{display: this.state.error ? \"\" : \"none\"}}>{this.state.error && this.state.error}</p>\n        <p className=\"info\" style={{display: this.state.info ? \"\" : \"none\"}}>{this.state.info}</p>\n      </div>\n    </div>;\n  }\n}\n","import env from '../globals/KED.env';\nimport cfg from '../globals/KED.cfg';\nimport { isomorphic } from 'kedbackend/clientweb';\nimport { EdsClient } from '../apis/edsclient';\n\nenv.edsClient = new EdsClient (\n  isomorphic,\n  cfg.EDS_API_URL,\n  env.bearerProvider);\n\n","import * as React from 'react';\nimport { users } from '../data/users';\n\nexport function ChooseUser() {\n  let select;\n  return <div className=\"sv-layout\">\n    <h2>Välj användare</h2>\n    <table className=\"login-table\"><thead><tr>\n      <th>Namn</th>\n      <th>Roller</th>\n      <th>E-post</th>\n      <th>Skola</th>\n    </tr></thead>\n      <tbody>\n        {users.map(({ username, displayName, mail, school, roles }) =>\n          <tr key={mail} onClick={() => location.search = `?user=${username}`}>\n            <td>{displayName}</td>\n            <td style={roles.length === 0 ? { fontStyle: 'italic' } : {}}>{roles.length === 0 ? \"saknar roller\" : roles.join(', ')}</td>\n            <td>{mail}</td>\n            <td style={school ? {} : { fontStyle: 'italic' }}>{school || \"saknar skola\"}</td>\n          </tr>\n        )}\n      </tbody></table>\n  </div>\n};\n","var map = {\n\t\"./en-au\": 47,\n\t\"./en-au.js\": 47,\n\t\"./en-ca\": 46,\n\t\"./en-ca.js\": 46,\n\t\"./en-gb\": 45,\n\t\"./en-gb.js\": 45,\n\t\"./en-ie\": 44,\n\t\"./en-ie.js\": 44,\n\t\"./en-nz\": 43,\n\t\"./en-nz.js\": 43,\n\t\"./sv\": 42,\n\t\"./sv.js\": 42\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\tvar module = __webpack_require__(id);\n\treturn module;\n}\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) { // check for number or string\n\t\tvar e = new Error('Cannot find module \"' + req + '\".');\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn id;\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 58;","/* These scripts assume some of the global vars have already been set:\n  * KED.cfg\n  * KED.env.currentUser\n\n  The rest will be set here (client side)\n*/\nimport './set-bearer-providers';\nimport './set-ked-backend-client';\nimport './set-eds-client';\n","import cfg from '../globals/KED.cfg';\nimport env from '../globals/KED.env';\n\n/* Contains ENV-based config, replaced using rollup-plugin-replace by its corresponding\n * ENV-variables.\n *\n * See \n*/\ndeclare var process;\n\ncfg.ENVIRONMENT = process.env.ENVIRONMENT; // \"production\", \"development\" or \"test\"\ncfg.KED_TOKEN_PATH = null ; // Must be null in test environment for set-bearer-providers.ts to work accordingly!\ncfg.KED_TOKEN_URL = process.env.KED_TOKEN_URL; // \"https://kedauthtest.azurewebsites.net/token\"\ncfg.KED_CLIENT_ID = process.env.KED_CLIENT_ID; // \"devclient\", \"testclient\", \"...\"\ncfg.KED_CLIENT_SECRET = process.env.KED_CLIENT_SECRET;\ncfg.KED_API_URL = process.env.KED_API_URL; // \"https://kedbackendtest.azurewebsites.net/api/\"\ncfg.EDS_API_URL = process.env.EDS_API_URL; // \"https://edsportalowinapi.azurewebsites.net/api/\"\n\nimport { users } from './data/users';\nimport { parseQueryString } from '../utils/query-string';\nconst username = parseQueryString (location.search).user;\nif (username) {\n  const user = users.find(u => u.username === username);\n  if (user) {\n    env.currentUser = user;\n  }\n}\n\nconst { role, school } = parseQueryString(location.search);\nif (env.currentUser) {\n  if (role) {\n    env.currentUser.roles = role.split(',');\n  }\n  if (school) {\n    env.currentUser.school = school;\n  }\n}\n","import * as React from 'react';\nimport { HashRouter as Router, Route, Link, Redirect } from 'react-router-dom';\nimport { ICourseEditorHost } from \"../interfaces/course-editor-host\";\nimport { Course } from 'kedbackend/models';\nimport { readBlobAsText, allowCopy, readBlobAsDataUrl } from \"../utils\";\nimport { showError, L } from \"../../../utils/utils\";\nimport { createUUID } from \"kedbackend/client\";\nimport { hasAccess } from \"../../../access-control\";\nimport env from '../../../globals/KED.env';\n\ntype Callback = () => void;\n\ninterface Props {\n  title: string,\n  activePage: BannerMenuItem,\n  callbacks?: { [menuName: string]: Callback },\n  routes: { [menuName: string]: string } & { feedback: string },\n  backgroundImage?: string,\n  isTemplate?,\n  host?: ICourseEditorHost,\n  course?: Course,\n  origCourse?: Course\n}\n\ntype BannerMenuItem =\n  \"courseBuilder\" |\n  \"studentPage\" |\n  \"templateBuilder\" |\n  \"subjects\" |\n  \"schools\";\n\nconst AdminMenuItems = [\n  { name: \"schools\", text: L`Skolor`, route: \"/schools\" },\n  { name: \"subjects\", text: L`Ämnen`, route: \"/subjects\" },\n  //{name: \"templateBuilder\", text: L`Mallbyggaren`, route: \"/course-templates\"},\n]\n\nconst NonAdminMenuItems = [\n  { name: \"courseBuilder\", text: L`Kursbyggaren`, route: \"/courses/new\" },\n  { name: \"studentPage\", text: L`Elevsida`, route: \"\" },\n  { name: \"feedback\", text: <span><i className=\"fa fa-commenting-o\" aria-hidden=\"true\"></i> Feedback</span>, route: \"https://kg.kunskapsporten.se/kursbyggaren/\" }\n]\n\n\nasync function onDropImage(ev: React.DragEvent<HTMLDivElement>, host: ICourseEditorHost, course: Course, origCourse: Course) {\n  ev.stopPropagation();\n  ev.preventDefault();\n  const files = ev.dataTransfer.files;\n  let url = null;\n  const items = Array.from(ev.dataTransfer.items);\n  if (files.length > 0) {\n    const file = files[0];\n    if (file.size > 2 * 1024 * 1024) {\n      showError(L`Kan inte ladda upp bilder större än 2 MB`);\n      return;\n    }\n    url = await readBlobAsDataUrl(file);\n  } else {\n    for (let i = 0; i < items.length; ++i) {\n      const item = items[i];\n      if (item.type.match('^text/uri-list')) {\n        // URI\n        url = await new Promise(resolve => item.getAsString(resolve));\n      }\n    }\n  }\n  if (url == null) {\n    showError(L`Kunde inte hitta någon bild i innehållet`);\n    return;\n  }\n  setCourseImage(course, origCourse, host, url);\n}\n\nexport function setCourseImage(\n  course: Course,\n  origCourse: Course,\n  host: ICourseEditorHost,\n  url: string\n) {\n  const imageId = createUUID();\n  host.update({\n    imageId: { $set: imageId },\n    images: {\n      $set: [{\n        id: imageId,\n        url,\n        acl: [\n          `role:USER:R`,\n          `schoolRole:${env.currentUser.school}/EMPLOYEE:S`\n        ],\n        $meta: 'add'\n      }]\n    }\n  });\n}\n\n/* This version had the bug that old images were not replaced.\nOne course at Uppsala contained 12 images.\n\n\nexport function setCourseImageOld(\n  course: Course,\n  origCourse: Course,\n  host: ICourseEditorHost,\n  url: string)\n{\n  if (!origCourse || !origCourse.imageId) {\n    const imageId = createUUID();\n    host.update({\n      imageId: { $set: imageId },\n      images: {\n        $push: [{\n          id: imageId,\n          url,\n          acl: course.isTemplate ? [\"role:USER:R\"] : [\"role:USER:R\", `schoolRole:${env.currentUser.school}/EMPLOYEE:S`],\n          $meta: 'add'\n        }]\n      }\n    });\n  } else {\n    // Update existing image:\n    const imgIdx = course.images.findIndex(img => img.id === course.imageId);\n    if (imgIdx >= 0) {\n      const imageEntity = course.images[imgIdx];\n      if (course.isTemplate) {\n        // Templates: Update the template image content:\n        host.update({\n          images: {\n            $splice: [[imgIdx, 1, {\n              ...imageEntity,\n              url,\n              $meta: 'update'\n            }]]\n          }\n        })\n      } else {\n        // Real courses: Replace with a new image\n        const imageId = createUUID();\n        host.update({\n          imageId: { $set: imageId },\n          images: {\n            $splice: [[imgIdx, 1, {\n              id: imageId,\n              url,\n              acl: [\n                `role:USER:R`,\n                `schoolRole:${env.currentUser.school}/EMPLOYEE:S`\n              ],\n              $meta: 'add'\n            }]]\n          }\n        })\n      }\n    } else {\n      showError(L`Kunde inte uppdatera bilden.`);\n    }\n  }\n}\n*/\n\nexport const CourseBanner = (props: Props) => {\n  const { title, isTemplate, host, course, origCourse, backgroundImage, activePage } = props;\n  const isAdmin = env.currentUser.roles.some(role => role === \"ADMIN\");\n  let menuItems = NonAdminMenuItems;\n  if (isAdmin) menuItems = AdminMenuItems.concat(menuItems);\n\n  return <div className=\"sv-row sv-layout sv-skip-spacer\">\n    <div className=\"sv-layout sv-skip-spacer sv-column-12\">\n      <div className=\"sv-script-portlet sv-portlet sv-skip-spacer\">\n        {backgroundImage && <style>{`\n        .pageHeader {\n          background-image: url('${backgroundImage}') !important;\n        }\n      `}</style>}\n        <div className=\"pageHeader\"\n          onDragOver={course && allowCopy}\n          onDrop={course && (ev => onDropImage(ev, host, course, origCourse))}>\n          <a>\n            <h1>{title}</h1>\n          </a>\n          <div className=\"buttonsField\">\n            <div className=\"buttonsContainer\">\n              <div className=\"align-horizontal\"></div>\n              <div className='horizontalMenu'>\n                <ul>\n                  {menuItems.map(item => ({\n                    item,\n                    isActive: activePage === item.name,\n                    callback: props.callbacks && props.callbacks[item.name],\n                    givenRoute: (props.routes && props.routes[item.name]),\n                    defaultRoute: item.route\n                  })).filter(x => x.callback || x.defaultRoute || x.givenRoute).map(({ item, isActive, callback, defaultRoute, givenRoute }) => {\n                    return <li\n                      key={item.name}\n                      className={isActive ? \"activePage\" : \"\"}\n                      onClick={callback}\n                    >\n                      {callback ?\n                        <a>{item.text}</a> :\n                        defaultRoute || givenRoute ?\n                          givenRoute || /^http[s]\\:\\/\\//i.test(defaultRoute) ?\n                            <a href={givenRoute || defaultRoute}>{item.text}</a> :\n                            <Link to={defaultRoute}>{item.text}</Link> :\n                          <a>{item.text}</a>}\n                    </li>;\n                  })}\n                </ul>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n}\n","import * as React from 'react';\nimport { School } from 'kedbackend/models';\nimport { DialogContainer } from \"../interfaces/course-editor-host\";\nimport { L } from \"../../../utils/utils\";\nimport env from '../../../globals/KED.env';\nimport { updateModificationAndCreationStamps } from \"../utils\";\nimport { EditSchool } from './edit-school';\nimport { Link } from 'react-router-dom';\nimport { actAs } from \"../../../access-control\";\nimport { Spinner } from \"../sub-components/spinner\";\n\ninterface Props {\n  schools?: School[]\n  viewCourseUrl: string\n}\n\nexport const EditableSchoolList = (props: Props) => {\n  const { schools, viewCourseUrl } = props;\n  const isAdmin = env.currentUser.roles.some(role => role === \"ADMIN\");\n  return <div className=\"editable-school-list\">\n    <div>\n      {schools ? <table>\n        <tbody>\n          {schools.map(school =>\n            <tr className=\"align-horizontal\" key={school.id}>\n              <td>\n                <Link className=\"editItem\" to={`/schools/${school.id}/edit`}></Link>\n              </td>\n              <td>\n                <p>{school.name}</p>\n              </td>\n              <td>\n                <p><a style={{cursor: 'pointer'}} onClick={()=>actAs({role: \"EMPLOYEE\", school: school.name})}>Agera som lärare på denna skola</a></p>\n              </td>\n              <td>\n                <p><a style={{cursor: 'pointer'}} onClick={()=>actAs({role: \"STUDENT\", school: school.name, url: viewCourseUrl})}>Agera som elev på denna skola</a></p>\n              </td>\n            </tr>)}\n        </tbody>\n      </table> : <p><Spinner />V.g. vänta medan skolor laddas</p>}\n    </div>\n    <br />\n    {schools && isAdmin && <Link to=\"/schools/new\" className=\"btn\">Lägg till skola</Link>}\n  </div >\n}\n","import * as React from 'react';\nimport { CourseBanner } from \"../courses/course-banner\";\nimport env from '../../../globals/KED.env';\nimport { School } from 'kedbackend/models';\nimport { EditableSchoolList } from './editable-school-list';\nimport { showError, compareProp } from \"../../../utils/utils\";\n\ninterface Props {\n  viewCourseUrl: string;\n  feedbackUrl: string;\n}\n\ninterface State {\n  schools: School[] | null\n}\n\nexport class Schools extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      schools: null\n    }\n  }\n\n  componentDidMount() {\n    this.load().catch(err => showError(err.message || err));\n  }\n\n  async load() {\n    const schools = await env.kedBackendClient.list<School>(\"schools\");\n    this.setState({ schools });\n  }\n\n  render() {\n    const { schools } = this.state;\n    schools && schools.sort(compareProp(\"name\"));\n    return <div style={{ outline: 0 }}>\n      <CourseBanner title=\"Skolor\" activePage=\"schools\" routes={{feedback: this.props.feedbackUrl}} />\n      <div className=\"sv-row sv-layout\">\n        <div className=\"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer\">\n          <EditableSchoolList schools={schools} viewCourseUrl={this.props.viewCourseUrl} />\n        </div>\n      </div>\n    </div>\n\n  }\n}\n","import * as React from 'react';\nimport { School } from \"kedbackend/models\";\nimport { CourseBanner } from \"../courses/course-banner\";\nimport { showError, L } from \"../../../utils/utils\";\nimport env from '../../../globals/KED.env';\nimport { createUUID, DocumentAccess, BatchRunner } from \"kedbackend/client\";\nimport { Link } from 'react-router-dom';\n\ninterface Props {\n  id?: string\n  title: string\n  feedbackUrl: string\n}\n\ntype State = School;\n\nexport class EditSchool extends React.Component<Props,State> {\n  origSchool: School;\n\n  constructor(props: Props) {\n    super(props);\n    this.state = null;\n  }\n\n  componentDidMount() {\n    this.load().catch(err => showError(err));\n  }\n\n  async load() {\n    if (this.props.id) {\n      // ID given, load it.\n      const { id } = this.props;\n      const school = await env.kedBackendClient.get<School>(\"schools\", id);\n      this.origSchool = { ...school };\n      this.setState({ ...school });\n    } else {\n      // No id, create new instead.\n      this.setState({\n        id: createUUID()\n      });\n    }\n  }\n\n  async save() {\n    const r = new BatchRunner();\n    let school = { ...this.state };\n    if (!this.origSchool) {\n      school.acl = [\"role:USER:R\"];\n      school.acl.push(\n        new DocumentAccess(\n          \"schoolRole\",\n          `${school.name}/EMPLOYEE`, \"W\").toString());\n      r.add(\"schools\", school);\n    } else if (this.origSchool.name !== this.state.name) {\n\n      // Unshare the old name\n      r.unshare(\"schools\", school.id, [\n        new DocumentAccess(\"schoolRole\", `${this.origSchool.name}/EMPLOYEE`, \"W\")\n      ].map(a => a.toString()));\n      // BUG workaround - renaming a school to a new name where just casing matters:\n      if (this.origSchool.name.toLowerCase() === this.state.name.toLowerCase()) {\n        // Workaround for bug with renaming when it differs just by casing:\n        await env.kedBackendClient.batch(r.mutationRequests);\n        r.mutationRequests = [];\n      }\n      // Share the new name\n      r.share(\"schools\", this.state.id, [\n        new DocumentAccess(\"schoolRole\", `${this.state.name}/EMPLOYEE`, \"W\")\n      ].map(a => a.toString()));\n      r.put(\"schools\", school);\n    } else {\n      r.put(\"schools\", school);\n    }\n\n    await env.kedBackendClient.batch(r.mutationRequests);\n\n    location.hash = \"#/schools\";\n  }\n\n  async deleteSchool() {\n    if (confirm(L`Är du säker på att ta bort skolan \"${this.state.name}\"`)) {\n      await env.kedBackendClient.delete(\"schools\", this.state.id);\n      location.hash= \"#/schools\";\n    }\n  }\n\n  render() {\n    const { title, id } = this.props;\n    const editExisting = !!id;\n    const school = this.state;\n    const origSchool = this.origSchool;\n    const isAdmin = env.currentUser.roles.some(role => role === \"ADMIN\");\n    return <div style={{ outline: 0 }}>\n      <CourseBanner\n        title=\"Skolor\" activePage=\"schools\" callbacks={{schools: ()=>location.hash=\"#/schools\"}}\n        routes={{feedback: this.props.feedbackUrl}} />\n      <div className=\"sv-row sv-layout\">\n        <div className=\"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer\">\n          <h2>{title}</h2>\n          <hr />\n          <div className=\"align-horizontal\">\n            <div className=\"horizontalItem top\">Namn:</div>\n            <div className=\"horizontalItem top\">\n              <input type=\"text\" autoFocus\n                disabled={!isAdmin}\n                tabIndex={1}\n                size={50}\n                value={school ? school.name : \"\"}\n                onChange={ev => this.setState({ name: ev.target.value })} />\n            </div>\n            <div className=\"horizontalItem top spaced\"></div>\n          </div>\n          {isAdmin && editExisting && <div tabIndex={2} className=\"btn btn-warning btn-large pull-right\" onClick={() =>\n            this.deleteSchool().catch(showError)}>\n            Ta bort skola\n          </div>}\n          <div className=\"pull-right\">&nbsp;</div>\n          <Link className=\"btn btn-warning btn-large pull-right\" to=\"/schools\">\n            Avbryt\n          </Link>\n          \n          {isAdmin && <a tabIndex={1} className={\"btn btn-large\"} onClick={() => {\n            if (origSchool && origSchool.name !== school.name) {\n              if (!confirm(L`Är du säker på att du vill döpa om skolan? Detta påverkar portalens funktion för lärare och elever som tillhör skolan. Namnet måste stämma exakt överens med namngivningen av skolan på användarobjekten.\n\nDet som händer annars är att elever och lärare på skolan inte längre hittar några kurser.\n\nBlir det fel kan du dock alltid bara döpa tillbaka skolans namn.`)) {\n                return;\n              }\n            }\n            this.save().catch(showError);\n          }}>Spara</a>}\n        </div>\n      </div>\n    </div>;\n  }\n}","import * as React from 'react';\nimport {EditSchool} from './edit-school';\n\ninterface Props {\n  feedbackUrl: string;\n}\n\nexport const NewSchool = (props: Props)=><EditSchool title=\"Lägg till skola\" feedbackUrl={props.feedbackUrl} />;\n","import * as React from 'react';\nimport { L } from '../../../utils/utils';\nimport { SkolverketSubject, SkolverketCourse } from './skolverket-subject';\nimport $ from 'jquery';\nimport env from '../../../globals/KED.env';\nimport { Subject, Course, Ability, KnowledgeRequirement, CentralContent } from 'kedbackend/models';\nimport { MutationRequest, BatchRunner, createUUID } from 'kedbackend/client';\nimport { SubjectToImport } from './subject-to-import';\nimport { loadCourse } from '../utils';\n\ninterface Props extends SkolverketSubject {\n  onCancel: () => void;\n  onImportSuccess: (subject: string) => void;\n}\n\ninterface Change {\n  change?: string;\n  content?: string;\n  mutations: (r: BatchRunner) => void;\n}\n\ninterface State {\n  showFullText: boolean;\n  changes: Change[];\n  isWorking: boolean,\n  isImporting: boolean\n}\n\nexport class UploadedSubject extends React.Component<Props, State> {\n  purposeElem: HTMLElement;\n  coursesElems: { [courseCode: string]: { course: SkolverketCourse, elem: HTMLElement } };\n  centralContentElems: HTMLElement[];\n  knowledgeRequirementElems: HTMLElement[];\n\n  constructor(props: Props) {\n    super(props);\n    this.coursesElems = {};\n    this.centralContentElems = [];\n    this.knowledgeRequirementElems = [];\n    this.state = {\n      showFullText: false,\n      changes: [],\n      isWorking: true,\n      isImporting: false\n    };\n  }\n\n  async componentDidMount() {\n    this.addClassesForCherryPickedElements();\n    try {\n      const changes = await this.diffWithExisting();\n      this.setState({ changes });\n    } finally {\n      this.setState({ isWorking: false });\n    }\n  }\n\n  addClassesForCherryPickedElements() {\n    const abilities = $(this.purposeElem).find('li').first().parent().children('li');\n    abilities.addClass('ability');\n    const centralContents = $(this.centralContentElems).find('li');\n    centralContents.addClass('central-content');\n    const knowledgeRequirements = $(this.knowledgeRequirementElems).find('p');\n    knowledgeRequirements.addClass('knowledge-requirement');\n    const all = $([abilities, centralContents, knowledgeRequirements]);\n    all.addClass('marked-area');\n  }\n\n  cherryPickData(): SubjectToImport {\n    //\n    // Reads elements (tagged by classes in addClassesForCherryPickedElements()) and converts their inner HTML to the corresponding\n    // model SubjectToImport. Note that if we need to adjust how to pick the right LI or P elements, we\n    // will only need to change the code in addClassesForCherryPickedElements(), not this code.\n    //\n    const skolSubject = this.props;\n    const abilities = Array.from($(this.purposeElem).find('li').first().parent().children('li'));\n\n    return {\n      name: skolSubject.name,\n      code: skolSubject.code,\n      abilities: abilities.map((a, i) => `${i + 1}. ${$(a).html()}`),\n      courses: Object.keys(this.coursesElems)\n        .map(courseCode => this.coursesElems[courseCode])\n        .map(({ course, elem }) => ({\n          name: course.name,\n          code: course.code,\n          points: course.points,\n          centralContent: Array.from($(elem).find('.central-content')).map(c => $(c).html()),\n          knowledgeRequirements:\n          Array.from($(elem).find('.grade-step-E .knowledge-requirement')).map(r => $(r).html())\n            .map(html => ({ gradeStep: \"E\", html }))\n            .concat(\n            Array.from($(elem).find('.grade-step-C .knowledge-requirement')).map(r => $(r).html())\n              .map(html => ({ gradeStep: \"C\", html })))\n            .concat(\n            Array.from($(elem).find('.grade-step-A .knowledge-requirement')).map(r => $(r).html())\n              .map(html => ({ gradeStep: \"A\", html })))\n        }))\n    };\n  }\n\n  async diffWithExisting(): Promise<Change[]> {\n    const subjectToImport = this.cherryPickData();\n    let changes: Change[] = [];\n    // Find existing Subject\n    const existingSubjects = await env.kedBackendClient.list<Subject>(\"subjects\");\n    let existingSubject = existingSubjects.filter(s => s.code === this.props.code)[0];\n    let centralContent = [] as CentralContent[],\n      knowledgeRequirements = [] as KnowledgeRequirement[];\n\n    let createTime = Date.now();\n    function ct() {\n      const rv = createTime;\n      createTime += 2;\n      return rv;\n    }\n\n    if (existingSubject) {\n      // Include abilities and standardCourses with the found Subject:\n      existingSubject = await env.kedBackendClient.get(\n        'subjects',\n        existingSubject.id, { include: \"courseTemplates\" });\n      // Lazily load all central contents and knowledgeRequirements on\n      // each course template\n      const expandedCourseTemplates = await Promise.all(\n        existingSubject.courseTemplates.map(ct => env.kedBackendClient.get<Course>(\"courses\", ct.id, {\n          include: [\n            'centralContent',\n            'knowledgeRequirements'\n          ]\n        })));\n\n      for (const courseTemplate of expandedCourseTemplates) {\n        // We don't have to include graphs. We already know that all courses\n        // with the same name and subjectCode will point to the same centralContent and\n        // same knowledgeRequirements.\n\n        // Now go through the XML data and record the order of centralContent\n        // and knowledgeRequirements:\n        const xmlCourse = subjectToImport.courses.find(c => c.name === courseTemplate.name);\n\n        const centralContentOrder = xmlCourse.centralContent\n          .map(html => courseTemplate.centralContent\n            .filter(cc => cc.name === html)\n            .map(cc => cc.id)[0]);\n\n        if (centralContentOrder.some(id => !id)) throw new Error(\n          \"Could not lookup all central contents!\");\n\n        const knowledgeRequirementsOrder = xmlCourse.knowledgeRequirements\n          .map(xmlKR => courseTemplate.knowledgeRequirements\n            .filter(kr => kr.name === xmlKR.html && kr.gradeStep === xmlKR.gradeStep)\n            .map(kr => kr.id)[0]);\n\n        if (knowledgeRequirementsOrder.some(id => !id)) throw new Error(\n          \"Could not lookup all knowledge requirements!\");\n\n        let derivedCourses = await env.kedBackendClient.list<Course>(\n          \"courses\", { name: courseTemplate.name });\n        // Just for sure - filter away courses with same name but different course code...\n        derivedCourses = derivedCourses.filter(c => c.subjectCode === subjectToImport.code);\n\n        for (const course of derivedCourses) {\n          if (!course.centralContentOrder ||\n            !course.knowledgeRequirementsOrder ||\n            course.centralContentOrder.join(',') !== centralContentOrder.join(',') ||\n            course.knowledgeRequirementsOrder.join(',') !== knowledgeRequirementsOrder.join(',')) {\n            course.centralContentOrder = centralContentOrder;\n            course.knowledgeRequirementsOrder = knowledgeRequirementsOrder;\n            changes.push({\n              change: \"Uppdatera ordningen för centralt innehåll och kunskapskrav\",\n              content: `${course.name} på ${course.school} (${course.description})`,\n              mutations: r => {\n                r.put(\"courses\", { ...course });\n              }\n            });\n          }\n        }\n      }\n    } else {\n      // Subject not imported before. Add it!\n      const newSubject: Subject = existingSubject = {\n        id: createUUID(),\n        acl: [\"role:USER:R\"],\n        code: subjectToImport.code,\n        name: subjectToImport.name,\n        publishable: false,\n        dateTime: ct()\n      };\n      changes.push({\n        change: \"Nytt ämne\",\n        content: `${subjectToImport.name} (${subjectToImport.code})`,\n        mutations: r => r.add(\"subjects\", newSubject)\n      });\n\n      const subjectAbilities = [];\n\n      for (let a of subjectToImport.abilities) {\n        const newAbility: Ability = {\n          id: createUUID(),\n          name: a,\n          acl: [\"role:USER:R\"],\n          dateTime: ct()\n        };\n\n        subjectAbilities.push(newAbility); // To refer from in courses later on!\n\n        changes.push({\n          change: \"Ny förmåga\",\n          content: a,\n          mutations: r => {\n            r.add(\"abilities\", newAbility);\n            r.link(\"subjects\", newSubject.id, \"abilities\", newAbility.id, \"abilities\");\n          }\n        });\n      }\n\n      for (let c of subjectToImport.courses) {\n        const newCourse: Course = {\n          id: createUUID(),\n          subjectCode: newSubject.code,\n          tags: [\"sub:\" + newSubject.code],\n          dateTime: ct(),\n          isTemplate: true,\n          acl: [\"role:EMPLOYEE:R\"], // Standardkurser endast synliga för lärare\n          name: c.name,\n          code: c.code,\n          points: c.points,\n          modules: [],\n          subjectId: newSubject.id,\n          resources: [],\n          createdBy: { name: env.currentUser.displayName, url: \"mailto:\" + env.currentUser.mail },\n          createdDate: Date.now(),\n          knowledgeRequirementsOrder: [],\n          centralContentOrder: []\n        };\n\n        changes.push({\n          change: \"Ny kurs\",\n          content: c.name,\n          mutations: r => {\n            r.add(\"courses\", newCourse);\n            r.link(\"subjects\", newSubject.id, \"courses\", newCourse.id, \"courseTemplates\");\n          }\n        });\n\n        for (let html of c.centralContent) {\n          // Check if there exists an identical central content on previous course first\n          let newCentralContent = centralContent.filter(cc => cc.name === html)[0];\n          if (!newCentralContent) {\n            newCentralContent = {\n              id: createUUID(),\n              dateTime: ct(),\n              name: html,\n              acl: [\"role:USER:R\"]\n            };\n            centralContent.push(newCentralContent);\n\n            changes.push({\n              change: \"Nytt centralt innehåll\",\n              content: html,\n              mutations: r => {\n                r.add(\"central-content\", newCentralContent);\n                r.link(\"courses\", newCourse.id, \"central-content\", newCentralContent.id, \"centralContent\");\n              }\n            });\n          } else {\n\n            changes.push({\n              mutations: r => {\n                r.link(\"courses\", newCourse.id, \"central-content\", newCentralContent.id, \"centralContent\");\n              }\n            });\n          }\n          // Register the order in which this central content appeared in the XML:\n          newCourse.centralContentOrder.push(newCentralContent.id);\n        }\n\n        for (let cr of c.knowledgeRequirements) {\n          let newKnowledgeRequirement = knowledgeRequirements.filter(kr => kr.name === cr.html && kr.gradeStep === cr.gradeStep)[0];\n          if (!newKnowledgeRequirement) {\n            newKnowledgeRequirement = {\n              id: createUUID(),\n              dateTime: ct(),\n              name: cr.html,\n              gradeStep: cr.gradeStep,\n              acl: [\"role:USER:R\"]\n            };\n\n            knowledgeRequirements.push(newKnowledgeRequirement);\n\n            changes.push({\n              change: \"Nytt kunskapskrav för betyget \" + cr.gradeStep,\n              content: cr.html,\n              mutations: r => {\n                r.add(\"knowledge-requirements\", newKnowledgeRequirement);\n                r.link(\"courses\", newCourse.id, \"knowledge-requirements\", newKnowledgeRequirement.id, \"knowledgeRequirements\");\n              }\n            });\n          } else {\n            changes.push({\n              mutations: r => {\n                r.link(\"courses\", newCourse.id, \"knowledge-requirements\", newKnowledgeRequirement.id, \"knowledgeRequirements\");\n              }\n            })\n          }\n          // Register the order in which this knowledge requirement appeared in the XML:\n          newCourse.knowledgeRequirementsOrder.push(newKnowledgeRequirement.id);\n        }\n        // Build knowledge matrix\n\n        // Link directly from course template to all abilities that the subject has:\n        for (const a of subjectAbilities) {\n          changes.push({\n            mutations: r => {\n              r.link(\"courses\", newCourse.id, \"abilities\", a.id, \"abilities\");\n            }\n          })\n        }\n      }\n    }\n    return changes;\n  }\n\n  cancel() {\n    this.props.onCancel();\n  }\n\n  async import() {\n    this.setState({ isWorking: true, isImporting: true });\n    const allMutations = this.state.changes.map(change => change.mutations);\n    try {\n      await env.kedBackendClient.do(r => {\n        allMutations.forEach(mut => mut(r));\n      });\n    } finally {\n      this.setState({ isWorking: false, isImporting: false });\n    }\n    this.props.onImportSuccess(this.props.name);\n  }\n\n  fixL(html: string) {\n    return html;//.replace('<l fromat=\"OL\">')\n  }\n\n  render() {\n    return <div><h1>{L`Uppladdat Ämne`}</h1>\n      {this.state.isWorking ? <p>Arbetar...</p> :\n        this.state.isImporting ? <p>Importerar...</p> :\n          this.state.changes.length === 0 ?\n            <div>\n              <p>Ämnet redan importerat.</p>\n              <button onClick={() => this.cancel()}> OK </button>\n            </div> :\n        <div>\n          <table><thead><tr>\n          <th colSpan={2}>Granskning av ändringar i grund-data</th>\n        </tr><tr>\n            <th>Ändring</th>\n            <th>Innehåll</th>\n          </tr></thead><tbody>\n            {this.state.changes.filter(change => change.change).map(change => <tr key={change.change + change.content}>\n              <td>{change.change}</td>\n              <td dangerouslySetInnerHTML={{ __html: change.content }} />\n            </tr>)}\n          </tbody></table>\n        <button onClick={() => this.cancel()} disabled={this.state.isImporting}>Avbryt</button>\n        <button onClick={() => this.import()} disabled={this.state.isImporting}>Importera</button>\n        <br />\n        </div>} \n      <button\n        onClick={() => this.setState({ showFullText: !this.state.showFullText })}>\n        {this.state.showFullText ?\n          L`Dölj nedan` :\n          L`Visa hela texten från Skolverket`}\n      </button>\n\n      {/* The table below is NOT just for show!\n          Functionality is dependent on its existence for importing stuff using jQuery to cherry-pick data. */}          \n      <table style={{ display: this.state.showFullText ? '' : 'none' }}><tbody><tr>\n        <th>\n          Namn\n          </th>\n        <td>\n          {this.props.name}\n        </td>\n      </tr><tr>\n          <th>\n            Ämneskod\n          </th>\n          <td>\n            {this.props.code}\n          </td>\n        </tr><tr>\n          <th>\n            Syfte\n          </th>\n          <td ref={elem => this.purposeElem = elem} dangerouslySetInnerHTML={{ __html: this.fixL(this.props.purpose) }} />\n        </tr><tr>\n          <th>\n            Kurser\n          </th>\n          <td>\n            {this.props.courses.map(course => <table key={course.code} ref={elem => this.coursesElems[course.code] = { course, elem }}><tbody>\n              <tr><th>Kursens namn</th><td>{course.name}</td></tr>\n              <tr><th>Kurskod</th><td>{course.code}</td></tr>\n              <tr><th>Poäng</th><td>{course.points}</td></tr>\n              <tr><th>Centralt innehåll</th><td ref={elem => this.centralContentElems.push(elem)} dangerouslySetInnerHTML={{ __html: this.fixL(course.centralContent) }} /></tr>\n              <tr><th>Kunskapskrav Betyg E</th><td className=\"grade-step-E\" ref={elem => this.knowledgeRequirementElems.push(elem)} dangerouslySetInnerHTML={{ __html: this.fixL(course.knownledgeRequirements.filter(r => r.gradeStep === 'E')[0].text) }} /></tr>\n              <tr><th>Kunskapskrav Betyg C</th><td className=\"grade-step-C\" ref={elem => this.knowledgeRequirementElems.push(elem)} dangerouslySetInnerHTML={{ __html: this.fixL(course.knownledgeRequirements.filter(r => r.gradeStep === 'C')[0].text) }} /></tr>\n              <tr><th>Kunskapskrav Betyg A</th><td className=\"grade-step-A\" ref={elem => this.knowledgeRequirementElems.push(elem)} dangerouslySetInnerHTML={{ __html: this.fixL(course.knownledgeRequirements.filter(r => r.gradeStep === 'A')[0].text) }} /></tr>\n            </tbody></table>)}\n          </td>\n        </tr></tbody></table>\n    </div>\n  }\n}\n","import * as React from 'react';\nimport { L } from '../../../utils/utils';\nimport { Subject } from 'kedbackend/models';\nimport env from '../../../globals/KED.env';\nimport { HashRouter as Router, Route, Link, Redirect } from 'react-router-dom';\nimport { CourseBanner } from \"../courses/course-banner\";\nimport { Spinner } from \"../sub-components/spinner\";\n\ninterface Props {\n  id: string\n  feedbackUrl: string\n}\n\ninterface State {\n  subject: Subject\n}\n\nexport class ShowSubject extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {subject: null};\n  }\n\n  componentWillMount() {\n    this.load();\n  }\n\n  async load() {\n    const subject = await env.kedBackendClient.get<Subject>('subjects', this.props.id, { include: 'courseTemplates' });\n    this.setState({ subject });\n  }\n\n  render() {\n    if (!this.state.subject) return <p><Spinner /></p>;\n    const { name, code, courseTemplates } = this.state.subject;\n    return <div><CourseBanner\n      title={name}\n      activePage=\"subjects\"\n      routes={{feedback: this.props.feedbackUrl}}\n       />\n      <h2>Kurser för ämnet {name} ({code})</h2>\n      <ul className=\"entity-list\">\n        {courseTemplates.map(({id, name, code, publishable, points}) =>\n          <li key={id} className=\"complete\">\n            {name} - {points}p\n          </li>)}\n      </ul>\n    </div>;\n  }\n}\n","import * as React from 'react';\nimport { L, showInfo, compareProp } from '../../../utils/utils';\nimport env from '../../../globals/KED.env';\nimport { Subject } from 'kedbackend/models';\nimport $ from 'jquery';\nimport { SkolverketSubject } from './skolverket-subject';\nimport { UploadedSubject } from './uploaded-subject';\nexport { ShowSubject } from './show-subject';\nimport { HashRouter as Router, Route, Link, Redirect } from 'react-router-dom';\nimport { readBlobAsText, allowCopy } from \"../utils\";\nimport { CourseBanner } from \"../courses/course-banner\";\nimport { Spinner } from \"../sub-components/spinner\";\n\ninterface Props {\n  feedbackUrl: string\n}\n\ninterface State {\n  subjects: Subject[];\n  isListingSubjects: boolean;\n  uploadedSubject: SkolverketSubject | null;\n}\n\nexport class Subjects extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      isListingSubjects: true,\n      subjects: [],\n      uploadedSubject: null\n    };\n  }\n\n  componentWillMount() {\n    this.load();\n  }\n\n  async load() {\n    const subjects = await env.kedBackendClient.list(\"subjects\");\n    subjects.sort(compareProp(\"name\"));\n    this.setState({ subjects, isListingSubjects: false });\n  }\n\n  async handleFileSelect(ev: React.DragEvent<HTMLDivElement>) {\n    ev.stopPropagation();\n    ev.preventDefault();\n    const files = ev.dataTransfer.files;\n    const xml = await readBlobAsText(files[0]);\n    const doc = $($.parseXML(xml));\n    const model : SkolverketSubject = {\n      name: doc.find(\"subject>name\").text(),\n      code: doc.find(\"subject>code\").text(),\n      purpose: doc.find(\"subject>purpose\").text(),\n      courses: []\n    };\n    const courses = doc.find(\"subject>courses\");\n    for (let i=0; i<courses.length; ++i) {\n      const course = $(courses[i]);\n      const knownledgeRequirements = [].slice.call(course.find(\"knowledgeRequirements\"))\n        .map(r => ({gradeStep: $(r).find('gradeStep').text(), text: $(r).find('text').text()}));\n\n      model.courses.push({\n        name: course.find(\"name\").text(),\n        code: course.find(\"code\").text(),\n        centralContent: course.find(\"centralContent\").text(),\n        points: parseInt(course.find(\"point\").text()),\n        knownledgeRequirements,\n      });\n    }\n    this.setState({uploadedSubject: model});\n  }\n\n  onImportSuccess(subject) {\n     showInfo(L`Importen av ${subject} lyckades`);\n     this.setState({uploadedSubject: null});\n     this.load();\n  }\n\n  render() {\n    return <div><CourseBanner\n      title={L`Ämnen`}\n      activePage=\"subjects\"\n      routes={{feedback: this.props.feedbackUrl}}\n     />\n      {this.state.uploadedSubject ?\n      <UploadedSubject\n        onCancel={()=>this.setState({uploadedSubject: null})}\n        onImportSuccess={subject => this.onImportSuccess(subject)}\n        {...this.state.uploadedSubject} />\n    : this.state.isListingSubjects ?\n      <div><p><Spinner/>Var god vänta medan ämnen hämtas...</p></div> :\n      <div>\n        <h2>{L`Ämnen`}</h2>\n        <ul>{this.state.subjects.map(s =>\n          <li key={s.id} className={s.publishable ? \"complete\" : \"incomplete\"}>\n            <Link to={\"/subjects/\" + s.id}>{s.name}</Link>\n          </li>)}\n        </ul>\n        <div className=\"drop-zone\" onDragOver={allowCopy} onDrop={ev=>this.handleFileSelect(ev)}>\n          Droppa Subject-fil här från skolverket (Hämtas från <a href=\"http://opendata.skolverket.se\" target=\"skolverket\">opendata.skolverket.se</a>)\n        </div>\n      </div>\n    }</div>\n  }\n}\n","import * as React from 'react';\nimport { L } from '../../../utils/utils';\nimport { SchoolCourses } from '../sub-components/school-courses';\nimport { Resource } from 'kedbackend/models';\nimport { dtFormat } from '../utils';\nimport { Dialog } from '../interfaces/course-editor-host';\nimport validUrl from 'valid-url';\n\ninterface Props {\n  resource?: Resource;\n  title: string;\n  onSave: (newResource: Resource) => void;\n  onDelete?: ()=>void;\n}\n\ntype State = Resource;\n\nexport class EditResource extends React.Component<Props,State> implements Dialog {\n  constructor(props: Props) {\n    super(props);\n    this.state = this.props.resource || {name: '', url: ''};\n  }\n\n  save() {\n    const resource = this.state;\n    if (!validUrl.isUri(resource.url)) throw new Error(L`Angiven URL '${resource.url}' är ogiltig. Ska börja med exempelvis http:, https: eller mailto:`);\n    this.props.onSave(resource);\n  }\n\n  render() {\n    const {title, onSave, onDelete} = this.props;\n    const resource = this.state;\n    const isValidUrl = validUrl.isUri(this.state.url);\n\n    return <div><div className=\"sv-html-portlet sv-portlet sv-skip-spacer\">\n      <h2>{title}</h2>\n      <hr />\n      <div className=\"align-horizontal\">\n        <div className=\"horizontalItem top\">Namn:</div>\n        <div className=\"horizontalItem top\">\n          <input type=\"text\" autoFocus\n            tabIndex={1}\n            size={50}\n            value={resource.name}\n            onChange={ev=>this.setState({name: ev.target.value})} />\n        </div>\n        <div className=\"horizontalItem top spaced\"></div>\n      </div>\n      <div className=\"align-horizontal\">\n        <div className=\"horizontalItem top\">Länk:</div>\n        <div className=\"horizontalItem top \">\n          <input type=\"text\"\n            tabIndex={1}\n            size={50}\n            value={resource.url}\n            onChange={ev=>this.setState({url: ev.target.value})} />\n        </div>\n        <div className=\"horizontalItem top spaced\"></div>\n      </div>\n      <br /></div>\n      <div className=\"sv-html-portlet sv-portlet\">\n        {(resource.createdDate || resource.modifiedDate) && <div>\n          {resource.createdDate && <p>\n            Resursen/Länken skapades {dtFormat(resource.createdDate)} av <strong>{resource.createdBy.name}</strong>.\n          </p>}\n          {resource.modifiedDate && <p>\n            Resursen/Länken redigerades senast {dtFormat(resource.modifiedDate)} av <strong>{resource.modifiedBy.name}</strong>.\n          </p>}\n          <br /><br/>\n        </div>}\n        {onDelete && <div tabIndex={2} className=\"btn btn-warning btn-large pull-right\" onClick={()=>onDelete()}>\n          Ta bort resurs/länk\n        </div>}\n        <a tabIndex={1} className={\"btn btn-large\" + (isValidUrl ? \"\" : \" btn-inactive\")} onClick={isValidUrl && (() => onSave(resource))}>Spara</a>\n      </div>\n    </div>\n  }\n}\n","import * as React from 'react';\nimport {Resource} from 'kedbackend/models';\nimport {Link} from 'react-router-dom';\nimport {ICourseEditorHost} from '../interfaces/course-editor-host';\nimport {EditResource} from '../modal-pages/edit-resource';\nimport { updateModificationAndCreationStamps } from '../utils';\nimport env from '../../../globals/KED.env';\n\ninterface Props {\n  resources: Resource[];\n  onUpdate: (resourcesUpdates) => void;\n  host: ICourseEditorHost;\n}\n\ninterface State {\n\n}\n\nexport class EditableResourceList extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state={};\n  }\n\n  render() {\n    const {host, onUpdate, resources} = this.props;\n    return <div>\n      <div className=\"taskContainer\">\n        {resources.map((resource, idx) => \n          <div className=\"align-horizontal\" key={idx}>\n            <div className=\"horizontalItem top\">\n              <a className=\"editItem\" onClick={()=>host.openDialog({\n                Component: EditResource,\n                props: {\n                  title: \"Redigera resurs\",\n                  resource,\n                  onSave: editedResource => {\n                    const updatedResource = updateModificationAndCreationStamps(editedResource, env.currentUser);\n                    onUpdate({$splice: [[idx, 1, updatedResource]]});\n                    host.closeDialog();\n                  },\n                  onDelete: ()=>{\n                    onUpdate({$splice: [[idx, 1]]});\n                    host.closeDialog();\n                  }\n                }\n              })}></a>\n            </div>\n            <div className=\"horizontalItem top\">\n              <a href={resource.url} target=\"_blank\" >{resource.name}</a>\n            </div>\n          </div>)}\n     </div>\n    <a className=\"btn\" onClick={()=>host.openDialog({\n      Component: EditResource,\n      props: {\n        title: \"Lägg till resurs\",\n        onSave: newResource => {\n          const updatedResource = updateModificationAndCreationStamps(newResource, env.currentUser);\n          onUpdate({$push: [updatedResource]})\n          host.closeDialog();\n        }\n      }\n    })}><i className=\"fa fa-paperclip\" aria-hidden></i> Lägg till resurs</a>\n    </div>\n  }\n}\n","import * as React from 'react';\nimport {Ability, KnowledgeRequirement} from 'kedbackend/models';\nimport env from '../../../globals/KED.env';\nimport {RemoveItem} from './remove-item';\nimport update from 'react-addons-update';\n\ninterface Props {\n  knowledgeRequirements: KnowledgeRequirement[];\n  idsToMarkNotOk?: {[id: string]: true};\n  // Props used in edit mode (editing course templates)\n  coveredIds?: string[];\n  // Props used in mark mode (editing tasks)\n  markMode?: boolean;\n  markedIds?: string[];\n  onMarkChanged: (id: string, isMarked: boolean) => void;\n}\n\nexport class KnowledgeMatrix extends React.Component<Props, {}> {\n  constructor(props: Props) {\n    super(props);\n  }\n\n  render() {\n    const { knowledgeRequirements, markedIds } = this.props;\n    const { idsToMarkNotOk, markMode, onMarkChanged } = this.props;\n\n    const columns = [\"E\", \"C\", \"A\"];\n    const rows: KnowledgeRequirement[][] = [];\n    const reqs = knowledgeRequirements.slice();\n    let row: KnowledgeRequirement[] | null = null;\n    while (true) {\n      row = columns.map(grade => {\n        const pNext = reqs.findIndex(r => r.gradeStep.toUpperCase() === grade);\n        if (pNext < 0) return null;\n        const rv = reqs[pNext];\n        reqs.splice(pNext, 1);\n        return rv;\n      });\n      if (row.every(r => r === null))\n        break;\n      rows.push(row);\n    }\n\n    return <div>\n      <table>\n        <thead>\n          <tr>\n            {columns.map(c => <th key={c}>{c}</th>)}\n          </tr>\n        </thead>\n        <tbody>\n          {rows.map((row,i) =>\n            <tr key={i}>\n              {row.map((requirement,j) => {\n                const isMarkedOK = requirement && markedIds && markedIds.indexOf(requirement.id) >= 0;\n                const isMarkedNotOK = requirement && idsToMarkNotOk && idsToMarkNotOk[requirement.id];\n                return <td\n                  key={j}\n                  dangerouslySetInnerHTML={{__html: requirement ? requirement.name : \"\"}}\n                  className={(markMode ? \"selectable\" : \"\") +\n                  (isMarkedOK ?\n                    \" markedGreen\" :\n                    (isMarkedNotOK ?\n                      \" markedRed\":\n                      \"\"))}\n                    onClick={markMode && requirement ?\n                      ()=>onMarkChanged(requirement.id, !isMarkedOK) :\n                      undefined} />\n              })}\n            </tr>\n          )}\n        </tbody>\n      </table>\n    </div>\n\n    {/*return <div>\n      <table>\n        <thead>\n          <tr>\n            <th>E</th>\n            <th>C</th>\n            <th>A</th>\n          </tr>\n        </thead>\n        <tbody>\n          {tbody.map((row, i) => \n          <tr key={i}>{row.map((cell, j) => {\n            const isMarkedOK = props.markedIds && props.markedIds.indexOf(cell.id) >= 0;\n            const isMarkedNotOK = props.idsToMarkNotOk && props.idsToMarkNotOk[cell.id];\n            return <td\n              key={j}\n              rowSpan={cell.rowSpan}\n              className={(props.markMode ? \"selectable\" : \"\") +\n                (isMarkedOK ?\n                  \" markedGreen\" :\n                  (isMarkedNotOK ?\n                    \" markedRed\":\n                    \"\"))}\n              onClick={props.markMode && (()=>props.onMarkChanged(cell.id, !isMarkedOK))}>\n              {cell.html && <div style={{position: 'relative'}}>\n                <p\n                  className={cell.type === 'ability' ? 'abilityText' : 'criteriaText'}\n                  dangerouslySetInnerHTML={{__html: cell.html}} />\n                {props.editMode && <RemoveItem className=\"upperRight\" onClick={()=>\n                  this.setCellIds(\n                    cell.type,\n                    cell.rowIndex,\n                    this.getCellIds(\n                      cell.type,\n                      cell.rowIndex).filter(id => id != cell.id) )} /> }\n              </div>}\n            </td>})}\n          </tr>)}\n        </tbody>\n      </table>\n    </div>*/}\n  }\n}\n","import * as React from 'react';\nimport { Course, CourseModule, Task, Document } from 'kedbackend/models';\nimport { OpenCloseBox } from \"../../utility-components/open-close-box\";\n\ninterface Props {\n  options: Document[];\n  title;\n  markMode: boolean;\n  markedIds: string[];\n  onMarkChanged: (id: string, isMarked: boolean) => void;\n}\n\ninterface State {\n}\n\nexport class SelectRelatedDocs extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {};\n  }\n\n  render() {\n    const {options, title, markedIds, markMode} = this.props;\n    return <OpenCloseBox title={<p>{title}</p>} className=\"larger\">\n        {options.map(option => {\n          const isMarked = markedIds.some(x => x === option.id);\n          return <div className=\"align-horizontal\" key={option.id} onClick={()=>\n            markMode && this.props.onMarkChanged(option.id, !isMarked)}>\n            <div className={\"horizontalItem top spaced\" +\n              (markMode ? \" selectable\" : \"\") +\n              (isMarked ? \" markedGreen\" : \"\")}>\n              <p dangerouslySetInnerHTML={{__html: option.name}} />\n              <br />\n            </div>\n          </div>;\n        })}\n    </OpenCloseBox>\n  }\n}","\nexport class CachedResponse<T> {\n    promise: Promise<T> | null;\n    result: T | null;\n    constructor(public queryer: ()=>Promise<T>) {\n        this.promise = null;\n        this.result = null;\n    }\n\n    query() {\n        return this.promise ?\n            this.promise :\n            (this.promise = this.queryer().then(x => this.result = x));\n    }\n\n    reset() {\n        this.promise = null;\n    }\n}\n","import {TC} from '../utils/utils';\n\nexport type Term = 'AT' | 'ST';\nexport type AcademicYear = string; // \"2016/2017\", \"2017/2018\", ...\nexport type SchoolGrade = number; // 0-9 (grundskola), 10-13 (gymnasium)\nexport type Grade = 'A' | 'B' | 'C' | 'D' | 'E';\n\nexport interface User {\n    username?: string;\n    mail: string;\n    displayName: string;\n    roles: string[];\n    schoolGrade?: number;\n    school?: string;\n    schoolType?: string;\n}\n\nexport interface LearningModuleTasks {\n    moduleName: string;\n    url?: string;\n    subject: SchoolSubject;\n    commonTasks?: LearningTask[];\n    learningGoals: LearningGoal[];\n}\n\nexport interface LearningGoal {\n    name: string;\n    tasks?: LearningTask[];\n}\n\nexport interface CustomGoal {\n  name: string,\n  url: string,\n  course: string,\n  description: string\n}\n\n\n/*export interface LearningGoal {\n    id?: string;\n    name: string;\n    courseId?: string;\n    subjectId?: string;\n}*/\n\n\nexport interface LearningTask {\n    name: string;\n    url?: string;\n    description?: string;\n    done?: boolean;\n}\n\nexport interface LearningCourse {\n    name: string;\n    url?: string;\n}\n\nexport interface SchoolSubject {\n    name: string;\n    course: LearningCourse;\n}\n\nexport class Course {\n    //Schema: \"[year+term+schoolYear+name],sortorder\";\n    id?: string;\n    //aYear: string; // Academic Year / Läsår / \"2016/2017\", \"2017/2018\", ...\n    //schoolGrade: number; // Årskurs (0-9 grundskola, 10-13 gymnasium). 100 = ej bundet till årskurs.\n    //term?: Term; // AT (Autumn Term) / ST (Spring Term)\n    name: string;\n    points?: number;\n    modules?: CourseModule[];\n    learningGoals?: LearningGoal[];\n    url?: string;\n}\n\n\nexport interface CourseModule {\n    id?: string;\n    courseId: string;\n    name: string;\n    readonly url: string;\n}\n\nexport interface TargetGrade {\n    id?: string;\n    user: string;\n    courseId?: string;\n    subjectId?: string;\n    aYear?: AcademicYear; // Läsår, tex \"2016/2017\". null means final goal.\n    term?: Term; // null means final goal.\n    grade: Grade;\n}\n\n\nexport const futureAbilities = [\n    \"Lära att lära\",\n    \"Samarbeta\",\n    \"Agera globalt\",\n    \"Visa handlingskraft\",\n    \"Vara innovativ\",\n    \"Leva digitalt\"];\n","import $ from 'jquery';\n\nconst parser = new DOMParser();\n\ntype HTMLPolicy = {[tagNameLower: string]: {[attributeLower: string]: boolean}};\n\n/** Tags / Attributes Whitelist\n * \n */\nconst HTML_WASH_POLICY: HTMLPolicy = {\n  b: {},  // bold\n  i: {},  // italic\n  p: {},  // paragraph\n  u: {},  // underline\n  strike: {}, // strike-through\n  pre: {}, // unformatted\n  h1: {}, // heading 1\n  h2: {}, // heading 2\n  h3: {}, // heading 3\n  h4: {}, // heading 4\n  h5: {}, // heading 5\n  img: {src: true, class: true, style: true, tabindex: true}, // image. We set style and tabindex ourselves. Accept that.\n  a: {href: true, target: true}, // link\n  ul: {}, // Unordered list\n  ol: {}, // Ordered list\n  li: {}, // list item\n  hr: {}, // Horizontal rule\n  br: {}, // Break line\n  div: {},// Of some reason, divs are sometimes inserted when pressing ENTER in the wysiwyg editor.\n  span: {},// Spans are harmless, just remove their style and other attributes and I feel great.\n  // table tags:\n  table: {border: true},\n  tbody: {},\n  thead: {},\n  tfoot: {},\n  tr: {},\n  td: {headers: true, colspan: true, rowspan: true},\n  th: {abbr: true, headers: true, scope: true, sorted: true, colspan: true, rowspan: true}\n};\n\nexport function washHtml (html: string): string {\n  const doc = parser.parseFromString(html, \"text/html\");\n  const {childNodes} = doc.body;\n  let modified = false;\n  for (let i=0; i<childNodes.length; ++i) {\n    if (washNode(childNodes.item(i))) {\n      modified = true;\n    }\n  }\n  return modified ?\n    doc.body.innerHTML :\n    html; // By returning the original HTML string, we spare the user from refreshing the edit area,\n          // which would otherwise put the cursor at the top, losing the position where user where.\n}\n\nfunction washNode(node: Node | Element | HTMLElement): boolean {\n  let modified = false;\n  if (isElement(node)) {\n    if (washElement(node)) {\n      modified = true;\n    }\n  }\n  if (washChildNodes(node)) {\n    modified = true;\n  }\n  return modified;\n}\n\nfunction washChildNodes(node: Node) {\n  let modified = false;\n  const {childNodes} = node;\n  for (let i=0; i<childNodes.length; ++i) {\n    if (washNode(childNodes.item(i))) {\n      modified = true;\n    }\n  }\n  return modified;\n} \n\n/** Replace an element with its child nodes.\n * \n */\nfunction removeMiddleElement(element: Element) {\n  const {childNodes} = element;\n  for (let i=0; i<childNodes.length; ++i) {\n    element.parentNode.insertBefore(childNodes.item(i), element);\n  }\n  element.remove();\n}\n\nfunction washElement(element: Element): boolean {\n  const policy = element.tagName && HTML_WASH_POLICY[element.tagName.toLowerCase()];\n  if (!policy) {\n    console.warn(\"Wysiwyg: not allowed tag\", element.tagName);\n    washChildNodes(element);\n    removeMiddleElement(element);\n    return true;\n  }\n  let modified = false;\n  for (let i=0; i<element.attributes.length; ++i) {\n    const attr = element.attributes.item(i);\n    const allowed = attr.name && !!policy[attr.name.toLowerCase()];\n    if (!allowed) {\n      modified = true;\n      console.warn(\"Wysiwyg: not allowed attribute\", attr.name);\n      element.removeAttribute(attr.name);\n    }\n  }\n  return modified;\n}\n\nfunction isElement(node: Node) : node is Element {\n  return !!(node as Element).tagName;\n}\n","export default (command, value = null) => {\n  document.execCommand(command, false, value)\n}\n","import exec from './exec';\n\nexport default {\n  bold: {\n    icon: '<b>B</b>',\n    title: 'Bold',\n    result: () => exec('bold')\n  },\n  italic: {\n    icon: '<i>I</i>',\n    title: 'Italic',\n    result: () => exec('italic')\n  },\n  underline: {\n    icon: '<u>U</u>',\n    title: 'Underline',\n    result: () => exec('underline')\n  },\n  strikethrough: {\n    icon: '<strike>S</strike>',\n    title: 'Strike-through',\n    result: () => exec('strikeThrough')\n  },\n  heading1: {\n    icon: '<b>H<sub>1</sub></b>',\n    title: 'Heading 1',\n    result: () => exec('formatBlock', '<H1>')\n  },\n  heading2: {\n    icon: '<b>H<sub>2</sub></b>',\n    title: 'Heading 2',\n    result: () => exec('formatBlock', '<H2>')\n  },\n  heading3: {\n    icon: '<b>H<sub>3</sub></b>',\n    title: 'Heading 3',\n    result: () => exec('formatBlock', '<H3>')\n  },\n  paragraph: {\n    icon: '&#182;',\n    title: 'Paragraph',\n    result: () => exec('formatBlock', '<P>')\n  },\n  quote: {\n    icon: '&#8220; &#8221;',\n    title: 'Quote',\n    result: () => exec('formatBlock', '<BLOCKQUOTE>')\n  },\n  olist: {\n    icon: '&#35;',\n    title: 'Ordered List',\n    result: () => exec('insertOrderedList')\n  },\n  ulist: {\n    icon: '&#8226;',\n    title: 'Unordered List',\n    result: () => exec('insertUnorderedList')\n  },\n  code: {\n    icon: '&lt;/&gt;',\n    title: 'Code',\n    result: () => exec('formatBlock', '<PRE>')\n  },\n  line: {\n    icon: '&#8213;',\n    title: 'Horizontal Line',\n    result: () => exec('insertHorizontalRule')\n  },\n  link: {\n    icon: '&#128279;',\n    title: 'Link',\n    result: () => {\n      const url = window.prompt('Enter the link URL')\n      if (url) exec('createLink', url)\n    }\n  },\n  image: {\n    icon: '&#128247;',\n    title: 'Image',\n    result: () => {\n      const url = window.prompt('Enter the image URL')\n      if (url) exec('insertImage', url)\n    }\n  }\n}\n","import * as React from 'react';\nimport exec from './exec';\nimport {washHtml} from './wash-html';\nimport imageEditActions from './image-edit-actions';\nimport actions from './actions';\n\nexport interface Action {\n  name?: string;\n  icon: string;\n  title: string;\n  result: (ev: React.MouseEvent<HTMLButtonElement>, component: Wysiwyg) => void;\n}\n\ninterface Props {\n  className?: string;\n  html: string;\n  onChange?: (html: string) => void;\n  defaultActions?: {[name: string]: Action};\n  actions?: (Partial<Action> | string)[];\n  readOnly?: boolean;\n}\n\ninterface State {\n  focusRect: ClientRect | null;\n}\n\nconst classes = {\n  actionbar: 'wysiwyg-actionbar',\n  button: 'wysiwyg-button',\n  content: 'wysiwyg-content',\n  focusrect: 'wysiwyg-focusrect',\n  focuspoint: 'wysiwyg-focuspoint',\n  readonlyContent: 'wysiwyg-content readonly'\n}\n\nexport class Wysiwyg extends React.Component<Props,State> {\n  contentDiv: HTMLDivElement;\n  focusRectDiv: HTMLDivElement;\n  focusElem: HTMLElement | null;\n  corner: string;\n  resizeStartX: number;\n\n  constructor (props: Props) {\n    super(props);\n    this.state = {focusRect: null};\n    this.onFocus = this.onFocus.bind(this);\n    this.onBlur = this.onBlur.bind(this);\n    this.onMouseDown = this.onMouseDown.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n  }\n\n  componentDidMount() {\n    Array.from(this.contentDiv.querySelectorAll(\"img,a\")).map(elem => (elem as (HTMLImageElement | HTMLAnchorElement)))\n    .forEach(elem => {\n      elem.tabIndex = 1;\n      elem.onfocus = this.onFocus;\n      elem.onblur = this.onBlur as any;\n    });\n    document.addEventListener('mousedown', this.onMouseDown);\n    document.addEventListener('mousemove', this.onMouseMove);\n    document.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  componentDidUpdate() {\n    Array.from(this.contentDiv.querySelectorAll(\"img,a\")).map(elem => (elem as (HTMLImageElement | HTMLAnchorElement)))\n    .forEach(elem => {\n      elem.tabIndex = 1;\n      elem.onfocus = this.onFocus;\n      elem.onblur = this.onBlur as any;\n    });\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mousedown', this.onMouseDown);\n    document.removeEventListener('mousemove', this.onMouseMove);\n    document.removeEventListener('mouseup', this.onMouseUp);\n  }\n\n  shouldComponentUpdate(nextProps: Props, nextState: State) {\n    //this.contentDiv.onfocus = this.onFocus;\n    //this.contentDiv.onblur = this.onBlur;\n    return !this.contentDiv ||\n      nextState != this.state ||\n      nextProps.readOnly !== this.props.readOnly ||\n      nextProps.html !== this.contentDiv.innerHTML;\n  }\n\n  triggerOnChange(html: string) {\n    this.props.onChange && this.props.onChange(washHtml(html));\n  }\n\n  onFocus(ev: FocusEvent) {\n    const elem = ev.target as HTMLElement;\n    if (!elem || !elem.tagName) return;\n    if (elem.tagName !== 'IMG' && elem.tagName !== 'A') return;\n    const contentParent = this.contentDiv.parentElement;\n    const newState = {\n      focusRect: getRelatativeClientRect(contentParent, elem),\n    }\n    switch (elem.tagName) {\n      case 'A':\n      case 'IMG':\n\n      default: break;\n    }\n    this.setState(newState);\n    this.focusElem = elem;\n  }\n\n  onBlur(ev: React.FocusEvent<HTMLDivElement>) {\n    /*if (ev.relatedTarget) {\n      const relatedTarget = ev.relatedTarget as HTMLElement;\n      if (relatedTarget.className && relatedTarget.className.split(' ').indexOf(classes.button) >= 0) {\n        // A image action button was pressed\n        set\n        return;\n      }\n    }*/\n    if ((ev.target === this.focusElem && ev.relatedTarget !== this.focusRectDiv) ||\n      ev.target === this.focusRectDiv)\n    {\n      this.setState({focusRect: null});\n    }\n  }\n\n  makeClickable(elem: HTMLElement) {\n     elem.tabIndex = 1;\n  }\n\n  onMouseDown(ev) {\n    if ((ev.target.className || \"\").split(' ').indexOf(classes.focuspoint) >= 0) {\n      const corner = this.getRectCorner(ev);\n      this.corner = corner;\n      this.resizeStartX = ev.clientX;\n    }\n  }\n\n  onMouseMove(ev: MouseEvent) {\n    if (this.corner && this.state.focusRect && this.focusElem) {\n      ev.preventDefault();\n      // TODO: Räkna ut baserat på this.corner hur bildens storlek borde ändras.\n      // Leta upp bilden per ID från this.contentDiv\n      // Sätt DIV:ens style attribut width till ny width.\n      // Om DIV:en redan hade height, sätt ny height med samma aspect ratio som innan,\n      // annars, sätt inte height alls (eller möjligtvis till auto))\n      const focusRect = this.focusRectDiv.getBoundingClientRect();\n      if (focusRect.width < 32) return;\n      //const currentWidth = focusRect.width;\n      //const currentHeight = focusRect.height;\n      //const hasHeightStyle = !this.focusElem.style.height || this.focusElem.style.height === \"auto\";\n      const newWidth = Math.max(32, this.corner.endsWith('l') ?\n        focusRect.width + (this.resizeStartX - ev.clientX) :\n        //focusRect.right - ev.clientX :\n        focusRect.width - (this.resizeStartX - ev.clientX));\n      this.resizeStartX = ev.clientX;\n        //ev.clientX - focusRect.left;\n      const factor = newWidth / focusRect.width;\n      const newHeight = focusRect.height * factor;\n      this.focusElem.style.width = newWidth + \"px\";\n      this.focusElem.style.height = newHeight + \"px\";\n      this.setState({\n        focusRect: getRelatativeClientRect(this.contentDiv.parentElement, this.focusElem),\n      });\n    }\n  }\n\n  onMouseUp(ev) {\n    if (this.corner && this.state.focusRect && this.focusElem) {\n      this.corner = null;\n      this.triggerOnChange(this.contentDiv.innerHTML);\n    }\n  }\n\n  getRectCorner(ev) {\n    for (const className of (ev.target.className || '').split(' ')) {\n      switch (className) {\n        case 'fpul':\n          return 'ul';\n        case 'fpur':\n          return 'fpur';\n        case 'fplr':\n          return 'lr';\n        case 'fpll':\n          return 'll';\n      }\n    }\n    return null;\n  }\n\n  execImageEditAction (cmd: string) {\n    //console.log(cmd);\n    if (!this.focusElem) return;\n    //console.log(\"doing it\");\n    switch (cmd) {\n      case 'float-left':\n        this.focusElem.style.cssFloat = 'left';\n        break;\n      case 'float-right':\n        this.focusElem.style.cssFloat = 'right';\n        break;\n      case 'unfloat':\n        this.focusElem.style.cssFloat = '';\n        break;\n    }\n    this.triggerOnChange(this.contentDiv.innerHTML);\n    this.setState({focusRect: getRelatativeClientRect(this.contentDiv.parentElement, this.focusElem)});\n  }\n\n  render() {\n    const defaultActions = this.props.defaultActions || actions;\n    let actionsToUse = this.props.actions ? this.props.actions.map(action =>\n      typeof action === 'string' ?\n        defaultActions[action] :\n        defaultActions[action.name] ?\n          { ...defaultActions[action.name], ...action } :\n          action)\n    : Object.keys(defaultActions).map(action => defaultActions[action]);\n\n    if (this.state.focusRect) {\n      actionsToUse = actionsToUse.concat(imageEditActions(cmd => this.execImageEditAction(cmd)));\n    }\n\n    const {focusRect} = this.state;\n    const {readOnly} = this.props;\n\n    return <div className={this.props.className}>\n      {!readOnly && <div className={classes.actionbar}>\n        {actionsToUse.map((action, idx) =>\n          <button key={idx} className={classes.button}\n            dangerouslySetInnerHTML={{__html: action.icon}}\n            title={action.title}\n            onMouseDown={ev=>{action.result(ev, this)}}\n            onMouseUp={ev=>setTimeout(()=>this.contentDiv.focus(), 10)}\n          />)}\n      </div>}\n      <div className={readOnly ? classes.readonlyContent : classes.content} style={{position: 'relative', top: 0, left: 0}}>\n        <div className=\"editor\"\n          ref={div => this.contentDiv = div}\n          dangerouslySetInnerHTML={{__html: washHtml(this.props.html)}}\n          contentEditable={!readOnly}\n          onInput={ev => this.triggerOnChange((ev.target as any).innerHTML)}\n          onKeyDown={ev => {\n            if (readOnly) return;\n            //console.log(\"Key: \" + ev.which);\n            if (ev.which >= 35 && ev.which <= 40) {// home/end/up/down/left/right\n              ev.stopPropagation(); // Prevent entire page from scrolling??\n            }\n            if (ev.which === 9) ev.preventDefault();\n            if ((ev.keyCode === 8 || ev.keyCode === 46) && this.focusElem && this.state.focusRect) {\n              if (this.focusElem && this.focusElem.parentElement) {\n                this.focusElem.parentElement.removeChild(this.focusElem);\n              }\n              this.focusElem = null;\n              this.setState({focusRect: null});\n              this.triggerOnChange(this.contentDiv.innerHTML);\n            }\n          }}\n        />\n        {focusRect && <div\n          ref={div => this.focusRectDiv = div}\n          className={classes.focusrect}\n          onBlur={this.onBlur}\n          tabIndex={1}\n          style={{\n            outline: 0,\n            position: 'absolute',\n            top: this.state.focusRect.top,\n            left: this.state.focusRect.left,\n            width: this.state.focusRect.width,\n            height: this.state.focusRect.height}}>\n          <div className={classes.focuspoint + \" fpul\"} style={{position:'absolute', top:0, left:0}} />\n          <div className={classes.focuspoint + \" fpur\"} style={{position:'absolute', top:0, right:0}} />\n          <div className={classes.focuspoint + \" fplr\"} style={{position:'absolute', bottom:0, right:0}} />\n          <div className={classes.focuspoint + \" fpll\"} style={{position:'absolute', bottom:0, left:0}} />\n        </div>}\n      </div>\n    </div>\n  }\n}\n\nfunction getRelatativeClientRect (parent: HTMLElement, child: HTMLElement) : ClientRect {\n  const parentRect = parent.getBoundingClientRect();\n  const childRect = child.getBoundingClientRect();\n  return {\n    top: childRect.top - parentRect.top + parent.scrollTop,\n    left: childRect.left - parentRect.left + parent.scrollLeft,\n    bottom: childRect.bottom - parentRect.top + parent.scrollTop,\n    right: childRect.right - parentRect.left + parent.scrollLeft,\n    width: childRect.width,\n    height: childRect.height\n  };\n}\n","export default function imageEditActions(cb) {\n  return [{\n    name: 'float-left',\n    icon: `<div style=\"position:relative\">\n      <i class=\"fa fa-align-right\" aria-hidden=\"true\"></i>\n      <div style=\"position:absolute; left:-4px;top:0; transform: scale(0.5); transform-origin: left top\">\n        <i class=\"fa fa-picture-o\" aria-hidden=\"true\"></i>\n      </div>\n    </div>`,\n    title: 'Låt bilden flyta vänster om text',\n    result: () => cb('float-left')\n  }, {\n    name: 'float-right',\n    icon: `<div style=\"position:relative\">\n      <i class=\"fa fa-align-left\" aria-hidden=\"true\"></i>\n      <div style=\"position:absolute; right:-4px;top:0; transform: scale(0.5); transform-origin: right top\">\n        <i class=\"fa fa-picture-o\" aria-hidden=\"true\"></i>\n      </div>\n    </div>`,\n    title: 'Låt bilden flyta höger om text',\n    result: () => cb('float-right')\n  }, {\n    name: 'unfloat',\n    icon: `<div style=\"position:relative;\" aria-hidden=\"true\">\n      <div style=\"position:absolute;top:0;left:0\">&#8254;</div>\n      <div style=\"position:absolute;top:0:left:0;transform: scale(0.5); transform-origin: left bottom\">\n        <i class=\"fa fa-picture-o\" aria-hidden=\"true\"></i>\n      </div>\n      <div style=\"position:absolute;top:0;left:0\">_</div>\n    </div>`,\n    title: 'Placera bilden på egen rad',\n    result: () => cb('unfloat')\n  }];\n}\n\n","import exec from './exec';\n\nexport default {\n  bold: {\n    icon: '<b>F</b>',\n    title: 'Fetstil',\n    result: () => exec('bold')\n  },\n  italic: {\n    icon: '<i>K</i>',\n    title: 'Kursiv',\n    result: () => exec('italic')\n  },\n  underline: {\n    icon: '<u>U</u>',\n    title: 'Understruken',\n    result: () => exec('underline')\n  },\n  strikethrough: {\n    icon: '<strike>S</strike>',\n    title: 'Struken',\n    result: () => exec('strikeThrough')\n  },\n  heading1: {\n    icon: '<b>H<sub>1</sub></b>',\n    title: 'Rubrik 1',\n    result: () => exec('formatBlock', '<H1>')\n  },\n  heading2: {\n    icon: '<b>H<sub>2</sub></b>',\n    title: 'Rubrik 2',\n    result: () => exec('formatBlock', '<H2>')\n  },\n  heading3: {\n    icon: '<b>H<sub>3</sub></b>',\n    title: 'Rubrik 3',\n    result: () => exec('formatBlock', '<H3>')\n  },\n  paragraph: {\n    icon: '&#182;',\n    title: 'Paragraf',\n    result: () => exec('formatBlock', '<P>')\n  },\n  quote: {\n    icon: '&#8220; &#8221;',\n    title: 'Citat',\n    result: () => exec('formatBlock', '<BLOCKQUOTE>')\n  },\n  olist: {\n    icon: '<i class=\"fa fa-list-ol\" aria-hidden=\"true\"></i>',\n    title: 'Ordnad lista',\n    result: () => exec('insertOrderedList')\n  },\n  ulist: {\n    icon: '<i class=\"fa fa-list\" aria-hidden=\"true\"></i>',\n    title: 'Punktlista',\n    result: () => exec('insertUnorderedList')\n  },\n  code: {\n    icon: '&lt;/&gt;',\n    title: 'Programkod',\n    result: () => exec('formatBlock', '<PRE>')\n  },\n  line: {\n    icon: '&#8213;',\n    title: 'Vågrät linje',\n    result: () => exec('insertHorizontalRule')\n  },\n  link: {\n    icon: '<i class=\"fa fa-link\" aria-hidden=\"true\"></i>',\n    title: 'Infoga länk',\n    result: () => {\n      const url = window.prompt('Ange länkens URL')\n      if (url) exec('createLink', url)\n    }\n  },\n  image: {\n    icon: '<i class=\"fa fa-picture-o\" aria-hidden=\"true\"></i>',\n    title: 'Infoga bild',\n    result: (ev, component) => {\n      const url = window.prompt('Ange bildens URL')\n      if (url) {\n        //exec('insertImage', url);\n        const img = document.createElement(\"img\");\n        img.src = url;\n        img.tabIndex = 1;\n        insertElement(img);\n        img.onfocus = component.onFocus;\n        img.onblur = component.onBlur;\n        component.props.onChange(component.contentDiv.innerHTML);\n      }\n    }\n  }\n}\n\nfunction insertElement(element: HTMLElement) {\n    var sel, range;\n    if (window.getSelection && (sel = window.getSelection()).rangeCount) {\n        range = sel.getRangeAt(0);\n        range.collapse(true);\n        range.insertNode(element);\n        // Move the caret immediately after the inserted span\n        range.setStartAfter(element);\n        range.collapse(true);\n        sel.removeAllRanges();\n        sel.addRange(range);\n    }\n}\n","import * as React from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Course, CourseModule, Ability, Task, Document } from 'kedbackend/models';\nimport { createUUID } from 'kedbackend/client';\nimport { KnowledgeMatrix } from '../sub-components/knowledge-matrix';\nimport update from 'react-addons-update';\nimport { Dialog, ICourseEditorHost } from \"../interfaces/course-editor-host\";\nimport { hasWriteAccess } from '../../../access-control';\nimport { SelectRelatedDocs } from '../sub-components/select-related-docs';\nimport validUrl from 'valid-url';\nimport { L, showError } from \"../../../utils/utils\";\nimport { CachedResponse } from \"../../../utils/cached-response\";\nimport { EditableResourceList } from \"../sub-components/editable-resource-list\";\nimport { dtFormat } from \"../utils\";\nimport { futureAbilities } from \"../../../contracts/ked-models\";\nimport env from '../../../globals/KED.env';\nimport { Spinner } from \"../sub-components/spinner\";\nimport { Wysiwyg } from '../../utility-components/wysiwyg';\nimport actions_swedish from '../../utility-components/wysiwyg/actions-sv';\nimport ReactDatePicker from 'react-datepicker';\nimport moment from 'moment';\nimport { Features } from '../../../features';\n\ninterface Props {\n  searchMode?: boolean;\n  task?: Task;\n  taskCustomization?: Partial<Task>;\n  module: CourseModule;\n  course: Course;\n  host: ICourseEditorHost;\n  idsNotCoveredByAnyTask: { [id: string]: true };\n  onSave: (task: Task, taskCustomization: Partial<Task>) => Promise<any>;\n  onSaveCustomization: (taskCustomization: Partial<Task>) => Promise<any>;\n  onReplace: (taskId: string, task: Task) => Promise<any>;\n  onCancel: () => void;\n  onDelete: () => void;\n}\n\ninterface State {\n  title: string;\n  task: Task;\n  taskCustomization: Partial<Task>\n  futureAbilitiesOpen: boolean;\n  searchResult?: Task[];\n  searchMarkedIds?: string[];\n  isSearching: boolean;\n  previewTaskContent?: string;\n}\n\nexport class EditTask extends React.Component<Props, State> implements Dialog {\n  searchResponse?: CachedResponse<Task[]>;\n  dialogElem: HTMLDivElement;\n  features = new Features();\n\n  setStatePromised(state: Partial<State>) {\n    return new Promise(resolve => super.setState(() => state as State, resolve));\n  }\n\n  constructor(props: Props) {\n    super(props);\n    const writeAccess = !props.task || hasWriteAccess(props.task);\n    this.state = {\n      title: props.task ?\n        writeAccess ?\n          L`Redigera uppgift till \"${props.module.name}\"` :\n          L`Visa uppgift till \"${props.module.name}\"` :\n        props.searchMode ?\n          L`Sök ny uppgift till \"${props.module.name}\"` :\n          L`Lägg till egen uppgift till \"${props.module.name}\"`,\n      futureAbilitiesOpen: false,\n      taskCustomization: props.taskCustomization || {},\n      task: props.task ?\n        // A task was given. Clone it and add $meta: 'update' to it\n        // to inform EditCourse.save() to update it on its own entity.\n        {\n          $meta: props.task.$meta || 'update',\n          ...props.task\n        } : props.searchMode ? null :\n          // No task was given. Set $meta = 'add' to inform EditCourse.save()\n          // to add the task to the tasks table.\n          {\n            id: createUUID(),\n            $meta: 'add',\n            tags: [\"sub:\" + props.course.subjectCode],\n            school: !props.course.isTemplate && env.currentUser.school,\n            resources: [],\n            abilities: [],\n            centralContent: [],\n            futureAbilities: [],\n            knowledgeRequirements: [],\n            name: \"\",\n            url: \"\",\n            acl: props.course.isTemplate ? [\n              `role:USER:R`// (OK to keep after kursbygg-changes). Templates (which will be empty!) will not have tasks. If they had, might not tasks should not be possible to modify. (An ADMIN could belong to a school! Other non-admins at that school should not be able to edit it)\n            ] : [\n                `role:USER:R`,\n                `schoolRole:${env.currentUser.school}/EMPLOYEE:S`\n              ]\n          },\n      searchMarkedIds: props.searchMode && [],\n      searchResult: props.searchMode && [],\n      isSearching: props.searchMode\n    };\n    if (props.searchMode) {\n      this.searchResponse = new CachedResponse(() =>\n        env.kedBackendClient.list<Task>(\"tasks\", {\n          tags: `sub:${props.course.subjectCode}`,\n          include: ['knowledgeRequirements', 'abilities', 'centralContent'],\n          flags: ['includeIdsOnly']\n        })); // TODO: includeIds istead of include?\n    }\n  }\n\n  async componentDidMount() {\n    if (this.props.searchMode) {\n      this.setStatePromised({ isSearching: true });\n      try {\n        await this.searchResponse.query();\n        if (this.state.searchMarkedIds && this.state.searchMarkedIds.length === 0) {\n          await this.updateSearchResult(this.state.searchMarkedIds);\n        }\n      } catch (err) {\n        showError(err);\n      } finally {\n        await this.setStatePromised({ isSearching: false });\n      }\n    }\n  }\n\n  async updateSearchMarkedIds(searchMarkedIds: string[]) {\n    const setStatePromise = this.setStatePromised({ task: null, searchMarkedIds, previewTaskContent: null });\n    if (!this.searchResponse.result) {\n      await this.searchResponse.promise;\n      // Refresh searchMarkedIds now as user might have clicked around while waiting for\n      // tasks to load...\n      await setStatePromise; // So we know state has been reflected...\n      searchMarkedIds = this.state.searchMarkedIds;\n    }\n    await this.updateSearchResult(searchMarkedIds);\n  }\n\n  async updateSearchResult(searchMarkedIds: string[]) {\n    const allTasksForSubject = await this.searchResponse.query();\n\n    const searchResult = allTasksForSubject.filter(t =>\n      searchMarkedIds.every(id =>\n        t.knowledgeRequirements.some(kr => kr.id === id) ||\n        t.abilities.some(a => a.id === id) ||\n        t.centralContent.some(c => c.id === id)));\n\n    this.setStatePromised({\n      searchResult\n    });\n  }\n\n  onMarkChanged(id: string, isMarked: boolean) {\n    const { searchMode } = this.props;\n    if (searchMode) {\n      const { searchMarkedIds } = this.state;\n      this.updateSearchMarkedIds(isMarked ?\n        searchMarkedIds.concat(id) :\n        searchMarkedIds.filter(x => x !== id)).catch(showError);\n      return;\n    }\n    const { course } = this.props;\n    const { task } = this.state;\n    // One of the following three will be found:\n    const ability = course.abilities.find(a => a.id === id);\n    const knowledgeRequirement = course.knowledgeRequirements.find(r => r.id === id);\n    const centralContent = course.centralContent.find(cc => cc.id === id);\n\n    const [collectionProp, item] =\n      ability ?\n        [\"abilities\", ability] :\n        knowledgeRequirement ?\n          [\"knowledgeRequirements\", knowledgeRequirement] :\n          centralContent ?\n            [\"centralContent\", centralContent] :\n            [null, null];\n\n    if (!collectionProp) {\n      console.error(\"Could not find marked id \" + id);\n      return;\n    }\n\n    const updatedCollection: Document[] = task[collectionProp].slice();\n    if (isMarked)\n      updatedCollection.push(item);\n    else\n      updatedCollection.splice(updatedCollection.findIndex(doc => doc.id === id), 1);\n\n    const updatedTask = { ...task };\n    updatedTask[collectionProp] = updatedCollection;\n\n    this.setStatePromised({\n      task: updatedTask\n    });\n  }\n\n  async save() {\n    const { task, taskCustomization } = this.state;\n    const writeAccess = hasWriteAccess(task);\n    if (writeAccess) {\n      if (!task.url && !task.content)\n        throw new Error(L`Uppgiften måste antingen ha en URL eller ett innehåll`);\n      if (task.url && !validUrl.isUri(task.url))\n        throw new Error(L`Angiven URL '${task.url}' är ogiltig. Den ska börja med http: eller https:`);\n      if (this.props.task && this.props.task.id !== task.id) {\n        // Replace existing task with copy\n        await this.props.onReplace(this.props.task.id, task);\n      } else {\n        // Update existing task\n        await this.props.onSave(task, null);\n      }\n    } else if (this.props.searchMode) {\n      await this.props.onSave(task, taskCustomization);\n    } else {\n      if (this.props.course.isTemplate && task.$meta === 'add')\n        throw new Error(L`Du saknar behörighet för att spara nya versioner av uppgifter i kursmallen`);\n\n      await this.props.onSaveCustomization(taskCustomization);\n    }\n  }\n\n  async copyTask() {\n    const taskCopy = {\n      ...this.state.task,\n      ...(this.state.taskCustomization || {}),\n      id: createUUID(),\n      acl: this.props.course.isTemplate ? [\n        `role:USER:R` // (OK to keep but this check might become unnescesary if we totally remove the possibility to edit templates) Template tasks should not be possible to modify. (An ADMIN could belong to a school! Other non-admins at that school should not be able to edit it)\n      ] : [\n          `role:USER:R`,\n          `schoolRole:${env.currentUser.school}/EMPLOYEE:S`\n        ]\n    };\n    taskCopy.$meta = 'add';\n\n    await this.setStatePromised({\n      task: taskCopy,\n      title: L`Redigera kopierad uppgift till \"${this.props.module.name}\"`,\n      taskCustomization: undefined\n    });\n  }\n\n  getTaskProp<T extends keyof Task>(taskProp: T) : Task[T] {\n    const {task, taskCustomization} = this.state;\n    const customization = taskCustomization && taskCustomization[taskProp];\n    return customization !== undefined ?\n      customization :\n      task[taskProp];\n  }\n\n  updateTaskOrCustomization (taskProp: keyof Task, updates) {\n    const {task, taskCustomization} = this.state;\n    const writeAccess = task && hasWriteAccess(task);\n    if (writeAccess && (!taskCustomization || taskCustomization[taskProp] === undefined)) {\n      const newTask = {...task};\n      newTask[taskProp] = update(task[taskProp], updates);\n      this.setStatePromised({task: newTask});\n    } else {\n      const newCustomization = {...taskCustomization};\n      newCustomization[taskProp] = update (\n        newCustomization[taskProp] || task[taskProp],\n        updates\n      );\n      this.setStatePromised({taskCustomization: newCustomization});\n    }\n  }\n\n  render() {\n    const { course, module, onCancel, onDelete, idsNotCoveredByAnyTask, searchMode } = this.props;\n    const { task, taskCustomization, title, searchResult, searchMarkedIds, isSearching } = this.state;\n    const markedIds = searchMode ?\n      searchMarkedIds :\n      task.centralContent.map(x => x.id)\n        .concat(task.abilities.map(x => x.id))\n        .concat(task.knowledgeRequirements.map(x => x.id));\n\n    const writeAccess = task && hasWriteAccess(task);\n    const taskUrlValid = task && validUrl.isUri(task.url);\n    const {features} = this;\n\n    return <div className=\"sv-spacer-20pxvt sv-vertical sv-layout sv-skip-spacer\">\n      <div className=\"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer\">\n        <div className=\"sv-text-portlet sv-use-margins sv-skip-spacer\">\n          <div className=\"sv-text-portlet-content\">\n            <h1 className=\"h1\">{title}</h1>\n          </div>\n        </div>\n        <div className=\"sv-fluid-grid sv-grid-ksgs12 sv-layout\">\n          <div className=\"sv-layout sv-skip-spacer sv-column-6\">\n            <div className=\"sv-html-portlet sv-portlet sv-skip-spacer\">\n              <div className=\"ked_boxed\">\n                <h3>{searchMode ?\n                  \"Filtrera på kunskapskrav\" : writeAccess ?\n                    \"Välj kunskapskrav\" :\n                    \"Kunskapskrav\"}</h3>\n                {searchMode ?\n                  <p>\n                    Markera de kunskapskrav som uppgiften måste täcka.\n                  </p> : writeAccess &&\n                  <p>\n                    Markera de kunskapskrav som din uppgift täcker.\n                  </p>\n                }\n                <KnowledgeMatrix\n                  knowledgeRequirements={course.knowledgeRequirements}\n                  markedIds={markedIds}\n                  idsToMarkNotOk={idsNotCoveredByAnyTask}\n                  markMode={searchMode || writeAccess}\n                  onMarkChanged={this.onMarkChanged.bind(this)}\n                />\n              </div>\n            </div>\n\n            <div className=\"sv-html-portlet sv-portlet\">\n              <SelectRelatedDocs\n                options={course.abilities}\n                title={writeAccess || searchMode ? \"Välj förmågor\" : \"Förmågor\"}\n                markedIds={markedIds}\n                markMode={writeAccess || searchMode}\n                onMarkChanged={this.onMarkChanged.bind(this)} />\n            </div>\n\n            <div className=\"sv-html-portlet sv-portlet\">\n              <SelectRelatedDocs\n                options={course.centralContent}\n                title={writeAccess || searchMode ? \"Välj centralt innehåll\" : \"Centralt innehåll\"}\n                markedIds={markedIds}\n                markMode={writeAccess || searchMode}\n                onMarkChanged={this.onMarkChanged.bind(this)} />\n            </div>\n\n            {!searchMode && <div className=\"sv-html-portlet sv-portlet\"><div className={\"openClose larger\" + (this.state.futureAbilitiesOpen ? \" open\" : \"\")}>\n              <div className=\"openHeader\" onClick={() => this.setStatePromised({ futureAbilitiesOpen: !this.state.futureAbilitiesOpen })}>\n                {writeAccess ?\n                  <p>Välj ytterligare alternativ</p> :\n                  <p>Ytterligare alternativ</p>}\n              </div>\n              <div className=\"openContent\">\n                <h4>Framtidsförmågor</h4>\n\n                <div className=\"taskContainer\">\n                  {futureAbilities.map(fa => {\n                    const selected = task.futureAbilities.indexOf(fa) >= 0;\n                    return <div className=\"align-horizontal\" key={fa}>\n                      <div className=\"horizontalItem top\">\n                        <div\n                          className={\"checkBox\" + (selected ? \" checked\" : \"\")}\n                          onClick={writeAccess ? () => {\n                            const updatedTask = { ...task };\n                            updatedTask.futureAbilities =\n                              selected ?\n                                task.futureAbilities.filter(a => a != fa) :\n                                task.futureAbilities.concat(fa);\n                            this.setStatePromised({ task: updatedTask });\n                          } : undefined} />\n                      </div>\n                      <div className=\"horizontalItem top\">{fa}\n                      </div>\n                    </div>\n                  })}\n                </div>\n              </div>\n\n            </div></div>}\n          </div>\n          <div className=\"sv-layout sv-column-6\">\n            <div className=\"sv-html-portlet sv-portlet sv-skip-spacer\">\n              {isSearching && <p><Spinner /> Laddar uppgifter...</p>}\n              {searchResult ? <div className={\"task-search-result\" + (!this.state.task && !this.state.previewTaskContent ? \" fixed\" : \"\")}>\n                {searchMarkedIds.length === 0 ?\n                  <h2>Samtliga uppgifter för ämnet</h2> :\n                  <h2>Uppgifter som täcker valda filter</h2>}\n                <div className=\"taskContainer\">\n                  {searchResult.map(foundTask => <div key={foundTask.id} className=\"align-horizontal\">\n                    <div className=\"horizontalItem top\">\n                      <div\n                        className={\"checkBox\" + (task && task.id === foundTask.id ? \" checked\" : \"\")}\n                        onClick={() => findDOMNode(this).parentElement.scrollTop = 0 || this.setStatePromised({ task: foundTask, previewTaskContent: null })} />\n                    </div>\n                    <div className=\"horizontalItem top\">\n                      {foundTask.content ?\n                        <a href=\"#\" onClick={ev => {\n                          this.setState({ previewTaskContent: foundTask.content, task: null });\n                          ev.preventDefault();\n                          ev.stopPropagation();\n                        }}>{foundTask.name}</a> :\n                        <a href={foundTask.url} target=\"_blank\">{foundTask.name}</a>}\n                    </div>\n                  </div>)}\n                </div>\n                <br />\n                <hr />\n              </div> : task && <div>\n                <h2>Uppgiftens namn och länk</h2>\n                <div className=\"align-horizontal spaced\">\n                  <div className=\"horizontalItem top\">\n                    <p>Uppgiftens namn:</p>\n                  </div>\n                  <div className=\"horizontalItem top\">\n                    <input autoFocus type=\"text\" size={35} value={task.name} disabled={!writeAccess} readOnly={!writeAccess} onChange={ev => {\n                      const newTask = { ...task };\n                      newTask.name = ev.target.value;\n                      this.setStatePromised({ task: newTask });\n                    }} />\n                  </div>\n                </div>\n                <div className=\"align-horizontal spaced\">\n                  <div className=\"horizontalItem top\">\n                    <p>URL:</p>\n                  </div>\n                  <div className={\"horizontalItem top\"}>\n                    <input type=\"text\" size={35} value={task.url} disabled={!writeAccess} readOnly={!writeAccess} onChange={ev => {\n                      const newTask = { ...task };\n                      newTask.url = ev.target.value;\n                      this.setStatePromised({ task: newTask });\n                    }} />\n                  </div>\n                </div>\n\n                {features.AssignmentTasks && <><h2>Inlämningsuppgift</h2>\n                <div className=\"align-horizontal\">\n                  <div className=\"horizontalItem top\">\n                    <div className={\"checkBox\" + (this.getTaskProp(\"assignment\") ? \" checked\" : \"\")}\n                      onClick={() => {\n                        this.updateTaskOrCustomization(\"assignment\", {$set: !this.getTaskProp(\"assignment\")});\n                      }}\n                    />\n                  </div>\n                  <div className=\"horizontalItem top\">\n                      <p>Den här uppgiften är en inlämningsuppgift</p>\n                  </div>\n                </div>\n                {this.getTaskProp(\"assignment\") && <>\n                  <p>Inlämningsdatum</p>\n                    <div className=\"align-horizontal\">\n                      <div className=\"horizontalItem top\">\n                        <ReactDatePicker\n                          selected={this.getTaskProp(\"deadline\") && moment(this.getTaskProp(\"deadline\"))}\n                          dateFormat=\"YYYY-MM-DD\"\n                          locale={\"sv\"}\n                          popperPlacement=\"bottom-start\"\n                          onChange={value => {\n                            this.updateTaskOrCustomization(\"deadline\", {$set: value.format(\"YYYY-MM-DD\")});\n                          }}\n                        />\n                      </div>\n                      <div className=\"horizontalItem top\">\n                        {this.getTaskProp(\"deadline\") && <a className=\"deleteDate\" href=\"#\" title=\"Ta bort inlämningsdatum\" onClick={ev=>{\n                          ev.preventDefault();\n                          this.updateTaskOrCustomization(\"deadline\", {$set: null});\n                        }}></a>}\n                      </div>\n                    </div>\n                </>}\n              </>}\n              </div>}\n\n              {this.state.previewTaskContent ? \n                <div dangerouslySetInnerHTML={{__html: this.state.previewTaskContent}} />\n               : task && <>\n                    <h3>Uppgiftens lärandemål</h3>\n                    <div>\n                      <textarea\n                        className=\"inputTextBox learning-goal-box\"\n                        disabled={!writeAccess}\n                        value={task.learningGoal}\n                        onChange={ev => {\n                          const newTask = { ...task };\n                          newTask.learningGoal = ev.target.value;\n                          this.setStatePromised({ task: newTask });\n                        }}\n                      />\n                    </div>\n\n                    <br />\n                    {(writeAccess || !!task.content) && <>\n                      <h3>Uppgiftens innehåll</h3>\n                        {writeAccess && <p>\n                          Om uppgiften inte länkar till något dokument kan du lägga innehåll här.\n                        </p>}\n                        <Wysiwyg\n                          actions={[\n                            \"bold\",\n                            \"italic\",\n                            \"underline\",\n                            \"strikethrough\",\n                            \"heading2\",\n                            \"heading3\",\n                            \"olist\",\n                            \"ulist\",\n                            \"line\",\n                            \"link\",\n                            \"image\"]}\n                          defaultActions={actions_swedish}\n                          readOnly={!writeAccess}\n                          html={task.content}\n                          onChange={html => {\n                            const newTask = { ...task };\n                            newTask.content = html;\n                            this.setState({ task: newTask });\n                          }}\n                        />\n                    </>}\n\n                  {taskCustomization && taskCustomization.resources ?\n                    <h3>Resurser för uppgiften (modifierad för denna kursinstans)</h3> :\n                    <h3>Resurser kopplade till uppgiften</h3>}\n\n                  <EditableResourceList\n                    resources={\n                      (taskCustomization && taskCustomization.resources) || task.resources}\n                    host={this.props.host}\n                    onUpdate={resourceUpdates => {\n                      this.updateTaskOrCustomization(\"resources\", resourceUpdates);\n                    }} />\n                </>}\n            </div>\n            {task && <div className=\"sv-html-portlet sv-portlet\"><hr />\n              <h3>Uppgiftens status</h3>\n\n              {task.createdBy && task.createdDate && <p>\n                Uppgiften skapades {dtFormat(task.createdDate)} av <strong>{task.createdBy.name}</strong>.\n              </p>}\n              {task.modifiedBy && task.modifiedDate && <p>\n                Uppgiften redigerades senast {dtFormat(task.modifiedDate)} av <strong>{task.modifiedBy.name}</strong>.\n              </p>}\n\n              <br />\n              {!!this.props.onDelete && <div\n                className=\"btn btn-warning btn-large pull-right\"\n                onClick={() => this.props.onDelete()}>\n                Ta bort från kursmodul\n              </div>}\n              <div className=\"pull-right\">&nbsp;</div>\n              <div className=\"btn btn-warning btn-large pull-right\" onClick={() => this.props.onCancel()}>\n                Avbryt\n              </div>\n\n              <div className=\"btn btn-large\" onClick={() => this.save().catch(showError)}>\n                Spara\n              </div>\n              {!writeAccess && <div className=\"btn btn-large\" onClick={() => this.copyTask().catch(showError)}>\n                Skapa kopia av den här uppgiften\n              </div>}\n            </div>}\n          </div>\n        </div>\n        <div className=\"sv-layout\">\n          <div className=\"sv-html-portlet sv-portlet sv-skip-spacer\"></div>\n        </div>\n      </div></div>\n  }\n\n}","import * as React from 'react';\nimport { L } from '../../../utils/utils';\nimport { Task, Course, CourseModule, Ability } from 'kedbackend/models';\nimport { Link } from 'react-router-dom';\nimport { EditTask } from '../modal-pages/edit-task';\nimport { ICourseEditorHost } from '../interfaces/course-editor-host';\nimport { updateModificationAndCreationStamps } from \"../utils\";\nimport env from '../../../globals/KED.env';\nimport { hasWriteAccess } from \"../../../access-control\";\n\ninterface Props {\n  taskIds: string[];\n  taskCustomizations?: { [taskId: string]: Partial<Task> }\n  course: Course;\n  module: CourseModule;\n  idsNotCoveredByAnyTask: {[id: string]: true};\n  onTaskAdded: (task: Task, taskCustomization?: Partial<Task>) => void;\n  onTaskUpdated: (task) => void;\n  onTaskCustomizationUpdated: (taskId, customization) => void;\n  onTaskDeleted: (id) => void;\n  onTaskReplaced: (id, task) => void;\n  host: ICourseEditorHost;\n}\n\ninterface State {\n\n}\n\nexport class EditableTaskList extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {};\n  }\n\n  openTaskDialog(task: Task) {\n    const {\n      taskCustomizations,\n      course,\n      host,\n      module,\n      taskIds,\n      onTaskAdded,\n      onTaskUpdated,\n      onTaskCustomizationUpdated,\n      onTaskDeleted,\n      idsNotCoveredByAnyTask,\n      onTaskReplaced\n    } = this.props;\n\n    host.openDialog({\n      Component: EditTask,\n      props: {\n        task,\n        taskCustomization: taskCustomizations && taskCustomizations[task.id],\n        module,\n        course,\n        host,\n        idsNotCoveredByAnyTask,\n        onSave: task => {\n          const updatedTask = updateModificationAndCreationStamps(task, env.currentUser);\n          onTaskUpdated(updatedTask);\n          host.closeDialog();\n        },\n        onSaveCustomization: customization => {\n          onTaskCustomizationUpdated(task.id, customization);\n          host.closeDialog();\n        },\n        onDelete: () => {\n          onTaskDeleted(task.id);\n          host.closeDialog();\n        },\n        onReplace: (taskId: string, newTask: Task) => {\n          onTaskReplaced(taskId, newTask);\n          host.closeDialog();\n        },\n        onCancel: () => host.closeDialog()\n      }\n    });\n  }\n\n  render() {\n    const props = this.props;\n    return <div>\n      <div className=\"taskContainer\">\n        {props.taskIds.map(id => props.course.tasks.find(t => t.id === id)).map(task => {\n          const canUpdateTask = hasWriteAccess(task);\n\n          return <div className=\"align-horizontal\" key={task.id}>\n            <div className=\"horizontalItem top\">\n              <div className={canUpdateTask ? \"editItem\" : \"viewItem\"} onClick={() =>\n                this.openTaskDialog(task)} />\n            </div>\n            <div className=\"horizontalItem top\">\n              {task.content ?\n                // Rather than linking to url, show the task's content (by opening\n                // the task dialog)\n                <a href=\"#\" onClick={ev=>{\n                  ev.preventDefault();\n                  this.openTaskDialog(task);\n                }}>{task.name}</a> :\n                <a href={task.url} target=\"_blank\">{task.name}</a>}\n            </div>\n          </div>;\n        })}\n      </div>\n      <br />\n      <a className=\"btn\" onClick={() => {\n        const {\n          course,\n          host,\n          idsNotCoveredByAnyTask,\n          module,\n          onTaskAdded,\n          onTaskCustomizationUpdated } = this.props;\n\n        props.host.openDialog({\n          Component: EditTask,\n          props: {\n            searchMode: true,\n            module,\n            course,\n            host,\n            idsNotCoveredByAnyTask,\n            onSave: (choosenTask, taskCustomization) => {\n              choosenTask = updateModificationAndCreationStamps(choosenTask, env.currentUser);\n              onTaskAdded(choosenTask, taskCustomization);\n              host.closeDialog();\n            },\n            onCancel: () => host.closeDialog()\n          }\n        });\n      }}><i className=\"fa fa-search\" aria-hidden /> Sök uppgift</a>\n      &nbsp;\n      <a onClick={() => {\n        const { course, host, module, taskIds, onTaskAdded, onTaskUpdated, onTaskDeleted, idsNotCoveredByAnyTask } = this.props;\n        host.openDialog({\n          Component: EditTask,\n          props: {\n            module,\n            course,\n            host,\n            idsNotCoveredByAnyTask,\n            onSave: newTask => {\n              newTask = updateModificationAndCreationStamps(newTask, env.currentUser);\n              onTaskAdded(newTask);\n              host.closeDialog();\n            },\n            onCancel: () => host.closeDialog()\n          }\n        });\n      }} className=\"btn\">\n        <i className=\"fa fa-plus\" aria-hidden /> Lägg till egen uppgift\n      </a>\n    </div >\n  }\n}","import * as React from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Course, CourseModule, Image, Task, Document, Ability } from 'kedbackend/models';\nimport $ from 'jquery';\nimport { EditableResourceList } from '../sub-components/editable-resource-list';\nimport { EditableTaskList } from '../sub-components/editable-task-list';\nimport update from 'react-addons-update';\nimport { ICourseEditorHost } from '../interfaces/course-editor-host';\nimport { RenameableText } from '../../utility-components/renameable-text';\nimport { RemoveItem } from '../sub-components/remove-item';\nimport { createUUID } from 'kedbackend/client';\nimport { L, showError } from \"../../../utils/utils\";\nimport moment from 'moment';\nimport { Wysiwyg } from '../../utility-components/wysiwyg';\nimport actions_swedish from '../../utility-components/wysiwyg/actions-sv';\nimport { OpenCloseBox } from '../../utility-components/open-close-box';\n\ninterface Props {\n  course: Course;\n  module: CourseModule;\n  host: ICourseEditorHost;\n  idsNotCoveredByAnyTask: {[id: string]: true};\n  onReorder: (direction: 1 | -1) => void;\n  getOrderedModules: ()=>CourseModule[];\n}\n\ninterface State {\n  editMandatoryContent: boolean;\n}\n\nconst DEFAULT_KNOWLEDGE_MATRIX = [{\n  abilityIds: [],\n  EIds: [],\n  CIds: [],\n  AIds: []\n}];\n\nexport class CourseModuleComponent extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      editMandatoryContent: false\n    }\n  }\n\n  getModuleIndex() {\n    const {course, module} = this.props;\n    return course.modules.findIndex(m => m.id === module.id);\n  }\n\n  getModuleOrderIndex() {\n    const {course, module} = this.props;\n    const orderedModules = this.props.getOrderedModules();\n    return orderedModules.findIndex(m => m.id === module.id);\n  }\n\n  updateModule(moduleUpdates) {\n    const {module} = this.props;\n    const updatedModule = update(module, moduleUpdates);\n    const moduleIndex = this.getModuleIndex();\n    this.props.host.update({ modules: { $splice: [[moduleIndex, 1, updatedModule]] } });\n  }\n\n  /* This method works for both adding new tasks to the task table\n  and adding references to existing tasks. The magic of that has to do with\n  whether task.$meta = 'add' or not and is done in EditCourse.save()\n  */\n  onTaskAdded (task: Task, taskCustomization: Partial<Task> | null) {\n    // Add task ID to module taskIds list:\n    const courseUpdates:any = {};\n    const taskIds = this.props.module.taskIds.slice();\n    taskIds.push(task.id);\n    // Add physical Task to Course.tasks.\n    if (!this.props.course.tasks.some(t => t.id ===task.id)) {\n      courseUpdates.tasks = {$push: [task]};\n    }\n    const customizations = {...(this.props.module.taskCustomizations || {})};\n    if (taskCustomization) customizations[task.id] = taskCustomization;\n    const moduleIndex = this.getModuleIndex();\n    courseUpdates.modules = {};\n    courseUpdates.modules[moduleIndex] = {\n      taskIds: {$set: taskIds},\n      taskCustomizations: {$set: customizations}\n    };\n    // Update module\n    this.props.host.update(courseUpdates);\n  }\n\n  onTaskUpdated (task: Task) {\n    if (!task.$meta) throw new Error(L`Hoppsan, blev lite knas. Fel ID: ${'Pa7Dq'}`);\n    const taskIndex = this.props.course.tasks.findIndex(t => t.id === task.id);\n    if (taskIndex >= 0) {\n      this.props.host.update({tasks: {$splice: [[taskIndex, 1, task]]}});\n    }\n  }\n\n  onTaskCustomized (taskId: string, customization: Partial<Task>) {\n    const customizations = {...(this.props.module.taskCustomizations || {})};\n    customizations[taskId] = customization;\n    this.updateModule({taskCustomizations: {$set: customizations}});\n  }\n\n  onTaskDeleted (id: string) {\n    // Remove task ID from module taskIds list.\n    // This depends on the fact that EditCourse._setState() maintains\n    // removed Task links (which it actually does (or should do at least)).\n    this.updateModule({\n      taskIds: {$set: this.props.module.taskIds.filter(tid => tid !== id)},\n      taskCustomizations: {\n        $apply: customizations => {\n          const copy = {...customizations};\n          delete copy[id];\n          return copy;\n        }\n      }\n    });\n  }\n\n  onTaskReplaced (id: string, task: Task) {\n    const idxTask = this.props.module.taskIds.indexOf(id);\n    if (idxTask < 0) {\n      showError(L`Kunde inte spara uppgift. Felkod d72kQ`);\n      return;\n    }\n    const moduleUpdates = {\n      // Replace old id with new id:\n      taskIds: {$splice: [[idxTask, 1, task.id]]},\n      taskCustomizations: {\n        $apply: customizations => {\n          const copy = {...customizations};\n          delete copy[id];\n          return copy;\n        }\n      }\n    }\n    const updatedModule = update(this.props.module, moduleUpdates);\n    const moduleIndex = this.getModuleIndex();\n    this.props.host.update({\n      // Apply moduleUpdates from above:\n      modules: { $splice: [[moduleIndex, 1, updatedModule]] },\n      // Add the new task to Course.tasks.\n      // Don't remove the old one! Why? Because it may be referenced\n      // by another module in same course! Let EditCourse._setState()\n      // do the \"garbage collection\" instead.\n      tasks: { $set: this.props.course.tasks.concat(task)}\n    });\n  }\n\n  render() {\n    const { course, host, module, idsNotCoveredByAnyTask } = this.props;\n    const moduleIndex = this.getModuleIndex();\n    const moduleOrderedIndex = this.getModuleOrderIndex();\n    let knowledgeMatrixDiv;\n\n    const updateModule = this.updateModule.bind(this);\n    let week = 1;\n    const startWeekOptions = [\"--\"];\n    const endWeekOptions = [\"--\"];\n    for (let i=0; i<51; ++i) {\n      startWeekOptions.push(''+ week);\n      endWeekOptions.push(''+ ++week);\n    }\n\n    return <div className=\"course-module ked_boxed\" style={{position: 'relative'}}>\n      <h3><RenameableText eager={true}\n        clickAdvertiseText=\"Namnlös modul\"\n        maxChars={100}\n        text={module.name}\n        onChange={newName => updateModule({name: {$set: newName}})} />\n      </h3>\n      <div className=\"align-horizontal spaced\">\n        <div className=\"horizontalItem center\">\n          <p>Startvecka</p>\n        </div>\n        <div className=\"horizontalItem center\">\n          <select value={module.startWeek || \"--\"}\n            onChange={ev => updateModule({startWeek: {\n              $set: ev.target.value === '--' ?\n                undefined :\n                parseInt(ev.target.value)\n            }\n          })}>\n            {startWeekOptions.map(o => <option key={o} value={o}>{o}</option>)}\n          </select>\n        </div>\n        <div className=\"horizontalItem center\">\n          <p>Slutvecka</p>\n        </div>\n        <div className=\"horizontalItem center\">\n          <select value={module.endWeek || \"--\"}\n            onChange={ev => updateModule({endWeek: {\n              $set: ev.target.value === '--' ?\n                undefined :\n                parseInt(ev.target.value)\n            }\n          })}>\n            {endWeekOptions.map(o => <option key={o} value={o}>{o}</option>)}\n          </select>\n        </div>\n      </div>\n      <h4>Kursmodulens introduktion</h4>\n      <Wysiwyg\n        actions={[\n          \"bold\",\n          \"italic\",\n          \"underline\",\n          \"strikethrough\",\n          \"heading2\",\n          \"heading3\",\n          \"olist\",\n          \"ulist\",\n          \"line\",\n          \"link\",\n          \"image\"]}\n        defaultActions={actions_swedish}\n        html={module.mandatoryContent}\n        onChange={html => {\n          updateModule({mandatoryContent: {$set: html}})\n        }} />\n\n      <h4>Uppgifter</h4>\n      <EditableTaskList\n        taskIds={module.taskIds}\n        taskCustomizations={module.taskCustomizations}\n        course={course}\n        module={module}\n        host={host}\n        idsNotCoveredByAnyTask={idsNotCoveredByAnyTask}\n        onTaskAdded={(task: Task, taskCustomization: Partial<Task>) => this.onTaskAdded(task, taskCustomization)}\n        onTaskUpdated={(task: Task) => this.onTaskUpdated(task)}\n        onTaskCustomizationUpdated={(taskId: string, customization: Partial<Task>) =>\n          this.onTaskCustomized(taskId, customization)}\n        onTaskDeleted={(id: string) => this.onTaskDeleted(id)}\n        onTaskReplaced={(id: string, task: Task) => this.onTaskReplaced(id, task)} />\n\n      <h4>Modulresurser</h4>\n      <p className=\"subHeader\">(Eventuella resuser för redovisning av modulen samt för modulen som helhet)</p>\n      <EditableResourceList\n        resources={module.resources}\n        onUpdate={resourcesUpdates => updateModule({ resources: resourcesUpdates })}\n        host={host} />\n      <div style={{position: 'absolute', top: 0, right: 0}}>\n        {moduleOrderedIndex > 0 && <span>\n          <i className=\"fa fa-arrow-circle-up selectable\"\n            aria-hidden=\"true\"\n            onClick={()=>this.props.onReorder(-1)} /> </span>}\n        {moduleOrderedIndex < course.modules.length - 1 && <span>\n          <i className=\"fa fa-arrow-circle-down selectable\"\n            aria-hidden=\"true\"\n            onClick={()=>this.props.onReorder(1)} /> </span>}\n        <RemoveItem\n          title=\"Ta bort modulen\"\n          style={{display: 'inline-block'}}\n          onClick={()=>confirm(L`Ta bort modul ${module.name}?`) && host.update({modules: {$splice: [[moduleIndex, 1]]}})} />\n      </div>\n    </div>\n  }\n}\n\n","import * as React from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { Course, CourseModule, Image, Task, Document, Ability } from 'kedbackend/models';\nimport { createUUID } from 'kedbackend/client';\nimport $ from 'jquery';\nimport update from 'react-addons-update';\nimport { ICourseEditorHost } from '../interfaces/course-editor-host';\nimport { CourseModuleComponent } from './course-module';\n\ninterface Props {\n  course: Course;\n  host: ICourseEditorHost;\n  idsNotCoveredByAnyTask: {[id: string]: true};\n}\n\ninterface State {\n}\n\nexport class CourseModuleList extends React.Component<Props,State> {\n  _elem: HTMLDivElement;\n  _moduleRefs: {[moduleId: string]: CourseModuleComponent};\n\n  constructor(props: Props) {\n    super(props);\n    this._moduleRefs = {};\n    this.state = {\n    }\n  }\n\n  addModule() {\n    this.props.host.update({modules: {$push: [{\n      name: \"Ny kursmodul\",\n      id: createUUID(),\n      resources: [],\n      taskIds: []\n     } as CourseModule\n    ]}});\n  }\n\n  getOrderedModules() {\n    const { course } = this.props;\n    const moduleOrder = course.moduleOrder || course.modules.map(m => m.id);\n    return moduleOrder\n      // Map ordered id to module\n      .map(id => course.modules.find(m => m.id === id))\n      // Ignore entries that only exists in moduleOrder but not in modules\n      .filter(m => !!m)\n      // Append modules at end that are not listed in moduleOrder\n      .concat (course.modules.filter(m => !moduleOrder.find(id => m.id === id)));\n  }\n\n  async reorder (moduleId: string, direction: -1 | 1) {\n    const { course } = this.props;\n    const orderedModules = this.getOrderedModules();\n    const moduleIndex = orderedModules.findIndex(m => m.id === moduleId);\n    const newModuleIndex = moduleIndex + direction;\n    if (newModuleIndex < 0 || newModuleIndex >= orderedModules.length) {\n      // Cannot order outside limits.\n      return;\n    }\n    const currentModuleAtPosition = orderedModules[newModuleIndex];\n    const moduleOrder = orderedModules.map(m => m.id);\n    moduleOrder[newModuleIndex] = moduleId;\n    moduleOrder[moduleIndex] = currentModuleAtPosition.id;\n    const origScrollPos = document.documentElement.scrollTop;\n    await this.props.host.update({\n      moduleOrder: {$set: moduleOrder}\n    });\n    // Now, scroll smoothly into view after reordering:\n    const elemModule: HTMLElement = findDOMNode(this._moduleRefs[moduleId]);\n    if (elemModule) {\n      try {\n        window.scrollTo({top: origScrollPos}); // Prohibit default scrolling directly upwards on move up.\n        elemModule.scrollIntoView({behavior: 'smooth', block: 'start'});\n      } catch (e) {\n        // Only Chrome beta supports the arguments given above. Default for older browsers.\n        window.scrollTo(null, origScrollPos);\n        elemModule.scrollIntoView(true);\n      }\n    }\n  }\n\n  render() {\n    const { course, host, idsNotCoveredByAnyTask} = this.props;\n    const moduleOrder = course.moduleOrder || course.modules.map(m => m.id);\n    const orderedModules = this.getOrderedModules();\n\n    return <div className=\"sv-html-portlet sv-portlet\" ref={elem => this._elem = elem}>\n      {orderedModules.map(module => <CourseModuleComponent\n        ref={elem => this._moduleRefs[module.id] = elem}\n        key={module.id}\n        course={course}\n        module={module}\n        onReorder={direction => this.reorder(module.id, direction)}\n        getOrderedModules={()=>this.getOrderedModules()}\n        host={host}\n        idsNotCoveredByAnyTask={idsNotCoveredByAnyTask}\n       />)}\n      <div className=\"btn btn-large\" onClick={()=>this.addModule()}>\n        Lägg till kursmodul\n      </div>\n    </div>\n  }\n}\n\n","import { Repo, RepoCommunicator } from './repo';\nimport { Course, School } from 'kedbackend/models';\nimport env from '../globals/KED.env';\nimport { flatten, L } from \"../utils/utils\";\n\nclass SchoolCoursesRepo extends Repo<Course> {\n  private _schoolId: string;\n  getSchoolId() {\n    return this.ensureHasData().then(()=>this._schoolId);\n  }\n\n  constructor(getSchoolName: ()=>string) {\n    super({\n      query: async () => {\n        const schoolName = getSchoolName();\n        const schools = await env.kedBackendClient.list<School>(\n          \"schools\", {\n            name: schoolName,\n            include: [\"courses\"]\n          });\n        this._schoolId = schools.length > 0 && schools[0].id;\n        if (!this._schoolId) throw new Error(L`Skolan ${schoolName} finns inte registrerad i systemet.\n          Kontakta en administratör för Kursbyggarverktyget och be om att lägga till skolan med namnet \"${schoolName}\"`);\n        return flatten(schools.map(school => school.courses));\n      }\n    })\n  }\n}\n\nexport const mySchoolCoursesRepo = new SchoolCoursesRepo(()=>env.currentUser.school);\n","import * as React from 'react';\nimport { L, showError, compareProp } from '../../../utils/utils';\nimport { Course } from \"kedbackend/models\";\nimport { mySchoolCoursesRepo } from \"../../../repos/school-courses\";\nimport { Spinner } from \"./spinner\";\nimport { Link } from 'react-router-dom';\nimport { shortDateFormat } from \"../utils\";\n\ninterface Props {\n}\n\ninterface State {\n  schoolCourses: Course[] | null;\n}\n\nexport class SchoolCourses extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      schoolCourses: null\n    }\n    this.onSchoolCoursesUpdated = this.onSchoolCoursesUpdated.bind(this);\n  }\n\n  componentDidMount() {\n    mySchoolCoursesRepo.subscribe(this.onSchoolCoursesUpdated).catch(showError);\n  }\n\n  componentWillUnmount() {\n    mySchoolCoursesRepo.unsubscribe(this.onSchoolCoursesUpdated);\n  }\n\n  onSchoolCoursesUpdated(schoolCourses: Course[]) {\n    const compareName = compareProp(\"name\");\n    const compareCreatedDate = compareProp(\"createdDate\");\n    schoolCourses.sort((a,b) => compareName(a,b) || compareCreatedDate(a,b));\n    this.setState({schoolCourses});\n  }\n\n  render() {\n    const {schoolCourses} = this.state;\n    return <div className=\"sv-html-portlet sv-portlet sv-skip-spacer\">\n      <div className=\"ked_boxed\">\n        <h3>Skolans kurser</h3>\n        <div className=\"taskContainer odd-even\">\n          {!schoolCourses ?\n            <p><Spinner /> Laddar skolans kurser</p> :\n            schoolCourses.map(course => <div className=\"schoolCourse\" key={course.id}>\n            <div className=\"align-horizontal\">\n              <div className=\"horizontalItem top pull-right\">\n                <Link\n                  to={`/courses/${course.id}/edit`}\n                  className=\"editItem\"\n                />\n              </div>\n              <div className=\"horizontalItem top\">\n                <Link to={`/courses/${course.id}/edit`}>{course.name}</Link></div>\n              <div className=\"horizontalItem top\">\n                {course.active && <div className=\"pill active\">Aktiv</div>}\n              </div>\n              {course.active && !course.publishable && <div className=\"horizontalItem top\">\n                <div className=\"pill incomplete\">Inkomplett</div>\n              </div>}\n            </div>\n            <div className=\"horizontalItem top\">\n              <p>{course.description}</p>\n            </div>\n            <div className=\"horizontalItem top\">\n              {course.modifiedBy ?\n                <p className=\"small\">Redigerad av {course.modifiedBy.name} / {shortDateFormat(course.modifiedDate)}</p> :\n                <p className=\"small\" style={{fontStyle: 'italic'}}> </p>}\n            </div>\n          </div>)}\n        </div>\n        {location.hash !== \"#/courses/new\" && <Link\n          className=\"btn\"\n          to=\"/courses/new\"\n          onClick={()=>window.scroll(0, 0)}>\n          Skapa ny kurs\n        </Link>}\n      </div>\n    </div>\n  }\n}\n","import { Document, Course, KnowledgeRequirement, CourseModule, Task } from 'kedbackend/models';\nimport { flatten, L } from \"../../../utils/utils\";\n\nexport function getUncoveredKnowledgeRequirements(course: Course) {\n  const uncoveredRequirements = course.knowledgeRequirements.reduce((result, item) => {\n    result[item.id] = item;\n    return result;\n  }, {} as { [id: string]: KnowledgeRequirement });\n\n  course.tasks.forEach(task => {\n    task.knowledgeRequirements.forEach(kr => {\n      delete uncoveredRequirements[kr.id];\n    });\n  });\n\n  return Object.keys(uncoveredRequirements).map(id => uncoveredRequirements[id]);\n}\n\nexport function getIdsNotCoveredByTasks(course: Course) : {[id: string]: true} {\n  const uncoveredIds = {};\n  // 1. Mark the ids of all knowledge requirements, abilities and central content for this course:\n  course.knowledgeRequirements.forEach(r => {\n    uncoveredIds[r.id] = true;\n  });\n  course.abilities.forEach(a => {\n    uncoveredIds[a.id] = true;\n  });\n  course.centralContent.forEach(cc => {\n    uncoveredIds[cc.id] = true;\n  });\n  // 2. List all tasks and unmark all ids that they refer to\n  const { tasks } = course;\n  tasks.forEach(task => {\n    task.knowledgeRequirements.forEach(kr => {\n      delete uncoveredIds[kr.id];\n    });\n    task.abilities.forEach(a => {\n      delete uncoveredIds[a.id];\n    });\n    task.centralContent.forEach(cc => {\n      delete uncoveredIds[cc.id];\n    });\n  });\n  return uncoveredIds;\n}\n\nexport function sanityCheck (course: Course) {\n  function hasDuplicateTasks(course: Course) {\n    const taskIds: {[id:string]: boolean} = {};\n    return flatten(course.modules.map(module => module.taskIds.map(taskId => {\n      if (taskIds[taskId]) {\n        const task = course.tasks.find(t => t.id === taskId);\n        return L`Samma uppgift förekommer flera gånger: \"${task.name}\"`;\n      }\n      taskIds[taskId] = true;\n    }).filter(x => x)));\n  }\n\n  function tasksWithSameUrl(course: Course) {\n    const taskUrls: {[url:string]: Task} = {};\n    return course.tasks.map(task => {\n      if (task.url) {\n        if (taskUrls[task.url]) {\n          return L`Två uppgifter pekar på samma URL: \"${taskUrls[task.url].name}\" samt \"${task.name}\"`;\n        }\n        taskUrls[task.url] = task;\n      }\n    }).filter(x => x);  \n  }\n\n  function hasEmptyModuleNames(course: Course) {\n    return course.modules.some (module => module.name === \"\") &&\n      L`Det finns minst en modul utan angivet namn`;\n  }\n\n  function hasDuplicateModuleNames(course: Course) {\n    const moduleNames: {[name: string]: true} = {};\n    return course.modules.map(module => {\n      if (module.name && moduleNames[module.name]) {\n        return L`Modulen med namn ${module.name} förekommer flera gånger`;\n      }\n      if (module.name) moduleNames[module.name] = true;\n    })\n  }\n\n  const checks = flatten([\n    hasDuplicateTasks(course),\n    tasksWithSameUrl(course),\n    hasEmptyModuleNames(course),\n    hasDuplicateModuleNames(course)\n  ]);\n\n  return checks.filter (result => result);\n}\n\n\nexport function getTasksPerId (course: Course) {\n  const result: {[id: string]: Task[]} = {};\n  function add(id: string, task: Task) {\n    const list = result[id] || (result[id] = []);\n    list.push(task);\n  }\n  course.tasks.forEach(task => {\n    task.abilities.forEach(a => add(a.id, task));\n    task.centralContent.forEach(c => add(c.id, task));\n    task.futureAbilities.forEach(fa => add(fa, task));\n  });\n  return result;\n}\n","import * as React from 'react';\nimport { Resource } from 'kedbackend/models';\nimport { RemoveItem } from \"./remove-item\";\n\ninterface Props {\n  teachers: Resource[];\n  onUpdate: (teachersUpdates) => void;\n}\n\ninterface State {\n  addEmtpyRow: boolean;\n}\n\nexport class EditableTeacherList extends React.Component<Props,State> {\n  nameElem: HTMLInputElement;\n\n  constructor(props: Props) {\n    super(props);\n    this.state={addEmtpyRow: props.teachers.length === 0};\n  }\n\n  render() {\n    let {teachers, onUpdate} = this.props;\n    const {addEmtpyRow} = this.state;\n    if (addEmtpyRow) teachers = teachers.concat({name: \"\", url: \"\"});\n\n    return <div className=\"teachers-list\">\n      <h3>Ansvariga lärare</h3>\n      <table tabIndex={1} style={{width: \"100%\"}} onBlur={ev=>\n        (!ev.relatedTarget ||\n        (ev.relatedTarget as any).tagName !== 'INPUT') &&\n        this.props.teachers.length > 0 &&\n        this.setState({addEmtpyRow: false})\n      }>\n        <thead>\n          {teachers.length > 0 && <tr>\n            <th style={{width: \"20%\"}}>Namn</th>\n            <th>Länk eller E-postadress</th>\n          </tr>}\n        </thead>\n        <tbody>\n          {teachers.map((teacher, idx) => \n          <tr key={idx}>\n            <td><input type=\"text\" ref={elem => this.nameElem = elem} value={teacher.name} autoFocus={!teacher.name && idx > 0} onChange={\n              ev=>{\n                if (addEmtpyRow && idx == teachers.length - 1) {\n                  onUpdate({$push: [{...teacher, name: ev.target.value}] });\n                  this.setState({addEmtpyRow: false});\n                } else if (ev.target.value || teacher.url) {\n                  onUpdate({$splice: [[idx, 1, {...teacher, name: ev.target.value}]] });\n                } else {\n                  if (this.props.teachers.length === 1)\n                    this.setState({addEmtpyRow: true});\n                  onUpdate({$splice: [[idx, 1]]});\n                }\n              }\n            }/></td>\n            <td><input\n              type=\"text\"\n              style={{width: \"100%\"}}\n              value={teacher.url}\n              onKeyDown={ev =>\n                ev.which === 9 &&\n                !ev.shiftKey &&\n                idx === teachers.length - 1 &&\n                (teachers.length < 1 || !!teachers[teachers.length - 1].name &&\n                  (this.setState({addEmtpyRow: true}),ev.preventDefault()))}\n              onChange={ev => {\n                if (addEmtpyRow && idx == teachers.length - 1) {\n                  onUpdate({$push: [{...teacher, url: ev.target.value}]})\n                  this.setState({addEmtpyRow: false});\n                } else if (ev.target.value || teacher.name) {\n                  onUpdate({$splice: [[idx, 1, {...teacher, url: ev.target.value}]]});\n                } else {\n                  if (this.props.teachers.length === 1)\n                    this.setState({addEmtpyRow: true});\n                  onUpdate({$splice: [[idx, 1]]});\n                }\n              }\n              \n            }/></td>\n          </tr>)}\n        </tbody>\n      </table>\n      <br/>\n      <a className=\"btn\" onClick={() =>\n        this.state.addEmtpyRow ?\n          this.nameElem.focus() :\n          this.setState({addEmtpyRow: true})}>\n            <i className=\"fa fa-user-plus\" aria-hidden /> Lägg till ansvarig lärare</a>\n    </div>\n  }\n}","import * as React from 'react';\nimport { Course } from 'kedbackend/models';\nimport { getTasksPerId } from \"../courses/business-logic\";\nimport { futureAbilities } from \"../../../contracts/ked-models\";\nimport { OpenCloseBox } from \"../../utility-components/open-close-box\";\n\ninterface Props {\n  course: Course;\n}\n\ninterface State {\n  isOpen: boolean;\n}\n\nexport class WeightedItemsTable extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      isOpen: false\n    };\n  }\n\n  render() {\n    const { course } = this.props;\n    const { isOpen } = this.state;\n    const rows = [];\n    const tasksPerId = getTasksPerId(course);\n\n    rows.push(<tr key=\"centralContent\" className=\"covered-item-label\"><td colSpan={2}>Centralt innehåll</td></tr>);\n    course.centralContent.forEach((cc,idx) => rows.push(<tr key={cc.id} className={idx % 2 ? \"tableOdd\" : \"\"}>\n      <td><p className=\"criteriaText\" dangerouslySetInnerHTML={{__html: cc.name}}/></td>\n      <td><p>{(tasksPerId[cc.id] || []).length}</p></td>\n    </tr>));\n\n    rows.push(<tr key=\"abilities\" className=\"covered-item-label\"><td colSpan={2}>Förmågor</td></tr>);\n    course.abilities.forEach((ability,idx) => rows.push(<tr key={ability.id} className={idx % 2 ? \"tableOdd\" : \"\"}>\n      <td><p className=\"abilityText\" dangerouslySetInnerHTML={{__html: ability.name}}/></td>\n      <td><p>{(tasksPerId[ability.id] || []).length}</p></td>\n    </tr>));\n\n    rows.push(<tr key=\"futureAbilities\" className=\"covered-item-label\"><td colSpan={2}>Framtidsförmågor</td></tr>);\n     futureAbilities.forEach((futureAbilityText, idx) => rows.push(<tr key={futureAbilityText} className={idx % 2 ? \"tableOdd\" : \"\"}>\n      <td><p className=\"abilityText\">{futureAbilityText}</p></td>\n      <td><p>{(tasksPerId[futureAbilityText] || []).length}</p></td>\n    </tr>));\n\n    return <OpenCloseBox\n      className=\"larger\"\n      title={<p>Kursens täckningstabell</p>}\n      contentClassName=\"weighted-items-table\">\n        <p>Tabellen anger hur många uppgifter som berör varje del.</p>\n        <table><tbody>{rows}</tbody></table>\n    </OpenCloseBox>\n  }\n}","import * as React from 'react';\nimport { L } from '../../../utils/utils';\nimport { Resource } from 'kedbackend/models';\nimport { Dialog } from '../interfaces/course-editor-host';\nimport validUrl from 'valid-url';\n\ninterface Props {\n  url?: string;\n  onSave: (newUrl: string) => void;\n  onDelete?: ()=>void;\n}\n\ninterface State {\n  url: string;\n}\n\nexport class EditWorkflowLink extends React.Component<Props,State> implements Dialog {\n  constructor(props: Props) {\n    super(props);\n    this.state = {url: this.props.url || ''};\n  }\n\n  save() {\n    const {url} = this.state;\n    if (!validUrl.isUri(url)) throw new Error(L`Angiven URL '${url}' är ogiltig. Ska börja med http: eller https:`);\n    this.props.onSave(url);\n  }\n\n  render() {\n    const {onSave, onDelete} = this.props;\n    const state = this.state;\n    const isValidUrl = validUrl.isUri(this.state.url);\n\n    return <div><div className=\"sv-html-portlet sv-portlet sv-skip-spacer\">\n      <h2>Koppla en arbetsgång till kursen</h2>\n      <p>Det går bara att lägga in en arbetsgång per kurs.</p>\n      <br />\n      <div className=\"align-horizontal\">\n        <div className=\"horizontalItem top\">Länk:</div>\n        <div className=\"horizontalItem top \">\n          <input type=\"text\"\n            tabIndex={1}\n            size={50}\n            value={state.url}\n            onChange={ev=>this.setState({url: ev.target.value})} />\n        </div>\n        <div className=\"horizontalItem top spaced\"></div>\n      </div>\n      <br /></div>\n      <div className=\"sv-html-portlet sv-portlet\" id=\"svid12_492422d515badf36646e4ff1\">\n        {onDelete && <div tabIndex={2} className=\"btn btn-warning btn-large pull-right\" onClick={()=>onDelete()}>\n          Ta bort arbetsgång\n        </div>}\n        <a\n          tabIndex={1}\n          className={\"btn btn-large\" + (isValidUrl ? \"\" : \" btn-inactive\")}\n          onClick={isValidUrl && (() => onSave(state.url))}>Spara</a>\n      </div>\n    </div>\n  }\n}\n","import * as React from 'react';\nimport {Resource} from 'kedbackend/models';\nimport {Link} from 'react-router-dom';\nimport {ICourseEditorHost} from '../interfaces/course-editor-host';\nimport {EditResource} from '../modal-pages/edit-resource';\nimport { updateModificationAndCreationStamps } from '../utils';\nimport env from '../../../globals/KED.env';\nimport { EditWorkflowLink } from '../modal-pages/edit-workflow-link';\n\ninterface Props {\n  url: string;\n  onUpdate: (updates) => void;\n  host: ICourseEditorHost;\n}\n\nexport class EditableWorkFlowLink extends React.Component<Props> {\n  constructor(props: Props) {\n    super(props);\n    this.state={};\n  }\n\n  render() {\n    const {host, onUpdate, url} = this.props;\n    return <div>\n      <div className=\"taskContainer\">\n        {url &&\n          <div className=\"align-horizontal\">\n            <div className=\"horizontalItem top\">\n              <a className=\"editItem\" onClick={()=>host.openDialog({\n                Component: EditWorkflowLink,\n                props: {\n                  url,\n                  onSave: newUrl => {\n                    onUpdate({$set: newUrl});\n                    host.closeDialog();\n                  },\n                  onDelete: ()=>{\n                    onUpdate({$set: undefined});\n                    host.closeDialog();\n                  }\n                }\n              })}></a>\n            </div>\n            <div className=\"horizontalItem top\">\n              <a href={url} target=\"_blank\" >Nuvarande arbetsgång</a>\n            </div>\n          </div>\n        }\n     </div>\n    {!url && <a className=\"btn\" onClick={()=>host.openDialog({\n      Component: EditWorkflowLink,\n      props: {\n        onSave: newUrl => {\n          onUpdate({$set: newUrl})\n          host.closeDialog();\n        }\n      }\n    })}><i className=\"fa fa-paperclip\" aria-hidden></i> Koppla en arbetsgång till kursen</a>}\n    </div>\n  }\n}\n","import * as React from 'react';\nimport { Course, Ability, Subject } from 'kedbackend/models';\nimport { EditableResourceList } from '../sub-components/editable-resource-list';\nimport { dtFormat } from '../utils';\nimport { CourseModuleList } from './course-module-list';\nimport { SchoolCourses } from '../sub-components/school-courses';\nimport { ICourseEditorHost } from '../interfaces/course-editor-host';\nimport { getUncoveredKnowledgeRequirements, sanityCheck, getIdsNotCoveredByTasks } from './business-logic';\nimport { setCourseImage } from \"./course-banner\";\nimport { Courses } from \"./index\";\nimport { ListCourseTemplates } from \"./list-course-templates\";\nimport { Spinner } from '../sub-components/spinner';\nimport { EditableTeacherList } from '../sub-components/editable-teacher-list';\nimport { showError, L } from \"../../../utils/utils\";\nimport { WeightedItemsTable } from '../sub-components/weighted-items-table';\nimport { Wysiwyg } from '../../utility-components/wysiwyg/index';\nimport actions_swedish from '../../utility-components/wysiwyg/actions-sv';\nimport { EditableWorkFlowLink } from '../sub-components/editable-workflow-link';\nimport { RenameableText } from '../../utility-components/renameable-text';\n\ninterface Props {\n  course: Course;\n  origCourse: Course;\n  host: ICourseEditorHost;\n};\n\ninterface State {\n  changeImageUrl: boolean;\n}\n\nexport class InnerEditCourse extends React.Component<Props,State> {\n  props: Props;\n  state: State;\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      changeImageUrl: false\n    };\n  }\n\n  setImageUrl(imageUrl: string) {\n    const { course } = this.props;\n    if (!course.imageId) {\n\n    }\n  }\n\n  render() {\n    const { course, origCourse, host } = this.props;\n    const uncoveredKnowledgeRequirements = getUncoveredKnowledgeRequirements(course);\n    const idsNotCoveredByAnyTask = getIdsNotCoveredByTasks(course);\n    const sanityCheckWarnings = sanityCheck(course);\n    const courseImage = course.images.find(img => img.id === course.imageId);\n    const courseImageIsUploaded = courseImage && courseImage.url.startsWith('data:');\n\n    return <div className=\"sv-row sv-layout sv-skip-spacer\">\n      <div className={\"sv-layout sv-skip-spacer sv-column-7\"}>\n        <div className=\"sv-html-portlet sv-portlet sv-skip-spacer\">\n          {course.isTemplate && <h1>Kursmall</h1> }\n          <h2>Kursövergripande</h2>\n          <hr />\n          <div className=\"ked_boxed\">\n            <div>\n              <h3>Kursens bild</h3>\n              {courseImageIsUploaded ?\n                <p>Kursens bild ligger i databasen. För att ändra bild måste du dra och släppa en ny bild ovanpå den gamla högst upp på denna sida.\n                  Bilden kan antingen vara från en annan webbsida. Lokala bildfiler går också bra att dra och släppa.</p>\n                 : courseImage ? <div><textarea\n                  value={courseImage.url}\n                  style={{width: '100%', height: '30px'}}\n                  onChange={ev=>setCourseImage(course, origCourse, host, ev.target.value)}/>\n                  <p>Bilden som visas högst upp hämtas från angiven URL.\n                    För att ändra bild kan du redigera URL ovan. Ett annat sätt att ändra bild är att dra och släppa en ny bild över den gamla högst upp på sidan.</p>\n                </div> :\n                  <p>Kursen saknar egen bild.\n                    Lägg till en bild genom att dra och släppa en bild på kurs-bannern högst upp på den här sidan.</p>}\n              <br/>\n            </div>\n\n            {!course.isTemplate && <div>\n              <h3>Beskrivning</h3>\n              <p className=\"subHeader\">(Beskrivning av kursen. För att skilja mellan olika varianter av samma gymnasiekurs)</p>\n              <textarea className=\"inputTextBox inputTextSmall\"\n                value={course.description}\n                onChange={ev => host.update({ description: { $set: ev.target.value } })} />\n              <br />\n            </div>}            \n\n            <div>\n              <h3>Upptaktstext</h3>\n              <p className=\"subHeader\">(texten ska visas på kursens upptaktssektion)</p>\n              <Wysiwyg\n                html={course.runUpText}\n                defaultActions={actions_swedish}\n                actions={[\n                  \"bold\",\n                  \"italic\",\n                  \"underline\",\n                  \"strikethrough\",\n                  \"heading2\",\n                  \"heading3\",\n                  \"olist\",\n                  \"ulist\",\n                  \"line\",\n                  \"link\",\n                  \"image\"]}\n                onChange={newHtml => host.update({ runUpText: {$set: newHtml}})} />\n              <br />\n            </div>\n\n            <h3>Kursresurser</h3>\n            <p className=\"subHeader\">(Resurser för upptakt och kursen som helhet)</p>\n            <EditableResourceList\n              resources={course.resources}\n              onUpdate={resourcesUpdates => host.update({ resources: resourcesUpdates })}\n              host={host} />\n            <br />\n            <h3>Arbetsgång</h3>\n            <p className=\"subHeader\">(Eventuell länk till arbetsgång för kursen)</p>\n            <EditableWorkFlowLink\n              url={course.workFlowLink}\n              onUpdate={updates => host.update({ workFlowLink: updates })}\n              host={host} />\n            <br />\n            {!course.isTemplate && <div>\n              <h3>Google Classroom</h3>\n              <div className=\"align-horizontal spaced\">\n                <div className=\"horizontalItem top\">\n                  <input\n                    placeholder=\"Google classroom URL\"\n                    type=\"text\"\n                    size={30}\n                    value={course.googleClassRoomURL}\n                    onChange={ev => host.update({googleClassRoomURL: {$set: ev.target.value}})}/>\n                </div>\n                <div className=\"horizontalItem top\">\n                  <input\n                    placeholder=\"kod\"\n                    type=\"text\"\n                    size={8}\n                    value={course.googleClassRoomCode}\n                    onChange={ev => host.update({googleClassRoomCode: {$set: ev.target.value}})} />\n                </div>\n              </div>\n            </div>}\n\n            <br />\n            {!course.isTemplate && <><EditableTeacherList \n              teachers={course.responsibleTeachers}\n              onUpdate={teachersUpdate => {\n                host.update({responsibleTeachers: teachersUpdate});\n              }} />\n            <br />\n            <h3>Inlämnings E-post</h3>\n            <table tabIndex={1} style={{width: '100%'}}>\n              <thead><tr><th>\n                E-postaddress\n              </th></tr></thead>\n              <tbody>\n                <tr>\n                  <td>\n                    <RenameableText\n                      eager={true}\n                      clickAdvertiseText=\"Klicka här för att ange vem som tar emot inlämningsuppgifter\"\n                      text={course.assignmentEmails ? course.assignmentEmails[0] : \"\"}\n                      placeholder=\"Ange mottagare av inlämningsuppgifter\"\n                      tag=\"input\"\n                      onChange={value => host.update({assignmentEmails: {$set: [value]}})}\n                    />\n                  </td>\n                </tr>\n              </tbody>\n            </table>\n            </>}\n\n          </div>\n          <div className=\"sv-html-portlet sv-portlet\" id=\"svid12_6ab4811f15b13c706b43bb47\">\n            <div id=\"Kursensmoduler\">\n            </div>\n            <h2>Kursens moduler</h2>\n            <hr />\n          </div>\n          <CourseModuleList\n            host={host}\n            course={course}\n            idsNotCoveredByAnyTask={idsNotCoveredByAnyTask} />\n          \n          <div>\n            <br/>\n            <WeightedItemsTable course={course}/>\n          </div>\n\n          <div className=\"sv-html-portlet sv-portlet\">\n            <h2>Kursens status</h2>\n            <hr />\n            {course.createdBy && course.createdDate && <p>\n              Kursen skapades {dtFormat(course.createdDate)} av <strong>{course.createdBy.name}</strong>.\n            </p>}\n            {course.modifiedBy && course.modifiedDate && <p>\n              Kursen redigerades senast {dtFormat(course.modifiedDate)} av <strong>{course.modifiedBy.name}</strong>.\n            </p>}\n            {course.active ? <p>\n              Kursen är <strong>AKTIV</strong> sedan {dtFormat(course.activatedDate)} av <strong>{course.activatedBy.name}</strong>.\n            </p> : <p>\n                Kursen är <strong>INAKTIV</strong>{course.inactivatedBy ? <span>\n                  sedan {dtFormat(course.inactivatedDate)} av <strong>{course.inactivatedBy.name}</strong>.</span> : <span>.</span>\n                }\n              </p>}\n            {(uncoveredKnowledgeRequirements.length === 0 ?\n              <p className=\"markedGreen\">Modulernas kunskapskrav täcker skolverkets krav för denna kurs</p> :\n              <div className=\"markedRed warning-box\"><div className=\"warningFlag\">\n                <i className=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i>\n              </div><p>Modulernas kunskapskrav täcker inte skolverkets krav för denna kurs.</p>\n              </div>)}\n            {sanityCheckWarnings.map(warning => <div key={warning} className=\"markedRed warning-box\"><div className=\"warningFlag\">\n                <i className=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i>\n              </div><p>{warning}</p></div>)}\n            <br />\n            {!course.isTemplate && (origCourse ? <div\n              className=\"btn btn-warning btn-large pull-right\"\n              onClick={()=>{\n                if (confirm(L`Bekräfta borttagning av kursen \"${course.name} - ${course.description}\" för skolan ${course.school}\\n\\nKursen kommar att raderas helt!\\n\\nÄr du säker?`))\n                  host.deleteCourse().catch(showError);\n              }}\n            >Ta bort kurs</div>:<div\n              className=\"btn btn-warning btn-large pull-right\"\n              onClick={()=>history.go(-1)}\n            >Avbryt\n              </div>)}\n            <div className=\"btn btn-large\" onClick={() => host.save()}>\n              Spara\n            </div>\n            {course.active ?\n              <div className=\"btn btn-info btn-large\"\n                onClick={() => host.inactivateAndSave()}>\n                Inaktivera och spara\n              </div> :\n              <div className=\"btn btn-info btn-large\"\n                onClick={() => host.activateAndSave()}>\n                Aktivera och spara\n              </div>}\n          </div>\n        </div>\n      </div>\n      <div className=\"sv-layout sv-column-5\">\n        <SchoolCourses />\n      </div>\n    </div>\n  }\n}","import * as React from 'react';\nimport { findDOMNode } from 'react-dom';\nimport { L, showInfo, showError, flatten, compareProp } from '../../../utils/utils';\nimport { Course, Resource, KnowledgeRequirement, Subject, Ability, Task, School } from 'kedbackend/models';\nimport { BatchRunner, HttpError, createUUID } from 'kedbackend/client';\nimport env from '../../../globals/KED.env';\nimport { CourseBanner } from './course-banner';\nimport { InnerEditCourse } from './inner-edit-course';\nimport moment from 'moment';\nimport update from 'react-addons-update';\nimport { updateDocumentGraphs, applyEtags, updateCourseBuilderStatus, loadCourse, updateModificationAndCreationStamps, updateCreationStamp, updateModificationStamp } from '../utils';\nimport { ICourseEditorHost, Dialog, DialogContainer } from '../interfaces/course-editor-host';\nimport { RemoveItem } from '../sub-components/remove-item';\nimport $ from 'jquery';\nimport { getUncoveredKnowledgeRequirements, getIdsNotCoveredByTasks } from './business-logic';\nimport cfg from '../../../globals/KED.cfg';\nimport { Spinner } from \"../sub-components/spinner\";\nimport { mySchoolCoursesRepo } from '../../../repos/school-courses';\nimport { preserveImpersonationQuery } from \"../../../access-control\";\n\nconst catcher = cfg.ENVIRONMENT === 'production' ?\n  showError : null;\n\ninterface Props {\n  id?: string;\n  subjectId?: string;\n  isTemplate?: boolean;\n  templateId?: string;\n  view?: 'studentPage' | 'courseBuilder' | 'templateBuilder';\n  viewCourseUrl: string;\n  feedbackUrl: string;\n}\n\ninterface State {\n  origCourse: Course | null;\n  origTemplate: Course | null;\n  course: Course;\n  allCourses?: Course[];\n  dialogContainers: DialogContainer[]; // When editing items, it may show as a dialog\n  hasUnsavedData: boolean;\n  view: 'studentPage' | 'courseBuilder' | 'templateBuilder';\n}\n\nconst CONFIRM_NAVIGATE_MESSAGE =\n  L`Du har osparat data. Välj avbryt och tryck CTRL+S om du vill spara först.`;\n  \nconst DEFAULT_STATE: State = {\n  origCourse: null,\n  origTemplate: null,\n  course: null,\n  dialogContainers: [],\n  hasUnsavedData: false,\n  view: 'courseBuilder'\n};\n\nexport class EditCourse extends React.Component<Props,State> implements ICourseEditorHost {\n  pageYOffset: number;\n  contentDiv: HTMLDivElement;\n  contentYPos: number;\n  isSaving: boolean;\n  dialogs: Dialog[];\n\n  setStatePromised (state: Partial<State>) : Promise<any> {\n    return this._setState({hasUnsavedData: true, ...state});\n  }\n\n  setNonSaveableDataState (state: Partial<State>) : Promise<any> {\n    return this._setState(state);\n  }\n\n  _setState (state: Partial<State>) : Promise<any> {\n    if (state.course) {\n      {\n        //\n        // Maintain course task links (remove links to tasks that are not used\n        // by any module)\n        //\n        const {tasks, modules} = state.course;\n        const usedTaskIds = {};\n        modules.forEach(module => module.taskIds.forEach(id => usedTaskIds[id] = true));\n        const filteredCourseTasks = tasks.filter(t => usedTaskIds[t.id]);\n        const modifiedCourse = {...state.course};\n        modifiedCourse.tasks = filteredCourseTasks;\n        state = {...state, course: modifiedCourse};\n      }\n    }\n\n    // Invoke our course into state property allCourses so that the\n    // right-hand side list of courses gets update immediately with\n    // the publishable state of this course.\n    let allCourses = state.allCourses || this.state.allCourses;\n    const course = state.course || this.state.course;\n    if (allCourses) {\n      const idxOurCourse = allCourses.findIndex(c => c.id === this.props.id);\n      allCourses = update(allCourses, {$splice: [[idxOurCourse, 1, course]]});\n      state = {...state};\n      state.allCourses = allCourses;\n    }\n\n    return new Promise(resolve => super.setState(()=>state as State, resolve));\n  }\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {...DEFAULT_STATE};\n    this.update = this.update.bind(this);\n    this.refDialog = this.refDialog.bind(this);\n    this.contentYPos = 0;\n    this.onKeyDown = this.onKeyDown.bind(this);\n    this.beforeUnload = this.beforeUnload.bind(this);\n    this.onClickPreventUnload = this.onClickPreventUnload.bind(this);\n    this.isSaving = false;\n    this.dialogs = [];\n    if (props.view) this.state = {\n      ...this.state,\n      view: props.view\n    };\n  }\n\n  componentWillMount() {\n    this.load().catch(catcher);\n    window.addEventListener('keydown', this.onKeyDown);\n    window.addEventListener('beforeunload', this.beforeUnload);\n    document.body.addEventListener('click', this.onClickPreventUnload);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('keydown', this.onKeyDown);\n    window.removeEventListener('beforeunload', this.beforeUnload);\n    document.body.removeEventListener('click', this.onClickPreventUnload);\n    updateCourseBuilderStatus('');\n  }\n\n  componentWillReceiveProps(nextProps: Props) {\n    if (this.state && this.state.course) {\n      if (nextProps.id !== this.props.id || nextProps.templateId !== this.props.templateId) {\n        this.setStatePromised(DEFAULT_STATE);\n      }\n    }\n    if (nextProps.view !== this.props.view) {\n      this.setNonSaveableDataState({view: nextProps.view});\n    }\n  }\n\n  componentDidUpdate(prevProps: Props, prevState: State) {\n    if (this.contentDiv) {\n      const contentDiv: HTMLDivElement = findDOMNode(this.contentDiv);\n      if (contentDiv) {\n        this.contentYPos = contentDiv.getBoundingClientRect().top;\n      }\n    }\n\n    if (prevState && prevState.course) {\n      // This was not the initial update.\n      // If props have been updated to point out another course or template, reset component:\n      if (this.props.id !== prevProps.id || this.props.templateId !== prevProps.templateId) {\n        this.load().catch(catcher);\n      }\n    }\n\n    if (!prevState.hasUnsavedData && this.state.hasUnsavedData) {\n      updateCourseBuilderStatus('unsaved');\n    }\n  }\n\n  async loadFromTemplate(templateId: string) {\n    showInfo(\"Laddar data från mall...\");\n    const template = await loadCourse(templateId, {includeTemplateChain: true});\n    const course = updateCreationStamp(Date.now(), template, env.currentUser);\n    course.id = createUUID();\n    course.parentId = templateId;\n    course.active = false;\n    course.isTemplate = false;\n    course.templateChain = [...course.templateChain];\n    course.templateChain.push({id: templateId, $meta: 'ref'} as Course);\n    const mySchool = env.currentUser.school;\n    course.school = mySchool;\n    course.description = \"\";\n    course.responsibleTeachers = [];\n    course.acl = [\n      \"role:USER:R\", // All users may view it. (Could have restricted it to school, but not nescessary!)\n      `schoolRole:${mySchool}/EMPLOYEE:S` // Other teachers at same school should be able to modify the course.\n    ];\n    delete course.$etag;\n    delete course.createdBy;\n    delete course.createdDate;\n    delete course.modifiedBy;\n    delete course.modifiedDate;\n    delete course.activatedBy;\n    delete course.activatedDate;\n    delete course.googleClassRoomCode;\n    delete course.googleClassRoomURL;\n    await this.setStatePromised({ course, origCourse: null, origTemplate: template });\n    showInfo(\"\");\n  }\n\n  async load() {\n    updateCourseBuilderStatus('');\n    if (this.props.id) {\n      await this.loadExistingCourse(this.props.id);\n    } else if (this.props.templateId) {\n      await this.loadFromTemplate(this.props.templateId);\n    } else {\n      throw new Error(L`Ogiltig parameter. id eller templateId måste anges`);\n    }\n  }\n\n  async loadExistingCourse(courseId: string) {\n    showInfo(\"Laddar kurs\");\n    const course = await loadCourse(courseId);\n    if (!course.responsibleTeachers) course.responsibleTeachers = [];\n    await this.setNonSaveableDataState({ course, origCourse: course });\n    showInfo(\"\");\n  }\n\n  async update(courseUpdates) {\n    await this.setStatePromised({ course: update(this.state.course, courseUpdates) });\n  }\n\n  async deleteCourse() {\n    showInfo(\"Raderar kursen...\");\n    const courseSchool = this.state.course.school;\n    const parentId = this.state.course.parentId;\n    const courseId = this.props.id;\n\n    const children = await env.kedBackendClient.list<Course>(\"courses\", {\n      hasEdgesTo: [this.props.id]\n    });\n    const br = new BatchRunner();\n    for (const childCourse of children) {\n      /* CANNOT DO THIS. MAY NOT HAVE ACCESS! if (childCourse.parentId === courseId) {\n        // Reconnect child with my parent instead, as I will be disappearing...\n        childCourse.parentId = parentId;\n        br.put(\"courses\", childCourse);\n      }*/\n    }\n\n    br.delete(\"courses\", courseId);\n    await env.kedBackendClient.batch(br.mutationRequests);\n    if (courseSchool === env.currentUser.school) {\n      mySchoolCoursesRepo.delete(courseId);\n    }\n    showInfo(\"\");\n    location.hash = \"#/courses/new\";\n  }\n\n  async save () {\n    if (this.isSaving) return;\n    try {\n      this.isSaving = true;\n      await this._save();\n    } catch (err) {\n      let errorMessage = err && err.message ? err.message : L`Ett okänt fel har inträffat...`;\n      if (err) {\n        if (err.name === 'http409' || err.name === 'http412' || err.name === 'http404') {\n          // Conflict. Show a nicer error message:\n          errorMessage = L`Kursen har redigerad av annan användare. Ladda om sidan och gör om ändrinarna.`;\n        } else if (err.name === 'http403') {\n          if (this.state.course.isTemplate)\n            errorMessage = L`Ingen behörighet att spara kursmallen. Endast administratörer kan redigera kursmallar.`;\n          else if (this.state.course.school)\n            errorMessage = L`Ingen behörighet att spara kursen ${this.state.course.name}. Kursen kan bara redigeras av anställda på ${this.state.course.school}`;\n        }\n      }\n      showError(errorMessage);\n      updateCourseBuilderStatus('error');\n    } finally {\n      this.isSaving = false;\n    }\n  }\n\n  private async _save() {\n    const { course, origCourse, origTemplate } = this.state;\n    const doesAllTasksCoverAllRequirements = getUncoveredKnowledgeRequirements(course).length === 0;\n\n    showInfo(L`Sparar...`);\n    let modifiedCourse: Course = updateModificationStamp(Date.now(), course, env.currentUser);\n\n    const batch = new BatchRunner();\n\n    // Resolve manipulated graphs of each task and remove $meta, generate UUID etc for\n    // each added / updated task.\n    // The result of this operation is two-fold:\n    //  1) Remove $meta and create id for each task. To be reflected into next state.\n    //  2) Generate mutation requests into 'batch' to include in the single batch request to the server.\n    const orig = origCourse || origTemplate;\n    const newCourseTasks = modifiedCourse.tasks.map(task => {\n      if (task.$meta === 'add' || task.$meta === 'update') {\n        const origTask = orig.tasks.find(t => t.id === task.id);\n        return updateDocumentGraphs(origTask || {}, task, \"tasks\", {\n          knowledgeRequirements: 'knowledge-requirements',\n          centralContent: 'central-content',\n          abilities: 'abilities'\n        }, batch);\n      } else {\n        const updatedTask = {...task};\n        delete updatedTask.$meta;\n        return updatedTask;\n      }\n    });\n    modifiedCourse = update(modifiedCourse, {tasks: {$set: newCourseTasks}});\n\n    modifiedCourse = updateDocumentGraphs(origCourse || {}, modifiedCourse, 'courses', {\n      templateChain: 'courses',\n      centralContent: 'central-content',\n      knowledgeRequirements: 'knowledge-requirements',\n      abilities: 'abilities',\n      images: 'images',\n      tasks: 'tasks'\n    }, batch);\n\n    modifiedCourse = {...modifiedCourse };\n    modifiedCourse.publishable = doesAllTasksCoverAllRequirements;\n    const tags = (modifiedCourse.tags || []).filter(tag => tag !== 'incomplete');\n    modifiedCourse.tags = modifiedCourse.publishable ?\n      tags : tags.concat(\"incomplete\");\n\n    if (!origCourse) {\n      // A new course should be added:\n      batch.add('courses', modifiedCourse);\n      if (course.school) {\n        const schoolId = await mySchoolCoursesRepo.getSchoolId();\n        batch.link(\"schools\", schoolId, \"courses\", course.id, \"courses\");\n        if (course.active) {\n          batch.link(\"schools\", schoolId, \"courses\", course.id, \"activeCourses\");\n        }\n      }\n    } else {\n      // An existing course should be updated:\n      batch.put('courses', modifiedCourse);\n      if (!origCourse.active && course.active) {\n        // Course was activated. Add a reference to the course on school.activeCourses.\n        const schoolId = await mySchoolCoursesRepo.getSchoolId();\n        batch.link(\"schools\", schoolId, \"courses\", course.id, \"activeCourses\");\n      } else if (origCourse.active && !course.active) {\n        // Course was inactivated. Remove from school.activeCourses.\n        const schoolId = await mySchoolCoursesRepo.getSchoolId();\n        batch.unlink(\"schools\", schoolId, \"courses\", course.id, \"activeCourses\");\n      }\n    }\n\n    // Perform the entire batch through a single POST request:\n    const res = await env.kedBackendClient.batch(batch.mutationRequests);\n    showInfo (origCourse ?\n      L`Ändringarna har sparats` :\n      L`Kursen har skapats`);\n    // Update state to reflect what has been posted:\n    if (res && res.newEtags)\n        modifiedCourse = applyEtags(modifiedCourse, res.newEtags, [\"images\", \"tasks\"]) as Course;\n    \n    if (course.school === env.currentUser.school) {\n      // Update mySchoolCoursesRepo\n      if (!origCourse) {\n        mySchoolCoursesRepo.insert(modifiedCourse);\n      } else {\n        mySchoolCoursesRepo.update(modifiedCourse);\n      }\n    }\n\n    await this.setNonSaveableDataState({course: modifiedCourse, origCourse: modifiedCourse, hasUnsavedData: false});\n    updateCourseBuilderStatus('');\n    if (!origCourse) {\n      // This was the creation of a new course. Correct the route now when the user enters an edit state:\n      location.hash = `#/courses/${modifiedCourse.id}/edit`;\n    }\n  }\n\n  activateAndSave() {\n    const course = {...this.state.course};\n    if (!course.active) {\n      /*const uncoveredRequirements = getUncoveredKnowledgeRequirements(course);\n      if (uncoveredRequirements.length > 0) \n        return showError (L`Det finns kunskapskrav som inte uppfylls av någon modul. Kan inte aktivera kursen förrän alla kunskapskrav finns med.`);\n      */\n\n      course.active = true;\n      course.activatedBy = {\n        name: env.currentUser.displayName,\n        url: \"mailto:\" +  env.currentUser.mail\n      };\n      course.activatedDate = Date.now();\n      this.setStatePromised({course})\n        .then(()=>this.save())\n        .catch(catcher);\n    }\n  }\n\n  inactivateAndSave() {\n    const course = {...this.state.course};\n    if (course.active) {\n      course.active = false;\n      course.inactivatedBy = {\n        name: env.currentUser.displayName,\n        url: \"mailto:\" +  env.currentUser.mail\n      };\n      course.inactivatedDate = Date.now();\n      this.setStatePromised({course})\n        .then(()=>this.save())\n        .catch(catcher);\n    }\n  }\n\n  openDialog(dialogContainer: DialogContainer) {\n    this.setNonSaveableDataState({dialogContainers: this.state.dialogContainers.concat(dialogContainer)});\n  }\n\n  closeDialog() {\n    const {dialogContainers} = this.state;\n    const {length} = dialogContainers;\n    length && this.setNonSaveableDataState({dialogContainers: dialogContainers.slice(0, length - 1)});\n    // Now sync the direct 'dialogs' property with the new state:\n    while (this.dialogs.length >= length) this.dialogs.pop();\n  }\n\n  refDialog(dialog: Dialog & React.Component, index: number) {\n    this.dialogs[index] = dialog; // Setting per index instead of push(). Works even if the ref attribute could be invoked multiple times.\n  }\n\n  onKeyDown (ev: KeyboardEvent) {\n    if (ev.which === 83 && (ev.ctrlKey || ev.metaKey)) { // CTRL-S\n      ev.preventDefault();\n      if (this.state.dialogContainers.length > 0) {\n        this.saveDialog();\n        return;\n      }\n      this.save();\n    } else if (ev.which === 27 && this.state.dialogContainers.length > 0) {\n      this.closeDialog();\n      ev.preventDefault();\n    } else if (ev.which === 13) {\n      const targetElem = ev.target as HTMLElement;\n      if (this.state.dialogContainers.length > 0 &&\n        targetElem.tagName !== 'TEXTAREA' &&\n        targetElem.tagName !== 'INPUT' &&\n        targetElem.tagName !== 'SELECT' &&\n        targetElem.tagName !== 'OPTION' &&\n        !targetElem.contentEditable)\n      {\n        this.saveDialog();\n      }\n    }\n  }\n\n  beforeUnload(ev: Event) {\n    if (this.state.dialogContainers.length > 0 || this.state.hasUnsavedData) {\n      if (!env.kedBackendClient.http.bearerProvider.wantsRedirect) {\n        ev.returnValue = CONFIRM_NAVIGATE_MESSAGE;\n        return ev.returnValue;\n      }\n    }\n  }\n\n  onClickPreventUnload(ev: Event) {\n    if (ev.target && (''+(ev.target as any).tagName).toLowerCase() === 'a') {\n      const a: HTMLAnchorElement = ev.target as HTMLAnchorElement;\n      if (a.href && a.getAttribute('href') !== '#' && !a.target) {\n        if (this.state.dialogContainers.length > 0 || this.state.hasUnsavedData) {\n          if (!confirm(CONFIRM_NAVIGATE_MESSAGE)) {\n            ev.preventDefault();\n            ev.stopPropagation();\n            return false;\n          }\n        }\n      }\n    }\n  }\n\n  saveDialog() {\n    if (this.state.dialogContainers.length > 0) {\n      const dialog = this.dialogs[this.state.dialogContainers.length-1]; // YES, should reference this.dialogs by length of dialogContainers. Strange yes, but leave it so!\n      dialog && dialog.save(); \n    }\n  }\n\n  render() {\n    const isAdmin = env.currentUser.roles.indexOf(\"ADMIN\") >= 0;\n    const course = this.state.course;\n    return !this.state.course ? <div style={{outline: 0}}>\n      <CourseBanner\n        title=\"\"\n        activePage={this.state.view}\n        routes={{feedback: this.props.feedbackUrl}}\n      /><p><Spinner/>V.g. vänta medan kursen laddas...</p>\n      </div> :\n      <div style={{outline: 0}}>\n      <CourseBanner\n        title={course.name + \" - \" + course.points + \"p\"}\n        activePage={this.state.view}\n        routes={{\n          studentPage: preserveImpersonationQuery(this.props.viewCourseUrl, {courseId: this.props.id}),\n          feedback: this.props.feedbackUrl\n        }}\n        host={this}\n        course={course}\n        origCourse={this.state.origCourse}\n        backgroundImage={course.images.filter(img => img.id === course.imageId).map(img=>img.url)[0]}\n        isTemplate={course.isTemplate}\n       />\n      <div className=\"sv-row sv-layout\">\n        <div className=\"sv-layout sv-skip-spacer sv-column-12\">\n          <div className=\"sv-spacer-20pxvt sv-vertical sv-layout sv-skip-spacer\">\n            <div className=\"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer\" ref={\n              div => this.contentDiv = div}>\n              <InnerEditCourse\n                course={this.state.course}\n                origCourse={this.state.origCourse}\n                host={this} />\n              <br/>\n              {this.state.dialogContainers.map(({Component, props}, i) => {\n                return <div key={i}>\n                  <div className=\"darken\">\n                  </div>\n                  <div className=\"modal-page-wrap\">\n                    <div className=\"modal-page\">\n                      <Component ref={dialog=>this.refDialog(dialog, i)} {...props} />\n                      <RemoveItem onClick={()=>this.closeDialog()} />\n                    </div>\n                  </div>\n                </div>\n              })}\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  }\n}\n","import * as React from 'react';\nimport { Course } from 'kedbackend/models';\nimport { L } from '../../../utils/utils';\nimport { Link } from 'react-router-dom';\n\nexport const ListCourseTemplates = (props: { courses: Course[], selectedCourseId? }) => {\n  const { courses } = props;\n  return <div>\n    <h2>{L`Välj kursmall att redigera: `}</h2>\n    <ul className=\"entity-list\">\n      {courses.map(({ id, name, code, publishable, points, subjectId }) =>\n        <li key={id} className={\n          (publishable ? \"complete\" : \"incomplete\") +\n          (props.selectedCourseId === id ? \" selected\" : \"\")}>\n          <Link to={`/course-templates/${subjectId}/${id}`}>{name} - {points}</Link></li>)}\n    </ul>\n  </div>\n}\n\n","import * as React from 'react';\nimport { CourseBanner } from \"./course-banner\";\nimport { L, showError, flatten, compareProp, showInfo, maxLength, capitalizeFirst } from \"../../../utils/utils\";\nimport { Course, Subject } from \"kedbackend/models\";\nimport env from '../../../globals/KED.env';\nimport { Link } from 'react-router-dom';\nimport { Spinner } from \"../sub-components/spinner\";\nimport { SchoolCourses } from \"../sub-components/school-courses\";\n\ninterface Props {\n  feedbackUrl: string;\n}\n\ninterface State {\n  courseOptions: CourseOption[];\n  selectedTemplateId: string;\n  courses: CourseOption[] | null;\n  selectedCourseId: string;\n}\n\ninterface CourseOption {\n  id: string;\n  name: string;\n}\n\nexport class CreateNewCourse extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      courseOptions: null,\n      selectedTemplateId: \"--\",\n      courses: null,\n      selectedCourseId: \"\"\n    }\n  }\n\n  componentDidMount() {\n    this.load().catch(showError);\n  }\n\n  async load() {\n    showInfo(\"Laddar kurser\");\n    const subjects = await env.kedBackendClient.list<Subject>(\"subjects\", { include: \"courseTemplates\" });\n    const courses = flatten(subjects.map(s => s.courseTemplates)).sort(compareProp(\"name\"));\n    const courseOptions: CourseOption[] =\n      [{ id: \"--\", name: \"--\" }].concat(courses);\n    showInfo(\"\");\n    this.setState({ courseOptions });\n  }\n\n  async onSelectCourse(id: string) {\n    const derivedCourses = await env.kedBackendClient.list<Course>(\"courses\", { hasEdgesTo: [id] });\n    const courseOptions = derivedCourses\n      .filter(course => course.active)\n      .map(({ id, school, description, createdBy, modifiedBy }) => {\n        if (description) description = maxLength(description, 80);\n        let descriptionOrAuthor = description ||\n          (createdBy ? `${createdBy.name}s version` :\n          modifiedBy && `${modifiedBy.name}s version`);\n        return {\n          id,\n          name: school === 'standard' ?\n            description ? `Standard - ${description}` : \"Standard\" :\n            `${school} - ${maxLength(descriptionOrAuthor, 90)}`,\n          school\n        };\n      }).sort(compareProp(\"name\"));\n    const kedStandardOptions = courseOptions.filter(option => option.school === \"standard\");\n    const teacherMade = courseOptions.filter(option => option.school !== \"standard\");\n    const courses = [\n      ...kedStandardOptions,\n      { id, name: \"Tom\" },\n      ...teacherMade];\n    this.setState({\n      courses,\n      selectedTemplateId: id,\n      selectedCourseId: courses[0].id\n    });\n  }\n\n  render() {\n    const { courseOptions, selectedTemplateId, courses, selectedCourseId } = this.state;\n    return <div style={{ outline: 0 }}>\n      <CourseBanner\n        title={L`Kursbyggaren`}\n        activePage=\"courseBuilder\"\n        routes={{feedback: this.props.feedbackUrl}}\n      />\n      <div className=\"sv-row sv-layout\">\n        <div className=\"sv-layout sv-skip-spacer sv-column-12\">\n          <div className=\"sv-spacer-20pxvt sv-vertical sv-layout sv-skip-spacer\">\n            <div className=\"pagecontent sv-layout sv-spacer-20pxvt sv-skip-spacer\">\n\n              <div className=\"sv-row sv-layout sv-skip-spacer\">\n                <div className={\"sv-layout sv-skip-spacer sv-column-7\"}>\n                  <div className=\"sv-html-portlet sv-portlet sv-skip-spacer\">\n                    <h2>Skapa ny kurs</h2>\n                    <hr />\n                    <div className=\"align-horizontal spaced\">\n                      <div className=\"horizontalItem top\">\n                        <p>Välj gymnasiekurs :</p>\n                      </div>\n                    </div>\n                    <div className=\"align-horizontal spaced\">\n                      <div className=\"horizontalItem top\">\n                        {!courseOptions ?\n                          <div><Spinner /><select disabled value=\"\"><option>--</option></select></div> :\n                          <select\n                            value={this.state.selectedTemplateId}\n                            onChange={ev => this.onSelectCourse(ev.target.value).catch(showError)}\n                          >\n                            {courseOptions.map(course =>\n                              <option key={course.id} value={course.id}>{course.name}</option>\n                            )}\n                          </select>}\n                      </div>\n                    </div>\n                    {courses && <div className=\"align-horizontal spaced\">\n                      <div className=\"horizontalItem top\">\n                        <p>Utgå från version: </p>\n                      </div>\n                    </div>}\n                    {courses && <div className=\"align-horizontal spaced\">\n                      <div className=\"horizontalItem top\">\n                        <select value={selectedCourseId} onChange={ev => this.setState({\n                          selectedCourseId: ev.target.value\n                        })}>\n                          {courses.map(course =>\n                            <option key={course.id} value={course.id}>{course.name}</option>\n                          )}\n                        </select>\n                      </div>\n                    </div>}\n                    <br /><br />\n                    {courses && selectedCourseId && <Link\n                      to={`/courses/create-from-template/${this.state.selectedCourseId}`}\n                      className=\"btn btn-large\"\n                    >Skapa</Link>}\n                  </div>\n                </div>\n                <div className=\"sv-layout sv-column-5\">\n                  <SchoolCourses />\n                </div>\n              </div>\n\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  }\n}","import * as React from 'react';\nimport { L } from '../../../utils/utils';\nimport { Course, Subject } from 'kedbackend/models';\nimport env from '../../../globals/KED.env';\nexport { EditCourse } from './edit-course';\nimport { HashRouter as Router, Route, Link, Redirect } from 'react-router-dom';\nimport { CourseBanner } from \"./course-banner\";\nimport { ListCourseTemplates } from './list-course-templates';\nimport { Spinner } from \"../sub-components/spinner\";\n\ninterface Props {\n  selectedCourseId?: string;\n  selectedCoursePublishable?: string;\n  feedbackUrl: string;\n}\n\ninterface State {\n  subjects: Subject[] | null;\n}\n\nexport class Courses extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      subjects: null\n    };\n  }\n\n  componentWillMount() {\n    this.load();\n  }\n\n  async load() {\n    const subjects = await env.kedBackendClient.list<Subject>('subjects', { include: 'standardCourses' });\n    this.setState({ subjects });\n  }\n\n  render() {\n    const courses: Course[] = [];\n    this.state.subjects && this.state.subjects.forEach(s => courses.push.apply(courses, s.standardCourses));\n    courses.sort((c1, c2) => c1.name > c2.name ? 1 : c1.name < c2.name ? -1 : 0);\n    return <div>\n      <CourseBanner\n        title={L`Kursmallar`}\n        activePage=\"templateBuilder\"\n        routes={{feedback: this.props.feedbackUrl}}\n      />\n      {!this.state.subjects ?\n        <p><Spinner />V.g. vänta medan kurser laddas</p> :\n        <ListCourseTemplates courses={courses} />}\n      </div>\n  }\n}\n","import $ from 'jquery';\n\nconst HEARTBEAT_INTERVAL = 5 * 60 * 1000; // 5 minutes.\nconst HEARTBEAT_URL = \"/4.4b4cce2a160e445593f16043.html\"; // Could be any protected resource. BUGBUG: Configurable.\n\nlet lastActivity = Date.now();\n\nexport function keepSessionAlive() {\n  setInterval(onTimeout, HEARTBEAT_INTERVAL);\n  setTimeout(()=>$('body')\n    .mousemove(onUserActive)\n    .keypress(onUserActive)\n    .scroll(onUserActive), 100);\n}\n\nfunction onUserActive() {\n  lastActivity = Date.now();\n}\n\nfunction onTimeout() {\n  const inactivityTime = Date.now() - lastActivity;\n  if (inactivityTime < HEARTBEAT_INTERVAL) {\n    heartbeat();\n  }\n}\n\nasync function heartbeat() {\n  console.log(`Sending heartbeat request to ${HEARTBEAT_URL}`);\n  try {\n    const res = await fetch(HEARTBEAT_URL, {\n      cache: 'no-cache',\n      credentials: 'same-origin'\n    });\n    console.log(`Response from ${HEARTBEAT_URL}: ${res.status} ${res.statusText}`);\n  } catch (err) {\n    console.warn(`Request to ${HEARTBEAT_URL} failed: ${err}`);\n  }\n}\n","import * as React from 'react';\nimport { L } from '../../utils/utils';\nimport { HashRouter as Router, Route, Link, Redirect } from 'react-router-dom';\nimport { ErrorSuccessFeedback } from '../../utils/error-success-feedback';\nimport { Schools } from './schools';\nimport { NewSchool } from './schools/new-school';\nimport env from '../../globals/KED.env';\n\n// Views\nimport { Subjects, ShowSubject } from './subjects';\nimport { Courses, EditCourse } from './courses';\nimport { EditSchool } from \"./schools/edit-school\";\nimport { CourseBanner } from \"./courses/course-banner\";\nimport { CreateNewCourse } from \"./courses/create-new\";\nimport { Spinner } from \"./sub-components/spinner\";\n\n// Keep Session Alive\nimport { keepSessionAlive } from '../../utils/keep-session-alive';\nkeepSessionAlive();\n\ninterface Props {\n  viewCourseUrl: string;\n  feedbackUrl: string;\n}\n\ninterface State {\n}\n\nexport class CourseBuilder extends React.Component<Props,State> {\n  constructor(props: Props) {\n    super(props);\n  }\n\n  render() {\n    const isAuthorized = env.currentUser.roles.some(role => role === \"ADMIN\" || role === \"EMPLOYEE\");\n    const isAdmin = env.currentUser.roles.some(role => role === \"ADMIN\");\n    return <div className=\"course-builder\">\n      <Router>\n        {isAuthorized ? <div>\n          <Route exact path=\"/\" render={({ match }) => isAdmin ?\n            <Schools viewCourseUrl={this.props.viewCourseUrl} feedbackUrl={this.props.feedbackUrl} /> :\n            <CreateNewCourse feedbackUrl={this.props.feedbackUrl} />} />\n          <Route exact path=\"/schools\" render={({ match }) =>\n            <Schools\n              viewCourseUrl={this.props.viewCourseUrl}\n              feedbackUrl={this.props.feedbackUrl} />} />\n          <Route exact path=\"/schools/new\" render={()=><NewSchool feedbackUrl={this.props.feedbackUrl} />} />\n          <Route exact path=\"/schools/:id/edit\" render={({ match }) => <EditSchool\n            id={match.params.id}\n            title={L`Editera skola`}\n            feedbackUrl={this.props.feedbackUrl} />} />\n          <Route exact path=\"/subjects\" render={()=><Subjects feedbackUrl={this.props.feedbackUrl} />} />\n          <Route path=\"/subjects/:id\" render={({ match }) => <ShowSubject\n            id={match.params.id}\n            feedbackUrl={this.props.feedbackUrl} />} />\n          <Route exact path=\"/courses/new\" render={()=> <CreateNewCourse\n          feedbackUrl={this.props.feedbackUrl} />} />\n          <Route path=\"/courses/create-from-template/:templateId\" render={({match}) => <EditCourse\n            templateId={match.params.templateId}\n            view=\"courseBuilder\"\n            viewCourseUrl={this.props.viewCourseUrl}\n            feedbackUrl={this.props.feedbackUrl}\n          />}/>\n          <Route path=\"/courses/:id/edit\" render={({match}) => <EditCourse\n            id={match.params.id}\n            view=\"courseBuilder\"\n            viewCourseUrl={this.props.viewCourseUrl}\n            feedbackUrl={this.props.feedbackUrl}\n          />} />\n        </div> : <div>\n            <Route path=\"/\" render={() => <div>\n              <CourseBanner title=\"Kursbyggaren\" activePage=\"courseBuilder\" routes={{feedback: this.props.feedbackUrl}} />\n              <h2>Behörighet saknas</h2>\n              <p>Detta verktyg är endast till för anställda på Kunskapsskolan.</p>\n              <h3>Användarattribut</h3>\n              <table className=\"ked_boxed\" style={{border: \"1px solid #eee\"}}>\n                <thead>\n                  <tr>\n                    <th>Attribut</th>\n                    <th>Värde</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {Object.keys(env.currentUser).map(attr => <tr key={attr}>\n                    <td>{attr}</td>\n                    <td>{env.currentUser[attr]}</td>\n                  </tr>)}\n                </tbody></table>\n            </div>} />\n          </div>}\n      </Router>\n      <ErrorSuccessFeedback />\n    </div>\n  }\n}\n","// <Initialization>\nimport './configure'; // Emulate server-side script\nimport '../global-setters/set-all'; // Client-side initialization\n// </Initialization>\n\nimport env from '../globals/KED.env';\nimport * as React from 'react';\nimport { CourseBuilder } from '../components/course-builder';\nimport { ChooseUser } from './utils/choose-user';\n\nexport default class App extends React.Component<{}> {\n  constructor(props: any) {\n    super(props);\n    if (!location.hash) location.hash = \"#/\";\n  }\n\n  render() {\n    return env.currentUser ?\n      <CourseBuilder\n        viewCourseUrl=\"courseviewer.html\"\n        feedbackUrl=\"http://svt.se/nyheter\" /> :\n      <ChooseUser />\n  }\n}\n"],"sourceRoot":""}